<?
include ("../../lib/cfg.common.php");
include ("../../config/db_info.php");

include "../../lib/class.database.php";
$dbcon	= new database($cfg["sql"]);

include "../../lib/class.common.php";
$common = new common();
?>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>" />
<title>우편번호찾기</title>
<style>
td  {font-size:12px; font-family:돋움,arial; text-decoration:none; color: #646464; font-weight:normal; line-height: 12pt;}
form{ margin : 0px;	padding : 0px;}
input{font-size:12px; border: 1px #DADCDC solid; height:20; background-color:#FFFFFF;}
select{font-size:12px; border: 1px #DADCDC solid; background-color:#FFFFFF;}
img{border:0px}
a:link{color:#646464;text-decoration:none}
a:visited{color:#646464;text-decoration:none}
a:active{color:#646464;text-decoration:underline}
a:hover{color:#646464;text-decoration:underline}
.b16{font-size:16px; font-weight:bold;letter-spacing:-1px}
.w, a.w:link, a.w:visited, a.w:hover, a.w:active{color:#FFFFFF}
</style>
</head>
<script>
window.resizeTo(412,290);
function checkForm(f){
	if(!f.keyword.value){
		alert("주소를 입력해주세요");
		f.keyword.focus();
		return false;
	}
}
</script>
</head>
<body topmargin="0" leftmargin="0" >
<table height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td valign="top" bgcolor="#F5F5F5"><table width="385" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
        <tr>
          <td width="350" height="35" background="<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/pop_top01.gif" class="b16 w" style="padding:2 0 0 45">우편번호
            찾기</td>
          <td align="right"><a href="javascript:self.close();"><img src="<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/pop_top_close.gif" width="35" height="35" border="0" /></a></td>
        </tr>
        <? if(!$mode || $mode == "search"){?>
        <tr>
          <td colspan="2" style="padding:10 0 10 25"><img src="<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/arrow01.gif" width="7" height="7"> 찾고자
            하는 주소의 동(읍/면/리)를 입력해주세요 <BR>
            &nbsp;&nbsp;예) 역삼2동, 서초동, 송파동 </td>
        </tr>
        <tr>
          <td colspan="2" align="center"><table  width="363" height="40" border="0" cellspacing="0" cellpadding="0">
              <form action="<? echo $_SERVER['PHP_SELF'];?>" method=post name=AddressFrm onSubmit="return checkForm(this);">
                <input type=hidden name=mode value=search>
                <input type=hidden name=form value=<?=$form?>>
                <input type=hidden name=zip1 value=<?=$zip1?>>
                <input type=hidden name=zip2 value=<?=$zip2?>>
                <input type=hidden name=firstaddress value=<?=$firstaddress?>>
                <input type=hidden name=secondaddress value=<?=$secondaddress?>>
                <input type=hidden name=searchmode value=address>
                <tr>
                  <td align="center" background="<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/g_bx01.gif"><input type="text" name="keyword">
                    &nbsp;
                    <input type = "image" src="./<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/btn_search.gif" align = absmiddle>
                  </td>
                </tr>
              </form>
            </table></td>
        </tr>
<script>
document.AddressFrm.keyword.focus();
</script>
        <? } ?>
        <tr>
          <td colspan="2" align="center"><br>
            <?
if($mode == "search"){

$search_count = 0;

if ($keyword){
	$sqlstr = "select * from wizzipcode where gugun like '%$keyword%' or dong like '%$keyword%'";
	$dbcon->_query($sqlstr);
    while ($qrylist = $dbcon->get_rows()){
		$tmpzip = split("\-", $qrylist["zipcode"]);
		$list[$search_count][zip1] = $tmpzip[0];// Zipcode1
		$list[$search_count][zip2] = $tmpzip[1];// Zipcode2

		$list[$search_count][addr] = $qrylist["sido"]." ".$qrylist["gugun"]." ".$qrylist["dong"];// 주소
		$list[$search_count][bunji] = $qrylist["bunji"];// 번지 
					  
		$search_count++;						
    }
		
	if(!$search_count) $common->js_alert("찾으시는 주소가 존재하지 않습니다.");
    
}

?>
            <table width="340" border="0" cellpadding="0" cellspacing="0" bgcolor="cccccc">
              <tr>
                <td height="1"></td>
              </tr>
            </table>
            <br>
<script>
function GotoStep3(f){	
	f.action = '<?=$PHP_SELF?>?mode=search_detail';	
	f.submit();
}
window.resizeTo(412,370);
</script>
아래의 주소 중에서 선택하신후 <b><font color="#CC3399">더블클릭</font></b> 해주세요.<br><br>
            <table width="340" border="0" cellpadding="2" cellspacing="1" bgcolor="dddddd">
              <form name = "SecFrm" method = "post">
                <input type=hidden name=form value=<?=$form?>>
                <input type=hidden name=zip1 value=<?=$zip1?>>
                <input type=hidden name=zip2 value=<?=$zip2?>>
                <input type=hidden name=firstaddress value=<?=$firstaddress?>>
                <input type=hidden name=secondaddress value=<?=$secondaddress?>>								
                <tr>
                  <td><select name='SKeyword' style='width:340px' size='6'  onDblClick='javascript:GotoStep3(this.form);'>
<?
for ($i = 0; $i < sizeof($list); $i++){
echo "<option value='{$list[$i][zip1]}-{$list[$i][zip2]}^{$list[$i][addr]}'>{$list[$i][addr]} {$list[$i][bunji]}</option>";
}
?>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td align = center ><img src = "<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/cancel2.gif" style = "cursor:pointer" onclick = "self.close();"> <img src = "<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/back.gif" style = "cursor:pointer" onclick = "javascript:history.go(-1)"></td>
                </tr>
              </form>
            </table>
<?
} else if($mode == "search_detail"){
$TmpAddr = explode("^", $SKeyword);
$TmpZipcode = explode("-" , $TmpAddr[0]);
?>
<script>
function checkThirdFrm(f){
	if(!f.address2.value){
		alert("상세주소를 입력하여 주세요");
		f.address2.focus();
		return false;
	}else{
		opener.document.<?=$form?>.<?=$zip1?>.value = f.zip1.value;
		opener.document.<?=$form?>.<?=$zip2?>.value = f.zip2.value;
		opener.document.<?=$form?>.<?=$firstaddress?>.value = f.address1.value;
		opener.document.<?=$form?>.<?=$secondaddress?>.value = f.address2.value;
		opener.document.<?=$form?>.<?=$secondaddress?>.focus();			
		window.close();
		return false;			
	}		
}
</script>
            <table width="340" border="0" cellpadding="2" cellspacing="1" bgcolor="dddddd">
              <form name = "ThirdFrm" method = "post" onSubmit = "return checkThirdFrm(this)">
                <tr>
                  <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
                      <tr>
                        <td bgcolor="e5e5e5" width="1"></td>
                        <td bgcolor="f4f4f4">&nbsp;</td>
                        <td bgcolor="e5e5e5" width="1"></td>
                      </tr>
                      <tr>
                        <td bgcolor="e5e5e5" width="1"></td>
                        <td bgcolor="f4f4f4"><p style="margin-left:10px;margin-top:1px;margin-bottom:10px">나머지
                              주소를 입력하시고, '주소입력'을 <b><font color="#CC3399">클릭</b>하세요.</p></td>
                        <td bgcolor="e5e5e5" width="1"></td>
                      </tr>
                      <tr>
                        <td bgcolor="e5e5e5" width="1"></td>
                        <td bgcolor="f4f4f4" width="100%" align="center"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                              <td align=right>&nbsp;<b>우편 번호</b>&nbsp;</td>
                              <td align="left" width="220"><input type='text' name='zip1' size=3 value='<?=$TmpZipcode[0]?>' readonly >
                                -
                                <input type='text' name='zip2' size=3 value='<?=$TmpZipcode[1]?>' readonly >
                              </td>
                            </tr>
                            <tr>
                              <td height="10" colspan=2></td>
                            </tr>
                            <tr>
                              <td align=right valign=top>&nbsp;<b>주소</b>&nbsp;</td>
                              <td align=left valign=top>
                                <?=$TmpAddr[1]?>
                                <br>
                                <input type = "hidden" name = "address1" value = "<?=$TmpAddr[1]?>">
                                <input name=address2 type="text" size=40 maxlength=50 value="" ></td>
                            </tr>
                            <tr>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                            </tr>
                          </table></td>
                        <td bgcolor="E5E5E5" width="1"></td>
                      </tr>
                    </table></td>
                </tr>
                <tr>
                  <td align = center ><input type = "image" src = "<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/add_submit.gif" > <img src = "<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/cancel2.gif" style = "cursor:pointer" onclick = "self.close();"> <img src = "<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/back.gif" style = "cursor:pointer" onclick = "javascript:history.go(-1)"></td>
                </tr>
              </form>
            </table>
<script>
document.ThirdFrm.address2.focus();
</script>
<?
}
?>
          </td>
        </tr>
        <tr>
          <td colspan="2">&nbsp;</td>
        </tr>
        <tr>
          <td colspan="2" bgcolor="#DDDDDD"><img src="<? echo $cfg["skin"]["ZipCodeSkin"]; ?>/images/1.gif" width="1" height="1"></td>
        </tr>
        <tr>
          <td colspan="2" bgcolor="#F5F5F5">&nbsp;</td>
        </tr>
      </table></td>
  </tr>
</table>
</body>
</html>