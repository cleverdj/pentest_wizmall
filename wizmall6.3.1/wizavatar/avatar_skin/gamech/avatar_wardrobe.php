<?
$sqlstr = "select * from ".$WIZTABLE["AVATARMEMCONFIG"]." where user_id = '".$avatar->avatar_userid."'";

$list =$dbcon->get_row($sqlstr);

//$gender = $list[gender];
unset($avatarimg);
$avatarimg[1] = $list[ava1];
$avatarimg[2] = $list[ava2];
$avatarimg[3] = $list[ava3];
$avatarimg[4] = $list[ava4];
$avatarimg[5] = $list[ava5];
$avatarimg[6] = $list[ava6];
$avatarimg[7] = $list[ava7];
$avatarimg[8] = $list[ava8];
$avatarimg[9] = $list[ava9];
$avatarimg[10] = $list[ava10];
$avatarimg[11] = $list[ava11];
$avatarimg[12] = $list[ava12];
$avatarimg[13] = $list[ava13];
$avatarimg[14] = $list[ava14];
$avatarimg[15] = $list[ava15];
$avatarimg[16] = $list[ava16];
$avatarimg[17] = $list[ava17];
$avatarimg[18] = $list[ava18];
$avatarimg[19] = $list[ava19];
?>
<style>
.box {
	width:590;
	height:270;
	overflow:auto;
	padding:0px;
	border:1 solid;
	border-color:ffffff;
	background-color: #ffffff;
}
</style>
<? include ($avatar_skin_path."/topbanner.php");?>
<!-- 아바타 체험 메뉴 시작 부분-->
<? include ($avatar_skin_path."/topnavy.php");?>
<!---서브메뉴 테아블 끝---->
<table width="678" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td colspan="3">&nbsp;</td>
  </tr>
  <tr>
    <td colspan="3"><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/avata_img01.gif" width="678" height="28"></td>
  </tr>
  <tr>
    <td width="7" bgcolor="e9e4e0">&nbsp;</td>
    <td width="663"><table width="98%" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/ava_title_15.gif" width="640" height="32"></td>
        </tr>
        <tr>
          <td align="center"><div class="box">
              <table width="599" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <?
$cnt=0;
$useravatar = $avatar->getmyavatar($avatar_id);
foreach($useravatar as $key => $value){
##key : 레이어 번호, $value : 이미지이름
	$bgcolor = "bgcolor='#dcdcdc'";
//foreach($avatarimg as $key => $value){
	if($value != ""){//기본 아이템에 대한 처리는 추후
?>
                  <td width="120" align="center" valign="top"><table width="100" height="100" border="0" align="center" cellpadding="0" cellspacing="1" <?=$bgcolor?>>
                      <tr>
                        <td align="center"><img id=MyAvatarItem<?=$key;?> src='<?=$avatar->getavatarImg($value)?>' width=100 height=100 border='0'></td>
                      </tr>
                    </table>

                    <img src="./<?=$cfg["avatar"]["web_skinpath"]?>/img/my_img08.gif" name="TakeOffBtn<?=$key;?>" width="30" height="14" border="0" id=TakeOffBtn<?=$key;?> style="cursor:pointer" onClick="take_off_one('<?=$key?>');" onfocus=blur()>
                   </td>
                  <?
		$cnt++;
		if(!($cnt%5)){
			echo "</tr><tr><td colspan='5'></td></tr><tr>";
		}//else echo "<td width='21'>&nbsp;</td>";
	}
}
$tmpcnt = $cnt%5;
if($tmpcnt){
	for($i=$tmpcnt; $i<5; $i++){
		echo "<td width='120'></td>";
	}
}
?>
                </tr>
              </table>
            </div></td>
        </tr>
      </table>
      <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/ava_title_16.gif" width="640" height="48"></td>
        </tr>
        <tr>
          <td align="center"><table width="599" border="0" cellspacing="0" cellpadding="0">
              <tr>
<?	
$ListNo=$pg_counts?$pg_counts:10;
$PageNo = 10;

/* 총 갯수 구하기 */
$total = $avatar->gethavecnt($avatar_id);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($total / $ListNo) ; /* 총페이지수(total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$total-($ListNo*($CP-1));
//$sqlstr = "select b.no, b.name, b.layer, b.filename1, b.filename2, b.filename3, a.item_no,a.no";
$sqlstr = "select a.item_no, a.no, b.name, b.buy_p, b.level, b.gender";
$sqlstr .= " from ".$WIZTABLE["AVATARMERCHANT"]." a ";
$sqlstr .= " left join ".$WIZTABLE["AVATARITEM"]." b on a.item_no = b.no ";
$sqlstr .= " where a.user_id = '$avatar_id' order by a.no desc limit $START_NO, $ListNo";
$sqlqry = $dbcon->_query($sqlstr);				  
$cnt=0;
while($list=$dbcon->_fetch_array($sqlqry)):
	extract($list);
?>  
                <!-- item start-->
                <td width="100" align="center"><table width="100" height="100" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="dcdcdc">
                    <tr>
                      <td align="center"><img id=waredrop<?=$key;?> src='<?=$avatar->getavatarImg($item_no)?>' width=100 height=100 border='0' ></td>
                    </tr>
                  </table>
                  <table border="0" cellpadding="3" cellspacing="0">
                    <tr>
                      <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/img/my_img09.gif" width="30" height="14" border="0" onClick="ch_avatar('<?=$item_no?>','<?=$list[no]?>','<?=$list[layer]?>');" onfocus=blur(); style="cursor:pointer" alt="입기"></td>
                      <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/img/my_img10.gif" width="30" height="14" border="0" onClick="sale_item('<?=$item_no?>','<?=$list[no]?>','<?=$list[layer]?>');" onfocus=blur(); style="cursor:pointer" alt="팔기"></td>
                    </tr>
                    <tr>
                      <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/img/my_img11.gif" width="30" height="14" border="0" onClick="present_item('<?=$item_no?>','<?=$list[no]?>','<?=$list[layer]?>');" onfocus=blur(); style="cursor:pointer" alt="선물"></td>
                      <td><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/img/my_img12.gif" width="30" height="14" border="0" onClick="Item_del('<?=$item_no?>','<?=$list[no]?>','<?=$list[layer]?>')" onfocus=blur(); style="cursor:pointer" alt="삭제"></td>
                    </tr>
                  </table></td>
                <!-- item end-->
                <?
		$cnt++;
		
		if(!($cnt%5)){
			echo "</tr>
<tr>
<td valign='top'>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>";
		}//else echo "<td width='21'>&nbsp;</td>";
endwhile;
$tmpcnt = $cnt%5;
if($tmpcnt){
	for($i=$tmpcnt; $i<5; $i++){
		echo "<td width='120'></td>";
	}
}
?>
              </tr>
              <tr colspan="5">
                <td align="center">&nbsp;</td>
              </tr>
              <tr>
                <td align="center" colspan="5"></td>
              </tr>
              <tr>
                <td align="center" colspan="5"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "skinmode=$skinmode&code=$code&c_gender=$c_gender";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='".$cfg["avatar"]["web_skinpath"]."/images/pre.gif' border='0'></a> ";
} else {
echo " <img src='".$cfg["avatar"]["web_skinpath"]."/images/pre.gif' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='".$cfg["avatar"]["web_skinpath"]."/images/next.gif' border='0'></a> ";
} else {
ECHO" <img src='".$cfg["avatar"]["web_skinpath"]."/images/next.gif' border='0'> ";
}
?></td>
              </tr>
            </table></td>
        </tr>
      </table></td>
    <td width="8" bgcolor="e9e4e0">&nbsp;</td>
  </tr>
  <tr>
    <td colspan="3"><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/avata_img02.gif" width="678" height="28"></td>
  </tr>
</table>
