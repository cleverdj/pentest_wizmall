<?
include "../../include/inc.depth3.php";

if($upmode == "receive" || $upmode == "reject"){
	if($upmode == "receive") $p_flag = "0";
	else $p_flag = "2";
	$sqlstr = "update ".$WIZTABLE["AVATARMERCHANT"]." set p_flag = '$p_flag' where no = '$no'";
	mysql_query($sqlstr);
}

?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>▒ wizAvatar  ▒</title>
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
<link rel="stylesheet" type="text/css" href="./style.css">
<script language="javascript">
<!--
function gotopage(url){
	opener.location.href = url
	self.close();
}

function CheckAll(objChkBox)
{ 
    bChecked = (objChkBox.checked)?true:false

    for (x=0;x<objChkBox.form.length;x++)
    {
        objChkBox.form.elements[x].checked = bChecked;
    }
}

function deleteItem(){
	var f = document.PresentForm;
	var nChecked=0;
    for( i = 0; i < f.checkListId.length; i++) if( f.checkListId[i].checked) nChecked++

    if( nChecked < 1) {
        alert( "적어도 1 개는 선택하셔야 합니다.")
    }else if(confirm('찜에서 삭제하시겠습니까?')){
		f.submit();
	}else{
		return;
	}
}

var old_menu = '';
function menuclick(submenu)
{
  if( old_menu != submenu ) {
	if( old_menu !='' ) {
	  old_menu.style.display = 'none';
	}
	submenu.style.display = 'block';
	old_menu = submenu;

  } else {
	submenu.style.display = 'none';
	old_menu = '';
  }
}
//-->
</script>
<script language="JavaScript" type="text/JavaScript">
<!--
function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
//-->
</script>
<form method="get" action="../../avatarProc.php" name="ProcForm">
  <input type="hidden" name="mode" value="zzim">
  <input type="hidden" name="item_no" value="<?=$item_no?>">
</form>
</head>
<body bgcolor="#e4ebff" leftmargin="10" topmargin="10" marginwidth="0" marginheight="0">
<?
if($mode == "zzim" && $item_no){
//$point = $avatar->check_point($avatar_id);
//echo "item_no = $item_no <br>";
$list = $avatar->getItemInfo($item_no);
$avatarimg0 = $list["filename1"]; 
//$avatarimg1 = $list["filename2"];
//$avatargender = $list["gender"];
//$category = $list["filename2"];
$buy_p = $list["buy_p"];
//$total_buy_point += $buy_p;	
?>
<table width="472" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><img src="./images/popup_img12.gif" width="472" height="86"></td>
  </tr>
  <tr>
    <td background="./images/popup_img13.gif"><P style="MARGIN-TOP: 15px">
      <table width="420" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><img src="./images/popup_img08_on.gif" width="65" height="23" border="0"></td>
          <td width="80"><div align="center"><a href="<?=$PHP_SELF;?>?mode=receiveP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu2','','./images/popup_img09_on.gif',1)" onFocus="blur()"><img src="./images/popup_img09.gif" name="menu2" width="65" height="23" border="0"></a></div></td>
          <td><a href="<?=$PHP_SELF;?>?mode=sendP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu3','','./images/popup_img10_on.gif',1)" onFocus="blur()"><img src="./images/popup_img10.gif" alt="보낸선물" name="menu3" width="65" height="23" border="0"></a></td>
          <td width="225">&nbsp;</td>
        </tr>
      </table>
      <table width="440" height="29" border="0" align="center" cellpadding="5" cellspacing="1" background="./images/popup_img11.gif">
        <tr>
          <td height="29"><div align="center"><font color="#FFFFFF"></font></div></td>
          <td><div align="center"><font color="#FFFFFF">구분</font></div></td>
          <td><div align="center"><font color="#FFFFFF">아이템명</font></div></td>
          <td><div align="center"><font color="#FFFFFF">가격</font></div></td>
          <td><div align="center"><font color="#FFFFFF">선물</font></div></td>
        </tr>
      </table>
      <table width="440" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td bgcolor="e2f2fc"><table width="90%" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><img src="<?=$avatar->getavatarImg($item_no)?>" width="100" height="100"></div></td>
              </tr>
              <tr>
                <td align="center"><?=$list["name"] ?>
                  <br>
                  <?=number_format($list["buy_p"])?></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <table width="440" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="40"><div align="center">선택한 아이템을 <strong>'찜 보관함'</strong> 에 넣겠습니까? </div></td>
        </tr>
        <tr>
          <td height="40"><table border="0" align="center" cellpadding="5" cellspacing="0">
              <form method="post" action="../../avatarProc.php" name="ProcForm">
                <input type="hidden" name="mode" value="zzim">
                <input type="hidden" name="item_no" value="<?=$item_no?>">
                <tr>
                  <td><div align="center">
                      <input type="image" src="./images/b_ok.gif" alt="확인" width="41" height="18" border="0">
                      <img src="./images/b_close.gif" alt="닫기" width="41" height="18" border="0" onClick="self.close()"; style="cursor:pointer"> </div></td>
                </tr>
              </form>
            </table></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><img src="./images/popup_img14.gif" width="471" height="8"></td>
  </tr>
</table>
<?
}else if($mode == "zzim" && !$item_no){
?>
<table width="472" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><img src="./images/popup_img12.gif" width="472" height="86"></td>
  </tr>
  <tr>
    <td background="./images/popup_img13.gif"><P style="MARGIN-TOP: 15px">
      <table width="420" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><img src="./images/popup_img08_on.gif" width="65" height="23"></td>
          <td width="80"><div align="center"><a href="<?=$PHP_SELF;?>?mode=receiveP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu2','','./images/popup_img09_on.gif',1)" onFocus="blur()"><img src="./images/popup_img09.gif" name="menu2" width="65" height="23" border="0"></a></div></td>
          <td><a href="<?=$PHP_SELF;?>?mode=sendP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu3','','./images/popup_img10_on.gif',1)" onFocus="blur()"><img src="./images/popup_img10.gif" alt="보낸선물" name="menu3" width="65" height="23" border="0"></a></td>
          <td width="225">&nbsp;</td>
        </tr>
      </table>
      <table width="440" height="29" border="0" align="center" cellpadding="5" cellspacing="1" background="./images/popup_img11.gif">
        <tr>
          <td height="29"><!--<div align="center"><font color="#FFFFFF"><input type="checkbox" name="checkbox" value="checkbox" onClick="CheckAll(this)"></font></div>--></td>
          <td><div align="center"><font color="#FFFFFF">구분</font></div></td>
          <td><div align="center"><font color="#FFFFFF">아이템명</font></div></td>
          <td><div align="center"><font color="#FFFFFF">가격</font></div></td>
          <td><div align="center"><font color="#FFFFFF">선물</font></div></td>
        </tr>
        <?
$ListNo=$pg_counts?$pg_counts:5;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

$whereis = "where z.user_id = '".$avatar->avatar_userid."'";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(z.no) FROM ".$WIZTABLE["AVATARZZIM"]." z $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select i.filename1, i.name, i.buy_p, z.item_no, z.no as zzimno, z.wdate as zzimdate  from ".$WIZTABLE["AVATARZZIM"]." z ";
$sqlstr .= " left join ".$WIZTABLE["AVATARITEM"]." i ";
$sqlstr .= " on z.item_no = i.no";
$sqlstr .= " $whereis ";
$sqlstr .= " order by z.no desc limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());
	
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
	$no = $list["item_no"];
?>
        <tr bgcolor="#FFFFFF">
          <td><div align="center">
              <input type="checkbox" name="checkList[<?=$list["zzimno"]?>]" value="1" id="checkListId">
            </div></td>
          <td><div align="center">아바타</div></td>
          <td><a href="javascript:menuclick(submenu<?=$list["zzimno"]?>);">
            <?=$list["name"]?>
            </a></td>
          <td><div align="center"><img src="./images/bamtori.gif" width="11" height="11">
              <?=number_format($list["buy_p"])?>
              개 </div></td>
          <td><div align="center"><img src="./images/purc_ico.gif" width="30" height="14" onClick="opener.buy_item_pop('<?=$no?>')" style="cursor:pointer"> <img src="./images/pros_ico.gif" width="30" height="14" onClick="opener.present_item_pop(<?=$no?>);" style="cursor:pointer"> </div></td>
        </tr>
        <tr bgcolor="#FFFFFF">
          <td colspan="5" bgcolor="e2f2fc" id="submenu<?=$list["zzimno"]?>" style="display:none"><table width="90%" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td width="100"><img src="<?=$avatar->getavatarImg($no)?>" width="100" height="100"></td>
                <td width="20">&nbsp;</td>
                <td><strong><font color="1494cf">찜한날짜</font></strong> :
                  <?=date("Y-m-d", $list["zzimdate"]);?>
                  <br>
                  <?=$list["name"]?></td>
              </tr>
            </table></td>
        </tr>
        <?
$cnt++;
endwhile;
?>
      </table>
      <table width="440" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="40" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "mode=$mode";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='./images/pre.gif' border='0'></a> ";
} else {
echo " <img src='./images/pre.gif' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='./images/next.gif' border='0'></a> ";
} else {
ECHO" <img src='./images/next.gif' border='0'> ";
}
?></td>
          <td width="50"><div align="right"><img src="./images/delate2.gif" width="50" height="20" onClick="deleteItem();" style="cursor:pointer"></div></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><img src="./images/popup_img14.gif" width="471" height="8"></td>
  </tr>
</table>
<?
}else if($mode == "receiveP"){//받은 선물
# p_flag = 0; 사용중, 1 = 액션없음, 2: 거절;
?>
<table width="472" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><img src="./images/popup_img12.gif" width="472" height="86"></td>
  </tr>
  <tr>
    <td background="./images/popup_img13.gif"><P style="MARGIN-TOP: 15px">
      <table width="420" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><a href="<?=$PHP_SELF;?>?mode=zzim" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu1','','./images/popup_img08_on.gif',1)" onFocus="blur()"><img src="./images/popup_img08.gif" name="menu1" width="65" height="23" border="0"></a></td>
          <td width="80"><div align="center"><img src="./images/popup_img09_on.gif" width="65" height="23"></div></td>
          <td><a href="<?=$PHP_SELF;?>?mode=sendP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu3','','./images/popup_img10_on.gif',1)" onFocus="blur()"><img src="./images/popup_img10.gif" alt="보낸선물" name="menu3" width="65" height="23" border="0"></a></td>
          <td width="225">&nbsp;</td>
        </tr>
      </table>
      <table width="440" height="29" border="0" align="center" cellpadding="5" cellspacing="1" background="./images/popup_img11.gif">
        <tr>
          <td height="29"><!--<div align="center"><font color="#FFFFFF"><input type="checkbox" name="checkbox3" value="checkbox" /></font></div>--></td>
          <td><div align="center"><font color="#FFFFFF">구분</font></div></td>
          <td><div align="center"><font color="#FFFFFF">아이템명</font></div></td>
          <td><div align="center"><font color="#FFFFFF">보낸사람</font></div></td>
          <td><div align="center"><font color="#FFFFFF">받은날짜</font></div></td>
          <td><div align="center"><font color="#FFFFFF">사용</font></div></td>
        </tr>
        <?
$ListNo=$pg_counts?$pg_counts:5;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

$whereis = "where m.user_id = '".$avatar->avatar_userid."' and m.p_user_id <> ''";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(m.no) FROM ".$WIZTABLE["AVATARMERCHANT"]." m $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select m.no, m.user_id, m.p_date, m.p_user_id, m.p_flag, i.name, i.filename1 from ".$WIZTABLE["AVATARMERCHANT"]." m ";
$sqlstr .= " left join ".$WIZTABLE["AVATARITEM"]." i ";
$sqlstr .= " on m.item_no = i.no";
$sqlstr .= " $whereis ";
$sqlstr .= " order by m.no desc limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());
	
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
# p_flag = 0; 사용중, 1 = 액션없음, 2: 거절;
$no = $list["no"];
switch($list["p_flag"]){
	case "0":
		$flagstr = "사용중";
	break;
	case "1":
		$flagstr = "<a href='$PHP_SELF?mode=$mode&upmode=receive&no=$no'>받기</a><!--/<a href='$PHP_SELF?mode=$mode&upmode=reject&no=$no'>거절</a>-->";
	break;
	case "2":
		$flagstr = "거절";
	break;
}
?>
        <tr bgcolor="#FFFFFF">
          <td><div align="center">
              <input type="checkbox" name="checkbox22" value="checkbox" />
            </div></td>
          <td><div align="center">아바타</div></td>
          <td><a href="javascript:menuclick(submenu<?=$list["no"]?>);"><?=$list["name"];?></a></td>
          <td><div align="center">
              <?=$list["p_user_id"];?>
            </div></td>
          <td><div align="center">
              <?=date("Y.m.d", $list["p_date"]);?>
            </div></td>
          <td><div align="center">
              <?=$flagstr?>
            </div></td>
        </tr>
		        <tr bgcolor="#FFFFFF">
          <td colspan="6" bgcolor="e2f2fc" id="submenu<?=$list["no"]?>" style="display:none"><table width="90%" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td width="100"><img src="<?=$avatar->getavatarImg($no)?>" width="100" height="100"></td>
                <td width="20">&nbsp;</td>
                <td><strong><font color="1494cf">찜한날짜</font></strong> :
                 <?=date("Y.m.d", $list["p_date"]);?>
                  <br>
                  <?=$list["name"]?></td>
              </tr>
            </table></td>
        </tr>
        <?
$cnt++;
endwhile;
?>
      </table>
      <table width="440" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="40" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "mode=$mode";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='./images/pre.gif' border='0'></a> ";
} else {
echo " <img src='./images/pre.gif' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='./images/next.gif' border='0'></a> ";
} else {
ECHO" <img src='./images/next.gif' border='0'> ";
}
?></td>
          <!--<td width="50"> 
            <div align="right"><img src="./images/delate2.gif" width="50" height="20"></div></td>-->
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><img src="./images/popup_img14.gif" width="471" height="8"></td>
  </tr>
</table>
<?
}else if($mode == "sendP"){//보낸 선물
?>
<table width="472" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><img src="./images/popup_img12.gif" width="472" height="86"></td>
  </tr>
  <tr>
    <td background="./images/popup_img13.gif"><P style="MARGIN-TOP: 15px">
      <table width="420" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td><a href="<?=$PHP_SELF;?>?mode=zzim" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu1','','./images/popup_img08_on.gif',1)" onFocus="blur()"><img src="./images/popup_img08.gif" name="menu1" width="65" height="23" border="0"></a></td>
          <td width="80"><div align="center"><a href="<?=$PHP_SELF;?>?mode=receiveP" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('menu2','','./images/popup_img09_on.gif',1)" onFocus="blur()"><img src="./images/popup_img09.gif" name="menu2" width="65" height="23" border="0"></a></div></td>
          <td><img src="./images/popup_img10_on.gif" alt="보낸선물" name="menu3" width="65" height="23" border="0"></td>
          <td width="225">&nbsp;</td>
        </tr>
      </table>
      <table width="440" height="29" border="0" align="center" cellpadding="5" cellspacing="1" background="./images/popup_img11.gif">
        <tr>
          <td height="29"><div align="center"><font color="#FFFFFF"></font></div></td>
          <td><div align="center"><font color="#FFFFFF">구분</font></div></td>
          <td><div align="center"><font color="#FFFFFF">아이템명</font></div></td>
          <td><div align="center"><font color="#FFFFFF">받는사람</font></div></td>
          <td><div align="center"><font color="#FFFFFF">보낸날짜</font></div></td>
        </tr>
        <?
$ListNo=$pg_counts?$pg_counts:5;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

$whereis = "where m.p_user_id = '".$avatar->avatar_userid."'";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(m.no) FROM ".$WIZTABLE["AVATARMERCHANT"]." m $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select m.no, m.user_id, m.p_date, i.name, i.filename1 from ".$WIZTABLE["AVATARMERCHANT"]." m ";
$sqlstr .= " left join ".$WIZTABLE["AVATARITEM"]." i ";
$sqlstr .= " on m.item_no = i.no";
$sqlstr .= " $whereis ";
$sqlstr .= " order by m.no desc limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());
	
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
?>
        <tr bgcolor="#FFFFFF">
          <td><div align="center">
              <input type="checkbox" name="checkbox2" value="checkbox" />
            </div></td>
          <td><div align="center">아바타</div></td>
          <td><a href="javascript:menuclick(submenu<?=$list["no"]?>);"><?=$list["name"];?></a></td>
          <td><div align="center"><?=$list["user_id"];?></div></td>
          <td><div align="center"><?=date("Y.m.d", $list["p_date"]);?></div></td>
        </tr>
        <tr bgcolor="#FFFFFF">
          <td colspan="5" bgcolor="e2f2fc" id="submenu<?=$list["no"]?>" style="display:none"><table width="90%" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td width="100"><img src="<?=$avatar->getavatarImg($no)?>" width="100" height="100"></td>
                <td width="20">&nbsp;</td>
                <td><strong><font color="1494cf">받은날짜</font></strong> :
                  <?=date("Y.m.d", $list["p_date"]);?>
                  <br>
                <?=$list["name"]?></td>
              </tr>
            </table></td>
        </tr>		
        <?
$cnt++;
endwhile;
?>
      </table>
      <table width="440" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="40"><div align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "mode=$mode";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='./images/pre.gif' border='0'></a> ";
} else {
echo " <img src='./images/pre.gif' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='./images/next.gif' border='0'></a> ";
} else {
ECHO" <img src='./images/next.gif' border='0'> ";
}
?></div></td>
          <!--<td width="50"><div align="right"><img src="./images/delate2.gif" width="50" height="20"></div></td>-->
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><img src="./images/popup_img14.gif" width="471" height="8"></td>
  </tr>
</table><?
}
?>
</body>
</html>
