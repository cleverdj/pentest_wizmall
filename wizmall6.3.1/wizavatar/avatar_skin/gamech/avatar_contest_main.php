<?
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;
$avatar->avatarpath = "./wizavatar/avatarimg/";

### 1, 2, 3, 4, 5, 6 위 가져오기
### 현재 등록된 컨테스트 리스트에서 최근 기간을 가져와 아래 기간에 세팅한다.
/*
$sqlstr = "select max(edate) from ".$WIZTABLE["AVATARCONTESTTERM"];
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$max_edate = $list[0];

$sqlstr = "select sdate, edate from ".$WIZTABLE["AVATARCONTESTTERM"]." where edate = '$max_edate'";
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$sdate = $list["sdate"];
$edate = $list["edate"];
echo $sdate;
*/
$thisYear = $thisYear ? $thisYear : date("Y");
if(!$thisMonth){
	if(date("m") == 1){
		$thisYear--;
		$thisMonth = 12;
	}else{
		$thisMonth = date("m")-1;
	}
}

$thisDay = $thisDay ? $thisDay : date("d");

if($thisYear == date("Y") && $thisMonth == date("m")){//금번달은 평가되지 않았으므로 return 시킨다.
	echo "<script>alert('평가가 완료되지 않았습니다.');history.back();</script>";
	exit;
}

$thisdate = mktime(0,0,1,$thisMonth, 1, $thisYear);
$sqlstr = "select attached from ".$WIZTABLE["AVATARCONTESTTERM"]." where $thisdate between sdate and edate";
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$attachedimg = split("\|", $list["attached"]);

$sdate = mktime(0,0,0,$thisMonth, 1, $thisYear);
$edate = mktime(0,0,-1,$thisMonth+1, 1, $thisYear);
$whereis = "where contest = 1 and cdate between $sdate and $edate ";
$sqlstr = "select no, user_id, cdate,score,adminscore from ".$WIZTABLE["AVATARALBUM"]." $whereis order by adminscore desc, score desc limit 6";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());

$cnt=0;
$avatar->mode = "photo";
while($list=@mysql_fetch_array($sqlqry)):
	$best_contest_view[$cnt] = $avatar->show_avatar($list[no]);
	$best_contest_no[$cnt] = $list["no"];
	$best_contest_id[$cnt] = $list["user_id"];
	$best_contest_name[$cnt] = $avatar->get_MemInfo($best_contest_id[$cnt], "name");
	$best_contest_cdate[$cnt] = $list["cdate"];
	$best_contest_score[$cnt] = $list["score"];
	$best_contest_adminscore[$cnt] = $list["adminscore"];
	$cnt++;
endwhile;
?>
<script language="javascript">
<!--
	function openContestWindow(no){
		window.open('<?=$avatar_skin_path?>/avatar_contest_detail.php?no='+no,'ContestWindow','width=570, height=639, scrollbars=1');
	}
	
	function gotoContest(){
		var f = document.ContestForm;
		f.submit();
	}	
//-->
</script>

<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td align="left"><table border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td><img src="<?=$avatar_skin_path?>/images/avata_con_8.gif" width="446" height="44" /></td>
          <td><img src="<?=$avatar_skin_path?>/images/avata_con_9.gif" width="94" height="19" border="0" onClick="AvatarSaveConfirm()" style="cursor:pointer"></td>
          <td width="6"></td>
          <td><a href="wizavatar.php?skinmode=contestlist" onFocus="blur()"><img src="<?=$avatar_skin_path?>/images/avata_con_10.gif" width="112" height="19" border="0" /></a></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td><!-- 아바타체험 상단 시작-->
      <table width="662" height="112" border="1" cellpadding="0" cellspacing="0" bordercolor="dccabd">
        <tr>
          <td bgcolor="f8f4ef" style="padding-left:14px;" valign="top"><!-- 아바타체험 상단 끝-->
            <table border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td colspan="2" align="left"><img src="<?=$avatar_skin_path?>/images/avata_con_1.gif" width="87" height="27" /></td>
              </tr>
              <tr>
                <td><table border="1" cellpadding="0" cellspacing="0" bordercolor="a9897b">
                    <tr>
                      <td><img src="./wizavatar/avatarimg/etc_img/<?=$attachedimg[0]?>" width="287" height="69"></td>
                    </tr>
                  </table></td>
                <td><img src="<?=$avatar_skin_path?>/images/avata_con_2.gif" width="357" height="71" /></td>
              </tr>
              <tr>
                <td colspan="2" align="left"><img src="<?=$avatar_skin_path?>/images/avata_con_7.gif" width="639" height="134" /></td>
              </tr>
            </table></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td height="50"><table border="0" align="right" cellpadding="0" cellspacing="0">
        <form name="ContestForm" action="<?=$PHP_SELF;?>" method="post">
          <input type="hidden" name="skinmode" value="<?=$skinmode;?>">
          <tr>
            <td><select name="thisYear">
                <?
for($i=2007; $i<=date("Y"); $i++){
	$selected = $thisYear == $i ? "selected":"";
	echo "<option value='$i' $selected>".$i."년</option>";
}
?>
              </select></td>
            <td width="6"></td>
            <td><select name="thisMonth">
                <?
for($i=1; $i<=12; $i++){
	$j = sprintf("%02d", $i);
	$selected = $thisMonth == $j ? "selected":"";
	echo "<option value='$i' $selected>".$j."월</option>";
}
?>
              </select></td>
            <td width="6"></td>
            <td><img src="<?=$avatar_skin_path?>/images/avata_con_4.gif" width="36" height="20" border="0" style="cursor:pointer" onclick="gotoContest();"></td>
            <td><img src="<?=$avatar_skin_path?>/images/avata_con_5.gif" width="57" height="20" /></td>
            <td><input type="text" name="textfield32" class="input4"/>
            </td>
            <td width="5"></td>
            <td><a href="#" onFocus="blur()"><img src="<?=$avatar_skin_path?>/images/avata_con_6.gif" width="45" height="20" border="0" /></a></td>
          </tr>
        </form>
      </table></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table width="670" border="0" align="center" cellpadding="5" cellspacing="0">
  <tr>
    <td width="213" align="center"><!---1위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img2.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[0]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img3.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" background="<?=$avatar_skin_path?>/images/co_img4.gif"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td align="center"><strong><font color="ff7725">
                  <?=$best_contest_name[0]?>
                  (
                  <?=$best_contest_id[0]?>
                  )</font></strong></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[0]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[0]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---1위 아바타 테이블 끝---->
    </td>
    <td width="213" align="center"><!---2위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img6.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[1]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725">
                    <?=$best_contest_name[1]?>
                    (
                    <?=$best_contest_id[1]?>
                    )</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[1]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[1]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---2위 아바타 테이블 끝---->
    </td>
    <td width="214" align="center"><!---3위 아바타 테이블 시작---->
      <table width="204" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img9.gif" width="201" height="49"></td>
        </tr>
        <tr>
          <td width="20"></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[2]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td></td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725">
                    <?=$best_contest_name[2]?>
                    (
                    <?=$best_contest_id[2]?>
                    )</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[2]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[2]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---3위 아바타 테이블 끝---->
    </td>
  </tr>
</table>
<P style="MARGIN-TOP: 20px">
<table width="670" border="0" align="center" cellpadding="5" cellspacing="0">
  <tr>
    <td width="213" align="center"><!---1위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img31.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[3]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725">
                    <?=$best_contest_name[3]?>
                    (
                    <?=$best_contest_id[3]?>
                    )</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[3]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[3]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---1위 아바타 테이블 끝---->
    </td>
    <td width="213" align="center"><!---2위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img32.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[4]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725">
                    <?=$best_contest_name[4]?>
                    (
                    <?=$best_contest_id[4]?>
                    )</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[4]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[4]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---2위 아바타 테이블 끝---->
    </td>
    <td width="214" align="center"><!---3위 아바타 테이블 시작---->
      <table width="204" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="<?=$avatar_skin_path?>/images/co_img33.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[5]?></td>
          <td width="22"><img src="<?=$avatar_skin_path?>/images/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725">
                    <?=$best_contest_name[5]?>
                    (
                    <?=$best_contest_id[5]?>
                    )</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 :
                    <?=$best_contest_adminscore[5]?>
                    점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="<?=$avatar_skin_path?>/images/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[5]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---3위 아바타 테이블 끝---->
    </td>
  </tr>
</table>
