<script language="javascript" type="text/javascript">
<!--
	function onoffmenu(v){
		var dp = document.getElementById("subcategory");
		if(dp.style.display == "block"){
			dp.style.display = "none";
			v.innerHTML = "[열기]";
		}else{
			dp.style.display = "block";
			v.innerHTML = "[닫기]";
		}
	}
	
	function ch_avatar_cat(code){
		if(code == undefined) code = "";
		location.href = "<?=$PHP_SELF;?>?s_code="+code;
	}
//-->
</script>
<div id="content-area">
			<div class="myavatarBoxTop"></div>
			<div id="myavatarBoxMid">
			<!--게임채널 아바타샵-->
				<div class='AvatarL'>
					<h2><span class='orange'>게임채널</span> 아바타샵</h2>
					<p><img src='img/avatar/A_banner.gif' alt='' /></p>
				</div>
			<!--// 게임채널 아바타샵 //-->
				<div class='AvatarR'>
					<h2><span class='orange'><?=$cfg["member"]["mname"]?>(<?=$cfg["member"]["mid"]?>)</span> 님 기본정보</h2>
					<div class='avatarLV'>
						<ul class='Lv'>
							<li>레벨: <img src='/wizboard/iconlevel/default/lv_<?=$cfg["member"]["mlevel"]?>.gif'><span class="orange"><?=$cfg["member"]["mlevel"]?></span></strong></li>
							<li>경험치: <span class="green"><?=$cfg["member"]["mexp"]?></span> exp</strong></li>
							<li>머니: <span class="point"><?=$cfg["member"]["mpoint"]?></span> FM</strong></li>
						</ul>
						<span>
							<ul>
								<li><a href='javascript:get_iniava();'><img src='img/common/btn_stop.gif' alt='원래대로' /></a> | <a href='javascript:buy_item()'><img src='img/common/btn_pay.gif' alt='일괄구매' /></a></li>
								<li class='btn'><a href='/mypage/my_avatar.htm'><img src='img/mypage/btn_avatar.gif' alt='내아바타관리' /></a></li>
							</ul>
						</span>
					</div>
					<div class='avatarSam'><?=$avatar->show_avatar($avatar_id);?></div>
				</div>
				<div class='TavatarBox'>
					<div class='titleTEXT'>
							<span class='tit01'>무기점</span>
							<span class='tit02'>방어구점</span>
							<span class='tit03'>악세사리점</span>
							<span class='tit04'>마법상점</span>
							<span class='tit05'>성형수술점</span>
							<span class='tit06' id="onoffcat" style="cursor:pointer" onclick="onoffmenu(this)">[닫기]</span>
					</div>
                    <div id="subcategory" style="display:block">
					<div class='Amap01'>
						<ul>
<?
	$list = $avatar->getsubcategory('010');
	foreach($list as $key=>$value) echo "<li><a href='javascript:ch_avatar_cat(\"$key\")'>".$value."</a></li>\n";
?>                        
						</ul>
					</div>
					<div class='Amap02'>
						<ul>
<?
	$list = $avatar->getsubcategory('020');
	foreach($list as $key=>$value) echo "<li><a href='javascript:ch_avatar_cat(\"$key\")'>".$value."</a></li>\n";
?> 
						</ul>
					</div>
					<div class='Amap03'>
						<ul>
<?
	$list = $avatar->getsubcategory('030');
	foreach($list as $key=>$value) echo "<li><a href='javascript:ch_avatar_cat(\"$key\")'>".$value."</a></li>\n";
?> 
						</ul>
					</div>
					<div class='Amap04'>
                   	 <ul>
<?
	$list = $avatar->getsubcategory('040');
	foreach($list as $key=>$value) echo "<li><a href='javascript:ch_avatar_cat(\"$key\")'>".$value."</a></li>\n";
?> 
						</ul>
					</div>
					<div class='Amap05'>
                    	<ul>
<?
	$list = $avatar->getsubcategory('041');
	foreach($list as $key=>$value) echo "<li><a href='javascript:ch_avatar_cat(\"$key\")'>".$value."</a></li>\n";
?> 
						</ul>
					</div>
                    </div>
				</div>
			</div>
			<div class="myavatarBoxBtm"></div>
			<div class='space10'></div>
			<div id='AllAvatar'>
				<h2>아바타샵 <?=$avatar->getCategoryFullPath($s_code)?></h2>
				<ul>
<?
$ListNo=$pg_counts?$pg_counts:15;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

switch($orderby){
	case "t1.wdate":
	case "t1.hitcnt":
		$orderbystr = " order by $orderby desc ";
	break;
	case "t1.name":
		$orderbystr = " order by binary $orderby asc ";
	break;	
	case "t1.buy_p":
		$orderbystr = " order by $orderby asc ";
	break;	
	default:
		$orderbystr = " order by t1.wdate desc ";
	break;
}
$orderArr = array("wdate"=>"신상품","hitcnt"=>"인기순","name"=>"상품명","buy_p"=>"가격순",);

//category 000 은 기본 이미지 dp
$whereis = "where defaultflag = 'u' ";
//and (gender = '$c_gender' or gender=0)";

if($s_code){
	$depth = strlen($s_code)/3;
	if($depth == 3){
		$whereis .= " and category = '$s_code'";
	}else if($depth == 2){
		$whereis .= " and length(category) >= 6 and  right(category, 6) = '$s_code'";
	}else{
		$whereis .= " and right(category, 3) = '$s_code'";
	}
}

if(!$display_zero_money){//0원인경우 디스플레이 안함
	$whereis .= " and buy_p <> 0";
}

/* 총 갯수 구하기 */
$sqlstr = "SELECT count(no) FROM ".$WIZTABLE["AVATARITEM"]." t1 $whereis";
$TOTAL = $dbcon->get_one($sqlstr);


if(empty($cp) || $cp <= 0) $cp = 1;

$START_NO = ($cp - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($cp-1));
$sqlstr = "select t1.*  from ".$WIZTABLE["AVATARITEM"]." t1 ";
$sqlstr .= " $whereis ";
$sqlstr .= " $orderbystr limit $START_NO, $ListNo";
$sqlqry = $dbcon->_query($sqlstr);
	
//echo "sqlstr = $sqlstr <br>";
$cnt=0;
while($list=$dbcon->_fetch_array($sqlqry)):
	extract($list);
	switch($gender){
		case "1":
			$genderimg = "<img src='/img/mypage/btn_man.gif' alt='남자전용' />";
		break;
		case "2":
			$genderimg = "<img src='/img/mypage/btn_woman.gif' alt='여자전용' />";
		break;
		case "3":
			$genderimg = "<img src='/img/mypage/btn_unisex2.gif' alt='공용' />";
		break;
	}
	
	
                             
	if(!$avatar_id){
		$takeon = " onclick=\"alert('로그인해 주시기 바랍니다.')\"";
	}else if($avatar_gender == $gender || $gender==0){
		$takeon = " onclick=\"take_avatar('".$avatar->getavatarImg($no, 1)."','".$layer."','".$gender."','".$no."','".$avatarimg2."');\"";
	}else{
		$takeon = " onclick=\"alert('성별이 다릅니다.')\"";
	}
?>	                
					<li>
						<span class='item01'><img src='<?=$avatar->getavatarImg($no)?>' width="74" height="74" <?=$takeon?> style="cursor:pointer"></span>
						<span class='item02'><?=$common->strCutting($list["name"], 17);?></span>
						<span class='item03'><img src='img/mypage/m_lv.gif' alt='' style='vertical-align:middle;'/><?=number_format($level)?>이상</span>
						<span class='item04'><img src='img/common/ic_coin.gif' alt='' style='vertical-align:middle;' />  <?=number_format($buy_p)?> <img src='img/mypage/avatar_icon<?=$gender?>.gif' alt='' style='vertical-align:middle;' /></span>
						<span class='item05'><img src='img/mypage/btn_dress05.gif' alt='구매' onclick="buy_item('<?=$list["no"]?>')" style="cursor:pointer" />&nbsp;&nbsp;<img src='img/mypage/btn_dress03.gif' alt='선물' onClick="present_item(<?=$list["no"]?>, '','');" style="cursor:pointer" /></span>
					</li>
<?
	$cnt++;
	if(!($cnt%5)){
		echo "</ul><ul>";
	}

endwhile;
	$tmpcnt = $cnt%5;
	if($tmpcnt){
		for($i=$tmpcnt; $i<5; $i++){
			echo "<li></li>";
		}
	}
?>                    
</ul>
			</div>
			<div class='space20'></div>
			<!-- paging -->
			<div class="pageNavigation">
				<?  
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?s_code=".$s_code;
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
$page_arg3 = array("pre"=>"../img/common/bts_prev.gif","next"=>"../img/common/bts_next.gif","pre0"=>"../img/common/bts_start.gif","next0"=>"../img/common/bts_end.gif");
$att[0] = "gameinfo";
echo $common->paging($page_arg1,$page_arg2,$page_arg3,$att);
?> </a>
			</div>
			<!-- //paging -->
			<div class='space10'></div>
		</div>