<?
include "../../include/inc.depth3.php";

$keyword=stripslashes($keyword);
$keyword=str_replace("`","",$keyword);
$keyword=str_replace("\"","",$keyword);
$keyword=str_replace("'","",$keyword);
$keyword=str_replace(".","",$keyword);
$keyword=str_replace("<","",$keyword);
$keyword=str_replace(">","",$keyword);

if(!$keykind) $keykind = "m.mid";
$whereis = "where 1";
switch ($WIZTABLE["MEMBER"]){//다양한 회원정보를 case by case 로 설계
	case "MemberInfo"://	
		if($keyword) $whereis .= " and $keykind like '%$keyword%'";
		$sqlstr = "select count(1) from ".$WIZTABLE["MEMBER"]." $whereis ";
	break;
	default:##wizMembers//
		if($keyword) $whereis .= " and $keykind like '%$keyword%'";
		$sqlstr = "select  count(1) from ".$WIZTABLE["MEMBER"]." m $whereis ";
	break;	
}
	$TOTAL = $dbcon->get_one($sqlstr);


$ListNo=$pg_counts?$pg_counts:10;
$PageNo = 10;

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>▒ wizAvatar  ▒</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="./style.css" type="text/css">
<script language="javascript">
<!--
function CheckStr(strOriginal, strFind, strChange){
   var position, strOri_Length;
   position = strOriginal.indexOf(strFind);

   while (position != -1){
     strOriginal = strOriginal.replace(strFind, strChange);
     position = strOriginal.indexOf(strFind);
  }

  strOri_Length = strOriginal.length;
  return strOri_Length;
}

function returnvalue(id) {
  var f = opener.document.PresentForm;
   f.keyword.value = id;
  // alert(returnvalue)
 	self.close();
}


function findCheck()
{
  if (CheckStr(search_member.keyword.value, " ", "")<3)
  {
     alert("검색어를 3자이상 기입해 주세요");
     search_member.keyword.value= "";
     search_member.keyword.focus();
     return false;
   }
   return true;
}
//-->
</script>
</head>
<body bgcolor="#f0d8e9" leftmargin="10" topmargin="10" marginwidth="0" marginheight="0">
<table width="333" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td height="25"><font color="#B577D2"><strong>아이디 찾기</strong></font></td>
  </tr>
  <tr> 
    <td  height="120" align="center" bgcolor="#FFFFFF"> 
      <table width="90%" border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td align="right">총 <font color=red style="font-family:Tahoma;font-size:9pt;">
                  <?=$TOTAL?>
                  </font> 명</td>
              </tr>
      </table>
            <table width="90%" border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td align="center" width="60" height="20" bgcolor="DCF8F8"><strong><font color="#0099CC">번호</font></strong></td>
                <td align="center" width="110"  bgcolor="DCF8F8"><strong><font color="#0099CC">ID</font></strong></td>
                <td align="center" width="110"  bgcolor="DCF8F8"><strong><font color="#0099CC">이름</font></strong></td>
              </tr>
              <form method="post" name="friinfo">
          <?
$cnt=0;	

	switch ($WIZTABLE["MEMBER"]){
		case "MemberInfo"://	
			$sqlstr = "select * from ".$WIZTABLE["MEMBER"]." $whereis limit $START_NO, $ListNo";
		break;
		default:##wizMembers//
			$sqlstr = "select  m.mname, m.mid from ".$WIZTABLE["MEMBER"]." m $whereis limit $START_NO, $ListNo";
		break;	
	}  
	
	$sqlqry = $dbcon->_query($sqlstr);
	
	while($list=$dbcon->_fetch_array($sqlqry)){
		extract($list);
	  // 아이템 중복 체크 및 성별체크(추후 프로그램 필요)
		switch ($WIZTABLE["MEMBER"]){
			case "MemberInfo"://	
				$user_id = $userid;
				$user_name = $namekr;
			break;
			default:##wizMembers//
				$user_id = $mid;
				$user_name = $mname;
			break;	
		}  

?>			  
                <tr align="center" height="20" onMouseOver="this.style.backgroundColor='#E6E6FA'" onMouseOut="this.style.backgroundColor=''">
                  <td style="font-family:Tahoma;font-size:7pt;"><?=$BOARD_NO1?></td>
                  <td class="userid"><a href="#" onClick='javascript:returnvalue("<?=$user_id?>")'> 
                    <?=$user_id?>

                    </a></td>
                  <td><?=$user_name?></td>
                </tr>
<?
	$cnt++;
	$BOARD_NO1--;
	}

if(!$cnt){
?>
                <tr align="center" height="20" onMouseOver="this.style.backgroundColor='#E6E6FA'" onMouseOut="this.style.backgroundColor=''">
                  <td colspan="3">검색된 친구가 없습니다. </td>
                </tr>
<?
}
?>				
              </form>
            </table>
            <table width="90%" border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "item=$item&page=$next&search=$search&keyword=$keyword&keykind=$keykind";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?></td>
              </tr>
            </table> 
    </td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF"><table width="98%" border="0" align="center" cellpadding="1" cellspacing="1">
        <tr>
          <td bgcolor="#f6e5f1"> 
          
				<!---받을 아이디 테이블 시작-->
				<table width="100%" border="0" cellspacing="5" cellpadding="0">
	          <form name="search_member" method="post">
          <input type="hidden" name="search" value="on">
          <input type="hidden" name="val" value="<?=$val?>">
        <tr>
          <td align="center"><select name="keykind" onChange="select_change(this.options[this.selectedIndex].value)" class="memo">
                <option value="m.mname" <?if($keykind=="m.mname")echo "selected";?>>이름</option>
                <option value="m.mid" <?if($keykind=="m.mid")echo "selected";?>>아이디</option>
              </select>
              <input type="text" name="keyword" value="<?echo $keyword;?>" onKeyPress="if(event.keyCode==13) return findCheck();">
              &nbsp;<a href="javascript:document.search_member.submit();" onClick="JavaScript:return findCheck();" style="cursor:hand;"><img src="./images/find.gif" alt="검색" width="45" height="20" border="0"></a></td>
        </tr></form>
    </table>			<!---받을 아이디 테이블 끝--></td>
        </tr>
      </table>
      <table border="0" align="center" cellpadding="5" cellspacing="0">
        <tr> 
          <td align="center">&nbsp;<a href='javascript:window.close()' onFocus="blur();"><img src="./images/b_close.gif" alt="닫기" width="41" height="18" border="0"></a>          </td>
        </tr>
      </table></td>
  </tr>
</table>
</body>
</html>
