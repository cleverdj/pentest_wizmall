<?
$orderArr = array("t1.wdate"=>"신상품","t1.hitcnt"=>"인기순","t1.name"=>"상품명","t1.buy_p"=>"가격순",);
switch($big_code){
	case "10":
		$titleimg = "<img src='".$cfg["avatar"]["web_skinpath"]."/images/ava_title_05.gif'>";
	break;
	case "20":
		$titleimg = "<img src='".$cfg["avatar"]["web_skinpath"]."/images/ava_title_12.gif'>";
	break;
	case "30":
		$titleimg = "<img src='".$cfg["avatar"]["web_skinpath"]."/images/ava_title_13.gif'>";
	break;		
	case "40":
		$titleimg = "<img src='".$cfg["avatar"]["web_skinpath"]."/images/ava_title_14.gif'>";
	break;
	default:
		$titleimg = "<img src='".$cfg["avatar"]["web_skinpath"]."/images/ava_title_11.gif'>";
	break;
}
?>
<script language="javascript">
<!--
function getOrder(v){
	var f = document.submitForm;
	f.orderby.value = v.value;
	f.submit();
}
//-->
</script>
<form name="submitForm" method="post" action="<?=$PHP_SELF;?>">
<input type="hidden" name="skinmode" value="<?=$skinmode?>">
<input type="hidden" name="code" value="<?=$code?>">
<input type="hidden" name="c_gender" value="<?=$c_gender?>">
<input type="hidden" name="orderby" value="<?=$orderby?>">
</form>
                              <? include ($cfg["avatar"]["sys_skinpath"]."/topbanner.php");?>
                              <!-- 아바타 체험 메뉴 시작 부분-->
                             <? include ($cfg["avatar"]["sys_skinpath"]."/topnavy.php");?>
<table width="685" border="0" align="center" cellpadding="0" cellspacing="0">
                                <tr> 
                                  <td height="45"><?=$titleimg?></td>
                                  <td align="right"><?
						  
if($c_gender==1) { 
?>
<a href='<?=$PHP_SELF?>?skinmode=<?=$skinmode;?>&code=<?=$code;?>&c_gender=2' onfocus="blur()"><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/avata_btn_W.gif" alt="여성아이콘" border="0"></a>
  <?
}else{
?>
 <a href='<?=$PHP_SELF?>?skinmode=<?=$skinmode;?>&code=<?=$code;?>&c_gender=1' onfocus="blur()"><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/avata_btn_M.gif" alt="남성아이콘" border="0"></a>  
  <?
}
	?></td>
                                </tr>
                                <tr bgcolor="eeeeee">
                                  <td height="1" colspan="2"></td>
                                </tr>
                              </table><table width="683" border="0" align="center" cellpadding="0" cellspacing="0">
                                <tr> 
                                  <td width="500" height="30"  style="padding-left:26px;">
                                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
<?
switch(substr($code, -3)){
	case "010"://패션샵
?>                                    
                                      <tr>
                                        <td><a href="./wizavatar.php?skinmode=shop&code=010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">전체보기</font></strong></a> 
            <font color="#af69c9">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=010010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><font color="#af69c9">상의</font></strong></a> 
            <font color="#af69c9">ㅣ</font><a href="./wizavatar.php?skinmode=shop&code=020010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">하의</font></strong></a> 
            <font color="#af69c9">ㅣ</font><a href="./wizavatar.php?skinmode=shop&code=030010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">한벌의상</font></strong></a></strong>
			<font color="#af69c9">ㅣ</font><a href="./wizavatar.php?skinmode=shop&code=040010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">커플의상</font></strong></a></strong>
			<font color="#af69c9">ㅣ</font><a href="./wizavatar.php?skinmode=shop&code=050010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">캐릭터</font></strong></a></strong></td>
                                      </tr>
<?
	break;
	case "020"://미용샵
?>                                      
                                      <tr>
                                        <td><a href="./wizavatar.php?skinmode=shop&code=020&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">전체보기</font></strong></a><strong> 
            <a href="./wizavatar.php?skinmode=shop&code=010020&c_gender=<?=$c_gender?>" onFocus="this.blur()"><font color="#af69c9">ㅣ헤어샵</font></a></strong></td>
                                      </tr>
<?
	break;
	case "030"://소품샵
?>                                      
                                      <tr>
                                        <td><a href="./wizavatar.php?skinmode=shop&code=030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">전체보기</font></strong></a><strong> 
            <font color="#af69c9">ㅣ</font> </strong><a href="./wizavatar.php?skinmode=shop&code=010030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">악세사리</font></strong></a> 
            <font color="#af69c9">ㅣ</font> <a href="./wizavatar.php?skinmode=shop&code=020030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="#af69c9">배경</font></strong></a></strong></td>
                                      </tr>
<?	
	break;
	case "040"://테마샵
?>                                      
                                      <tr>
                                        <td>&nbsp;</td>
                                      </tr>
<?	
	break;		
}
?>                                      
                                    </table></td>
                                  <td align="right">
<select name="orderby" onchange="getOrder(this)">
              <?
foreach($orderArr as $key=>$value){
	$selected = $orderby == $key ? "selected":"";
	echo "<option value='$key' $selected>$value</option>\n";
}
?>							
            </select>
                                  </td>
                                </tr>
                              </table>
      <table width="670" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr> 
<?
$ListNo=$pg_counts?$pg_counts:10;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

switch($orderby){
	case "t1.wdate":
	case "t1.hitcnt":
		$orderbystr = " order by $orderby desc ";
	break;
	case "t1.name":
		$orderbystr = " order by binary $orderby asc ";
	break;	
	case "t1.buy_p":
		$orderbystr = " order by $orderby asc ";
	break;	
	default:
		$orderbystr = " order by t1.wdate desc ";
	break;
}
$orderArr = array("wdate"=>"신상품","hitcnt"=>"인기순","name"=>"상품명","buy_p"=>"가격순",);

//category 000 은 기본 이미지 dp
$whereis = "where defaultflag = 'u' and (gender = '$c_gender' or gender=0)";

if($code){

	$depth = strlen($s_code)/3;
	if($depth == 3){
		$whereis .= " and category = '$code'";
	}else if($depth == 2){
		$whereis .= " and length(category) >= 6 and  right(category, 6) = '$code'";
	}else{
		$whereis .= " and right(category, 3) = '$code'";
	}
}

//echo "whereis1 = $whereis <br>";
//echo "display_zero_money = $display_zero_money <br>";
if(!$display_zero_money){//0원인경우 디스플레이 안함
	$whereis .= " and buy_p <> 0";
}
//echo "whereis2 = $whereis <br>";

/* 총 갯수 구하기 */
$sqlstr = "SELECT count(no) FROM ".$WIZTABLE["AVATARITEM"]." t1 $whereis";
$TOTAL = $dbcon->get_one($sqlstr);

if(empty($CP) || $CP <= 0) $CP = 1;


$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select t1.*  from ".$WIZTABLE["AVATARITEM"]." t1 ";
$sqlstr .= " $whereis ";
$sqlstr .= " $orderbystr limit $START_NO, $ListNo";
$sqlqry = $dbcon->_query($sqlstr);
	
//echo "sqlstr = $sqlstr <br>";
$cnt=0;
while($list=$dbcon->_fetch_array($sqlqry)):
	extract($list);
	switch($gender){
		case "1":
			$genderimg = "<img src='/img/mypage/btn_man.gif' alt='남자전용' />";
		break;
		case "2":
			$genderimg = "<img src='/img/mypage/btn_woman.gif' alt='여자전용' />";
		break;
		case "3":
			$genderimg = "<img src='/img/mypage/btn_unisex2.gif' alt='공용' />";
		break;
	}
	
	if(!$avatar_id){
		$takeon = " onclick=\"alert('로그인해 주시기 바랍니다.')\"";
	}else if($avatar_gender == $gender || $gender==0){
		$takeon = " onclick=\"take_avatar('".$avatarimg1."','".$layer."','".$gender."','".$no."','".$avatarimg2."');\"";
	}else{
		$takeon = " onclick=\"alert('성별이 다릅니다.')\"";
	}
?>		
          <td width="125" valign="top"> 
            <!---하나의 아이템 테이블 시작--->
<?
if(substr($category, -3) == "040"){ //테마샵일 경우 디스플레이 변경
?>	
            <table width="120" border="0" align="center" cellpadding="5" cellspacing="0">
              <tr> 
                <td align="center"><a href="<?=$PHP_SELF;?>?skinmode=avatar_item_view&code=<?=$category?>&no=<?=$list["no"]?>&c_gender=<?=$c_gender?>" onfocus="blur();"><img src="<?=$avatar->getavatarImg($no)?>" width="100" height="100" border="0" align="absmiddle" style="cursor:pointer"></a></td>
              </tr>
              <tr> 
                <td align="center"><a href="<?=$PHP_SELF;?>?skinmode=avatar_item_view&code=<?=$code?>&no=<?=$list["no"]?>&c_gender=<?=$c_gender?>"><strong><font color="FD7E02">
                  <?=$avatar->strCutting($list["name"], 20);?>
                </font></strong></a></td>
              </tr>
            </table>
<?
}else{
?>
<table width="120" border="0" align="center" cellpadding="5" cellspacing="0">
              <tr> 
                <td align="center"><img src="<?=$avatar->getavatarImg($no)?>" width="100" height="100" border="0" align="absmiddle" style="cursor:pointer" <?=$takeon?> /></td>
              </tr>
              <tr> 
                <td align="center"><a href="<?=$PHP_SELF;?>?skinmode=avatar_item_view&code=<?=$category?>&no=<?=$list["no"]?>&c_gender=<?=$c_gender?>"><strong><font color="FD7E02">
                  <?=$common->strCutting($list["name"], 15);?>
                </font></strong></a></td>
              </tr>
              <tr> 
                <td align="center"><img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/mony-ico.gif" width="12" height="11"> 
                  <?=number_format($list["buy_p"])?>
                  개</td>
              </tr>
              <tr> 
                <td align="center"><?
//echo " $avatar_gender == $gender ";
//echo $gender;									
if($avatar_gender == $gender || $gender==0){ //내성별과 상품성별이 같을 경우 구매 아이콘 활성화
?>
                    <img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/purc_ico.gif" alt="구매" width="30" height="14" border="0" onclick="buy_item('<?=$list["no"]?>','','')" style="cursor:pointer">
                    <?
}//if($avatar_gender == $gender){
?> 
                    <img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/pros_ico.gif" alt="선물" width="30" height="14" border="0" onClick="present_item(<?=$list["no"]?>, '','');" style="cursor:pointer"> 
                    <img src="./<?=$cfg["avatar"]["web_skinpath"]?>/images/zzim_ico.gif" alt="찜" width="30" height="14" border="0" onClick="zzim_item(<?=$list["no"]?>, '','');" style="cursor:pointer">                </td>
              </tr>
            </table>
<?
}
?>			
            <!---하나의 아이템 테이블 끝--->
          </td>
<?
	$cnt++;
	if(!($cnt%5)){
		echo "</tr></table>      <table width='670' border='0' align='center' cellpadding='5' cellspacing='0'>
        <tr><td height='1' bgcolor='d3d3d3'></td></tr>
      </table><P style='MARGIN-TOP: 20px'><P style='MARGIN-TOP: 20px'><table width='627' border='0' align='center' cellpadding='0' cellspacing='0'><tr> ";
	}//else echo "<td width='17'>&nbsp;</td>";

endwhile;
	$tmpcnt = $cnt%5;
	if($tmpcnt){
		for($i=$tmpcnt; $i<5; $i++){
			echo "<td width='125' align='center'>&nbsp;</td>";
		}
	}
?>

        </tr>
      </table>

      <table width="670" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="50" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "skinmode=$skinmode&code=$code&c_gender=$c_gender&orderby=$orderby";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='".$cfg["avatar"]["web_skinpath"]."/images/pre.gif' border='0'></a> ";
} else {
echo " <img src='".$cfg["avatar"]["web_skinpath"]."/images/pre.gif' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='".$cfg["avatar"]["web_skinpath"]."/images/next.gif' border='0'></a> ";
} else {
ECHO" <img src='".$cfg["avatar"]["web_skinpath"]."/images/next.gif' border='0'> ";
}
?></td>
        </tr>
      </table>
