<?
$orderArr = array("t1.wdate"=>"신상품","t1.hitcnt"=>"인기순","t1.name"=>"상품명","t1.buy_p"=>"가격순");
switch($regoption){
	case "베스트":
		$titleimg = "<img src='$avatar_skin_path/images/ava_title_08.gif'>";
	break;
	case "신규":
		$titleimg = "<img src='$avatar_skin_path/images/ava_title_09.gif'>";
	break;
	case "인기":
		$titleimg = "<img src='$avatar_skin_path/images/ava_title_10.gif'>";
	break;		
}

?>
<script language="javascript">
<!--
function getOrder(v){
	var f = document.submitForm;
	f.orderby.value = v.value;
	f.submit();
}
//-->
</script>

<form name="submitForm" method="post" action="<?=$PHP_SELF;?>">
  <input type="hidden" name="skinmode" value="<?=$skinmode?>">
  <input type="hidden" name="code" value="<?=$code?>">
  <input type="hidden" name="c_gender" value="<?=$c_gender?>">
  <input type="hidden" name="c_gender" value="<?=$c_gender?>">
  <input type="hidden" name="orderby" value="<?=$orderby?>">
</form>
<? include ($avatar_skin_path."/topbanner.php");?>
<!-- 아바타 체험 메뉴 시작 부분-->
<? include ($avatar_skin_path."/topnavy.php");?>
<table width="676" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="45"><?=$titleimg?></td>
    <td align="right"><select name="orderby" onchange="getOrder(this)">
        <?
foreach($orderArr as $key=>$value){
	$selected = $orderby == $key ? "selected":"";
	echo "<option value='$key' $selected>$value</option>\n";
}
?>
      </select></td>
  </tr>
  <tr bgcolor="eeeeee">
    <td height="1" colspan="2"></td>
  </tr>
</table>
<!---서브 메뉴 부분 테이블 끝--->
<table width="670" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <?
$ListNo=$pg_counts?$pg_counts:10;
$PageNo = 10;
if($i_gender=="") $i_gender=1;

switch($orderby){
	case "t1.wdate":
	case "t1.hitcnt":
		$orderbystr = " order by $orderby desc ";
	break;
	case "t1.name":
		$orderbystr = " order by binary $orderby asc ";
	break;	
	case "t1.buy_p":
		$orderbystr = " order by $orderby asc ";
	break;	
	default:
		$orderbystr = " order by t1.wdate desc ";
	break;
}
$orderArr = array("wdate"=>"신상품","hitcnt"=>"인기순","name"=>"상품명","buy_p"=>"가격순",);



$RegOptionRevArr = array_flip($reg_optionArr);
$tmpkey = $RegOptionRevArr[$regoption];
$pos = $tmpkey*2 + 1;
$whereis = "where SUBSTRING(reg_option,".$pos.",1)= '1' and buy_p <> 0";



//echo "whereis = $whereis <br>";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(no) FROM ".$WIZTABLE["AVATARITEM"]." t1 $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select t1.*  from ".$WIZTABLE["AVATARITEM"]." t1 ";
$sqlstr .= " $whereis ";
$sqlstr .= " $orderbystr limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());
	
//echo "sqlstr = $sqlstr <br>";
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
	$no = $list["no"];
	$avatar->getavatarImg($no);
	$avatarimg0 = $avatar->avatarimg[0]; 
	$avatarimg1 = $avatar->avatarimg[1];
	$avatarimg2 = $avatar->avatarimg[2];
	$i_gender = $list["gender"];
  $check++;
?>
    <td width="125" valign="top"><!---하나의 아이템 테이블 시작--->
      <table width="120" border="0" align="center" cellpadding="5" cellspacing="0">
        <tr>
          <td align="center"><img src="./wizavatar/avatarimg/<?=$avatarimg0?>" width="100" height="100" border="0" align="absmiddle" style="cursor:pointer" <?
								  if($avatar_gender == $i_gender || $i_gender==0)  echo "onclick=\"take_avatar('".$avatarimg1."','".$list[layer]."','".$i_gender."','".$list[no]."','".$avatarimg2."');\""; ?>></td>
        </tr>
        <tr>
          <td align="center"><a href="<?=$PHP_SELF;?>?skinmode=avatar_item_view&no=<?=$list["no"]?>&c_gender=<?=$i_gender?>"><strong><font color="FD7E02">
            <?=$avatar->strCutting($list["name"], 15);?>
            </font></strong></a></td>
        </tr>
        <tr>
          <td align="center"><img src="./<?=$avatar_skin_path?>/images/mony-ico.gif" width="12" height="11">
            <?=number_format($list["buy_p"])?>
            개</td>
        </tr>
        <tr>
          <td align="center"><?
//echo " $avatar_gender == $i_gender ";									
if($avatar_gender == $i_gender || $i_gender==0){ //내성별과 상품성별이 같을 경우 구매 아이콘 활성화
?>
            <img src="./<?=$avatar_skin_path?>/images/purc_ico.gif" alt="구매" width="30" height="14" border="0" onclick="buy_item('<?=$list["no"]?>','','')" style="cursor:pointer">
            <?
}//if($avatar_gender == $i_gender){
?>
            <img src="./<?=$avatar_skin_path?>/images/pros_ico.gif" alt="선물" width="30" height="14" border="0" onClick="present_item(<?=$list["no"]?>, '','');" style="cursor:pointer"> <img src="./<?=$avatar_skin_path?>/images/zzim_ico.gif" alt="찜" width="30" height="14" border="0" onClick="zzim_item(<?=$list["no"]?>, '','');" style="cursor:pointer"> </td>
        </tr>
      </table>
      <!---하나의 아이템 테이블 끝--->
    </td>
    <?
	$cnt++;
	if(!($cnt%5)){
		echo "</tr></table>      <table width='670' border='0' align='center' cellpadding='5' cellspacing='0'>
        <tr><td height='1' bgcolor='d3d3d3'></td></tr>
      </table><P style='MARGIN-TOP: 20px'><P style='MARGIN-TOP: 20px'><table width='627' border='0' align='center' cellpadding='0' cellspacing='0'><tr> ";
	}//else echo "<td width='17'>&nbsp;</td>";

endwhile;
	$tmpcnt = $cnt%5;
	if($tmpcnt){
		for($i=$tmpcnt; $i<5; $i++){
			echo "<td width='125' align='center'>&nbsp;</td>";
		}
	}
?>
  </tr>
</table>
<table width="628" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td width="628" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "skinmode=$skinmode&regoption=$regoption&code=$code&c_gender=$c_gender&orderby=$orderby";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='./$avatar_skin_path/images/pre.gif' border='0' /></a> ";
} else {
echo " <img src='./$avatar_skin_path/images/pre.gif' border='0' /> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='./$avatar_skin_path/images/next.gif' border='0' /></a> ";
} else {
ECHO" <img src='./$avatar_skin_path/images/next.gif' border='0' /> ";
}
?></td>
  </tr>
</table>
