<?
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;
$avatar->avatarpath = "./wizavatar/avatarimg/";

### 1, 2, 3, 4, 5, 6 위 가져오기
### 현재 등록된 컨테스트 리스트에서 최근 기간을 가져와 아래 기간에 세팅한다.
/*
$sqlstr = "select max(edate) from ".$WIZTABLE["AVATARCONTESTTERM"];
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$max_edate = $list[0];

$sqlstr = "select sdate, edate from ".$WIZTABLE["AVATARCONTESTTERM"]." where edate = '$max_edate'";
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$sdate = $list["sdate"];
$edate = $list["edate"];
echo $sdate;
*/
$thisYear = $thisYear ? $thisYear : date("Y");
if(!$thisMonth){
	if(date("m") == 1){
		$thisYear--;
		$thisMonth = 12;
	}else{
		$thisMonth = date("m")-1;
	}
}

$thisDay = $thisDay ? $thisDay : date("d");

if($thisYear == date("Y") && $thisMonth == date("m")){//금번달은 평가되지 않았으므로 return 시킨다.
	echo "<script>alert('평가가 완료되지 않았습니다.');history.back();</script>";
	exit;
}

$thisdate = mktime(0,0,1,$thisMonth, 1, $thisYear);
$sqlstr = "select attached from ".$WIZTABLE["AVATARCONTESTTERM"]." where $thisdate between sdate and edate";
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$attachedimg = split("\|", $list["attached"]);

$sdate = mktime(0,0,0,$thisMonth, 1, $thisYear);
$edate = mktime(0,0,-1,$thisMonth+1, 1, $thisYear);
$whereis = "where contest = 1 and cdate between $sdate and $edate ";
$sqlstr = "select no, user_id, cdate,score,adminscore from ".$WIZTABLE["AVATARALBUM"]." $whereis order by adminscore desc, score desc limit 6";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());

$cnt=0;
$avatar->mode = "photo";
while($list=@mysql_fetch_array($sqlqry)):
	$best_contest_view[$cnt] = $avatar->show_avatar($list[no]);
	$best_contest_no[$cnt] = $list["no"];
	$best_contest_id[$cnt] = $list["user_id"];
	$best_contest_name[$cnt] = $avatar->get_MemInfo($best_contest_id[$cnt], "name");
	$best_contest_cdate[$cnt] = $list["cdate"];
	$best_contest_score[$cnt] = $list["score"];
	$best_contest_adminscore[$cnt] = $list["adminscore"];
	$cnt++;
endwhile;
?>
<script language="javascript">
<!--
	function openContestWindow(no){
		window.open('<?=$avatar_skin_path?>/avatar_contest_detail.php?no='+no,'ContestWindow','width=570, height=639, scrollbars=1');
	}
	
	function gotoContest(){
		var f = document.ContestForm;
		f.submit();
	}	
//-->
</script>
<table width="686" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="33"><img src="image/xgame/sub_title2.gif" width="105" height="18"></td>
    <td><div align="right"><img src="common/home.gif" width="14" height="9">홈 
        &gt; XMAN 놀이터 &gt; 아바타 세상<font color="ff8233"> &gt; 콘테스트</font></div></td>
  </tr>
</table>
<table width="686" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td width="120" height="2" bgcolor="cc53c2"></td>
    <td width="566" bgcolor="e4dfca"></td>
  </tr>
</table>
<P style="MARGIN-TOP: 20px">
  <? 
			  include $avatar_skin_path."/xman_inc2.php";
			  ?>
<P style="MARGIN-TOP: 20px">
  <? 
			  include $avatar_skin_path."/xman_inc3.php";
			  ?>
<P style="MARGIN-TOP: 20px">
<table width="670" border="0" align="center" cellpadding="3" cellspacing="0">
  <tr>
    <td height="30"><img src="image/xgame/avatar_skin/img09.gif" width="113" height="16"></td>
    <td width="78"><img src="image/xgame/avatar_skin/button1.gif" alt="참여하기" width="75" height="20" border="0" onClick="AvatarSaveConfirm()" style="cursor:pointer"></td>
  </tr>
</table>
<table width="656" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="30" colspan="3"><img src="image/xgame/avatar_skin/img10.gif" width="95" height="13"></td>
  </tr>
  <tr>
    <td colspan="3"><img src="image/xgame/avatar_skin/img11.gif" width="656" height="3"></td>
  </tr>
  <tr>
    <td width="3"><img src="image/xgame/avatar_skin/img13.gif" width="3" height="69"></td>
    <td width="650"><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td width="287"><img src="./wizavatar/avatarimg/etc_img/<?=$attachedimg[0]?>" width="287" height="69"></td>
          <td><div align="center"><a href="/wizavatar.php?skinmode=contestlist" onFocus="this.blur()"><img src="image/xgame/avatar_skin/img24.gif" alt="이달의 주제보기" width="352" height="60" border="0"></a></div></td>
        </tr>
      </table></td>
    <td width="3"><img src="image/xgame/avatar_skin/img14.gif" width="3" height="69"></td>
  </tr>
  <tr>
    <td colspan="3"><img src="image/xgame/avatar_skin/img12.gif" width="656" height="3"></td>
  </tr>
</table>
<P style="MARGIN-TOP: 20px">
<table width="670" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="39" background="image/xgame/avatar_skin/img15.gif"><table border="0" align="right" cellpadding="3" cellspacing="0">
        	  <form name="ContestForm" action="<?=$PHP_SELF;?>" method="post">
	  <input type="hidden" name="skinmode" value="<?=$skinmode;?>"><tr>
          <td><select name="thisYear">
<?
for($i=2007; $i<=date("Y"); $i++){
	$selected = $thisYear == $i ? "selected":"";
	echo "<option value='$i' $selected>".$i."년</option>";
}
?>		  
            
          </select></td>
          <td><select name="thisMonth">
<?
for($i=1; $i<=12; $i++){
	$j = sprintf("%02d", $i);
	$selected = $thisMonth == $j ? "selected":"";
	echo "<option value='$i' $selected>".$j."월</option>";
}
?>			
            </select></td>
          <td><img src="image/button/see2.gif" alt="보기" width="36" height="20" border="0" style="cursor:pointer" onclick="gotoContest();"></td>
          <td><strong>아이디</strong></td>
          <td><input name="textfield" type="text" class="input" size="20"></td>
          <td><a href="#" onFocus="this.blur()"><img src="image/button/find.gif" alt="검색" width="45" height="20" border="0"></a></td>
          <td width="5">&nbsp;</td>
        </tr></form>
      </table></td>
  </tr>
</table>
<table width="670" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td background="image/xgame/avatar_skin/img16.gif"><div align="center"><img src="image/xgame/avatar_skin/img25.gif" width="653" height="102"></div></td>
  </tr>
</table>
<P style="MARGIN-TOP: 20px">
<table width="670" border="0" align="center" cellpadding="5" cellspacing="0">
  <tr>
    <td width="213" align="center"><!---1위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img2.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[0]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img3.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" background="image/xgame/avatar_skin/co_img4.gif"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td align="center"><strong><font color="ff7725">
                  <?=$best_contest_name[0]?> 
                  (
                  <?=$best_contest_id[0]?>
                  )</font></strong></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[0]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[0]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---1위 아바타 테이블 끝---->    </td>
    <td width="213" align="center"><!---2위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img6.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[1]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725"><?=$best_contest_name[1]?> 
                    (<?=$best_contest_id[1]?>)</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[1]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[1]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---2위 아바타 테이블 끝---->    </td>
    <td width="214" align="center"><!---3위 아바타 테이블 시작---->
      <table width="204" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img9.gif" width="201" height="49"></td>
        </tr>
        <tr>
          <td width="20"> </td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[2]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td> </td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725"><?=$best_contest_name[2]?> 
                    (<?=$best_contest_id[2]?>)</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[2]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[2]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---3위 아바타 테이블 끝---->    </td>
  </tr>
</table>
<P style="MARGIN-TOP: 20px">
<table width="670" border="0" align="center" cellpadding="5" cellspacing="0">
  <tr>
    <td width="213" align="center"><!---1위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img31.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[3]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725"><?=$best_contest_name[3]?> 
                    (<?=$best_contest_id[3]?>)</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[3]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[3]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---1위 아바타 테이블 끝---->    </td>
    <td width="213" align="center"><!---2위 아바타 테이블 시작---->
      <table width="204" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img32.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[4]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725"><?=$best_contest_name[4]?> 
                    (<?=$best_contest_id[4]?>)</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[4]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[4]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---2위 아바타 테이블 끝---->    </td>
    <td width="214" align="center"><!---3위 아바타 테이블 시작---->
      <table width="204" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"><img src="image/xgame/avatar_skin/co_img33.gif" width="203" height="49"></td>
        </tr>
        <tr>
          <td width="20">&nbsp;</td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img7.gif" width="22" height="200"></td>
          <td width="140" align="center"><?=$best_contest_view[5]?></td>
          <td width="22"><img src="image/xgame/avatar_skin/co_img8.gif" width="22" height="200"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td height="97" colspan="3" bgcolor="#FFFFFF"><table width="150" border="0" align="center" cellpadding="3" cellspacing="0">
              <tr>
                <td><div align="center"><strong><font color="ff7725"><?=$best_contest_name[5]?> 
                    (<?=$best_contest_id[5]?>)</font></strong></div></td>
              </tr>
              <tr>
                <td><div align="center">점수 : <?=$best_contest_adminscore[5]?>점</div></td>
              </tr>
              <tr>
                <td align="center"><img src="image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$best_contest_no[5]?>);" style="cursor:pointer"></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <!---3위 아바타 테이블 끝---->    </td>
  </tr>
</table>
