<?
$list = $avatar->getItemInfo($no);
$ref_item = $list["ref_item"];
$theme_item = $list["theme_item"];
$ref_item_arr  = split("\|", $ref_item);
krsort($ref_item_arr);
reset($ref_item_arr);
$TOTAL = sizeof($ref_item_arr)-1;

$ListNo=$pg_counts?$pg_counts:9;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

if(empty($CP) || $CP <= 0) $CP = 1;
$START_NO = ($CP - 1) * $ListNo;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */
?>
<script language="javascript">
<!--
function getOrder(v){
	var f = document.submitForm;
	f.orderby.value = v.value;
	f.submit();
}
//-->
</script>
<form name="submitForm" method="post" action="<?=$PHP_SELF;?>">
<input type="hidden" name="skinmode" value="<?=$skinmode?>">
<input type="hidden" name="code" value="<?=$code?>">
<input type="hidden" name="c_gender" value="<?=$c_gender?>">
<input type="hidden" name="orderby" value="<?=$orderby?>">
<table width="686" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr> 
          <td height="33"><img src="image/xgame/sub_title2.gif" width="105" height="18"></td>
          <td><div align="right"><img src="common/home.gif" width="14" height="9">홈 
              &gt; XMAN 놀이터 &gt; 아바타 세상<font color="ff8233"> &gt; 테마샵</font></div></td>
        </tr>
</table>
      <table width="686" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td width="120" height="2" bgcolor="cc53c2"></td>
          <td width="566" bgcolor="e4dfca"></td>
        </tr>
      </table>
      <P style="MARGIN-TOP: 20px">
      <? 
			  include $avatar_skin_path."/xman_inc2.php";
			  ?>
      <a href="#" onFocus="this.blur()"></a>
      <P style="MARGIN-TOP: 20px">
      <? 
			  include $avatar_skin_path."/xman_inc3.php";
			  ?>
      <P style="MARGIN-TOP: 20px">
      <table width="670" border="0" align="center" cellpadding="3" cellspacing="0">
        <tr> 
          <td height="50"><?
switch($big_code){
	case "10"://패션샵
?><table width="100%" border="0" align="center" cellpadding="3" cellspacing="0">
        <tr> 
          <td width="76" height="50"><img src="image/xgame/avatar_skin/img05.gif" width="71" height="16"></td>
          <td><a href="./wizavatar.php?skinmode=shop&code=000010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">전체보기</font></strong></a><strong> 
            <font color="19A6C4">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=001010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">상의</font></strong></a> 
            <strong><font color="19A6C4">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=002010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">하의</font></strong></a> 
            <strong><font color="19A6C4">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=003010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">한벌의상</font></strong></a></strong>
			<strong><font color="19A6C4">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=004010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">커플의상</font></strong></a></strong>
			<strong><font color="19A6C4">ㅣ</font></strong><a href="./wizavatar.php?skinmode=shop&code=005010&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">캐릭터</font></strong></a></strong></td>
        </tr>
      </table><?
	break;
	case "20"://미용샵
?><table width="100%" border="0" align="center" cellpadding="3" cellspacing="0">
        <tr> 
          <td width="76" height="50"><img src="image/xgame/avatar_skin/img06.gif" width="71" height="16"></td>
          <td><a href="./wizavatar.php?skinmode=shop&code=000020&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">전체보기</font></strong></a><strong> 
            <a href="./wizavatar.php?skinmode=shop&code=001020&c_gender=<?=$c_gender?>" onFocus="this.blur()"><font color="19A6C4">ㅣ헤어샵</font></a></strong></td>
        </tr>
      </table><?
	break;
	case "30"://소품샵
?><table width="100%" border="0" align="center" cellpadding="3" cellspacing="0">
        <tr> 
          <td width="76" height="50"><img src="image/xgame/avatar_skin/img07.gif" width="71" height="16"></td>
          <td><a href="./wizavatar.php?skinmode=shop&code=000030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">전체보기</font></strong></a><strong> 
            <font color="19A6C4">ㅣ</font> </strong><a href="./wizavatar.php?skinmode=shop&code=001030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">악세사리</font></strong></a> 
            <strong><font color="19A6C4">ㅣ</font></strong> <a href="./wizavatar.php?skinmode=shop&code=002030&c_gender=<?=$c_gender?>" onFocus="this.blur()"><strong><font color="19A6C4">배경</font></strong></a></strong></td>
        </tr>
      </table><?	
	break;
	case "40"://테마샵
?><table width="100%" border="0" align="center" cellpadding="3" cellspacing="0">
        <tr> 
          <td width="76" height="50"><img src="image/xgame/avatar_skin/img08.gif" width="71" height="16"></td>
          <td>&nbsp;</td>
        </tr>
      </table><?	
	break;		
}
?></td>
          <td width="116" align="right">&nbsp;</td>
        </tr>
</table>
      <P style="MARGIN-TOP: 20px"> 
      <table width="656" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr> 
          <td width="200" valign="top"> <table width="186" border="0" cellpadding="0" cellspacing="0">
              <tr> 
                <td><img src="image/xgame/avatar_skin/img18.gif" width="186" height="19"></td>
              </tr>
              <tr> 
                <td height="200" align="center" background="image/xgame/avatar_skin/img19.gif">
<? echo $avatar->show_avatar_theme($theme_item);?></td>
              </tr>
              <tr> 
                <td><img src="image/xgame/avatar_skin/img20.gif" width="186" height="14"></td>
              </tr>
              <tr> 
                <td height="51" background="image/xgame/avatar_skin/img21.gif">
<table width="150" border="0" align="center" cellpadding="2" cellspacing="0">
                    <tr> 
                      <td><img src="image/xgame/avatar_skin/img22.gif" width="10" height="10"></td>
                      <td><strong><font color="FF3188"><?=$list["name"]?></font></strong></td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table></td>
          <td width="427" valign="top"><table width="400" border="0" align="center" cellpadding="0" cellspacing="0">
              <tr> 
<?
$cnt=0;
for( $i = $START_NO; $i < $ListNo + $START_NO; $i++) {
	if($ref_item_arr[$i]){
		$list = $avatar->getItemInfo($ref_item_arr[$i]);
		$subno = $list["no"];
		$i_gender = $list["gender"];

		$avatar->getavatarImg($subno);
		$avatarimg0 = $avatar->avatarimg[0]; 
		$avatarimg1 = $avatar->avatarimg[1];
		$avatarimg2 = $avatar->avatarimg[2];	
		if($list["buy_p"]){
?>			  
                <td width="133" valign="top"> 
                  <!---하나의 아이템 테이블 시작--->
                  <table width="120" border="0" align="center" cellpadding="5" cellspacing="0">
              <tr> 
                <td align="center"><img src="./wizavatar/avatarimg/<?=$avatarimg0?>" width="100" height="100" border="0" align="absmiddle" style="cursor:pointer" <?
								  if($avatar_gender == $i_gender || $i_gender==0)  echo "onclick=\"take_avatar('".$avatarimg1."','".$list[layer]."','".$c_gender."','".$list[no]."','".$avatarimg2."');\""; ?>></td>
              </tr>
              <tr> 
                <td align="center"><a href="<?=$PHP_SELF;?>?skinmode=avatar_item_view&code=<?=$code?>&no=<?=$list["no"]?>&c_gender=<?=$c_gender?>"><strong><font color="FD7E02">
                  <?=$avatar->strCutting($list["name"], 15);?>
                </font></strong></a></td>
              </tr>
              <tr> 
                <td align="center"><img src="./<?=$avatar_skin_path?>/images/mony-ico.gif" width="12" height="11"> 
                  <?=number_format($list["buy_p"])?>
                  개</td>
              </tr>
              <tr> 
                <td align="center"><?
//echo " $avatar_gender == $i_gender ";									
if($avatar_gender == $i_gender || $i_gender==0){ //내성별과 상품성별이 같을 경우 구매 아이콘 활성화
?>
                    <img src="./<?=$avatar_skin_path?>/images/purc_ico.gif" alt="구매" width="30" height="14" border="0" onclick="buy_item('<?=$list["no"]?>','','')" style="cursor:pointer">
                    <?
}//if($avatar_gender == $i_gender){
?> 
                    <img src="./<?=$avatar_skin_path?>/images/pros_ico.gif" alt="선물" width="30" height="14" border="0" onClick="present_item(<?=$list["no"]?>, '','');" style="cursor:pointer"> 
                    <img src="./<?=$avatar_skin_path?>/images/zzim_ico.gif" alt="찜" width="30" height="14" border="0" onClick="zzim_item(<?=$list["no"]?>, '','');" style="cursor:pointer">                </td>
              </tr>
            </table>
                  <!---하나의 아이템 테이블 끝--->
                </td>
<?
	$cnt++;
	if(!($cnt%3)){
		echo "</tr>
</table>
<P style='MARGIN-TOP: 20px'> 
<table width='400' border='0' align='center' cellpadding='0' cellspacing='0'>
<tr> 
<td height='1' bgcolor='D8D8D8'></td>
</tr>
</table>
<P style='MARGIN-TOP: 20px'> 
<table width='400' border='0' align='center' cellpadding='0' cellspacing='0'>
<tr> ";
			}//else echo "<td width='17'>&nbsp;</td>";
		}//if($list["buy_p"]){
	}//if (ref_item_arr[$i];
}//for( $i = $START_NO; $i < $ListNo + $START_NO; $i++) {
	$tmpcnt = $cnt%3;
	if($tmpcnt){
		for($i=$tmpcnt; $i<3; $i++){
			echo "<td width='133' align='center'>&nbsp;</td>";
		}
	}
?>				
              </tr>
            </table>

            <P style="MARGIN-TOP: 20px">
            
            <table width="400" border="0" align="center" cellpadding="0" cellspacing="0">
              <tr> 
                <td width="628" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "skinmode=$skinmode&code=$code&no=$no&c_gender=$c_gender&orderby=$orderby";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'><img src='image/button/pre.gif' width='6' height='5' border='0'></a> ";
} else {
echo " <img src='image/button/pre.gif' width='6' height='5' border='0'> ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'><img src='image/button/next.gif' width='6' height='5' border='0'></a> ";
} else {
ECHO" <img src='image/button/next.gif' width='6' height='5' border='0'> ";
}
?></td>
              </tr>
            </table></td>
        </tr>
      </table>
