<script language="javascript">
<!--
function show_sub_menu(code,c_gender) {
<?
$sqlstr = "select cat_no, cat_name from ".$WIZTABLE["CATEGORY"]." where cat_no < 100 and cat_flag='avatar' order by cat_no asc";
$sqlqry = mysql_query($sqlstr);

while($list = mysql_fetch_array($sqlqry)):
	$big_cat_no = substr($list["cat_no"], -2);
	$substr = "select cat_no, cat_name from ".$WIZTABLE["CATEGORY"]." where cat_no < 10000 and cat_no >= 100 and substring(cat_no, 5, 2) = $big_cat_no and cat_flag='avatar' order by cat_no asc";
	$subqry = mysql_query($substr) or die($substr."<br>".mysql_error());
	echo "if(code == ".$big_cat_no.") {\ndocument.all.submenu.innerHTML = \"";
	$cnt = 0;
	while($sublist = mysql_fetch_array($subqry)):
		$mid_cat_no = $sublist["cat_no"];
		$mid_cat_name = $sublist["cat_name"];
		$addsplit = $cnt ? " | " : "";
	 echo " $addsplit <a href='wizavatar.php?code=$mid_cat_no&c_gender=\"+c_gender+\"'>".$mid_cat_name."</a> ";
	 $cnt++;
	endwhile;
	echo "\";\n}\n";
endwhile;
?>
}
//-->
</script>

<table width="520" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F8F8F8" align="center" height="50"><table width="500" border="0" cellspacing="1" cellpadding="0" bgcolor="E4E4E4">
        <tr>
          <td><table width="500" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
              <tr>
                <td bgcolor="#F8F8F8" width="20">&nbsp;</td>
                <td bgcolor="#F8F8F8" height="20"><?
$sqlstr = "select cat_no, cat_name from ".$WIZTABLE["CATEGORY"]." where cat_no < 100 and cat_flag='avatar' order by cat_no asc";
$sqlqry = mysql_query($sqlstr);
$cnt = 0;
while($list = mysql_fetch_array($sqlqry)):
	$addsplit = $cnt ? " | " : " ";
	echo $addsplit. "<a href=\"wizavatar.php?code=".$list["cat_no"]."&c_gender=".$c_gender."\" class=\"TTL_link\" onmouseover=\"show_sub_menu(".substr($list["cat_no"], -2).",'$gender')\">".$list["cat_name"]."</a>";
$cnt++;
endwhile;

?>
                </td>
              </tr>
            </table></td>
        </tr>
        <tr>
          <td><table width="500" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
              <tr>
                <td bgcolor="#F8F8F8" width="20">&nbsp;</td>
                <td bgcolor="#F8F8F8" height="20"><font color="#666666">
                  <div id="submenu"></div>
                  </font></td>
              </tr>
            </table></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td height="10"></td>
  </tr>
  <tr>
    <td bgcolor="#FAFAFA" align="right"><?
	//echo "gender = $gender <br>";
if($c_gender==1) { 
?>
      <a href='<?=$PHP_SELF?>?c_gender=2'><img src='<?=$avatar_skin_path?>/images/avatar1.gif' width='109' height='20' border='0'></a>
      <?
}elseif($c_gender==2) {
?>
      <a href='<?=$PHP_SELF?>?c_gender=1'><img src='<?=$avatar_skin_path?>/images/avatar.gif' width='109' height='20' border='0'></a>
      <?
}
	?></td>
  </tr>
  <tr>
    <td bgcolor="#FAFAFA" align="right" height="10"></td>
  </tr>
  <tr>
    <td bgcolor="#FAFAFA" align="center"><!-- List Start -->
      <table width=95% align="center">
        <tr>
          <td width=100% bgcolor="#dddddd" height=1></td>
        </tr>
      </table>
      <table border="0" cellspacing="0" cellpadding="0" align="center">
        <tr>
          <td width="189">&nbsp;</td>
          <td width="189">&nbsp;</td>
        </tr>
        <tr>
<?
$ListNo=$pg_counts?$pg_counts:10;
$PageNo = 10;
if($c_gender=="") $c_gender=1;

$tmpcode = intval($code);
if($tmpcode < 100){
	$newcode = substr($code, -2);
}else if($tmpcode < 10000){
	$newcode = substr($code, -4);
}else if($tmpcode < 1000000){
	$newcode = substr($code, -6);
}
$whereis = "where category <> '000000' and (gender = '$c_gender' or gender=0)";
if($newcode) $whereis .= " and category like '%$newcode'";
//echo "whereis = $whereis <br>";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(no) FROM ".$WIZTABLE["AVATARITEM"]." t1 $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
$sqlstr = "select t1.*  from ".$WIZTABLE["AVATARITEM"]." t1 ";
$sqlstr .= " $whereis ";
$sqlstr .= " order by t1.no desc limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());
	
//echo "sqlstr = $sqlstr <br>";
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
	$no = $list["no"];
	$avatar->getavatarImg($no);
	$avatarimg0 = $avatar->avatarimg[0]; 
	$avatarimg1 = $avatar->avatarimg[1];
  $check++;
?>
          <td width='189' align="center"><table width='187' border='0' cellspacing='1' cellpadding='0' bgcolor='#CFD0CF' height='95'>
              <tr>
                <td align="center"><table width='187' border='0' cellspacing='1' cellpadding='0' bgcolor='#FFFFFF' height='95'>
                    <tr>
                      <td width='5'>&nbsp;</td>
                      <td width='77'><table width='77' border='0' cellspacing='1' cellpadding='0' bgcolor='#CFD0CF' height='77'>
                          <tr>
                            <td><table width='77' border='0' cellspacing='0' cellpadding='0' bgcolor='#FFFFFF' height='77'>
                                <tr>
                                  <td align="center">
                                      <img src="./wizavatar/avatarimg/<?=$avatarimg0?>" width="50" border="0" align="absmiddle" style="cursor:pointer" <?
								  if($avatar_gender == $c_gender || $c_gender==0)  echo "onclick=\"take_avatar('".$avatarimg1."','".$list[layer]."','".$c_gender."','".$list[no]."');\""; ?>>
                               </td>
                                </tr>
                            </table></td>
                          </tr>
                      </table></td>
                      <td class='TTL_body_5px' valign='top'><br />
                          <span class='TTL_link1'>
                          <?=latest_text($list[name],12)?>
                          </span><br />
                          <img src='<?=$avatar_skin_path?>/images/write_num.gif' />
                          <?=$list[buy_p]?>
                          <br />
                          <a href='<?=$PHP_SELF;?>?skinmode=avatar_item_view&no=<?=$list[no]?>&c_gender=<?=$c_gender?>' class='TTL_link'><font color='#000080'>☞ 상세보기</font></a><br />
                          <br />
                          <?
//echo "나의성별 = ".$member_c_gender." <br>";
    if($avatar_gender == $c_gender){ 

?>
                          <a href='javascript:buy_item("<?=$list["no"]?>")'>[구매]</a> <a href='javascript:present_item("<?=$list["no"]?>","")'>[선물]</a>
                          <?
      }else{
?>
                          <a href="javascript:present_item('<?=$list["no"]?>','')">[선물]</a>
                          <?
      }
  
?>
                      </td>
                    </tr>
                </table></td>
              </tr>
          </table></td>
          <?
	$cnt++;
	if(!($cnt%2)){
		echo "</tr>
<tr>
<td width='189'>&nbsp;</td>
<td width='189'></td>
</tr>
<tr>";
	}

endwhile;
	$tmpcnt = $cnt%2;
	if($tmpcnt){
		for($i=$tmpcnt; $i<2; $i++){
			echo "<td width='189' align='center'>";
		}
	}
?>
        </tr>
      </table>
      <table width=100% align="center">
        <tr>
          <td width=100% bgcolor="#dddddd" height=1></td>
        </tr>
      </table>
      <table width=100%>
        <tr>
          <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "skinmode=$skinmode&code=$code&c_gender=$c_gender";	
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?>
          </td>
        </tr>
      </table>
      <table width=100% align="center">
        <tr>
          <td width=100% bgcolor="#dddddd" height=1></td>
        </tr>
      </table>
      <!-- List End --></td>
  </tr>
  <tr>
    <td bgcolor="#FAFAFA" align="center" height="10"></td>
  </tr>
</table>
