<?
include "./inc.depth2.php";
?>

<script language="javascript">
<!--
/// 아래는 아바타 관련
function ch_face(item_id,face_no,a_src,face_layer){
		createXMLHttpRequest();
		var url = "/wizavatar/avatarProc.php";
		var queryString = "mode=changFace&item_id="+item_id+"&face_no="+face_no+"&a_src="+a_src+"&face_layer="+face_layer ;
		//alert(queryString)
		xmlHttp.open("POST", url, true);
		//xmlHttp.onreadystatechange = handleStateChange;
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
		xmlHttp.send(queryString);
		document.images["ImgChar"+face_layer].src= "<?=$avatar->avatarpath?>face_img/"+a_src
		//alert(document.images["ImgChar9"].src);
		
}
//-->
</script>
<!-- 아바타 관련 시작 -->
<script language="JavaScript" src="/wizavatar/avatarjs.php"></script>
<script>
<!--

<?
switch($avatar_gender){
	case "2"://여성
		$avatarIniimg[0] = "default_w_top9.gif";
		$avatarIniimg[1] = "default_w_bottom9.gif";
		$avatarIniimg[2] = "default_w_head9.gif";
	break;
	default://남성
		$avatarIniimg[0] = "default_m_top9.gif";
		$avatarIniimg[1] = "default_m_bottom9.gif";
		$avatarIniimg[2] = "default_m_head9.gif";
	break;		
}
?>
naked_avatar = new Array(20);
<?
echo "naked_avatar[10] = '".$avatarIniimg[0]."';\n";	
echo "naked_avatar[12] = '".$avatarIniimg[1]."';\n";
echo "naked_avatar[9] = '".$avatarIniimg[2]."';\n";
?>


function origin_avatar() {
<?
	for($i=1; $i<=19; $i++){
		switch($i){
			case "10"://상의
				switch($avatar_gender){
					case "2"://여성
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_w_top9.gif";
					break;
					default:
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_m_top9.gif";
					break;
				}
			break;
			case "12"://하의
				switch($avatar_gender){
					case "2"://여성
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_w_bottom9.gif";
					break;
					default:
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_m_bottom9.gif";		
					break;
				}			
			break;
			case "9"://얼굴
				switch($avatar_gender){
					case "2"://여성
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_w_head9.gif";
					break;
					default:
						$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_m_head9.gif";
					break;
				}			
			break;	
			default:
				$avatarimg[$i] = $avatarimg[$i]!="default_blank.gif"?$avatarimg[$i]:"default_blank.gif";	
			break;
		}
		echo "origin_ch('".$avatarimg[$i]."','".$i."');\n";	
	}
		
?>
	avatar_trim();//레이어의 중첩여부를 책크하여 아바타의 중복을 피한다	
	item = new Array(20);//현재 배열에 담긴 아바타 초기화
	ResetPresentAvatar();//세션에 담긴 아바타 초기화
}
<?
	for($i=1; $i<=19; $i++){
		$avatarimg[$i] = $avatarimg[$i]?$avatarimg[$i]:"default_blank.gif";
		echo "origin_avatar_".$i."_src = '".$avatarimg[$i]."';\n";
	}
?>


//-->
</script>
<? if (!$cfg["member"]){ ?>
<!--로그인 플로우 구성 -->
<? } else { ?>
<?=$avatar->show_avatar($avatar_id);?><script language="javascript">
<!--
<?
$avatar->getAvatarSession();

if($_SESSION["avatar_face"]["name"]){
	echo "document.images[\"ImgChar".$_SESSION["avatar_face"]["layer"]."\"].src= \"".$avatar->avatarpath."face_img/".$_SESSION["avatar_face"]["name"]."\"";
}
?>
	
faceimg0 = new Array(5);
faceimg1 = new Array(5);
function changeFaceBox(item_id,facelayer,faceimg0, faceimg1){
	var faceBox="";
	//alert(item_id+","+facelayer+","+faceimg0+","+faceimg1)
	
	faceBox = "<table width='100%' border='0' cellspacing='0' cellpadding='0'>"+
				"<tr>"+
				"<td bgcolor='#ffd8f0'><table width='100%' border='0' cellspacing='0' cellpadding='0'>"+
				"<tr>"+
				"<td align='center'><img id='ImgFace1' src='<?=$avatar->avatarpath?>face_img/"+faceimg0[0]+"' width='26' height='27' border='0' alt='기본' style='cursor:pointer' onclick='ch_face("+item_id+",\"0\",\""+faceimg1[0]+"\", "+facelayer+");'></td>"+
				"<td width='2' bgcolor='#FFFFFF'> </td>"+
				"<td align='center'><img id='ImgFace2' src='<?=$avatar->avatarpath?>face_img/"+faceimg0[1]+"' width='26' height='27' border='0' alt='웃음' style='cursor:pointer' onclick='ch_face("+item_id+",\"1\",\""+faceimg1[1]+"\", "+facelayer+");'></td>"+
				"<td width='2' bgcolor='#FFFFFF'> </td>"+
				"<td align='center'><img id='ImgFace3' src='<?=$avatar->avatarpath?>face_img/"+faceimg0[2]+"' width='26' height='27' border='0' alt='울음' style='cursor:pointer' onclick='ch_face("+item_id+",\"2\",\""+faceimg1[2]+"\", "+facelayer+");'></td>"+
				"<td width='2' bgcolor='#FFFFFF'> </td>"+
				"<td align='center'><img id='ImgFace4' src='<?=$avatar->avatarpath?>face_img/"+faceimg0[3]+"' width='26' height='27' border='0' alt='화남' style='cursor:pointer' onclick='ch_face("+item_id+",\"3\",\""+faceimg1[3]+"\", "+facelayer+");'></td>"+
				"<td width='2' bgcolor='#FFFFFF'> </td>"+
				"<td align='center'><img id='ImgFace5' src='<?=$avatar->avatarpath?>face_img/"+faceimg0[4]+"' width='26' height='27' border='0' alt='황당' style='cursor:pointer' onclick='ch_face("+item_id+",\"4\",\""+faceimg1[4]+"\", "+facelayer+");'></td>"+
				"</tr>"+
				"</table></td>"+
				"</tr>"+
				"<tr>"+
				"<td height='1' bgcolor='#ffd8f0'></td>"+
				"</tr>"+
				"</table>";
				
				document.getElementById("ImgFace").innerHTML = faceBox;
/*				
   if (document.layers){  
        document.layers.ImgFace.document.write(faceBox);  
        document.layers.ImgFace.document.close();  
    }else{  
        if (document.all){  
            ImgFace.innerHTML = faceBox;
        }  
    }
	*/				
}

//alert(document.images["ImgChar9"].src);

if(getAvatarFilename(document.images["ImgChar13"].src) != "default_blank.gif" ){//한벌의상이면
	getInitAvatarFace(getAvatarFilename(document.images["ImgChar13"].src),'13');
}else if(getAvatarFilename(document.images["ImgChar9"].src) != "default_blank.gif"){//얼굴이면
	getInitAvatarFace(getAvatarFilename(document.images["ImgChar9"].src),'9');
}else if(getAvatarFilename(document.images["ImgChar17"].src) != "default_blank.gif"){//테마의상
	getInitAvatarFace(getAvatarFilename(document.images["ImgChar17"].src),'17');
}

<?
$facelist = $avatar->getFaceList1();
for($i=0; $i<5; $i++){
	$j = $i+1;
	echo "faceimg0[$i] = \"".$facelist["i"][$j]."\";\n";
	echo "faceimg1[$i] = \"".$facelist["a"][$j]."\";\n";
}
?>
//-->
</script>
<? } ?>
