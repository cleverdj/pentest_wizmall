<?
//include_once $DOCUMENT_ROOT."/lib/cfg.avatar.php";
include_once $DOCUMENT_ROOT."/wizavatar/include/inc.depth2.php";
?>
/**********************************************
전역변수
설명:
전체 function 는 전역변수를 사용한다.
**********************************************/
/*********************************************
input_ch(a_src,layer,gender) : 아바타 이미지 문자 입력하는 부분
init_d(layer.gender) : 디스플레이 삭제
**********************************************/
var layercnt = <?=$avatar->getlayercnt();?>;
var ImgChar; // 아바타 레이어
var ava; // 아바타 디스플레이 레이어
var item = new Array(layercnt) // 아이템 저장
var tmpArr = new Array(layercnt) // 아이템 저장(현재 입고 있는 아이템)
var patten = /[default_blank.gif]/   //패턴용
var ini_imgname = new Array(layercnt) // 초기 아바타 이미지(아바타 샵에서 임시적으로 입기 이전의 초기 입은 모습
var curr_imgname = new Array(layercnt) // 현재 착용(임시적)하고 있는 아바타 모습
var naked_avatar = new Array(layercnt) // 현재 아무 착용이 없을 경우의 아바타
var last; // 마지막 사용
var i;
var AvatarImgPath="/wizavatar/avatarimg/"; // 공용 url
var tmp;
var a_src;
var layer;
var gender;
var tem_no;
var patten = /^(.*)default_blank.gif+$/; 
var xmlHttp;


ini_avatar();//사용자에 관한 아바타 초기 값을 구한다.

function ini_avatar(){//초기 아바타 정보 가져오기
	var tmpavatar = "<?=$avatar->getshowinitName($avatar_id)?>";
	ini_imgname = tmpavatar.split(",");//초기 및 현재 착용모습을 모두 초기화 시킨다.
    var tmpavatar1 = "<?=$avatar->getshowinitName($avatar_id, "s")?>";
    curr_imgname = tmpavatar1.split(",");
    var tmpavatar2 = "<?=$avatar->getnaked()?>";
    naked_avatar = tmpavatar2.split(",");    
}

function temp(k){

	if(curr_imgname[k] == "default_blank.gif") return false;
	else { return true; }
} // 임시

function o_public_ch(layer){
	document.images["ImgChar"+layer].src=AvatarImgPath+curr_imgname[layer];
}

function public_ch(src,layer,gender){
	document.images["ImgChar"+layer].src=AvatarImgPath+src;

//	if ( layer != 9 ) document.images["ava"+layer].src=AvatarImgPath+src;
//원래프로그램 ; 레이어변동후 입고 있는 아바타 리스트 출력하기
}

function ch_avatar(item_no, layer){//내옷장에서 아바타 변경
    $.post("<?=$avatar_root?>/avatarProc.php", {mode:"updatemyon",no:item_no,layer:layer}, function (data){
        //성공
        // alert(data);
        //alert(layer);
        var result=data.split("|");//avatar_src|layer"
        //input_ch1(src1, src2, layer);//??????
        document.images["ImgChar"+layer].src=result[0];
        //eval("TakeOffBtn"+layer+".style.display='block'");
        //ch_avatarface();
    });
}

function ch_avatar1(imgname, layer){//단순하게 특정레이어의 이미지만 변경
	document.images["ImgChar"+layer].src=AvatarImgPath+imgname;
}



function s_src(a_src,layer) { // 변수 등록해주기
	if (layer != "" ){
		curr_imgname[layer]=a_src;
		last=layer;
	}
}

//function take_avatar(a_src,layer,gender,item_no,a_src1){   // 아바타 바꾸기(기존:한번클릭시 입히고 또한번 클릭시 벗김
function take_avatar(a_src,layer,gender,item_no,a_src1){   // 아바타 바꾸기(만약 실시간으로 db에저장(mypage)하려면 이후 saveavatar를 추가해준다.
	//a_src: 아바타 이미지, layer : 레이어번호, gender : 아이템성, item_no : 아이템 고유번호, a_src1 : 추가레이어(뒷머리);
//alert(a_src+","+layer+","+gender+","+item_no);
	if(curr_imgname[layer] != a_src){
		savetmpavatar(layer, 'plus', a_src);
		item[layer]= item_no;
		take_avatar_on(a_src,layer);
		//if(layer == "9" && a_src1 != ""){//9:얼굴
		//	take_avatar_on(a_src1,'16');//뒷헤어착용
		//}
	}else {
    	//alert('여기');
    	take_avatar_off(layer);
		//take_avatar_off(a_src,layer,gender,item_no) ;
		//if(layer == "9" && a_src1 != ""){//9:얼굴
		//	take_avatar_off(a_src1,'16',gender,item_no);//뒷헤어벗기기
		//}		
	}

	////changeAvatarFace(item_no,layer);//아바타 표정 변경
	//ch_avatarface(); 금번프로젝트에서는 사용안함
	// 상체, 하체 얼굴이 없을 경우 기본값으로 변경
}

function avatar_trim(){//현재레이어 값을 가져와 필요없는 부분정리
	if(getAvatarFilename(document.images["ImgChar13"].src) != "default_blank.gif" ){//한벌의상을 입었으면
		//ch_avatar1("default_blank.gif",'10');//상의
		//ch_avatar1("default_blank.gif",'12');//하의
		//ch_avatar1("default_blank.gif",'9');//얼굴
		//ch_avatar1("default_blank.gif",'16');//뒷헤어
		//ch_avatar1("default_blank.gif",'17');//테마의상
	}else if(getAvatarFilename(document.images["ImgChar17"].src) != "default_blank.gif"){//테마의상
		//ch_avatar1("default_blank.gif",'10');//상의
		//ch_avatar1("default_blank.gif",'12');//하의
		//ch_avatar1("default_blank.gif",'9');//얼굴
		//ch_avatar1("default_blank.gif",'16');//뒷헤어
		//ch_avatar1("default_blank.gif",'17');//테마의상
	}
}

function ch_avatarface(){
	if(getAvatarFilename(document.images["ImgChar13"].src) != "default_blank.gif" ){//한벌의상이면
		getInitAvatarFace(getAvatarFilename(document.images["ImgChar13"].src),'13');
	}else if(getAvatarFilename(document.images["ImgChar9"].src) != "default_blank.gif"){//얼굴이면
		getInitAvatarFace(getAvatarFilename(document.images["ImgChar9"].src),'9');
	}else if(getAvatarFilename(document.images["ImgChar17"].src) != "default_blank.gif"){//테마의상
		getInitAvatarFace(getAvatarFilename(document.images["ImgChar17"].src),'17');
	}
}

function take_session_avatar(a_src,layer,gender,item_no,a_src1){   // 세션으로부터 아바타 변경
	take_avatar(a_src,layer,gender,item_no,a_src1);
}

function take_avatar_on(a_src,layer){
       
        document.images["ImgChar"+layer].src=a_src;
        curr_imgname[layer] = a_src;
        //last=layer;
            
        /*
	if(!patten.test(document.images["ImgChar13"].src)){ //한벌의상(13)이 현재 입혀져 있으면 기존 아바타 복원
		if(layer == "8" || layer == "10" || layer == "12" || layer == "9" || layer == "15" || layer == "16"){
				origin_ch1(origin_avatar_8_src,8);
				origin_ch1(origin_avatar_9_src,9);
				origin_ch1(origin_avatar_10_src,10);
				origin_ch1(origin_avatar_12_src,12);
				origin_ch1(origin_avatar_9_src,9);
				origin_ch1(origin_avatar_15_src,15);
				origin_ch1(origin_avatar_16_src,16);
				makeBlank(13);//한벌의상
		}
	}else if(!patten.test(document.images["ImgChar17"].src)){ //테마의상(17)이 현재 입혀져 있으면 기존 아바타 복원
		if(layer == "8" || layer == "10" || layer == "12" || layer == "9" || layer == "15" || layer == "16"){
				origin_ch1(origin_avatar_8_src,8);
				origin_ch1(origin_avatar_9_src,9);
				origin_ch1(origin_avatar_10_src,10);
				origin_ch1(origin_avatar_12_src,12);
				origin_ch1(origin_avatar_9_src,9);
				origin_ch1(origin_avatar_15_src,15);
				origin_ch1(origin_avatar_16_src,16);
				makeBlank(17);//한벌의상
		}
	}

	switch(layer){ 
		case("13")://한벌의상:앞헤어, 얼굴, 상의 하의 , 뒤헤어를 삭제
			curr_imgname[13]=a_src;last=layer;
			document.images["ImgChar"+layer].src=AvatarImgPath+a_src;	
			makeBlank(8);//프론트헤어
			makeBlank(9);//얼굴	
			makeBlank(10);//상의
			makeBlank(12);//하의
			makeBlank(15);//신발
			makeBlank(16);//뒷헤어
			makeBlank(17);//테마의상
		break;		
		case("17")://테마의상:앞헤어, 얼굴, 상의 하의 , 뒤헤어를 삭제
			curr_imgname[17]=a_src;last=layer;
			document.images["ImgChar"+layer].src=AvatarImgPath+a_src;
			makeBlank(8);//프론트헤어	
			makeBlank(9);//얼굴	
			makeBlank(10);//상의
			makeBlank(12);//하의
			makeBlank(13);//한벌의상
			makeBlank(15);//신발
			makeBlank(16);//뒷헤어
		break;										
		default: 
		//alert(layer+','+a_src);
			document.images["ImgChar"+layer].src=AvatarImgPath+a_src;
			curr_imgname[layer] = a_src;
			last=layer;
		break; 
	} 
    */
}

function changeAvatarFace(item_no,layer){
	if(layer == "9" || layer == "13" || layer == "17"){  
		createXMLHttpRequest();
		var url = "<?=$avatar_root?>/avatarProc.php";
		var queryString = "mode=getAvatarFace&item_no="+item_no+"&layer="+layer;
		xmlHttp.open("POST", url, true);
		xmlHttp.onreadystatechange = changeAvatarFaceResult;
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
		xmlHttp.send(queryString);
	}	
}	

function changeAvatarFaceResult(){
	alert(xmlHttp.readyState)
    if(xmlHttp.readyState == 4) {
        if(xmlHttp.status == 200) {
			var item_no = xmlHttp.responseXML.getElementsByTagName("item_no")[0].firstChild.data;	
			alert(item_no);
			//changeFaceBox('<?=$myavatar->item_id;?>','<?=$myavatar->facelayer?>',faceimg0,faceimg1)				
        }else{
			alert('<?=$avatar_root?>/avatarProc.php\n접속실패(2)');
		}
    }
}

function makeBlank(layer){
	curr_imgname[layer]="";
	document.images["ImgChar"+layer].src=AvatarImgPath+"default_blank.gif";
	//alert(layer+','+document.images["ImgChar"+layer].src);
}

function changeAllFace(item_no,layer){
	// layer : 13: 한벌의상, 9:얼굴, 17: 테마의상 일경우 모든 표정값을 바꾼다.
	if(layer == "13" || layer == "9" || layer == "17"){
		createXMLHttpRequest();
		var url = "<?=$avatar_root?>/avatarProc.php";
		var mode = "avatarTmpReset";
		var queryString = "mode=changeAllFace&item_no="+item_no;
		xmlHttp.open("POST", url, true);
		xmlHttp.onreadystatechange = handleStatechangeAllFace;
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
		xmlHttp.send(queryString);
	}
}

function handleStatechangeAllFace() {
    if(xmlHttp.readyState == 4) {
        if(xmlHttp.status == 200) {
			var ImgFace1 = xmlHttp.responseXML.getElementsByTagName("ImgFace1")[0].firstChild.data;
			var ImgFace2 = xmlHttp.responseXML.getElementsByTagName("ImgFace2")[0].firstChild.data;
			var ImgFace3 = xmlHttp.responseXML.getElementsByTagName("ImgFace3")[0].firstChild.data;
			var ImgFace4 = xmlHttp.responseXML.getElementsByTagName("ImgFace4")[0].firstChild.data;
			var ImgFace5 = xmlHttp.responseXML.getElementsByTagName("ImgFace5")[0].firstChild.data;
			if(result == "1"){
				//alert(layer+","+gender);
                take_avatar_off(layer);
				//take_avatar_off(a_src,layer,gender,item_no);
				location.reload();
			}
        }else{
			alert('<?=$avatar_root?>/avatarProc.php\n접속실패(3)');
		}
    }
}

function take_avatar_off(layer) {//옷벗기
	//alert(curr_imgname[layer]+", "+ini_imgname[layer]);
    curr_imgname[layer]=ini_imgname[layer];//배열에 현재 입고 있는 값 변경
    take_avatar_on(ini_imgname[layer],layer);//아바타 변경
    /*origin_src = eval("origin_avatar_"+layer+"_src");
	//alert(origin_src+", "+a_src);
	savetmpavatar(layer, 'minus', ini_imgname[layer]);
	//현재아이템이 테마의상(17) 혹은 한벌의상(13) 일경우 기존 아바타를 모두 복원
	switch(layer){
		case "13":
		break;
		case "17":
			origin_ch1(origin_avatar_8_src,8);//프론트헤어
			origin_ch1(origin_avatar_10_src,10);//상의
			origin_ch1(origin_avatar_12_src,12);//하의
			origin_ch1(origin_avatar_9_src,9);//얼굴
			origin_ch1(origin_avatar_15_src,15);//신발
			origin_ch1(origin_src,layer);
		break;
		default:
			origin_ch1(origin_src,layer);
		break;
	}
    */
}

//function take_off_one(a_src,layer,gender,item_no) {//옷장에서 옷벗기
function take_off_one(layer) {//옷장에서 옷벗기
    document.images["ImgChar"+layer].src= naked_avatar[layer];
    savetmpavatar(layer, 'minus', "");
    //location.reload();
    //updateCurrentAvatar();//현재 아바타를 기준으로 db 초기화
}

function origin_ch(a_src,layer) { // 기본 아바타로 돌리기
	if (layer != "" ){
		curr_imgname[layer]=a_src;
		last=layer;
	}

	ImgChar = "ImgChar"+layer;
	ava = "ava"+layer;
	o_public_ch(layer);

	for(h=1; h<=item.length; h=h+1) {
		item[h]= "";
	}
}

function origin_ch1(a_src,layer){  // 이전아바타로 돌리기
	if (layer != "" ){
		curr_imgname[layer]=a_src;
		last=layer;
	}

  ImgChar = "ImgChar"+layer;
  ava = "ava"+layer;
  o_public_ch(layer);

  item[layer]= "";
}


function get_iniava(){  // 원래대로
	for(i=0; i<layercnt; i++){//현재 레이어 변경
    	document.images["ImgChar"+i].src=ini_imgname[i];
        curr_imgname[i] = ini_imgname[i];
    }
    //세션 초기화
	$.post("<?=$avatar_root?>/avatarProc.php", {mode:"inisession"}, function (data){
    });    
}
/*
function naked_ch(layer){  // 초기설정 아바타로 돌리기(옷장에서 실행)
	//alert(document.images["ImgChar"+layer].src)
	document.images["ImgChar"+layer].src=AvatarImgPath+naked_avatar[layer];
}
*/
function input_ch(a_src,layer){
	take_avatar_on(a_src,layer);
}

function input_ch1(a_src1,a_src2,layer){//얼굴포함
	take_avatar_on(a_src1,layer);
	if(layer == "9") take_avatar_on(a_src2,'16');
}
function buy_item(item_no){
	var items = "";
	
	if(item_no){//아바타샵에서 한개씩 구매일경우
		url = "<?=$avatar_skin_webpath?>/avatar_buy_item.php?item="+item_no;
		wizwindow(url, 'ItemWindow', 'width=360, height=400, scrollbars=no, resizable=no');
	}else{//현재 착용한 아이템 구매일 경우
    	var eachitem = false;
        for(i=0; i< layercnt; i++){
        	if(ini_imgname[i] != curr_imgname[i]){
            	eachitem = true; 
            }
        }
        /*
		for(h=1; h<=item.length; h++) {
			if(item[h]) items = items + item[h]+"-";
		}
        */
		if(!eachitem){
			alert ("장착한 아이템이 없습니다.");
		}else{ 
			url = "<?=$avatar_skin_webpath?>/avatar_buy_item.php?smode=multibuy";
			wizwindow(url, 'ItemWindow', 'width=380, height=450, scrollbars=yes, resizable=no');
		}
	}
}

function buy_item_pop(item_no){
	url = "./avatar_buy_item.php?item="+item_no;
	wizwindow(url, 'ItemWindow', 'width=360, height=400, scrollbars=no, resizable=no');
}

function present_item(item_no, my_item_no,layer) {
	url = "<?=$avatar_skin_webpath?>/avatar_present_item.php?item_no="+item_no+"&my_item_no="+my_item_no;
	if(!my_item_no){
		wizwindow(url, 'ItemWindow', 'width=360, height=450, scrollbars=no, resizable=no');
	}else{
		wizwindow(url, 'ItemWindow', 'width=360, height=350, scrollbars=no, resizable=no');
	}
}

function present_item_pop(item_no) {
	url = "./avatar_present_item.php?item_no="+item_no;
	wizwindow(url, 'ItemWindow', 'width=360, height=450, scrollbars=no, resizable=no');
}

function zzim_item(item_no){
	url = "<?=$avatar_skin_webpath?>/avatar_pop.php?mode=zzim&item_no="+item_no;
	wizwindow(url, 'ZZimWindow', 'width=512, height=400, scrollbars=1, resizable=no');
}

function viewPresentWindow(mode){
	url = "<?=$avatar_skin_webpath?>/avatar_pop.php?mode="+mode
	wizwindow(url, 'ZZimWindow', 'width=512, height=400, scrollbars=1, resizable=no');
}

function sale_item(item_no, my_item_no, layer){//아이템판매
	url = "<?=$avatar_skin_webpath?>/avatar_sale_item.php?item_no="+item_no+"&my_item_no="+my_item_no+"&layer="+layer;
	wizwindow(url, 'ItemWindow', 'width=360, height=340, scrollbars=no, resizable=no');
}

function Item_del(my_item_no, layer) {
	if(confirm('선택하신 아이템을 삭제하시겠습니까?')){
        $.post("<?=$avatar_root?>/avatarProc.php", {mode:"del",my_item_no:my_item_no,layer:layer}, function (data){
            //성공
            //take_avatar_off(a_src,layer,gender,item_no);
            //take_avatar_off(layer);
            location.reload();
        });
    }
}

function Movepage(pagenum){//페이지 이동에 관한 함수
	//현재 저장된 정보를 세션에 저장
	location.href = pagenum;
}


///////////////////////////////// Ajax관련 시작
function createXMLHttpRequest() {
	if (window.ActiveXObject) {
		xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
	} 
	else if (window.XMLHttpRequest) {
		xmlHttp = new XMLHttpRequest();                
	}
}

function updateCurrentAvatar() {//현재 아바타로 모든 것을 초기화
	createXMLHttpRequest();
	//현재 입고 있는 정보를 배열에 저장
	
	for(i=1; i<=tmpArr.length; i++){
		tmpArr[i] = document.images["ImgChar"+i].src;
	}

	var url = "<?=$avatar_root?>/avatarProc.php";
	var queryString = "mode=InitialUpdate&fullsrc[1]=" + tmpArr[1] + "&fullsrc[2]=" + tmpArr[2] + "&fullsrc[3]=" + tmpArr[3] + "&fullsrc[4]=" + tmpArr[4] + "&fullsrc[5]=" + tmpArr[5] + "&fullsrc[6]=" + tmpArr[6] + "&fullsrc[7]=" + tmpArr[7] + "&fullsrc[8]=" + tmpArr[8] + "&fullsrc[9]=" + tmpArr[9] + "&fullsrc[10]=" + tmpArr[2] + "&fullsrc[10]=" + tmpArr[2] + "&fullsrc[11]=" + tmpArr[11] + "&fullsrc[12]=" + tmpArr[12] + "&fullsrc[13]=" + tmpArr[13] + "&fullsrc[14]=" + tmpArr[14] + "&fullsrc[15]=" + tmpArr[15] + "&fullsrc[16]=" + tmpArr[16] + "&fullsrc[17]=" + tmpArr[17] + "&fullsrc[18]=" + tmpArr[18] + "&fullsrc[19]=" + tmpArr[19];
	//alert(queryString);
	xmlHttp.open("POST", url, true);
	xmlHttp.onreadystatechange = handleStateChange;
	xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
	xmlHttp.send(queryString);
}

function savetmpavatar(layer,flag,src) {//현재 입고있는 아이템의 레이어 부분을 현재와 동기화 시킨다.(페이징이나 타 페이지로 갈경우도 현재 값 유지(완전 세이브는 아니고 일시적인 저장임)
	//layer : 레이어 번호, flag:plus or minus, src : 아바타명
    if(src == undefined) src = "";
    $.post("<?=$avatar_root?>/avatarProc.php", {mode:"avatarTmpSave",layer:layer,flag:flag,src:src}, function (data){
    	//alert(data);
    	//성공
    });
}

function saveavatar() {//현재입고 있는 아마타 저장(mypage 용)
    $.post("<?=$avatar_root?>/avatarProc.php", {mode:"avatarSave"}, function (data){
    	//alert(data);
    });
}


function ResetPresentAvatar(){
    $.post("<?=$avatar_root?>/avatarProc.php", {mode:"avatarTmpReset"}, function (data){
    	//성공
    });
}


///////////////////////////////// Ajax관련 끝

function setAvatarCookie( name, value, expiredays){ 
        var todayDate = new Date(); 
        todayDate.setDate( todayDate.getDate() + expiredays ); 
        document.cookie = name + "=" + escape( value ) + "; path=/; expires=" + todayDate.toGMTString() + ";" 
} 

function getAvatarCookie( name ) {        
	var nameOfCookie = name + "=";
	var x = 0;
	while ( x <= document.cookie.length ){
		var y = (x+nameOfCookie.length);
		if ( document.cookie.substring( x, y ) == nameOfCookie ) {
			if ( (endOfCookie=document.cookie.indexOf( ";", y )) == -1 ) 
			endOfCookie = document.cookie.length; 
			return unescape( document.cookie.substring( y, endOfCookie ) ); 
		}
		x = document.cookie.indexOf( " ", x ) + 1;
		if ( x == 0 )
		break;
	}
	return "";
}

function getAvatarFilename(src){
	var to_length = src.lastIndexOf("/");
	var full_length = src.length;
	var src_file_name = src.substring(to_length+1,full_length);
	return src_file_name
}



/// 아래는 아바타 관련
function ch_face(item_id,face_no,a_src,face_layer){
		createXMLHttpRequest();
		var url = "<?=$avatar_root?>/avatarProc.php";
		var queryString = "mode=changFace&item_id="+item_id+"&face_no="+face_no+"&a_src="+a_src+"&face_layer="+face_layer ;
		//alert(queryString)
		xmlHttp.open("POST", url, true);
		//xmlHttp.onreadystatechange = handleStateChange;
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
		xmlHttp.send(queryString);
		document.images["ImgChar"+face_layer].src= "<?=$avatar->avatarpath?>face_img/"+a_src
		//alert(document.images["ImgChar9"].src);
		
}

//페이스 관련
function getAvatarFilename(src){
	var to_length = src.lastIndexOf("/");
	var full_length = src.length;
	var src_file_name = src.substring(to_length+1,full_length);
	return src_file_name
}

function getInitAvatarFace(src_name,layer){
	createXMLHttpRequest();
	var url = "<?=$avatar_root?>/avatarProc.php";
	var queryString = "mode=getAvatarFacebyimgname&src_name="+src_name+"&layer="+layer;
	//document.getElementById("errmsg").innerHTML = queryString;
	xmlHttp.open("POST", url, true);
	xmlHttp.onreadystatechange = getInitAvatarFaceResult;
	xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");    
	xmlHttp.send(queryString);
}	

function getInitAvatarFaceResult(){
	//document.getElementById("errmsg").innerHTML = xmlHttp.status;
/* 금번프로젝트에서는 사용안함
    if(xmlHttp.readyState == 4) {
        if(xmlHttp.status == 200) {
			var item_no = xmlHttp.responseXML.getElementsByTagName("item_no")[0].firstChild.data;	
			var layer = xmlHttp.responseXML.getElementsByTagName("layer")[0].firstChild.data;
			faceimg0[0] = xmlHttp.responseXML.getElementsByTagName("facei1")[0].firstChild.data;
			faceimg1[0] = xmlHttp.responseXML.getElementsByTagName("facea1")[0].firstChild.data;
			faceimg0[1] = xmlHttp.responseXML.getElementsByTagName("facei2")[0].firstChild.data;
			faceimg1[1] = xmlHttp.responseXML.getElementsByTagName("facea2")[0].firstChild.data;
			faceimg0[2] = xmlHttp.responseXML.getElementsByTagName("facei3")[0].firstChild.data;
			faceimg1[2] = xmlHttp.responseXML.getElementsByTagName("facea3")[0].firstChild.data;
			faceimg0[3] = xmlHttp.responseXML.getElementsByTagName("facei4")[0].firstChild.data;
			faceimg1[3] = xmlHttp.responseXML.getElementsByTagName("facea4")[0].firstChild.data;
			faceimg0[4] = xmlHttp.responseXML.getElementsByTagName("facei5")[0].firstChild.data;
			faceimg1[4] = xmlHttp.responseXML.getElementsByTagName("facea5")[0].firstChild.data;
			document.getElementById("errmsg").innerHTML = item_no+","+layer+","+faceimg0+","+faceimg1;
			changeFaceBox(item_no,layer,faceimg0,faceimg1)				
        }else{
			alert('<?=$avatar_root?>/avatarProc.php\n접속실패');
		}
    }
*/
}

function getnaked(){//모두 벗기 선택
    $.post("<?=$avatar_root?>/avatarProc.php", {mode:"getnaked"}, function (data){
        //성공
        //alert(data);
        var result=data.split("|");//avatar_src|layer"
       	for(i=0; i < result.length; i++){
			eval("document.images['ImgChar"+i+"'].src='"+result[i]+"'");
        }
    });
}

function AvatarSave(){
	var url = "<?=$avatar_skin_webpath?>/avatar_album_save.php?mode=insertAlbum";
	window.open(url,'avatar_album','left=50,top=50,width=360,height=450,toolbar=no,scrollbars=no');
}
function AvatarSaveConfirm(){
	if(confirm('구매하지 않은 아이템에 대해서는 저장되지 않습니다\n저장하시겠습니까?')){
		AvatarSave()
	}

}