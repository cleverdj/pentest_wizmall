<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
?>
<?
include_once ("./ROOT_CHECK.php");
include_once $avavar_root."lib/class.avatar.php";
include_once ($avavar_root."config/avatar_array.php");
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;

//include "./lib/admin_cls.php";
//$avataradmin = new Avataradmin_Cls($MYSQL_HOST, $MYSQL_DB, $MYSQL_ID, $MYSQL_PASSWORD);

if($query == "delete"){
	$sqlstr = "delete from ".$WIZTABLE["AVATARCONTESTTERM"]." where no = '$no'";
	mysql_query($sqlstr);
}

function getAttno($sdate, $edate){
	global $WIZTABLE;
	$sqlstr = "select count(1) from ".$WIZTABLE["AVATARALBUM"]." where cdate between $sdate and $edate ";
	//echo $sqlstr;
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	return $list[0];
}
?>

<script language=javascript>
<!--
function gotoWrite(){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contest1_write"
}

function gotoModify(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contest1_write&mode=update&no="+no;
}

function gotoDel(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=<?=$theme;?>&query=delete&no="+no;
}

function gotoEva(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contestatt_list&contestno="+no;
}
//-->
</script>
<?
$ListNo=$pg_counts?$pg_counts:20;
$PageNo = 10;
$whereis = "where 1 ";

/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(no) FROM ".$WIZTABLE["AVATARCONTESTTERM"]." $whereis";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));


	$sqlstr = "select *  from ".$WIZTABLE["AVATARCONTESTTERM"]."  $whereis order by no desc limit $START_NO, $ListNo";
	$sqlqry = mysql_query($sqlstr) or die($sqlstr);
$cnt=0;
?>
<fieldset class="desc">
<legend>콘테스트 기간 설정</legend>
<div id="notice">[note]</div>
<div id="comment">콘테스트를 설정 관리하실 수 있습니다.</div>
</fieldset>
<p></p>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td align="right"><input type="button" name="Button" value="등록하기" onClick="gotoWrite();"; style="cursor:pointer"></td>
        </tr>
      </table>
      

<table  class="table_main">
              <tr>
                <td align="center" bgcolor="E0E4E8"><strong>콘테스트명</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>기간</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>참여자수</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>평가</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>수정</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>삭제</strong></td>
              </tr>	
<?
while($list=@mysql_fetch_array($sqlqry)):
$attached = split("\|", $list["attached"]);
?>	  
<tr>
                <td align="center" bgcolor="#FFFFFF">&nbsp;
                  <table width="100%" border="0" cellspacing="0" cellpadding="0" class="s1">
                    <tr>
                      <td><? if($attached[0]): ?>
                      <img src="../wizavatar/avatarimg/etc_img/<?=$attached[0]?>">                        <? endif; ?></td>
                    </tr>
                    <tr>
                      <td><?=$list["subject"]?></td>
                    </tr>
                  </table></td>
                <td align="center" bgcolor="#FFFFFF">&nbsp;<?=date("Y.m.d", $list["sdate"])?>~<?=date("Y.m.d", $list["edate"])?></td>
                <td align="center" bgcolor="#FFFFFF"><?=number_format(getAttno($list["sdate"], $list["edate"]));?></td>
                <td align="center" bgcolor="#FFFFFF"><input type="button" name="Button2" value="평가하기" onClick="gotoEva('<?=$list["no"]?>');"; style="cursor:pointer"></td>
                <td align="center" bgcolor="#FFFFFF"><input type="button" name="Submit2" value="수정하기" onClick="gotoModify('<?=$list["no"]?>');"; style="cursor:pointer"></td>
                <td align="center" bgcolor="#FFFFFF"><input type="button" name="Button" value="삭제하기" onClick="gotoDel('<?=$list["no"]?>');"; style="cursor:pointer"></td>
        </tr>
<?
$BOARD_NO1--;
$cnt++;
endwhile;
?>
      </table>
<br>

<TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
  <tr>
    <td align="center" bgcolor="#ffffff" ><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "menushow=$menushow&theme=$theme&Category1=$Category1&Category2=$Category2&gender=$gender";
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?>    </td>
  </tr>
</table>
