<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

include ("./ROOT_CHECK.php");
include ($avavar_root."config/avatar_array.php");

function getRefArr ($RefValue){
	global $DB_CONNECT;
	$RefArr = split("\|", $RefValue);
	$j=0;
	$str = "";
	for($i=0; $i<count($RefArr); $i++){
		if($RefArr[$i]){
			$substr = "select TITLE from ISTORYWAREITEM where SEQ = '$RefArr[$i]'";
			$substmt = ociparse($dbconn, $substr);
			ociexecute($substmt);
			$list = oci_fetch_array($substmt);
			
			$str .= "<option value='".$RefArr[$i]."' selected='selected'>".$list["TITLE"]."</option>\n";
			$j++;
		}
	}
	if(!$j){
		$str =  "<option value=''></option>";
	}
	
	echo $str;
}

?>

<script language="javascript" src="../../js/jquery.plugins/selectboxes.js"></script>
<script language=javascript>
<!--
function getCategory(v, step) {
	//alert("alue="+v.value+"&step="+step);
	if(step == 1) $("#Category2").removeOption(/./);
	else if(step == 2) $("#Category3").removeOption(/./);
		$.ajax({
		
			type: "GET",
			url: "./avatar/search_category.php",
			data: "value="+v.value+"&step="+step,//특정변수값을 주어서 결과를 받을때
			
			dataType: "xml",
			success: function(xml) {
				$(xml).find('channel').each(function(){
					var cat_no = $(this).find('cat_no').text();
					var cat_name = $(this).find('cat_name').text();
					//alert(step);
					if(step == 1) $("#Category2").addOption(cat_no, cat_name, false);
					else if(step == 2) $("#Category3").addOption(cat_no, cat_name, false);	
					
				}); //close each(
			}//close function(xml)
		}); //close $.ajax(

} //close $(

function check_submit(f){
	 var tmparr = "";
	if(!f.tmp_ref_item) tmp_ref_item = new Array(); 

	if(f.itemname.value == ""){
		alert('아이템이름을 입력하세요');
		f.itemname.focus();
		return false;
	}else if(f.Category1.value == ""){
		alert('분류1을 입력하세요');
		f.Category1.focus();
		return false;
	}else if(f.Category2.value == ""){
		alert('분류2를 입력하세요');
		f.Category2.focus();
		return false;
	}else if(f.gender.value == ""){
		alert('성별을을 입력하세요');
		f.gender.focus();
		return false;
	}else if(f.layer.value == ""){
		alert('사용레이어를 입력하세요');
		f.layer.focus();
		return false;
	}
	
	if(f.tmp_ref_item){
		var length = f.tmp_ref_item.length
		for (i = 0; i < length; i++){
			tmparr = tmparr+f.tmp_ref_item[i].value +"|";
		}
		f.ref_item.value = tmparr
		tmparr = "";
	}
	
	return true;
	
}

function findItem(textname) {
	window.open("./avatar/avatar_ref_item.php?formname=avataradm&textname="+textname, "NavDir", "scrollbars=yes, toolbar=no, resizable, left=268, top=134, width=650, height=500") ;
}
//-->
</script>
<fieldset class="desc">
<legend>아바타 추가하기</legend>
<div id="notice">[note]</div>
<div id="comment"> </div>
</fieldset>
<p></p>
      <form action="./avatar/avatarProc.php" method="post" enctype="multipart/form-data" name="avataradm" onSubmit="return check_submit(this);">
        <input type="hidden" name="query" value="insert">
        <input type="hidden" name="menushow" value="<?=$menushow?>">
        <input type="hidden" name="theme" value="<?=$theme?>">
		<input type="hidden" name="ref_item" value="">
        <table  class="table_main">
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">아이템이름</td>
            <td bgcolor="#ffffff"><input type="text" name="itemname" size="30" maxlength="100" class="dd1"></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">분류1</td>
            <td bgcolor="#ffffff"><select name="Category1" onchange="getCategory(this, 1);" id="Category1">
                <option value="" selected>대분류 </option>
                <option value="">----------------</option>
<?
$mall->getSelectCategory("1", $list["category"], "wizavatar");
?>
              </select></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">분류2</td>
            <td bgcolor="#ffffff"><select name="Category2" id="Category2">
                <option value="" selected>중분류</option>
                <?
if($mode == "update"){
$mall->getSelectCategory("2", $list["category"], "wizavatar");
}
?>
                <option value="">----------------</option>
              </select></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">성별</td>
            <td bgcolor="#ffffff"><select name="gender">
                <option value="0">공동</option>
                <option value="1">남</option>
                <option value="2">여</option>
              </select></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">디스플레이용</td>
            <td bgcolor="#ffffff"><input name='file[0]' type='file' class="dd1" id="file[0]" size='30' maxlength='255'>
            (100*100)</td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">실제아바타</td>
            <td bgcolor="#ffffff"><input name='file[1]' type='file' class="dd1" id="file[1]" size='30' maxlength='255'></td>
          </tr>	
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">뒷헤어아바타</td>
            <td bgcolor="#ffffff"><input name='file[2]' type='file' class="dd1" id="file[2]" size='30' maxlength='255'>
            (헤어선택시 뒷헤어까지 포함) </td>
          </tr>			  	  
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">레이어</td>
            <td bgcolor="#ffffff"><select name='layer'>
                <?
foreach($LayerArr as $key => $value){			
echo "<option value='$key'>$value</option>\n";
}
?>
              </select>
            (얼굴, 한벌의상 선택시 목록에서 표정관리까지 하실 수 있습니다.)</td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">판매갯수</td>
            <td bgcolor="#ffffff"><input type='text' name='jaego' size='10' maxlength='20' value="0" class="dd1"></td>
          </tr>		  
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">살때포인트</td>
            <td bgcolor="#ffffff"><input type='text' name='buy_p' size='10' maxlength='20' value="0" class="dd1"></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">팔때포인트</td>
            <td bgcolor="#ffffff"><input type='text' name='sale_p' size='10' maxlength='20' value="0" class="dd1"></td>
          </tr>
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">등록옵션</td>
            <td bgcolor="#ffffff"><?
reset($reg_optionArr);
$OptionArr = split("\|", $list[reg_option]);
while(list($key, $value)=each($reg_optionArr)):
	$checked = $OptionArr[$key] ? "checked":"";
	echo "<input type='checkbox' name='Multi_Option[".$key."]' value='1' $checked >".$value."&nbsp; ";
endwhile;
?></td>
          </tr>	
          <tr>
            <td width=90 bgcolor="E0E4E8" align="center">관련아이템</td>
            <td bgcolor="#ffffff"><select name="tmp_ref_item" size="5"  multiple="multiple" class="dd1" id="tmp_ref_item" style="width:300px" readonly>
<?
//getRefArr($list["REFSEQ"]);
?>
            </select>
            <input type="button" name='SnapshotSrch102' value='찾아보기' onClick="findItem('tmp_ref_item')" /></td>
          </tr>			  	  
        </table>
        <table width="500" align="center">
          <tr>
            <td align="center"><input type="submit" name="Submit" value="확인" /></td>
          </tr>
        </table>
      </form>
