<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
?>
<?
include ("./ROOT_CHECK.php");
include_once ("../../lib/class.avatar.php");
include_once ("../../config/avatar_array.php");
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;

function getRefArr ($RefValue){
	global $WIZTABLE;
	$RefArr = split("\|", $RefValue);
	$j=0;
	$str = "";
	for($i=0; $i<count($RefArr); $i++){
		if($RefArr[$i]){
			$sqlstr = "select name from ".$WIZTABLE["AVATARITEM"]." where no = '$RefArr[$i]'";
			//echo $sqlstr;
			$sqlqry = mysql_query($sqlstr);
			$list = mysql_fetch_array($sqlqry);
			$str .= "<option value='".$RefArr[$i]."' selected='selected'>".$list["name"]."</option>\n";
			$j++;
		}
	}
	if(!$j){
		$str =  "<option value=''></option>";
	}
	
	echo $str;
}

$sqlstr = "select * from ".$WIZTABLE["AVATARITEM"]." where no = '$no'";
//echo $sqlstr;
$sqlqry = mysql_query($sqlstr);
$list = mysql_fetch_array($sqlqry);
$no 		= $list["no"];
$ref_item 	= $list["ref_item"];
$theme_item  = $list["theme_item"];
$oldfilename1 = $list["filename1"]."|".$list["filename2"]."|".$list["filename3"]
?>
<script language="javascript" src="../../js/jquery.plugins/selectboxes.js"></script>
<script language=javascript>
<!--
function getCategory(v, step) {
	//alert("alue="+v.value+"&step="+step);
	if(step == 1) $("#Category2").removeOption(/./);
	else if(step == 2) $("#Category3").removeOption(/./);
		$.ajax({
		
			type: "GET",
			url: "./avatar/search_category.php",
			data: "value="+v.value+"&step="+step,//특정변수값을 주어서 결과를 받을때
			
			dataType: "xml",
			success: function(xml) {
				$(xml).find('channel').each(function(){
					var cat_no = $(this).find('cat_no').text();
					var cat_name = $(this).find('cat_name').text();
					//alert(step);
					//alert(cat_no);
					if(step == 1) $("#Category2").addOption(cat_no, cat_name, false);
					else if(step == 2) $("#Category3").addOption(cat_no, cat_name, false);	
					
				}); //close each(
			}//close function(xml)
		}); //close $.ajax(

} //close $(

function check_submit1() {
	var f = document.avataradm
	 var tmparr = "";
	if(!f.tmp_ref_item) tmp_ref_item = new Array(); 	
	if(!f.itemname.value){
		alert('아이템 이름을 입력하여 주세요.');
		f.itemname.focus();
		return false;
	}else if(f.Category1.value == 0){
		alert('분류1을 선택하여 주세요.');
		f.Category1.focus();
		return false;
	}else if(f.Category2.value == 0){
		alert('분류2을 선택하여 주세요.');
		f.Category2.focus();
		return false;
	}
	if(f.tmp_ref_item){
		var length = f.tmp_ref_item.length
		for (i = 0; i < length; i++){
			tmparr = tmparr+f.tmp_ref_item[i].value +"|";
		}
		f.ref_item.value = tmparr
		tmparr = "";
	}	
	if(f.tmp_theme_item){
		var length = f.tmp_theme_item.length
		for (i = 0; i < length; i++){
			tmparr = tmparr+f.tmp_theme_item[i].value +"|";
		}
		f.theme_item.value = tmparr
		tmparr = "";
	}		
}

function findItem(textname) {
	window.open("./avatar/avatar_ref_item.php?formname=avataradm&textname="+textname, "NavDir", "scrollbars=yes, toolbar=no, resizable, left=268, top=134, width=650, height=500") ;
}
//-->
</script>

<table  border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td height="8"></td>
    <td height="8"></td>
  </tr>
  <tr>
    <td></td>
    <td valign="top"><table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1">
        <TR>
          <TD bgColor=#ffffff><strong><font color="#FF6600">아바타 수정하기 </font></strong></TD>
        </TR>
        <TR>
          <TD bgColor=#ffffff><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0 class="s1">
              <TR>
                <TD vAlign=top align=center width=70><font color=#ff6600>[note]</font> </TD>
                <TD>아이템 성별과 레이어는 자동으로 선택되어 나타납니다.<br>
                  수정하실때 꼭 <strong>분류</strong>를 선택하여 주세요.</TD>
              </TR>
            </TABLE></TD>
        </TR>
      </TABLE>
      <br>
      <br>
      <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
        <form action="avatar/avatarProc.php" method="post" name="avataradm" onsubmit="return check_submit1()" enctype="multipart/form-data">
          <input type="hidden" name="query" value="update">
          <input type="hidden" name="page" value="<?=$page?>">
          <input type="hidden" name="no" value="<?=$no?>">
          <input type="hidden" name="menushow" value="<?=$menushow?>">
          <input type="hidden" name="theme" value="<?=$theme?>">
          <input type="hidden" name="oldfilename1" value="<?=$oldfilename1?>">
		  <input type="hidden" name="Category1" value="<?=$Category1?>">
		  <input type="hidden" name="Category2" value="<?=$Category2?>">
		  <input type="hidden" name="gender" value="<?=$gender?>">
		  <input type="hidden" name="ref_item" value="">
		  <input type="hidden" name="theme_item" value="">
          <tr>
            <td bgcolor="#FFFFFF"><table width="500" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td bgcolor="#d9d9d9" height="1"></td>
                </tr>
              </table>
              <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
                <tr>
                  <td rowspan="11" valign="top" bgcolor="#FFFFFF"><!--  디스플레이 아이템 -->
                    <img src='../wizavatar/avatarimg/<?=$list["filename1"]?>' width="100" height="100" border=0></td>
                  <td width=90 height="28" align=middle bgcolor="E0E4E8"><b>이름</b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><input type="Text" name="itemname" value="<?=$list[name]?>" class="dd1">
                  </td>
                  <td width="90" height="28" align=middle bgcolor="E0E4E8"><b>성별<br>
                    </b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><select name=gender>
                      <option value=0 <? if($list[gender]==0) echo "selected";?>>공동</option>
                      <option value=1 <? if($list[gender]==1) echo "selected";?>>남</option>
                      <option value=2 <? if($list[gender]==2) echo "selected";?>>여</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>분류</b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><select name="Category1" onchange="getCategory(this, 1);" id="Category1">
                <option value="" selected>대분류 </option>
                <option value="">----------------</option>
<?
$mall->getSelectCategory("1", $list["category"], "wizavatar");
?>
              </select>
                    <select name="Category2" id="Category2">
                      <option value="" selected>중분류</option>
                      <option value="">----------------</option>
                      <?
if($no){
$mall->getSelectCategory("2", $list["category"], "wizavatar");
}
?>
                      
                    </select>
                  </td>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>레이어<font color="#F5F5F5"></font></b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><select name=layer>
                      <?
foreach($LayerArr as $key=>$value){
	$selected = $list["layer"] == $key?"selected":"";
	echo "<option value='$key' $selected>$value</option>\n";
}
?>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>살때</b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><input type='text' name='buy_p' size='10' maxlength='20' value="<?=$list["buy_p"]?>" class="dd1"></td>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>팔때<font color="#F5F5F5"></font></b></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><input type='text' name='sale_p' size='10' maxlength='20' value="<?=$list["sale_p"]?>" class="dd1"></td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><strong>등록옵션</strong></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><?
reset($reg_optionArr);
$OptionArr = split("\|", $list[reg_option]);
while(list($key, $value)=each($reg_optionArr)):
	$checked = $OptionArr[$key] ? "checked":"";
	echo "<input type='checkbox' name='Multi_Option[".$key."]' value='1' $checked >".$value."&nbsp; ";
endwhile;
?></td>
                  <td height="28" align=middle bgcolor="E0E4E8"><strong>현재재고</strong></td>
                  <td height="28" bgcolor="#FFFFFF" class="TTL_body_5px"><input type='text' name='jaego' size='10' maxlength='20' class="dd1"  value="<?=$list["jaego"]?>"></td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>디스플레이용</b></td>
                  <td height="28" colspan="3" bgcolor="#FFFFFF" class="TTL_body_5px"><input name='file[0]' type='file' class="dd1" id="file[0]" size='30' maxlength='255'>
                    <input type="checkbox" name="del_file[0]" value="1" />
                    파일삭제
                    (100*100)</td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>실제아바타</b></td>
                  <td height="28" colspan="3" bgcolor="#FFFFFF" class="TTL_body_5px"><input name='file[1]' type='file' class="dd1" id="file[1]" size='30' maxlength='255'> <input type="checkbox" name="del_file[1]" value="1" />
                    파일삭제</td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>뒷헤어아바타</b></td>
                  <td height="28" colspan="3" bgcolor="#FFFFFF" class="TTL_body_5px"><input name='file[2]' type='file' class="dd1" id="file[2]" size='30' maxlength='255'> <input type="checkbox" name="del_file[2]" value="1" />
                    파일삭제</td>
                </tr>
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>테마착용아이템</b></td>
                  <td height="28" colspan="3" bgcolor="#FFFFFF" class="TTL_body_5px"><select name="tmp_theme_item" size="5"  multiple="multiple" class="dd1" id="tmp_theme_item" style="width:300px" readonly>
<?
getRefArr($theme_item);
?>
            </select>
            <input type="button" name='SnapshotSrch102' value='찾아보기' onClick="findItem('tmp_theme_item')" /></td>
                </tr>				
                <tr>
                  <td height="28" align=middle bgcolor="E0E4E8"><b>관련아이템</b></td>
                  <td height="28" colspan="3" bgcolor="#FFFFFF" class="TTL_body_5px"><select name="tmp_ref_item" size="5"  multiple="multiple" class="dd1" id="tmp_ref_item" style="width:300px" readonly>
<?
getRefArr($ref_item);
?>
            </select>
            <input type="button" name='SnapshotSrch102' value='찾아보기' onClick="findItem('tmp_ref_item')" /></td>
                </tr>									
                <tr>
                  <td height="28" colspan="4" align=middle bgcolor="#FFFFFF"><textarea name=memo  cols=100%  rows=5 class=dd1><?=$list[memo]?>
</textarea></td>
                </tr>
              </table>
          <tr align="center">
            <td colspan=6 bgcolor="#FFFFFF"><br>
              <input type="submit" name="Submit" value="확인" />
              <input type="button" name="Submit2" value="목록" onclick="location.href='<?=$PHP_SELF;?>?menushow=<?=$menushow;?>&theme=avatar/avatar_list&Category1=<?=$Category1?>&Category2=<?=$Category2?>&gender=<?=$gender?>'" style="cursor:hand">
              <br>
              <br>
            </td>
          </tr>
        </form>
      </table>
      <br>
      <br></td>
  </tr>
</table>
<form name="onItem">
<!-- 입고 있는 아이템 리스트 -->
<input type=checkbox value='<?=$list[name]?>'
                        name="SelectedLink[<?=$no?>]" <? echo $SelectedLink[$no]?"checked":"";?>>
</form>
