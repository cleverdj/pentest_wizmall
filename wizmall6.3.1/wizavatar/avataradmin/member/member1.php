<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
?>
<?
include_once ("./ROOT_CHECK.php");
include_once "../../lib/class.avatar.php";
include_once ("../../config/avatar_array.php");
include_once ("../../config/avatar_config.php");
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;

if($query == "delete"){
	$avatar->deleteUser($userid);
}
?>
<script language=javascript>
<!--
function deleteMember(userid){
	if(confirm('현재 아바타와 관련된 정보만 삭제됩니다.\n삭제하시겠습니까?')){
		location.href='<?=$PHP_SELF;?>?menushow=<?=$menushow;?>&theme=<?=$theme;?>&query=delete&userid='+userid;
	}

}
//-->
</script>
<table  border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td height="8"></td>
    <td height="8"></td>
  </tr>
  <tr>
    <td></td>
    <td valign="top"><table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1">
        <TR>
          <TD bgColor=#ffffff><strong><font color="#FF6600">회원리스트</font></strong></TD>
        </TR>
        <TR>
          <TD bgColor=#ffffff><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0 class="s1">
              <TR>
                <TD vAlign=top align=center width=70><font color=#ff6600>[note]</font> </TD>
                <TD>아바타를 이용하고 있는 회원 리스트를 보실 수 있습니다.<br /></TD>
              </TR>
            </TABLE></TD>
        </TR>
      </TABLE>
      <br>
      <br>
<TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
  <form action="<?=$PHP_SELF;?>" method="post" name="list">
  <input type="hidden" name="menushow" value="<?=$menushow?>" />
   <input type="hidden" name="theme" value="<?=$theme?>" />
    <tr>
      <td colspan="3" bgcolor="#ffffff"><select name="sitem" id="sitem">
        <option value="c.user_id">아이디</option>
      </select>
      <input type="text" name="skeyword" id="skeyword" />
        <input type="submit" name="button" id="button" value="검색" /></td>
      </tr>
  </form>
</table>
<br>
<?
$ListNo=$pg_counts?$pg_counts:20;
$PageNo = 10;


$whereis = "where c.no is not null ";
if($sitem && $skeyword){
	$whereis .= " and $sitem like '%$skeyword%' ";
}

/* 총 갯수 구하기 */
$str = "select count(1) from ".$WIZTABLE["AVATARMEMCONFIG"]." c ";
$str .= " $whereis ";
$qry = mysql_query($str);
$list = mysql_fetch_array($qry);
$TOTAL = $list[0];

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
?>
<TABLE cellSpacing=0 borderColorDark=white width="100%" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
              <tr>
                <td align="center" bgcolor="E0E4E8"><strong>no</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>아이디</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>이름</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>성별</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>포인터</strong></td>
                <td align="center" bgcolor="E0E4E8">&nbsp;</td>
              </tr>	
<? 
$sqlstr = "select c.user_id, c.gender, c.name, c.point from ".$WIZTABLE["AVATARMEMCONFIG"]." c " ;
//$sqlstr .= " left join ".$WIZTABLE["AVATARMEMBER"]." m on c.user_id = m.$membertableid " ;
$sqlstr .= " $whereis limit $START_NO, $ListNo ";

//echo $sqlstr;
$sqlqry = mysql_query($sqlstr);
$cnt=0;
while($list=mysql_fetch_array($sqlqry)):
	$name = $list[2];
	$user_id = $list["user_id"];
	switch($list["gender"]){
		case "1":
			$genderstr = "남";
		break;
		case "2":
			$genderstr = "여";
		break;
		default:
			$genderstr = "중";
		break;	
	}
	$point = $avatar->check_point($user_id);
?><tr>
                <td align="center" bgcolor="#FFFFFF">&nbsp;<?=$BOARD_NO1?></td>
                <td align="center" bgcolor="#FFFFFF">&nbsp;<?=$user_id;?></td>
                <td align="center" bgcolor="#FFFFFF">&nbsp;<?=$name;?></td>
                <td align="center" bgcolor="#FFFFFF"><?=$genderstr;?></td>
                <td align="center" bgcolor="#FFFFFF"><a href="javascript:wizwindow('./member/pointpop.php?userid=<?=$user_id;?>','Wind','width=500, height=500')">
                  <?=number_format($point);?>
                </a></td>
                <td align="center" bgcolor="#FFFFFF"><input type="button" name="button2" id="button2" value="삭제" onClick="deleteMember('<?=$user_id;?>')" style="cursor:pointer"></td>
                </tr>
<?
$BOARD_NO1--;
$cnt++;
endwhile;
?>			  
      </table>
<br>

<TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
  <tr>
    <td align="center" bgcolor="#ffffff" ><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "menushow=$menushow&theme=$theme&skeyword=$skeyword&sitem=$sitem";
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?>    </td>
  </tr>
</table>        </td>
  </tr>
</table>
