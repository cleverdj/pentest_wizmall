<?php
/**
* 기본 환경 설정 체크
*
* @filename : php/init_check.php
* @version  : v 1.0 2003.07.18 18:29:55
* @author   : nsl <smpoem@magicn.com>
* @info     : common/sky_init.php 파일에서 호출함
*/

//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 기본 환경 설정 검사 ^^^^^^^^^^^^^^^^^^^^^^^^^

function getGlobalErrorChk($errorMsg, $title = ' 환경설정 Error !') {

    global $_SKYDIR_URL;

    echo  "<br><br><br>" .
                "<table border=0 cellspacing= 1 cellpadding=3 bgcolor=#D7D7D7 width=500 align=center style='line-height:130%'>" .
                "<tr><td align=center height=40 bgcolor=#EFEFEF >" . 
                "<b><img src='" . $_SKYDIR_URL . "image/mark_a32.gif' align='absmiddle' width='32' height='32' border='0'>&nbsp;&nbsp;" .
                "<font style='font-size:9pt' color=red>:: $title ::</font></b></td></tr>" .
                "<tr><td bgcolor=#FFFFFF><font style='font-size:9pt'>" .
                 $errorMsg .
                "</td></tr>" .
                "<tr><td align=center height=40 bgcolor=#FFFFFF>" . 
                "<input type=button value=' 확 인 ' OnClick='history.back()' style='height:30px; width:70px'></td></tr></table>";
    exit();
}

//_SKYDIR_PATH 확인
if (!@is_dir($_SKYDIR_PATH)) {

    $errorMsg = "common/skydir_init.php 이 파일에서 설정한<br>" .
                " <font color=blue>\$_SKYDIR_PATH = " . $_SKYDIR_PATH . "</font><br>" .
                "이 경로가 서버상에 존재하지 않습니다.<br>" .
                "다시 설정한 후에 실행하시기 바랍니다.";

    getGlobalErrorChk($errorMsg);
}

// config 디렉토리가 있는지 확인
$configTemp = $_SKYDIR_PATH . _DIR_SEP_PATH . 'config';
if ( !@is_dir($configTemp) ) {

    $errorMsg = "<font color=red>:: config 이 디렉토리가 존재하지 않습니다.</font><br>" .
                " <font color=blue>1. 디렉토리 생성 : mkdir config</font><br>" .
                " <font color=blue>2. 쓰기권한 부여 : chmod 0777 config</font><br>";

    getGlobalErrorChk($errorMsg);
}

// config 디렉토리 쓰기 가능한지 확인
if ( decoct(fileperms($configTemp) - 16384) != '0777') {

    $errorMsg = "<font color=red>:: config 이 디렉토리 쓰기 권한이 없습니다.</font><br>" .
                " <font color=blue>1. 쓰기권한 부여 : chmod 0777 config</font><br>";

    getGlobalErrorChk($errorMsg);
}
unset($configTemp);


// config/uconfig.php 파일이 있는지 확인
$uconfigTemp = $_SKYDIR_PATH . _DIR_SEP_PATH . 'config' . _DIR_SEP_PATH . 'uconfig.php';

if ( !@is_file($uconfigTemp) ) {

    $errorMsg = "<font color=red>:: config/uconfig.php 이 파일이 존재하지 않습니다.</font><br>" .
                " <font color=blue>1. 파일이름 : uconfig.php, 파일크기 : 0 byte 인 파일을 config/ 디렉토리에 넣어주세요</font><br>" .
                " <font color=blue>2. chmod 0777 uconfig.php -> 쓰기 권한을 부여해주세요</font><br>";


    getGlobalErrorChk($errorMsg);
}

// config/uconfig.php 파일 쓰기 가능여부 확인
if ( !@is_writeable($uconfigTemp) ) {

    $errorMsg = "<font color=red>:: config/uconfig.php 이 파일에, 쓰기 권한이 없습니다.</font><br>" .
                " <font color=blue>1. chmod 0777 uconfig.php -> 쓰기 권한을 부여해주세요</font><br>";

    getGlobalErrorChk($errorMsg);
}


// config/nlog.php 파일이 있는지 확인
$logTemp = $_SKYDIR_PATH . _DIR_SEP_PATH . 'config' . _DIR_SEP_PATH . 'nlog.log';

if ( !@is_file($logTemp) ) {

    $errorMsg = "<font color=red>:: config/nlog.log 이 파일이 존재하지 않습니다.</font><br>" .
                " <font color=blue>1. 파일이름 : nlog.log, 파일용량 : 0 byte 인 파일을 config/ 디렉토리에 넣어주세요요</font><br>" .
                " <font color=blue>2. chmod 0777 nlog.log -> 쓰기 권한을 부여해주세요</font><br>";

    getGlobalErrorChk($errorMsg);
}

// config/nlog.php 파일 쓰기 가능여부 확인

if ( !@is_writeable($logTemp) ) {

    $errorMsg = "<font color=red>:: config/nlog.log 이 파일에 쓰기 권한이 없습니다.<br>" .
                " <font color=blue>1. chmod 0777 nlog.log -> 쓰기 권한을 부여해주세요</font><br>";

    getGlobalErrorChk($errorMsg);
}

//        처음 실행했다면
if ( (@filesize($uconfigTemp) == 0 ) ) {

	//바로 세팅으로 연결
    Header("Location:./php/uconfig_setting.php");
    exit();
   // Header("Location:install.php");
   // exit();
}
unset($uconfigTemp);



if ( phpversion() < "4.1.0") {

    $errorMsg = "<font color=red>:: PHP 4.1.0 이상에서만 실행가능합니다.<br>" .
                " <font color=blue>1. 이 서버는 " . phpversion() . " 입니다.";

    getGlobalErrorChk($errorMsg, 'PHP 버전 Error!');
}

?>