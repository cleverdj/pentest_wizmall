<?
/* 
제작자 : 폰돌
제작자 URL : http://www.shop-wiz.com
제작자 Email : master@shop-wiz.com
Free Distributer 
- http://www.shop-wiz.com
*** Updating List ***
*/

include "../lib/inc.depth1.php";
include "../config/common_array.php";
//include "../config/wizboard/table/config.php";
include("./admin_check.php");
// 로그인 책크 부분 끝
	echo "query=".$query;
	//exit;
if ($query == 'update') {    
	foreach($Newcatname as $key => $value){
		$sqlstr = "update wizTable_Category set catname = '$value' where uid = '$key'";
		$dbcon->_query($sqlstr);	
	}
}else if ($query == 'insert') {
	$sqlstr = "select max(ordernum) maxnum from wizTable_Category where bid='$BID' and gid = '$GID'";
	$maxnum = $dbcon->get_one($sqlstr);
	$maxnum = $maxnum ? $maxnum+1:1;
	
	$sqlstr = "insert into wizTable_Category (bid, gid, ordernum, catname) values ('$BID', '$GID', '$maxnum', '$catname')";

	$dbcon->_query($sqlstr);
}else if ($query == 'delete') {
	$TableName = "wizTable_".$GID."_".$BID;
	//현재 카테고리의 카테고리 번호를 구해서 모두 0으로 치환한다.
	$sqlstr = "select ordernum from wizTable_Category where uid = $uid";
	$ordernum = $dbcon->get_one($sqlstr);
	
	$sqlstr = "update $TableName set CATEGORY = '0' where CATEGORY = $'ordernum'";
	$dbcon->_query($sqlstr);
	
	$sqlstr = "delete from wizTable_Category where uid = $uid";
	$dbcon->_query($sqlstr);
}else if ($query == 'move') {
	$TableName = "wizTable_".$GID."_".$BID;
	foreach($Newcatname as $key => $value){
		if($value){
			$sqlstr = "update from $TableName set CATEGORY = '$value' where CATEGORY = '$key'";
			$dbcon->_query($sqlstr);
		}
	}
}else if($query=="OptionPageChange"){
	include ("./configwrite.php");
}else if($query == "emp_input"){
	$op_icon	= $op_icon;
	$op_strong	= $op_strong ? $op_strong : 0;
	$op_color = $op_color;
	$op_em = $op_em ? $op_em : 0;
	$opflag = $op_icon."|".$op_strong."|".$op_color."|".$op_em;
	
	$sqlstr = "insert into wizTable_Emp (bid, gid, point, opflag) values ('$BID', '$GID', '$point', '$opflag')";
	$dbcon->_query($sqlstr);
	$common->js_location($PHP_SELF."?BID=".$BID."&GID=".$GID);
}else if($query == "emp_delete"){
	$sqlstr = "delete from wizTable_Emp where uid = '$uid'";
	$dbcon->_query($sqlstr);
	$common->js_location($PHP_SELF."?BID=".$BID."&GID=".$GID);
}else if($query == "emp_update"){
	$point = $op_point[$uid];
	$op_icon	= $op_icon[$uid];
	$op_strong	= $op_strong[$uid] ? $op_strong[$uid] : 0;
	$op_color = $op_color[$uid];
	$op_em = $op_em[$uid] ? $op_em[$uid] : 0;
	$opflag = $op_icon."|".$op_strong."|".$op_color."|".$op_em;
	
	
	$sqlstr = "update wizTable_Emp set point='$point', opflag = '$opflag' where uid = '$uid'";
	$dbcon->_query($sqlstr);
	$common->js_location($PHP_SELF."?BID=".$BID."&GID=".$GID);
}

include "../config/wizboard/table/$GID/$BID/config.php";

include "./admin_pop_top.php";
?>

<div id="table_pop_layout">
  <div id="pop_menu"> <a href="./admin1.php?BID=<?=$BID?>&GID=<?=$GID?>">LayOut</a> | <a href="./admin2.php?BID=<?=$BID?>&GID=<?=$GID?>">ListPage</a> | <a href="./admin3.php?BID=<?=$BID?>&GID=<?=$GID?>">ViewPage</a> | <a href="./admin4.php?BID=<?=$BID?>&GID=<?=$GID?>">WritePage</a> | <span>Option</span> </div>    
  <form action="<?=$PHP_SELF?>" method="POST" name="BasicInfo">
      <input type="hidden" name="query" value="OptionPageChange">
      <input type="hidden" name="BID" value="<?=$BID;?>">
      <input type="hidden" name="GID" value="<?=$GID;?>">
  <table class="table_pop_main">

      <?  
$nodp = array("ListForMember","ReadForMember","WriteForMember","DownForMember","UpLoadingOverWriteEnable","CategoryEnable","WritingPointEnable");

		  foreach($cfg["wizboard"] as $key=>$value)  
		  if (!in_array($key, $nodp)) 
		  echo "<input type='hidden' name='".$key."' value='".$value."'>\n"; 
		  ?>
      <tr>
        <td height="30" colspan="4" bgcolor="#E0E4E8">회원관련(일부 스킨만 적용가능, 1~10등급가능,
          WizMember와 호환)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%">회원전용(읽기)
          <input name="ReadForMember" type="checkbox" id="ReadForMember" value="checked" <?=$cfg["wizboard"]["ReadForMember"]?>></td>
        <td colspan="3" bgcolor="#FFFFFF"><select name="ReadMemberGrade">
            <?
	$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["ReadMemberGrade"]);
?>
          </select>
          <?
$selArr1 = array("over"=>"이상","less"=>"이하","only"=>"만");
$common->mkselectmenu("ReadMemberGradeBoundary", $selArr1, $cfg["wizboard"]["ReadMemberGradeBoundary"]);
?>
          <?
$selArr2 = array(""=>"성별선택","1"=>"남성전용","2"=>"여성전용");
$common->mkselectmenu("ReadMemberGenderBoundary", $selArr2, $cfg["wizboard"]["ReadMemberGenderBoundary"]);
?>        </td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%">회원전용(쓰기)
          <input name="WriteForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["WriteForMember"]?>></td>
        <td colspan="3" bgcolor="#FFFFFF"><select name="WriteMemberGrade">
            <?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["WriteMemberGrade"]);
?>
          </select>
          <?
$common->mkselectmenu("WriteMemberGradeBoundary", $selArr1, $cfg["wizboard"]["WriteMemberGradeBoundary"]);
?>
          <?
$common->mkselectmenu("WriteMemberGenderBoundary", $selArr2, $cfg["wizboard"]["WriteMemberGenderBoundary"]);
?></td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%">회원전용(다운)
          <input name="DownForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["DownForMember"]?>>        </td>
        <td colspan="3" bgcolor="#FFFFFF"><select name="DownMemberGrade">
            <?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["DownMemberGrade"]);
?>
          </select>
          <?
$common->mkselectmenu("DownMemberGradeBoundary", $selArr1, $cfg["wizboard"]["DownMemberGradeBoundary"]);
?>
          <?
$common->mkselectmenu("DownMemberGenderBoundary", $selArr2, $cfg["wizboard"]["DownMemberGenderBoundary"]);
?></td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%">회원전용(리스트)
          <input name="ListForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["ListForMember"]?>></td>
        <td colspan="3" bgcolor="#FFFFFF"><select name="ListMemberGrade">
            <?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["ListMemberGrade"]);
?>
          </select>
          <?
$common->mkselectmenu("ListMemberGradeBoundary", $selArr1, $cfg["wizboard"]["ListMemberGradeBoundary"]);
?>
          <?
$common->mkselectmenu("ListMemberGenderBoundary", $selArr2, $cfg["wizboard"]["ListMemberGenderBoundary"]);
?></td>
      </tr>
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">게시물점수(게시물당 점수 부여)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 추천</td>
        <td width="25%" bgcolor="#FFFFFF"><input name="bp_recommand" type="text" id="bp_recommand" value="<?=$cfg["wizboard"]["bp_recommand"]?>" size="5">
          포인트 </td>
        <td width="26%" bgcolor="#E0E4E8">비추천</td>
        <td width="24%" bgcolor="#FFFFFF"><input name="bp_nonerecommand" type="text" id="commentPoint" value="<?=$cfg["wizboard"]["bp_nonerecommand"]?>" size="5">
          (감점:음수기입)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 코멘트 </td>
        <td bgcolor="#FFFFFF"><input name="bp_reple" type="text" id="bp_reple" value="<?=$cfg["wizboard"]["bp_reple"]?>" size="5">
          포인트 </td>
        <td bgcolor="#E0E4E8">답글</td>
        <td bgcolor="#FFFFFF"><input name="bp_reply" type="text" id="commentPoint" value="<?=$cfg["wizboard"]["bp_reply"]?>" size="5">
        포인트 </td>
      </tr>      
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">게시물 레벨 설정(상기 게시물에 따른 등급 부여)</td>
      </tr> 
      <tr>
        <td bgcolor="#E0E4E8" width="25%">중박 게시물</td>
        <td colspan="3" bgcolor="#FFFFFF"><input name="np_lv10" type="text" id="np_lv10" value="<?=$cfg["wizboard"]["np_lv10"]?>" size="5" /></td>
      </tr>  
      <tr>
        <td bgcolor="#E0E4E8" width="25%">대박 게시물</td>
        <td colspan="3" bgcolor="#FFFFFF"><input name="np_lv20" type="text" id="np_lv20" value="<?=$cfg["wizboard"]["np_lv20"]?>" size="5" /></td>
      </tr> 
      <tr>
        <td bgcolor="#E0E4E8" width="25%">명예 게시물</td>
        <td colspan="3" bgcolor="#FFFFFF"><input name="np_lv30" type="text" id="np_lv30" value="<?=$cfg["wizboard"]["np_lv30"]?>" size="5" /></td>
      </tr>                       
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">게시판 활동점수(게시판 활동을 통한 회원 포인트 설정)<br />
          회수에서 -1 일경우 무제한</td>
      </tr>  
          
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 글쓰기</td>
        <td colspan="3" bgcolor="#FFFFFF">경험치
          <input type="text" name="writeExp" size="5" value="<?=$cfg["wizboard"]["writeExp"]?>">
          ,  머니
          <input type="text" name="writePoint" size="5" value="<?=$cfg["wizboard"]["writePoint"]?>">
          ,  <input type="text" name="writePer" size="5" value="<?=$cfg["wizboard"]["writePer"]?>">회(하루)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 코멘트</td>
        <td colspan="3" bgcolor="#FFFFFF">경험치
          <input type="text" name="commentExp" size="5" value="<?=$cfg["wizboard"]["commentExp"]?>">
          ,  머니 <input name="commentPoint" type="text" id="commentPoint" value="<?=$cfg["wizboard"]["commentPoint"]?>" size="5">
          ,  <input type="text" name="commentPer" size="5" value="<?=$cfg["wizboard"]["commentPer"]?>">회(하루)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 답글/토론참여</td>
        <td colspan="3" bgcolor="#FFFFFF">경험치
          <input type="text" name="replyExp" size="5" value="<?=$cfg["wizboard"]["replyExp"]?>">
          ,  머니 <input name="replyPoint" type="text" id="replyPoint" value="<?=$cfg["wizboard"]["replyPoint"]?>" size="5">
          ,  <input type="text" name="replyPer" size="5" value="<?=$cfg["wizboard"]["replyPer"]?>">회(하루)</td>
      </tr>
      <tr>
        <td bgcolor="#E0E4E8" width="25%"> 추천/비추천</td>
        <td colspan="3" bgcolor="#FFFFFF">경험치
          <input type="text" name="rccomExp" size="5" value="<?=$cfg["wizboard"]["rccomExp"]?>">
          ,  머니 <input name="rccomPoint" type="text" id="rccomPoint" value="<?=$cfg["wizboard"]["rccomPoint"]?>" size="5"> , <?=$cfg["wizboard"]["rccomPer"]?>회(총게시판별)</td>
      </tr>
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">파일업로딩 금지 확장자 설정하기(","로 나열)<a href="#" onClick="window.open('http://shop-wiz.com/wizmanual.php?BID=manual&mode=view&UID=1&cp=1&BOARD_NO=1&SEARCHTITLE=&searchkeyword=&category=1','OnlineManual','width=500, height=400,scrollbars=yes,resizable=yes')";><img src="images/help.gif" width="20" height="9" border="0"></a></td>
      </tr>
      <tr align="center">
        <td colspan="4" bgcolor="#FFFFFF"><textarea name="ProhibitExtention" style="width:98%;"><?=$cfg["wizboard"]["ProhibitExtention"]?>
</textarea></td>
      </tr>
      <tr>
        <td height="38" colspan="9" align="center" bgcolor="#FFFFFF"><input type="button" name="Button" value="수정" onClick="javascript:submit()"; style="cursor:pointer;"></td>
      </tr>
   
  </table> </form>

  <div class="space10"></div>
  <form name="catForm" method="post">
    <input type="hidden" name="BID" value="<?=$BID?>" />
    <input type="hidden" name="GID" value="<?=$GID?>" />
    <input type="hidden" name="query" value="" />
    <table class="table_pop_main">
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">카테고리사용
          <input name="CategoryEnable" type="checkbox" value="checked" <?=$cfg["wizboard"]["CategoryEnable"]?> onClick="setBoardcfg(this)">
          (동일테이브로 옵션선택 - 링크방법은 wizboard.php?BID=보드아이디&amp;category=카테고리번호)</td>
      </tr>
      <tr>
        <td colspan="4" bgcolor="#E0E4E8">표시형식 :
          <input type="radio" name="CategoryType" value="radio" <? if($cfg["wizboard"]["CategoryType"] == "radio") echo "checked";?> onclick="setBoardcfg(this)">
          라디오버튼
          <input type="radio" name="CategoryType" value="select" <? if($cfg["wizboard"]["CategoryType"] == "select") echo "checked";?> onclick="setBoardcfg(this)">
          실렉트버튼</td>
      </tr>
      <tr>
        <td colspan="4" bgcolor="#FFFFFF"><?
$catstr = "select ordernum, catname, uid from wizTable_Category where gid = '$GID' and bid = '$BID' order by ordernum asc";
$catqry = $dbcon->_query($catstr);
$TotalCount = $dbcon->_num_rows($catqry);
?>
      <tr>
        <td height="25" colspan="4" bgcolor="#FFFFFF"><div id="">전체 <font color="#b02832"><? echo number_format($TotalCount);?></font> 개
            카테고리 
            카테고리명 :
            <input name="catname" type="text" size="18">
            <button name="btn" onClick="CategoryManager('insert');" title="등록">등록</button>
          </div></td>
      </tr>
      <tr>
        <td colspan="4" bgcolor="#FFFFFF"><table class="table_pop_main">
            <tr align="center" bgcolor="F7F7ED">
              <td width="50">선택</td>
              <td width="50">번호</td>
              <td>카테고리명</td>
              <td>게시물의 <br>
                카테고리이동</td>
              <td width="80">삭제</td>
            </tr>
            <?

$cnt=0;
while($catlist = $dbcon->_fetch_array($catqry)):
?>
            <tr align="center" bgcolor="F7F7F7">
              <td><input name="MultiSelect[<?=$catlist["uid"]?>]" type="checkbox" value="<?=$catlist["uid"]?>"></td>
              <td><?=$catlist["ordernum"]?></td>
              <td><input type="text" name="Newcatname[<?=$catlist["uid"]?>]" size="10" value="<?=$catlist["catname"]?>" style="width:100%"></td>
              <td><table border="0" cellspacing="0" cellpadding="0">
                  <tr>
                    <td><select name="Movecatname[<?=$catlist["ordernum"]?>]">
                        <option value="0">전체</option>
                        <?	
$subcatstr = "select ordernum, catname, uid from wizTable_Category where gid = '$GID' and bid = '$BID' order by ordernum asc";
$dbcon->_query($subcatstr);
while($subcatlist = $dbcon->get_rows()):
$selected = $subcatlist["ordernum"] == $catlist["ordernum"]?"selected":"";
$selectvalue = $subcatlist["ordernum"] == $catlist["ordernum"]?"":$subcatlist["ordernum"];
echo "<option value='".$selectvalue."' $selected>".$subcatlist["catname"]."</option>\n";
endwhile;
?>
                      </select>
                      로 게시물 </td>
                    <td width="5">&nbsp;</td>
                    <td><button type="button" name="btn" onClick="CategoryManager('move','<?=$catlist["uid"]?>');" title="이동">이동</button></td>
                  </tr>
                </table></td>
              <td><? if($cnt <> 0):?>
                <button type="button" name="btn" onClick="CategoryManager('delete','<?=$catlist["uid"]?>');" title="삭제">삭제</button>
                <? endif; ?></td>
            </tr>
            <?
$cnt++;
endwhile;
if(!$cnt){
?>
            <tr align="center" bgcolor="F7F7F7">
              <td colspan="5">등록된 카테고리가 없습니다. </td>
            </tr>
            <?
}
?>
            <tr align="center" bgcolor="F7F7F7">
              <td colspan="3"><button type="button" name="btn" onClick="CategoryManager('update');" title="카테고리명수정">카테고리명수정</button></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
          </table></td>
      </tr>
    </table>
  </form>
  <table class="table_pop_main">
    <tr>
      <td colspan="4" bgcolor="#E0E4E8">획득포인트별 제목 강조</td>
    </tr>
    <tr align="center" bgcolor="F7F7ED">
      <td>점수(이상)</td>
      <td>강조옵션</td>
      <td bgcolor="F7F7ED">삭제</td>
    </tr>
    <form>
      <input type="hidden" name="BID" value="<?=$BID?>" />
      <input type="hidden" name="GID" value="<?=$GID?>" />
      <input type="hidden" name="query" value="emp_input" />
      <tr align="center" bgcolor="F7F7F7">
        <td><input name="point" type="text" id="point" style="width:50px"></td>
        <td bgcolor="F7F7F7">아이콘
          <select name="op_icon" id="op_icon">
          </select>
          , 강조
          <input name="op_strong" type="checkbox" id="op_strong" value="1" />
          , 색상
          <input type="text" name="op_color" id="op_color" />
          , 이태릭
          <input name="op_em" type="checkbox" id="op_em" value="1" /></td>
        <td><button type="submit" name="btn" title="등록"><font color="#FF6600">등록</font></button></td>
      </tr>
    </form>
    <form name="empForm" method="post">
      <input type="hidden" name="uid" value="" />
      <!-- 수정용 -->
      <input type="hidden" name="query" value="emp_update" />
      <?
$sqlstr = "select * from wizTable_Emp where bid='$BID' and gid='$GID' order by point asc";
$sqlqry = $dbcon->_query($sqlstr);
$cnt=0;
while($list = $dbcon->_fetch_array($sqlqry)):
	$opflag = split("\|", $list["opflag"]);
	$op_icon = $opflag[0];
	$op_strong = $opflag[1]=="1"? " checked":"";
	$op_color = $opflag[2];
	$op_em = $opflag[3]=="1"? " checked":"";
	$uid = $list["uid"];
?>
      <tr align="center" bgcolor="F7F7F7">
        <td><input name="op_point[<?=$uid?>]" type="text" id="point[<?=$uid?>]" style="width:50px" value="<?=$list["point"]?>"></td>
        <td>아이콘
          <select name="op_icon[<?=$uid?>]" id="op_icon[<?=$uid?>]">
          </select>
          , 강조
          <input name="op_strong[<?=$uid?>]" type="checkbox" id="op_strong[<?=$uid?>]" value="1"<?=$op_strong?> />
          , 색상
          <input type="text" name="op_color[<?=$uid?>]" id="op_color[<?=$uid?>]" value="<?=$op_color?>" />
          , 이태릭
          <input name="op_em[<?=$uid?>]" type="checkbox" id="op_em[<?=$uid?>]" value="1"<?=$op_em?> /></td>
        <td><button name="btn" type="button" onClick="emp_manager('update','<?=$list["uid"]?>');" title="삭제">수정</button>
          <button name="btn" type="button" onClick="emp_manager('delete','<?=$list["uid"]?>');" title="삭제">삭제</button></td>
      </tr>
      <?
$cnt++;
endwhile;
if(!$cnt){
?>
      <tr align="center" bgcolor="F7F7F7">
        <td colspan="3">등록된 옵션이 없습니다. </td>
      </tr>
      <?
}
?>
    </form>
  </table>  
</div>
<?
include "./admin_pop_bottom.php";
?>
