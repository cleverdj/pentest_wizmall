<?
include "./inc.depth1.php";
include "./class.board.php";
$board = new board();
$board->get_object($dbcon, $common);

$tb_name = "wizTable_".$gid."_".$bid;

$config_include_path = "../config/wizboard/table/$gid/$bid";
include $config_include_path."/config.php";#보드관련 세부 config 관련 정보
$folder_skin = "./wizboard/skin/".$cfg["wizboard"]["BOARD_SKIN_TYPE"];
//spage='+spage+'&listno='+listno+'&flag='+flag+'&targetDiv='+targetDiv+'&gid=$GID;&bid==$BID;

$whereis = "where W_DATE <= ".(time()+60*60*24*30*3);
$orderby = "order by UID desc";
switch($flag){
	case "lv30"://대박 게시물
    	$whereis .= " and GETPOINT >= ".$cfg["wizboard"]["np_lv30"];
    break;
    case "rec"://추천게시물
    	$orderby = "order by RECCOUNT desc";
    break;
}
$sqlstr = "select count(UID) from $tb_name $whereis ";
$total = $dbcon->get_one($sqlstr);
$total = $total > 20 ? 20 : $total;//max dp 갯수를 20개로 한정
?>
var NeedDiv = '<?=$targetDiv?>';
a=new Array();
<?
/*
$StartNum = ($spage-1) * $listno;
$_row=$MySQL->fetch_array2("SELECT bdata.*, floor(bdata.bbs_good/".$_bbs[bbs_value][_point][good][cond].")*".$_bbs[bbs_value][_point][good][point]." - floor(bdata.bbs_bad/".$_bbs[bbs_value][_point][bad][cond].")*".$_bbs[bbs_value][_point][bad][point]." + floor(bdata.bbs_comment/".$_bbs[bbs_value][_point][comm][cond].")*".$_bbs[bbs_value][_point][comm][point]." + floor(bdata.bbs_reply/".$_bbs[bbs_value][_point][reply][cond].")*".$_bbs[bbs_value][_point][reply][point]." as bbs_point FROM bbs_best bbest INNER JOIN tb_".$BbsCode." bdata ON (bbest.bbs_data_seq = bdata.seq) WHERE bbest.bbs_code='$BbsCode' and bbest.bbs_best_type='lotto' and bdata.is_hidden='N' ORDER BY bbest.reg_date DESC limit $StartNum, $listno");
for($i=0; $i<count($_row); $i++)
{
	$bbs_title = cut_str(str_replace('"',"'",strip_tags($_row[$i][bbs_title])),45,'');
	*/
if(!$spage) $spage = 1;
$START_NO = ($spage - 1) * $listno;
$sqlqry = $dbcon->get_select('*',$tb_name,$whereis, $orderby, $START_NO, $listno);
$cnt	= $total-($listno*($spage-1));
$i=0;
switch($flag){
case "lv30":
while( $list = $dbcon->_fetch_array($sqlqry)) :
$subject = $common->strCutting($list["SUBJECT"], "20", "..");
?>
a[<?=$i?>] = "<dl><dt><?= $list[GETPOINT]?> <dfn>점</dfn></dt><dd class='title'><span class='numbertxt2'><a href='./wizboard.php?BID=<?=$bid?>&amp;GID=<?=$gid?>&amp;mode=view&amp;UID=<?=$list["UID"]?>'><?=$subject?></a></span> <span class='numbertxt0'>(</span><span class='numbertxt'><?=$list[RPLCOUNT]?></span><span class='numbertxt0'>)</span></dd></dl>";
<?
$i++;
endwhile;
break;
case "rec":
while( $list = $dbcon->_fetch_array($sqlqry)) :
$subject = $common->strCutting($list["SUBJECT"], "20", "..");
?>
a[<?=$i?>] = "<dl><dt><?=$list["UID"]?> <dfn>점</dfn></dt><dd class='title'><span class='numbertxt2'><a href='./wizboard.php?BID=<?=$bid?>&amp;GID=<?=$gid?>&amp;mode=view&amp;UID=<?=$list["UID"]?>'><?=$subject?></a></span> <span class='numbertxt0'>(</span><span class='numbertxt'><?=$list[RPLCOUNT]?></span><span class='numbertxt0'>)</span></dd></dl>";
<?
$i++;
endwhile;
break;
}
$_PageNum =ceil($total/$listno) ? ceil($total/$listno) : 1;
if($spage=='1')
{
//GetList(1, <?=$listno ? >,'< ? = $flag ? >','< ?=$targetDiv? >')
?>
a[<?=$i?>] = "<dl><dd class='pager'><a href='javascript:void(0)' onclick=\"GetList(<?=$_PageNum?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/btn_prev.gif' alt='이전' /></a>";
<?
}
else
{
?>
a[<?=$i?>] = "<dl><dd class='pager'><a href='javascript:void(0)' onclick=\"GetList(<?=$spage-1?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/btn_prev.gif' alt='이전' /></a>";
<?
}
if($spage==$_PageNum)
{
?>
a[<?=$i?>] += "<a href='javascript:void(0)' onclick=\"GetList(1, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/btn_next.gif' alt='다음' /></a></dd></dl>";
<?
}
else
{
?>
a[<?=$i?>] += "<a href='javascript:void(0)' onclick=\"GetList(<?=$spage+1?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/btn_next.gif' alt='다음' /></a></dd></dl>";
<?
}
?>