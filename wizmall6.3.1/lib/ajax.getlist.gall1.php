<?
include "./inc.depth1.php";
include "./class.board.php";
$board = new board();
$board->get_object($dbcon, $common);

$tb_name = "wizTable_".$gid."_".$bid;

$config_include_path = "../config/wizboard/table/$gid/$bid";
include $config_include_path."/config.php";#보드관련 세부 config 관련 정보
$folder_skin = "./wizboard/skin/".$cfg["wizboard"]["BOARD_SKIN_TYPE"];
//spage='+spage+'&listno='+listno+'&flag='+flag+'&targetDiv='+targetDiv+'&gid=$GID;&bid==$BID;

$whereis = "where W_DATE <= ".(time()+60*60*24*30*3);
$orderby = "order by UID desc";
switch($flag){
	case "lv30"://대박 게시물
    	$whereis .= " and GETPOINT >= ".$cfg["wizboard"]["np_lv30"];
    break;
    case "rec"://추천게시물
    	$orderby = "order by RECCOUNT desc";
    break;
}
$sqlstr = "select count(UID) from $tb_name $whereis ";
$total = $dbcon->get_one($sqlstr);
$total = $total > 20 ? 20 : $total;//max dp 갯수를 20개로 한정
?>
var NeedDiv = '<?=$targetDiv?>';
a=new Array();
<?
/*
$StartNum = ($spage-1) * $listno;
$_row=$MySQL->fetch_array2("SELECT bdata.*, floor(bdata.bbs_good/".$_bbs[bbs_value][_point][good][cond].")*".$_bbs[bbs_value][_point][good][point]." - floor(bdata.bbs_bad/".$_bbs[bbs_value][_point][bad][cond].")*".$_bbs[bbs_value][_point][bad][point]." + floor(bdata.bbs_comment/".$_bbs[bbs_value][_point][comm][cond].")*".$_bbs[bbs_value][_point][comm][point]." + floor(bdata.bbs_reply/".$_bbs[bbs_value][_point][reply][cond].")*".$_bbs[bbs_value][_point][reply][point]." as bbs_point FROM bbs_best bbest INNER JOIN tb_".$BbsCode." bdata ON (bbest.bbs_data_seq = bdata.seq) WHERE bbest.bbs_code='$BbsCode' and bbest.bbs_best_type='lotto' and bdata.is_hidden='N' ORDER BY bbest.reg_date DESC limit $StartNum, $listno");
for($i=0; $i<count($_row); $i++)
{
	$bbs_title = cut_str(str_replace('"',"'",strip_tags($_row[$i][bbs_title])),45,'');
	*/
if(!$spage) $spage = 1;
$START_NO = ($spage - 1) * $listno;
$sqlqry = $dbcon->get_select('*',$tb_name,$whereis, $orderby, $START_NO, $listno);
$cnt	= $total-($listno*($spage-1));

$_PageNum =ceil($total/$listno) ? ceil($total/$listno) : 1;
if($spage=='1')
{
//GetList(1, <?=$listno ? >,'< ? = $flag ? >','< ?=$targetDiv? >')
?>
a[0] = "<a href='javascript:void(0)' onclick=\"GetListGallery(<?=$_PageNum?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/gallery_arrow1.gif' alt='이전' /></a>";
<?
}
else
{
?>
a[0] = "<a href='javascript:void(0)' onclick=\"GetListGallery(<?=$spage-1?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/gallery_arrow1.gif' alt='이전' /></a>";
<?
}
?>
<?
$i=0;
switch($flag){
case "lv30":
while( $list = $dbcon->_fetch_array($sqlqry)) :
//$subject = $common->strCutting($list["SUBJECT"], "30", "..");
$attached = split("\|", $list["UPDIR1"]);
$img = "./config/wizboard/table/".$gid."/".$bid."/updir/".$attached[0];
?>
a[<?=$i+1?>] = "<dl><dt><a href='./wizboard.php?BID=<?=$bid?>&amp;GID=<?=$gid?>&amp;mode=view&amp;UID=<?=$list["UID"]?>'><img src='<?=$img?>' alt='샘플이미지' onerror=\"this.src='./img/community/noimages1.gif'\" /></a></dt></dl>";
<?
$i++;
endwhile;
if($i%2) echo "a[".($i+1)."] = '<dl><dt></dt></dl>';\n";
break;
case "rec":
while( $list = $dbcon->_fetch_array($sqlqry)) :
$subject = $common->strCutting($list["SUBJECT"], "30", "..");
?>
<?
$i++;
endwhile;
break;
}
?>
<?
if($spage==$_PageNum)
{
?>
a[3] = "<a href='javascript:void(0)' onclick=\"GetListGallery(1, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/gallery_arrow2.gif' alt='다음' /></a>";
<?
}
else
{
?>
a[3] = "<a href='javascript:void(0)' onclick=\"GetListGallery(<?=$spage+1?>, <?=$listno?>,'<?=$flag?>','<?=$targetDiv?>')\"><img src='<?=$folder_skin?>/images/gallery_arrow2.gif' alt='다음' /></a>";
<?
}
?>