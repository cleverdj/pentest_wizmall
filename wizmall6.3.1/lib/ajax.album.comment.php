<?
include "./inc.depth1.php";
include "./class.board.php";
$board = new board();
$board->get_object($dbcon, $common);

include "./class.member.php";
$member = new member();
$member->get_object($dbcon, $common);

$tb_name = "wizTable_".$gid."_".$bid;
$tb_name_r = $tb_name."_reply";

$config_include_path = "../config/wizboard/table/$gid/$bid";
include $config_include_path."/config.php";#보드관련 세부 config 관련 정보
$folder_skin = "./wizboard/skin/".$cfg["wizboard"]["BOARD_SKIN_TYPE"];

$whereis = " where r.ID = '$user_id'";
$sqlstr = "select count(r.UID) from $tb_name_r r  $whereis ";
$total = $dbcon->get_one($sqlstr);
//$total = $total > 20 ? 20 : $total;//max dp 갯수를 20개로 한정
?>

var AlbumCommentDesc = "";
AlbumCommentDesc += "<ul class='latestlist'>";
<?
if(!$cp) $cp = 1;
$listno = 5;
$START_NO = ($cp - 1) * $listno;
$jointb = " ".$tb_name_r." r left join ".$tb_name." p on r.MID = p.UID";
$sqlqry = $dbcon->get_select('r.NAME, r.CONTENTS, r.W_DATE, p.UID ',$jointb,$whereis, $orderby, $START_NO, $listno);
$cnt	= $total-($listno*($cp-1));
$i=0;
while( $list = $dbcon->_fetch_array($sqlqry)) :
$content = $common->strCutting($list["CONTENTS"], "20", "..");
$mlevel = $member->getidLevel($user_id);
$mlevel_img = "<img src='../wizboard/iconlevel/default/lv_".$mlevel.".gif'>";
?>
	AlbumCommentDesc += "<li class='listline3'><dl><dt class='name'><?=$mlevel_img.$list["NAME"]?></dt><dd class='text4'><a href='./wizboard.php?BID=<?=$bid?>&amp;GID=<?=$gid?>&amp;mode=view&amp;UID=<?=$list["UID"]?>'>";
	AlbumCommentDesc += "<?=$content?>";
	AlbumCommentDesc += "</a></dd><dd class='text3'><?=date("Y.m.d", $list["W_DATE"])?></dd></dl></li>";
	<?
endwhile;
?>
AlbumCommentDesc += "</ul><ul class='boardlist2'><li><dl><dd class='pager'><a href='javascript:void(0)' onclick=\"GetAlbumComment('<?=$user_id?>',1)\"><img src='<?=$folder_skin?>/images/pre1.gif' style='vertical-align: middle;' alt='처음' /></a> &nbsp; ";
<?
$pagecnt = 10;
$tp = ceil($total / $listno) ; # 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트
$cb = ceil($cp / $pagecnt); #현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수
$sp = ($cb - 1) * $pagecnt + 1;#블록의 처음 페이지(Start Page) 구하기
$ep = ($cb * $pagecnt);#블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수
$tb = ceil($tp / $pagecnt);#총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수
		
if ( $cb > 1 ) {
$PREV_PAGE = $sp - 1;
$AlbumCommentDesc .= "<a href='javascript:void(0)' onclick=\\\"GetAlbumComment('$user_id',$PREV_PAGE)\\\"><img src='".$folder_skin."/images/pre.gif' style='vertical-align: middle;' alt='이전10페이지' /></a> &nbsp; ";

}


/* LISTING NUMBER PART */
for ($i = $sp; $i <= $ep && $i <= $tp ; $i++) {
$class = $cp == $i ? " class='currentpage'":"";
$AlbumCommentDesc .= "<a href='javascript:void(0)'$class onclick=\\\"GetAlbumComment('$user_id',$i)\\\">".$i."</a> &nbsp; ";
}

/* NEXT or END PART */
if ($cb < $tb) {
	$NEXT_PAGE = $ep + 1;
	$AlbumCommentDesc .= "<a href='javascript:void(0)' onclick=\\\"GetAlbumComment('$user_id',$NEXT_PAGE)\\\"><img src='".$folder_skin."/images/next.gif' style='vertical-align: middle;' alt='이후10페이지' /></a> &nbsp; ";
}

//맨마지막
$AlbumCommentDesc .= "<a href='javascript:void(0)' onclick=\\\"GetAlbumComment('$user_id',$tp)\\\"><img src='".$folder_skin."/images/next1.gif' style='vertical-align: middle;' alt='마지막' /></a> &nbsp;</dd></dl></li></ul>";
?>
AlbumCommentDesc += "<?=$AlbumCommentDesc?>";