<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
?>
<?
include_once ("./ROOT_CHECK.php");
include_once "../../lib/class.avatar.php";
include_once ("../../config/avatar_array.php");
include_once ("../../config/avatar_config.php");
$avatar_skin_path = "../wizavatar/avatar_skin/".$avatar_skin;
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;
$avatar->avatarpath = "../wizavatar/avatarimg/";
$avatar->mode = "photo";
$orderbyselect = $orderbyselect ? $orderbyselect : "cdate";
if($query == "update"){
	foreach($textlist as $key => $value){
		$sqlstr = "update ".$WIZTABLE["AVATARALBUM"]." set adminscore = '$value' where no = '$key'";
		mysql_query($sqlstr);
	}
}
?>
<script language=javascript>
<!--
function gotoWrite(){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contest1_write"
}

function gotoModify(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contest1_write&mode=update&no="+no;
}

function gotoDel(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=<?=$theme;?>&query=delete&no="+no;
}

function gotoEva(no){
	location.href="<?=$PHP_SELF;?>?menushow=<?=$menushow?>&theme=avatar_contest/contestatt_list&no="+no;
}

function openContestWindow(no){
	window.open('<?=$avatar_skin_path?>/avatar_contest_detail.php?no='+no,'ContestWindow','width=570, height=639, scrollbars=1');
}

function gotoContest(){
	var f = document.ContestForm;
	f.submit();
}
//-->
</script>
<fieldset class="desc">
<legend>콘테스트 참여자보기</legend>
<div id="notice">[note]</div>
<div id="comment">콘테스트에 참여한 참여자 정보를 보실수 있습니다.</div>
</fieldset>
<p></p>
<table  class="table_main">
        <tr>
          <td colspan="7" align="right" bgcolor="#FFFFFF"><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
              <tr>
                <td height="39" background="image/xgame/avatar_skin/img15.gif"><table border="0" align="right" cellpadding="3" cellspacing="0" class="s1">
                    <form name="ContestForm" action="<?=$PHP_SELF;?>" method="post">
                      <input type="hidden" name="menushow" value="<?=$menushow;?>">
					  <input type="hidden" name="theme" value="<?=$theme;?>">
                      <tr>
                        <td><select name="contestno">
                          <option value="">콘테스트선택</option>
<? 
	$whereis = "where 1 ";					
	$sqlstr = "select no,subject from ".$WIZTABLE["AVATARCONTESTTERM"]."  $whereis order by no desc ";
	$sqlqry = mysql_query($sqlstr) or die($sqlstr);
	while($list = mysql_fetch_array($sqlqry)):
		$selected = $contestno == $list["no"] ? "selected":"";
		echo "<option value='".$list["no"]."' $selected>".$list["subject"]."</option>\n";
	endwhile;
?>
                          </select>
<?
$orderbyselectarr = array("score" => "추천점수별","adminscore" => "총계별","cdate" => "등록순별");
?>						  
						  <select name="orderbyselect">
                          <option value="">정렬</option>
<?
foreach($orderbyselectarr as $key=>$value){
	$selected = $orderbyselect == $key ? "selected":"";
	echo "<option value='$key' $selected>$value</option>\n"; 
}
?>				  
                          </select></td>
                        <td><img src="/image/button/see2.gif" alt="보기" width="36" height="20" border="0" style="cursor:pointer" onclick="gotoContest();"></td>
                        <td><strong>아이디</strong></td>
                        <td><input name="textfield" type="text" class="input" size="20"></td>
                        <td><a href="#" onFocus="this.blur()"><img src="/image/button/find.gif" alt="검색" width="45" height="20" border="0"></a></td>
                        <td width="5">&nbsp;</td>
                      </tr>
                    </form>
                  </table></td>
              </tr>
            </table></td>
        </tr><form name="checkForm" method="post" action="<?=$PHP_SELF;?>">
		<input type="hidden" name="menushow" value="<?=$menushow;?>">
		<input type="hidden" name="theme" value="<?=$theme;?>">
		<input type="hidden" name="query" value="update">
		<input type="hidden" name="contestno" value="<?=$contestno?>">
        <tr>
          <td align="center" bgcolor="E0E4E8"><input type="checkbox" name="checkbox" value="checkbox" /></td>
          <td align="center" bgcolor="E0E4E8"><strong>콘테스트명</strong></td>
          <td align="center" bgcolor="E0E4E8"><strong>추천점수</strong></td>
          <td align="center" bgcolor="E0E4E8"><strong>주제의적합성</strong></td>
          <td align="center" bgcolor="E0E4E8"><strong>성실한 참여글 </strong></td>
          <td align="center" bgcolor="E0E4E8"><strong>운영자</strong></td>
          <td align="center" bgcolor="E0E4E8"><strong>총계</strong></td>
        </tr>
     
<?
## 현재 콘테스트에서 기간정보 가져오기
	$whereis = "where no = '$contestno' ";					
	$sqlstr = "select sdate,edate from ".$WIZTABLE["AVATARCONTESTTERM"]."  $whereis ";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	$sdate = $list["sdate"];
	$edate = $list["edate"];	

$ListNo=$pg_counts?$pg_counts:20;
$PageNo = 10;

$whereis = "where contest = 1 and cdate between $sdate and $edate ";

//$whereis = "where contest = 1";

/* 총 갯수 구하기 */

$TOTAL_STR = "select count(no) from ".$WIZTABLE["AVATARALBUM"]." $whereis ";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_result($TOTAL_QRY, 0, 0);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));

### 신규등록된 아바타 가져오기
$orderby = "order by $orderbyselect desc ";	
$sqlstr = "select no, user_id, cdate,score,adminscore from ".$WIZTABLE["AVATARALBUM"]." $whereis $orderby limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr."<br>".mysql_error());

$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
	$contest_view = $avatar->show_avatar($list[no]);
	$no = $list["no"];
	$user_id = $list["user_id"];
	$name = $avatar->get_MemInfo($user_id, "name");
	$cdate = $list["cdate"];
	$score = $list["score"];
?>
          <tr>
            <td align="center" bgcolor="#FFFFFF"><input type="checkbox" name="selectlist[<?=$no?>]" value="<?=$no?>" /></td>
            <td align="center" bgcolor="#FFFFFF"><table width="140" border="0" align="center" cellpadding="3" cellspacing="1" bgcolor="dddddd">
                <tr>
                  <td align="center" bgcolor="#FFFFFF"><?=$contest_view?></td>
                </tr>
              </table>
              <table width="140" border="0" align="center" cellpadding="3" cellspacing="0">
                <tr>
                  <td align="center"><strong><font color="ff8233">
                    <?=$user_id?>
                    </font></strong></td>
                </tr>
                <tr>
                  <td align="center"><img src="/image/xgame/avatar_skin/button3.gif" alt="상세보기" width="58" height="20" border="0" onClick="openContestWindow(<?=$no?>);" style="cursor:pointer"></td>
                </tr>
              </table></td>
            <td align="center" bgcolor="#FFFFFF"><?=number_format($score);?></td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF">&nbsp;</td>
            <td align="center" bgcolor="#FFFFFF"><input name="textlist[<?=$no?>]" type="text" size="10" value="<?=$list["adminscore"]?>"></td>
          </tr>
          <?
$BOARD_NO1--;
$cnt++;
endwhile;
?>          <tr>
            <td colspan="7" align="right" bgcolor="#FFFFFF"><input type="submit" name="Submit" value="평가점수제출" /></td>
            </tr>
        </form>
      </table>
      <br>
      <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
        <tr>
          <td align="center" bgcolor="#ffffff" ><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "menushow=$menushow&theme=$theme&contestno=$contestno&orderbyselect=$orderbyselect";
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?>
          </td>
        </tr>
      </table>