<?
/*
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

if(!strcmp($query,"addrmove")){
		while(list($key,$value) = each($_GET)) 
		{
			if ($value == "wizMail") 
			{
				$key = ereg_replace("_",".",$key);
				$sql_update = "update wizMailAddressBook set grp='$movebox' where userid='$WIZMAIL_USER_ID' and idx=$key";
				$dbcon->_query($sql_update);
			}
		}
}else if(!strcmp($query,"addrdelete")){
		while(list($key,$value) = each($_GET)) 
		{
			if ($value == "wizMail") 
			{
				$key = ereg_replace("_",".",$key);
			
				$sql_delete = "delete from wizMailAddressBook where userid='$WIZMAIL_USER_ID' and idx=$key";
				$sth = $dbcon->_query($sql_delete);
			}
		}
}else if(!strcmp($query,"groupedit")){
		if ($groupcode != "all") 
		{
			$sql_update = "update wizMailAddressBookG set subject='$groupname' where userid='$WIZMAIL_USER_ID' and code='$groupcode'";
			$dbcon->_query($sql_update);
			$segroup = $groupcode;
			$segroupname = $groupname;
		}
}else if(!strcmp($query, "groupdatadelete")){
		if ($segroup != "all") 
		{
			$sql_delete = "delete from wizMailAddressBook where userid='$WIZMAIL_USER_ID' and grp='$segroup'";
			$dbcon->_query($sql_delete);
		}
}else if(!strcmp($query, "groupdelete")){
		if ($segroup != "all") 
		{
			$sql_delete = "delete from wizMailAddressBookG where userid='$WIZMAIL_USER_ID' and code='$segroup'";
			$dbcon->_query($sql_delete);

			$segroup="all";
			$segroupname="전체그룹";
		}
}
?>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>주소록 관리 > <?if($segroupname) echo "$segroupname"; else echo "전체그룹";?></legend>
						<div id="notice">[note]</div>
						<div id="comment">  </div>
						</fieldset>
						<p></p>	
						<table class="table_main">

  <tr valign='top' bgcolor="#FFFFFF"> 
    <td width='150'> <table cellpadding='0' cellspacing='0' border='0' width='100%' class="s1">
        <tr height='19'>
          
        </tr>
        <tr height='2'>
          
        </tr>
        <tr>
          <td> <table cellpadding='0' cellspacing='1' border='0' width='100%' bgcolor='#AFC6E9' class="s1">
              <tr> 
                <td> <table cellpadding='0' cellspacing='0' border='0' width='100%' bgcolor='#F9FBFF' class="s1">
                    <tr height='25' valign='middle'> 
                      <td width='10' align='center'>&nbsp;</td>
                      <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&segroup=all&segroupname=전체그룹'>전체그룹</a> 
                      </td>
                    </tr>
                  </table></td>
              </tr>
            </table></td>
        </tr>

<?
$sqlstr = "select * from wizMailAddressBookG where userid='$HTTP_COOKIE_VARS[WIZMAIL_USER_ID]' order by idx asc";
$sqlqry=$dbcon->_query($sqlstr);
$Total=$dbcon->_num_rows();

if($Total){
	$cnts = 0;
	while($list = $dbcon->_fetch_array())
	{
		$dbcodef	= $list["code"];
		$dbsubject	= $list["subject"];
?>
        <tr height='1'>
          
        </tr>
        <tr>
          <td> <table cellpadding='0' cellspacing='1' border='0' width='100%' bgcolor='#AFC6E9'>
              <tr> 
                <td> <table cellpadding='0' cellspacing='0' border='0' width='100%' bgcolor='#F9FBFF' class="s1">
                    <tr height='25' valign='middle'> 
                      <td width='10' align='center'>&nbsp;</td>
                      <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&segroup=<?=$dbcode?>&segroupname=<?=$dbsubject?>'>
                        <?=$dbsubject?>
                        </a> 
                      </td>
                    </tr>
                  </table></td>
              </tr>
            </table></td>
        </tr>
        <?

		$cnts = $cnts + 1;
	}
}

?>
      </table></td>
    <td> 
<?
$TABLE_NAME = "wizMailAddressBook";
$ListNo = 10;
$PageNo = 10;
/* 검색 키워드 및 WHERE 구하기 */
if(!$WHERE) $WHERE = "WHERE userid='".$_COOKIE[WIZMAIL_USER_ID]."'";
if(empty($segroup)) $segroup = "all";
if($segroup != "all")
	$WHERE .= "and grp='$segroup' ";

if($sehkey != "all")
{

	$WHERE .= $admin->hangul_qurey($sehkey);
}

if(!empty($searchkeyword))
{
	$segroup = "all";
	$sehkey = "all";
	$WHERE = "WHERE userid='$HTTP_COOKIE_VARS[WIZMAIL_USER_ID]' and $searchkey like '%$searchkeyword%' ";
}


/* 총 갯수 구하기 */
$sqlstr = "select * from $TABLE_NAME $WHERE order by binary name";
$dbcon->_query($sqlstr);
$TOTAL = $dbcon->_num_rows();

if(empty($cp) || $cp <= 0) $cp = 1;
?>	
      <script language='JavaScript'>
<!--

function reverse()
{
  var i;

  for(i=0; i<document.addrbook.elements.length; i++)
    if (document.addrbook.elements[i].name.indexOf('@'))
	  if(document.addrbook.chkboxse.value=='1')
        document.addrbook.elements[i].checked=true;
      else
        document.addrbook.elements[i].checked=false;

  if(document.addrbook.chkboxse.value=='1') 
  {
	document.addrbook.chkboxse.value = '0';
    btn1.innerHTML = "<img src='./img/button2.gif' border=0>";
  }
  else
  {
	document.addrbook.chkboxse.value='1';
    btn1.innerHTML = "<img src='./img/button1.gif' border=0>";
  }
}

function addrbook_move()
{
    var boxselectedval = document.addrbook.movebox.value;
	var	i;
	
	if(boxselectedval == 0)
		return;

    if(document.addrbook.elements.length == 0)
	{
        alert('\n이동할 사람을 선택해 주세요!\n\n');
		return;
    }
	document.addrbook.query.value='addrmove';
	document.addrbook.submit();    
}

function selected_addrbook_delete()
{
    if(document.addrbook.elements.length == 0)
	{
        alert('\n삭제할 사람을 선택해 주세요!\n\n');
		return;
    }

	if(confirm('\n선택한 사람들을 삭제합니다\n\n삭제작업을 진행하실려면 확인을 클릭하세요\n\n'))
	{
		document.addrbook.query.value='addrdelete';
		document.addrbook.submit();    
	}
}

function search()
{
	document.addrbook.query.value='';
	document.addrbook.submit();    
}

// -->

</script>
        <table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'>
 <form action='<?=$PHP_SELF?>' name='addrbook' method='get'>
<input type='hidden' name='menushow' value='<?=$menushow?>'>
<input type='hidden' name='theme' value='<?=$theme?>'> 
<input type='hidden' name='query' value=''> 
<input type='hidden' name='chkboxse' value='1'> 
<input type='hidden' name='segroup' value='<?=$segroup?>'> 
<input type='hidden' name='sehkey' value='<?=$sehkey?>'> 
<input type='hidden' name='sehkeyword' value='<?=$sehkeyword?>'>  
        <!-- 주소록 본문시작 -->		
          <tr> 
            <td width='330'> <table cellpadding='0' cellspacing='0' border='0'>
                <tr> 
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=all'><img src='./img/all.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㄱ");?>'><img src='./img/kor01.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㄴ");?>'><img src='./img/kor02.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㄷ");?>'><img src='./img/kor03.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㄹ");?>'><img src='./img/kor04.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅁ");?>'><img src='./img/kor05.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅂ");?>'><img src='./img/kor06.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅅ");?>'><img src='./img/kor07.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅇ");?>'><img src='./img/kor08.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅈ");?>'><img src='./img/kor09.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅊ");?>'><img src='./img/kor10.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅋ");?>'><img src='./img/kor11.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅌ");?>'><img src='./img/kor12.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅍ");?>'><img src='./img/kor13.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=<?=urlencode("ㅎ");?>'><img src='./img/kor14.gif' border='0'></a></td>
                  <td><a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&sehkey=eng'><img src='img/eng.gif' width="42" height="18" border='0'></a></td>
                </tr>
              </table></td>
            <td width='220'> <table cellpadding='0' cellspacing='0' border='0' align='right'>
                <tr> 
                  
                  <td> <select name='searchkey' class='select'>
                      <option value='name' selected>이름</option>
                      <option value='company'>회사명</option>
                      <option value='hphone'>전화번호</option>
                      <option value='hand'>전화번호</option>
                    </select> </td>
                  <td><input name='searchkeyword' type='text' size='12' class='input'></td>
                  <td> <a href='javascript:search();'><img src='img/button8.gif' width="46" height="20" border='0' align='absmiddle'></a> 
                  </td>
                </tr>
              </table></td>
          </tr>
          <tr> 
            <td colspan='2'> <table cellpadding='0' cellspacing='0' border='0' width='100%'>
                <tr height='2'>
                  
                </tr>
                <tr> 
                  <td><table cellspacing=0 bordercolordark=white width="100%" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1">
                      <tr align='center' valign='middle' bgcolor="E0E4E8" height='23'> 
                        <td width='30'>선택</td>
                        
                        <td width='90'>이름</td>
                        
                        <td width='130' bgcolor="E0E4E8">직장명</td>
                        
                        <td width='131'>전화번호</td>
                        
                        <td width="685">전자우편</td>
                      </tr>
                      <? 
$START_NO = ($cp - 1) * $ListNo;
$BOARD_NO=$TOTAL-($ListNo*($cp-1));
$SELECT_STR="$sqlstr LIMIT $START_NO, $ListNo";
$SELECT_QRY=$dbcon->_query($SELECT_STR);
$cnt = 0;
while($list=@$dbcon->_fetch_array($SELECT_QRY)):
?>
                      <tr align='center' valign='middle' bgcolor="#FFFFFF" height='23' onMouseOver="this.style.backgroundColor='#FBFDFF';" onMouseOut="this.style.backgroundColor='';"> 
                        <td width="30" height="23"><input type='checkbox' name='<?=$list[idx]?>' value='wizMail'></td>
                        
                        <td width="90"> &nbsp;
                          <a href="<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=mail/address5&mode=modify&idx=<?=$list[idx]?>"><?=$list[name]?></a>
                        </td>
                        
                        <td width="130"> &nbsp;
                          <?=$list[company]?>
                        </td>
                        
                        <td width="131"> &nbsp;
                          <?=$list[cphone];?>
                        </td>
                        
                        <td>&nbsp; 
                          <?=$list[email]?>
                        </td>
                      </tr>
                      <?
$cnt++;
$BOARD_NO--;
endwhile;
if(!$cnt):/* 게시물이 존재하지 않을 경우 */
?>
                      <tr align='center' valign='middle' bgcolor="#FFFFFF" height='23'> 
                        <td colspan="9">검색된 데이타가 없습니다.</td>
                      </tr>
<?
endif;
?>					  
                    </table></td>
                </tr>
                <tr> 
                  <td>&nbsp; </td>
                </tr>
              </table></td>
          </tr>
          <tr>
            <td colspan='2' height='1'></td>
          </tr>
          <tr> 
            <td colspan='2'> <table cellpadding='0' cellspacing='0' border='0' width='100%'>
                <tr> 
                  <td width='70%'> <table border='0' cellpadding='0' cellspacing='0' width='100%' class="s1">
                      <tr> 
                        <td width='70'><a href='javascript:reverse()'>
                          <div id='btn1'><img src='img/button1.gif' width="66" height="20" border='0'></div>
                          </a></td>
                        <td width='80'>선택한 사람을</td>
                        <td width='45'><a href='javascript:selected_addrbook_delete()'><img src='img/button3.gif' width="46" height="20" border='0'></a></td>
                        <td width='145'> <select name='movebox' sytle='width:134' onChange='addrbook_move()'>
                            <option value='0' selected>다른 그룹으로 이동</option>
                            <?

$SQL = "select * from wizMailAddressBookG where userid='$HTTP_COOKIE_VARS[WIZMAIL_USER_ID]' order by idx asc";
$Rs=$dbcon->_query($SQL);
$Total=$dbcon->_num_rows($Rs);

if($Total)
{
	$cnts = 0;
	while($list = $dbcon->get_rows())
	{
		$grpcode =$list["code"];
		$grpname = $list["subject"];

			echo("<option value='$grpcode'>$grpname</option>");

		$cnts = $cnts + 1;
	}
}

?>
                          </select> 
                        </td>
                        <td><img src='./img/blank.gif' border='0'></td>
                      </tr>
                    </table></td>
                  <td width='30%' align='right'> <a href='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=mail/address5'><img src='img/button9.gif' width="66" height="20" border='0'></a> 
                    <!--<a href="#" onClick="window.open('./address1_1.php','GroupAddWindwo','')"><img src='img/button10.gif' width="66" height="20" border='0'></a> -->
                  </td>
                </tr>
              </table></td>
          </tr></form>
        </table>
        
      <!-- 주소록 본문종료 -->
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td align="center" class="s1"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?theme=$theme&menushow=$menushow&SEARCHTITLE=$SEARCHTITLE&searchkeyword=".urlencode($searchkeyword);
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
</td>
        </tr>
      </table> </td>
  </tr>
</table>

</td>
  </tr>
</table>