<?
include "../common/header_pop.php";
include "../../config/avatar_array.php";
include "../../lib/class.avatar.php";

$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;
$avatarpath = $avatar->avatarpath = "../../config/wizavatar/avatarimg/";
$avavar_root = "../";

//include_once "../../lib/class.avatar.gen.php";
//$gencls = new Gen_Class($MYSQL_HOST, $MYSQL_DB, $MYSQL_ID, $MYSQL_PASSWORD);

if($query == "insert") {
	$common->upload_path = $avatarpath."face_img/";
	$common->ProhibitExtention = "cgi, php, asp, jsp, exe, php3, php4, html, htm, shtml";
	$common->uploadmode = "insert";
	$common->uploadfile("file");	//attached 등은 반드시 배열이여야 한다.
	//$common->oldfilename upload된 파일명을 받는다(다중일경우 "|" 로 된 파일을 넘겨준다)
	//$common->delfile = $delflag//파일삭제 책크시(delflag 는 반드시 배열)(수정시)
	for($i=0; $i<10; $i++)
	{
		$imgname[$i] = $common->returnfile[$i];
	}
	
	//$gencls->replacflag = "on";
	//$gencls->uploadfile("file");
	//$imgname = split("\|", $gencls->attachedfile);
	
		
	$sqlstr = "insert into ".$WIZTABLE["AVATARFACE"]." (item_id, face01, face01a, face02, face02a, face03, face03a, face04, face04a, face05, face05a) values ('$item_id','".$imgname[0]."','".$imgname[1]."','".$imgname[2]."','".$imgname[3]."','".$imgname[4]."','".$imgname[5]."','".$imgname[6]."','".$imgname[7]."','".$imgname[8]."','".$imgname[9]."')";
	$result = $dbcon->_query($sqlstr);
	
	if($result) $common->js_windowclose("아이템이 추가되었습니다.", "reload");
	else $common->js_alert("아이템 추가에 오류가 발생했습니다");


}else if($query == "delete") {// 파일지우기

}else if($query == "update"){
	$common->upload_path = $avatarpath."face_img/";
	$common->ProhibitExtention = "cgi, php, asp, jsp, exe, php3, php4, html, htm, shtml";
	$common->uploadmode = "update";
	$common->oldfilename = $oldfilename1;//upload된 파일명을 받는다(다중일경우 "|" 로 된 파일을 넘겨준다)	
	$common->uploadfile("file");	//attached 등은 반드시 배열이여야 한다.

	//$common->delfile = $delflag//파일삭제 책크시(delflag 는 반드시 배열)(수정시)
	//print_r($common->returnfile);

	for($i=0; $i<10; $i++)
	{
		$imgname[$i] = $common->returnfile[$i];
	}
//print_r($imgname);
	
	
	//$gencls->mode = "update";
	//$gencls->upload_path = $avatar->avatarpath."face_img/";
	//$gencls->replacflag = "on";
	//$gencls->old_attachedfile=$oldfilename1;
	//$gencls->uploadfile("file");
	//$imgname = split("\|", $gencls->attachedfile);

	$sqlstr = "update ".$WIZTABLE["AVATARFACE"]." set face01='".$imgname[0]."', face01a='".$imgname[1]."', face02='".$imgname[2]."', face02a='".$imgname[3]."', face03='".$imgname[4]."', face03a='".$imgname[5]."', face04='".$imgname[6]."', face04a='".$imgname[7]."', face05='".$imgname[8]."', face05a='".$imgname[9]."' where item_id='$item_id'";
	$result = $dbcon->_query($sqlstr, 1);
	if($result) $common->js_windowclose();
	else $common->js_alert("정상적으로 수정 되지 못했습니다.");

}


## 현재 필드가 등록되어 있는지 확인후 있으면 update를 없으면 insert를 실행한다.
$sqlstr = "select * from ".$WIZTABLE["AVATARFACE"]." where item_id = '$no'";
$list = $dbcon->get_row($sqlstr);
if($list[0]){
	$mode = "update";
	$oldfilename1 = $list["face01"]."|".$list["face01a"]."|".$list["face02"]."|".$list["face02a"]."|".$list["face03"]."|".$list["face03a"]."|".$list["face04"]."|".$list["face04a"]."|".$list["face05"]."|".$list["face05a"];
}else{
	$mode = "insert";
}

$facelist = getFaceList($no);
function getFaceList($item_id){
	global $WIZTABLE;
	$sqlstr = "select * from ".$WIZTABLE["AVATARFACE"]." where item_id = '$item_id'";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	$facelist[1] = $list["face01"];
	$facelist[2] = $list["face02"];
	$facelist[3] = $list["face03"];
	$facelist[4] = $list["face04"];
	$facelist[5] = $list["face05"];
	$facelist[11] = $list["face01a"];
	$facelist[12] = $list["face02a"];
	$facelist[13] = $list["face03a"];
	$facelist[14] = $list["face04a"];
	$facelist[15] = $list["face05a"];
	return $facelist;
}

?>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<form method="post" action="<?=$PHP_SELF;?>" enctype="multipart/form-data">
<input type="hidden" name="query" value="<?=$mode;?>">
<input type="hidden" name="item_id" value="<?=$no;?>">
<input type="hidden" name="oldfilename1" value="<?=$oldfilename1;?>">


   <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[1]?>' border=0 width=26, height=26>기본(이미지)</td>
    <td><input type="file" name="file[0]" /></td>
  </tr>
    <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[11]?>' border=0 width=26, height=26>기본(아바타)</td>
    <td><input type="file" name="file[1]" /></td>
  </tr>
  <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>  
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[2]?>' border=0 width=26, height=26>웃음(이미지)</td>
    <td><input type="file" name="file[2]" /></td>
  </tr>
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[12]?>' border=0 width=26, height=26>웃음(아바타)</td>
    <td><input type="file" name="file[3]" /></td>
  </tr>  
  <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>  
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[3]?>' border=0 width=26, height=26>울음(이미지)</td>
    <td><input type="file" name="file[4]" /></td>
  </tr>
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[13]?>' border=0 width=26, height=26>울음(아바타)</td>
    <td><input type="file" name="file[5]" /></td>
  </tr> 
  <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>   
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[4]?>' border=0 width=26, height=26>화남(이미지)</td>
    <td><input type="file" name="file[6]" /></td>
  </tr>
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[14]?>' border=0 width=26, height=26>화남(아바타)</td>
    <td><input type="file" name="file[7]" /></td>
  </tr> 
  <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>   
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[5]?>' border=0 width=26, height=26>황당(이미지)</td>
    <td><input type="file" name="file[8]" /></td>
  </tr>
  <tr>
    <td><img src='<?=$avatarpath?>face_img/<?=$facelist[15]?>' border=0 width=26, height=26>황당(아바타)</td>
    <td><input type="file" name="file[9]" /></td>
  </tr>  
  <tr>
    <td height="1" colspan="2" bgcolor="#CCCCCC"></td>
    </tr>  
  <tr>
    <td colspan="2" align="center"><input type="submit" name="Submit" value="Submit" /></td>
  </tr></form>
</table>
