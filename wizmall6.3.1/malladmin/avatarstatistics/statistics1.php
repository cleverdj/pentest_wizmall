<?
/* 
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
?>
<?
include_once ("./ROOT_CHECK.php");
include_once "../../lib/class.avatar.php";
include_once ("../../config/avatar_array.php");
$avatar = new avatar();
$avatar->get_object($dbcon, $common);
$avatar->WIZTABLE = $WIZTABLE;

include "./lib/admin_cls.php";
$avataradmin = new Avataradmin_Cls($MYSQL_HOST, $MYSQL_DB, $MYSQL_ID, $MYSQL_PASSWORD);

$syear = $syear ? $syear : date("Y");
$smonth = $smonth ? $smonth : date("m");
$sday = $sday ? $sday : date("d");
$tyear = ($tyear == "" || $tyear < $syear) ? $syear:$tyear;
$tmonth = ($tmonth == "" || $tmonth < $smonth) ? $smonth:$tmonth;
$tday = ($tday == "" || $tday < $sday) ? $sday:$tday;

$sregdate = mktime(0,0,0,$smonth,$sday,$syear);
$tregdate = mktime(0,0,-1,$tmonth,$tday+1,$tyear);
?>
<script id="dynamic"></script>
<script language=javascript>
<!--
function getCategory(step,f,flag){
	form = f.form.name;
	dynamic.src = "./avatar/search_category.php?step="+step+"&trigger="+f.value+"&form="+form+"&flag="+flag;
}

function confirm_del(no,item_name) {
	if(confirm(item_name +"을 정말 삭제하시겠습니까?")) {
		location.href="avatar/avatarProc.php?no="+no+"&query=delete&menushow=<?=$menushow;?>&theme=<?=$theme;?>";
	}else  {
		alert("삭제를 취소하셨습니다.");
	}
}

function FaceWindow(no){
	window.open('./avatar/facesave.php?no='+no,'FaceWindow','width=400, height=400');

}
//-->
</script>
<table  border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td height="8"></td>
    <td height="8"></td>
  </tr>
  <tr>
    <td></td>
    <td valign="top"><table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1">
        <TR>
          <TD bgColor=#ffffff><strong><font color="#FF6600">기간별 판매 리스트 </font></strong></TD>
        </TR>
        <TR>
          <TD bgColor=#ffffff><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0 class="s1">
              <TR>
                <TD vAlign=top align=center width=70><font color=#ff6600>[note]</font> </TD>
                <TD>기간별 아이템의 판매수량을 보실 수 있습니다.<br>
                  단, 구매금액은 현재 item 테이블과 연동되므로 실제 구매금액과의 차이가 있을 수 있습니다. </TD>
              </TR>
            </TABLE></TD>
        </TR>
      </TABLE>
      <br>
      <br>
<TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
  <form action="<?=$PHP_SELF;?>" method="post" name="list">
  <input type="hidden" name="menushow" value="<?=$menushow?>" />
   <input type="hidden" name="theme" value="<?=$theme?>" />
    <tr>
      <td width=350 bgcolor="#ffffff"><select name="Category1" onChange="getCategory('1', this, 'avatar');">
                <option value="" selected>대분류 </option>
                <option value="">----------------</option>
                <?
$substr = "SELECT cat_no, cat_name FROM ".$WIZTABLE["CATEGORY"]." WHERE cat_no < 100 ORDER BY cat_no ASC";
$subqry = mysql_query($substr);
while($sublist=@mysql_fetch_array($subqry)):
$selected = substr($Category1, -2) == substr($sublist["cat_no"], -2)?"selected":""; 
echo"<option value='$sublist[cat_no]' ${selected}>$sublist[cat_name]</option> \n";
endwhile;
?>
              </select>
<select name="Category2">
                <option value="" selected>중분류</option>
<?
if($mode == "update"){
$substr = "SELECT cat_no, cat_name FROM ".$WIZTABLE["CATEGORY"]." WHERE cat_no < 10000 and cat_no >= 100 and substring(cat_no, 5, 2)='".substr($list["Category"], -2)."' ORDER BY cat_no ASC";
$subqry = mysql_query($substr);
while($sublist=@mysql_fetch_array($subqry)):
$selected = substr($Category2, -4) == substr($sublist["cat_no"], -4)?"selected":""; 
echo"<option value='$sublist[cat_no]' ${selected}>$sublist[cat_name]</option> \n";
endwhile;
}
?>				
                <option value="">----------------</option>
            </select></td>
      <td width=100 bgcolor="#ffffff"><select name="gender">
        <option value="">전체</option>
<?
$genderArr = array("0"=>"기타", "1"=>"남성", "2"=>"여성");
foreach($genderArr as $key => $value){
	$selected = $gender == $key && $gender <> "" ? "selected":"";
	echo "<option value='$key' $selected>$value</option>\n";
}
?>
      </select></td>
      <td bgcolor="#ffffff"><input type="submit" name="Submit" value="찾기" /></td>
    </tr>
    <tr>
      <td bgcolor="#ffffff">
	  <? $startyear = "2007"; $endyear = "2008"; ?>
	  <?=$avataradmin->selectdatefnc("syear", "smonth", "sday", $startyear, $endyear,$sregdate)?> ~ <?=$avataradmin->selectdatefnc("tyear", "tmonth", "tday", $startyear, $endyear,$tregdate)?></td>
      <td bgcolor="#ffffff">&nbsp;</td>
      <td bgcolor="#ffffff">&nbsp;</td>
    </tr>
  </form>
</table>
<br>
<?
function getCategoryName($code){
	global $WIZTABLE;
	$sqlstr = "select cat_name from ".$WIZTABLE["CATEGORY"]." where cat_no = '$code'";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	return $list["cat_name"];
}

function getFaceList($item_id){
	global $WIZTABLE;
	$sqlstr = "select * from ".$WIZTABLE["AVATARFACE"]." where item_id = '$item_id'";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	$facelist[1] = $list["face01"];
	$facelist[2] = $list["face02"];
	$facelist[3] = $list["face03"];
	$facelist[4] = $list["face04"];
	$facelist[5] = $list["face05"];
	return $facelist;
}


function showFace($facearr){
	$path = "../wizavatar/avatarimg/face_img/";
	foreach($facearr as $key => $value){
		$str .= "<img src='".$path.$value."' border=0 width=26, height=26>&nbsp;"; 
	}
	echo $str;
}	
	
	
$ListNo=$pg_counts?$pg_counts:20;
$PageNo = 10;


$whereis = "where 1 and i.category <> 000000 and m.b_date between $sregdate and $tregdate";
if($gender <> "") $whereis .= " and i.gender = '$gender' ";
if($Category2) $whereis .= " and substr(i.category, 3, 4) = '".substr($Category2, -4)."' ";
else if($Category1) $whereis .= " and substr(i.category, 5, 2) = '".substr($Category1, -2)."' ";


/* 총 갯수 구하기 */
$TOTAL_STR = "select count(1) from ".$WIZTABLE["AVATARMERCHANT"]." m ";
$TOTAL_STR .= " left join ".$WIZTABLE["AVATARITEM"]." i ";
$TOTAL_STR .= " on m.item_no = i.no ";
$TOTAL_STR .= " $whereis ";
$TOTAL_STR .= " group by m.item_no ";
//echo "\$TOTAL_STR = $TOTAL_STR <br>";
$TOTAL_QRY = mysql_query($TOTAL_STR) or die(mysql_error()."<br>".$TOTAL_STR);
$TOTAL = @mysql_num_rows($TOTAL_QRY);
mysql_free_result($TOTAL_QRY);

if(empty($CP) || $CP <= 0) $CP = 1;

//--페이지 나타내기--
/* 하단 페이지수 표시 for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) */
$TP = ceil($TOTAL / $ListNo) ; /* 총페이지수(Total Page) : 총게시물수 / 페이지당 리스트수  */
$CB = ceil($CP / $PageNo); /* 현재블록(Current Block) : 현재페이지 / 표시되는 페이지 수 */
$SP = ($CB - 1) * $PageNo + 1; /* 블록의 처음 페이지(Start Page) 구하기 */
$EP = ($CB * $PageNo); /*블록의 마지막 페이지(End Page) : 현재 블록 * 표시되는 페이지수 */
$TB = ceil($TP / $PageNo); /* 총블록수(Total Block) : 총페이지수 / 표시되는 페이지 수 */

$START_NO = ($CP - 1) * $ListNo;
$BOARD_NO1=$TOTAL-($ListNo*($CP-1));
?>
<TABLE cellSpacing=0 borderColorDark=white width="100%" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
              <tr>
                <td align="center" bgcolor="E0E4E8"><strong>이미지</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>분류</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>아이템명</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>구매금액</strong></td>
                <td align="center" bgcolor="E0E4E8"><strong>판매갯수</strong></td>
              </tr>	
			  <? 
$sqlstr = "select count(m.item_no) as salecnt, i.*  from ".$WIZTABLE["AVATARMERCHANT"]." m ";
$sqlstr .= " left join ".$WIZTABLE["AVATARITEM"]." i ";
$sqlstr .= " on m.item_no = i.no ";
$sqlstr .= " $whereis ";
$sqlstr .= " group by m.item_no order by salecnt desc limit $START_NO, $ListNo";
$sqlqry = mysql_query($sqlstr) or die($sqlstr);
$cnt=0;
while($list=@mysql_fetch_array($sqlqry)):
	$code = $list["category"];
	//echo "code = $code <br>";
	$big_code = substr($code, -2);
	$mid_code = substr($code, -4, 2);
	$small_code = substr($code, -6, 2);
	if($big_code <> "00"){
		$fcode = "0000".$big_code;
		$codename = getCategoryName($fcode);
	}
	if($mid_code <> "00"){
		$fcode = "00".$mid_code.$big_code;
		$codename .= " &gt; ".getCategoryName($fcode);
	}
	if($small_code <> "00"){
		$fcode = $small_code.$mid_code.$big_code;
		$codename .= " &gt; ".getCategoryName($fcode);
	}	
	$tmpgender = $list["gender"];
	switch($tmpgender){
		case "1":
			$genderstr = "남";
		break;
		case "2":
			$genderstr = "여";
		break;		
		default:
			$genderstr = "공동";
		break;	
	}
	$layer = $list["layer"];	
?><tr>
                <td align="center" bgcolor="E0E4E8"><img src='../wizavatar/avatarimg/<?=$list["filename1"]?>' width="50" border=0></td>
                <td align="center" bgcolor="#FFFFFF"><?=$codename?></td>
                <td align="center" bgcolor="#FFFFFF"><?=$list["name"]?></td>
                <td align="center" bgcolor="#FFFFFF"><?=$list["buy_p"]?></td>
                <td align="center" bgcolor="#FFFFFF"><?=$list["salecnt"]?></td>
              </tr>
<?
$BOARD_NO1--;
$cnt++;
endwhile;
?>			  
      </table>
<br>

<TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=1 class="s1">
  <tr>
    <td align="center" bgcolor="#ffffff" ><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$TransData = "menushow=$menushow&theme=$theme&Category1=$Category1&Category2=$Category2&gender=$gender&syear=$syear&smonth=$smonth&sday=$sday&tyear=$tyear&tmonth=$tmonth&tday=$tday";
if ( $CB > 1 ) {
$PREV_PAGE = $SP - 1;
echo " <a href='$PHP_SELF?CP=$PREV_PAGE&$TransData'>Prev</a> ";
} else {
echo " Prev ";
 }


/* LISTING NUMBER PART */
for ($i = $SP; $i <= $EP && $i <= $TP ; $i++) {
if($CP == $i){$NUMBER_SHAPE= "<B>${i}</B>";}
else $NUMBER_SHAPE=${i};
ECHO" <A HREF='$PHP_SELF?CP=$i&$TransData'>$NUMBER_SHAPE</a> ";
}

/* NEXT or END PART */
if ($CB < $TB) {
$NEXT_PAGE = $EP + 1;
ECHO " <a href='$PHP_SELF?CP=$NEXT_PAGE&$TransData'>Next</a> ";
} else {
ECHO" Next ";
}
?>    </td>
  </tr>
</table>        </td>
  </tr>
</table>
