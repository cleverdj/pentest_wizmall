<?
#CREATE TABLE `wizbanner` (
#  `uid` int(11) NOT NULL auto_increment,
#  `ordernum` int(5) NOT NULL default '0',
#  `url` varchar(50) NOT NULL default '',
#  `target` varchar(20) NOT NULL default 'root',
#  `attached` varchar(250) NOT NULL default '',
#  `wdate` int(13) NOT NULL default '0',
#  PRIMARY KEY  (`uid`)
#) TYPE=MyISAM AUTO_INCREMENT=1 ;


$BOARD_NAME="wizbanner";
/******************************************************************************/

if ($query == 'insert') {   //
	## 파일 업로딩 시작 
	$common->upload_path = "../config/banner";
	$common->uploadmode = "insert";
	$common->uploadfile("file");
	$linkimg = $common->returnfile[0];
	## 파일 업로딩 끝
	
	$sqlstr = "select max(ordernum) from $BOARD_NAME where flag1 = '$flag1'";
	$max = $dbcon->get_one($sqlstr);
	$max = $max?$max+1:1;
	$sqlstr = "insert into $BOARD_NAME (flag1, ordernum, url, target, attached, wdate) values('$flag1', '$max', '$url','$target', '$linkimg',".time().")";
	$sqlqry = $dbcon->_query($sqlstr);
	$common->js_location("$PHP_SELF?theme=basicconfig/main01&menushow=$menushow&flag1=$flag1");
	
	
}else if ($query == 'update') {   //if ($query == 'insert') {   //
	## 파일 업로딩 시작 
	$common->upload_path = "../config/banner";
	$common->uploadmode = "update";
	$common->oldfilename = $oldfile;
	$common->uploadfile("file");
	$linkimg = $common->returnfile[0];
	## 파일 업로딩 끝	
	
	$sqlstr = "update $BOARD_NAME set ordernum='$ordernum', url='$url', target='$target', attached='$linkimg' where uid='$uid'";
	$sqlqry = $dbcon->_query($sqlstr);
	$mode = "update";
}

if($uid){
	$sqlstr = "select * from $BOARD_NAME where uid = '$uid'";
	$dbcon->_query($sqlstr);
	$list = $dbcon->_fetch_array();
	extract($list);
	$mode = "update";
}else $mode = "insert";
?>
<SCRIPT LANGUAGE=javascript>
<!--
function check_field(){
	var f = document.forms.BrdList;
}
//-->
</SCRIPT>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>베너관리</legend>
						<div id="notice">[note]</div>
						<div id="comment"> order가 작은 순서가 상위에 위치합니다. </div>
						</fieldset>
						<p></p>
					    <table class="table_main">
        <form action="<?=$PHP_SELF?>" enctype="multipart/form-data" Name="BrdList" method="post" onsubmit='return check_field()'>
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type="hidden" name="theme" value="<?=$theme;?>">
          <input type="hidden" name="query" value="<?=$mode;?>">
          <input type="hidden" name="uid" value="<?=$uid;?>">
		  <input type="hidden" name="flag1" value="<?=$flag1?>">
          <tr bgcolor="E0E4E8"> 
            <td width="150" align="center" bgcolor="E0E4E8">우선순위</td>
            <td bgcolor="#FFFFFF"><input name="ordernum" type="text" size="3" value="<?=$ordernum;?>"></td>
          </tr>
          <tr bgcolor="#FFFFFF"> 
            <td align="center" bgcolor="E0E4E8">URL </td>
            <td><input name="url" type="text" size="30" value="<?=$url;?>"> 
            </td>
          </tr>
          <tr bgcolor="#FFFFFF"> 
            <td align="center" bgcolor="E0E4E8">target </td>
            <td><select name="target" id="target">
              <option value="_self"<? if($target == "_self") echo " selected";?>>_self</option>
              <option value="_blank"<? if($target == "_blank") echo " selected";?>>_blank</option>
            </select>
            </td>
          </tr>          
          <tr bgcolor="#FFFFFF"> 
            <td align="center" bgcolor="E0E4E8">첨부화일</td>
            <td><input type="file" name="file[0]">
              <INPUT type='hidden' name='oldfile'  value="<?=$attached;?>"></td>
          </tr>
          <tr bgcolor="#FFFFFF"> 
            <td colspan="2" align="center"> <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td align="center"> <input type="image" src="img/dung.gif" width="55" height="20" border="0" align="absmiddle"></a>
                  </td>
                </tr>
              </table></td>
          </tr>
        </form>
      </table></td>
  </tr>
</table>
