<?
#CREATE TABLE `wizpopup` (
#  `uid` int(6) NOT NULL auto_increment,
#  `pskinname` varchar(50) NOT NULL default '',
#  `pwidth` int(5) NOT NULL default '0',
#  `pheight` int(5) NOT NULL default '0',
#  `ptop` int(5) NOT NULL default '0',
#  `pleft` int(5) NOT NULL default '0',
#  `psubject` varchar(250) NOT NULL default '',
#  `pcontents` text NOT NULL,
#  `pattached` varchar(100) NOT NULL default '',
#  `popupenable` int(2) NOT NULL default '0',
#  `options` text NOT NULL,
#  PRIMARY KEY  (`uid`)
#) TYPE=MyISAM AUTO_INCREMENT=1 ;

$BOARD_NAME="wizpopup";
/******************************************************************************/
?>
<?
if ($query == 'delete') {   //삭제옵션시 실행
while (list($key,$value) = each($_GET)) {
        if(ereg("deleteItem", $key)) {
                $sqlstr = "SELECT * FROM $BOARD_NAME WHERE UID='$value'";
                $LIST = $dbcon->_fetch_array($dbcon->_query($sqlstr));
				$Loaded = split("\|", $LIST[pattached]);
				for($i=0; $i<sizeof($Loaded); $i++){
               	 if (is_file("../config/wizpopup/$Loaded[$i]") && $Loaded[$i]) {
                  	      unlink("../config/wizpopup/$Loaded[$i]");
				 }
                }
                $dbcon->_query("DELETE FROM $BOARD_NAME WHERE uid=$value");
        }
} 
} //삭제옵션 끝
?>
<?
//include "../wizboard/func/STR_CUTTING_FUNC.php";
$WHERE = "WHERE uid <> '0' ";
/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(uid) FROM $BOARD_NAME $WHERE";
$TOTAL = $dbcon->get_one($TOTAL_STR);
$LIST_NO=10; /* 페이지당 출력 리스트 수 */
$PageNo=10; /* 페이지 밑의 출력 수 */
if(empty($SUB_cp) || $SUB_cp <= 0) $SUB_cp = 1;
?>
<script language="javascript">
<!--
function popupview(uid, pleft, ptop, pwidth, pheight){
window.open('../util/wizpopup/index.php?uid='+uid,'PopUpWindow','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,left='+pleft+',top='+ptop+',width='+pwidth+',height='+pheight);

}
//-->
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>팝업창 관리</legend>
						<div id="notice">[note]</div>
						<div id="comment">만약 index.php에 아래코드가 없을 경우 아래 코드를 넣어 준다.<br />
                    &lt;?<br />
                    include &quot;./util/wizpopup/popinsert.php&quot;;<br />
                    ?&gt; </div>
						</fieldset>
						<p></p>	
      <table class="table_main">
        <form action="<?=$PHP_SELF?>" Name="BrdList" onsubmit='return deletefnc()'>
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type="hidden" name="theme" value="<?=$theme;?>">
          <input type="hidden" name="cp" value="<?=$cp?>">
          <input type="hidden" name="SUB_cp" value="<?=$SUB_cp?>">
          <input type="hidden" name="query" value="delete">
          <input type="hidden" name="flag1" value="<?=$flag1?>">
          <tr align="center" bgcolor="E0E4E8">
            <td width="30">삭제</td>
            <td width="80">사용여부</td>
            <td>제목</td>
            <td width="70" bgcolor="E0E4E8">보기</td>
            <td width="70" bgcolor="E0E4E8">수정</td>
          </tr>
          <? 
$START_NO = ($SUB_cp - 1) * $LIST_NO;
$BOARD_NO=$TOTAL-($LIST_NO*($SUB_cp-1));
$sqlstr="SELECT * FROM $BOARD_NAME $WHERE ORDER BY uid DESC LIMIT $START_NO, $LIST_NO";
//echo "sqlstr = $sqlstr <br />";
$sqlqry=$dbcon->_query($sqlstr);
while($LIST=@$dbcon->_fetch_array($sqlqry)):
?>
          <tr bgcolor="#FFFFFF">
            <td align="center"><input type="checkbox" name="deleteItem_<?=$LIST[uid]?>" value="<?=$LIST[uid]?>">
            </td>
            <td align="center"><? echo $LIST[popupenable]=="1"?"보임":"숨김";?> </td>
            <td><?=$LIST[psubject];?>
            </td>
            <td align="center"><a href="javascript:popupview('<?=$LIST["uid"]?>', '<?=$LIST["pleft"]?>', '<?=$LIST["ptop"]?>', '<?=$LIST["pwidth"]?>', '<?=$LIST["pheight"]?>')">보기</a></td>
            <td align="center"><a href="<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=util/popup1_write&mode=update&uid=<?=$LIST[uid];?>"><img src="img/su.gif" width="53" height="20" border="0"></a> </td>
          </tr>
          <?
$BOARD_NO--;
endwhile;
?>
          <tr align="center" bgcolor="F2F2F2">
            <td colspan="5"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td width="5%" align="center"><input type="image" style="cursor:pointer" src="img/del02.gif" align="middle" width="53" height="20">
                  </td>
                  <td width="95%"><a href="<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=util/popup1_write&mode=insert"><img src="img/dung.gif" width="55" height="20" border="0" align="absmiddle"></a></td>
                </tr>
              </table></td>
          </tr>
        </form>
      </table>
      <table >
        <tr>
          <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&cp=$cp&stitle=$stitle&keyword=".urlencode($keyword);
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
//$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
          </td>
        </tr>
      </table></td>
  </tr>
</table>
