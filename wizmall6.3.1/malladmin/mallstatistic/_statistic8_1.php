<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
03-12-19 전체 레이아웃 수정 및 버그 수정
*/

if ($sort) {
        $cat_query = $sort;
        if ($sort1) {$cat_query = $cat_query.">".$sort1;}
        if ($sort2) {$cat_query = $cat_query.">".$sort2;}
        $WHERE = "WHERE Category LIKE '$cat_query%'"; $WHERE1 = "AND Category LIKE '$cat_query%'";
}


$listNo = "15";
$PageNo = "20";
$sqlstr = "SELECT count(*) FROM wizCom where (CompSort = '01' or CompSort = '02' or CompSort = '03')";
$TOTAL = $dbcon->get_one($sqlstr);

if(empty($cp) || $cp <= 0) $cp = 1;
$START_NO = ($cp - 1) * $listNo;

//--페이지 나타내기--
$TP = ceil($TOTAL / $listNo) ; /* 페이지 하단의 총 페이지수 */
$CB = ceil($cp / $PageNo);
$SP = ($CB - 1) * $PageNo + 1;
$EP = ($CB * $PageNo);
$TB = ceil($TP / $PageNo);
?>
<table  border="0" cellpadding="0" cellspacing="0"> <tr>
                <td height="8"></td>
                <td height="8"></td>
              </tr>
              <tr>
                <td> </td>
                <td valign="top"><table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1" >
                <tr> 
                  
                
          <td bgcolor="#FFFFFF"><b><font color="#FF6600">거래처(기업회원)별 판매 통계</font></b></td>
                </tr>
                <tr> 
                  <td bgcolor="#FFFFFF"><table cellspacing=0 cellpadding=0 width="100%" border=0 class="s1">
                      <tr> 
                        <td width="70" align="center" valign="top"><font color=#ff6600>[note]</font></td>
                        
                <td>기업회원은 통상 Grad 5로 분류 됩니다.</td>
                      </tr>
                    </table></td>
                </tr>
              </table>
              <br />
                  
      <table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1">
         
        <tr> 
                      
            <td bgcolor=#ffffff valign="top">
              <table cellspacing=0 cellpadding=0 width="100%" 
border=0 class="s1">
                           
                          <tr> 
                            <td valign=top align=right height="28">&nbsp; 
                              <table width="709" border="0" class="s1">
        <FORM ACTION='<?=$PHP_SELF?>' METHOD=POST>
          <INPUT TYPE=HIDDEN NAME=cp VALUE='<?=$cp?>'>
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <INPUT TYPE=HIDDEN NAME=theme VALUE='<?=$theme?>'>							  
                                <tr> 
                                  <td width="257">&nbsp; </td>
                                  
                            <td width="101">&nbsp; </td>
                            <td width="115">&nbsp; </td>
                            <td width="79">&nbsp; </td>
                                  
                            <td width="135"><a href="<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=statistic8_2&mid=<?=$mid?>">월주문주기보기</a> </td>
                                </tr></form>
                              </table>
                            </td>
                          </tr>
                           
                        </table>
                      </td>
                    </tr>
                     
                  </table>
                  <br />
                  
      <table width="760" border=0 cellpadding="5" cellspacing=1 bordercolorlight=#dddddd bordercolordark=white bgcolor=#c0c0c0 class="s1">
        
          <tr bgcolor="E0E4E8"> 
            <td align="center">거래처명/담당자</td>
            <td align="center">판매수량</td>
            <td align="center">총판매금액</td>
            <td align="center">주 소</td>
          </tr>
          <tr bgcolor="#FFFFFF"> 
            <td height=1 colspan=4 align="middle"></td>
          </tr>
<?
$MSqlstr = "SELECT UID,ID,Grade,Address1,Address2,Tel1,Name FROM wizMembers WHERE ID = '$mid'";
$MSqlqry = $dbcon->_query($MSqlstr);
$Mlist = $dbcon->_fetch_array( $MSqlqry );
$sqlstr = "select CompName, CompChaName, CompChaTel, CompAddress1, CompAddress2 from wizCom where CompID = '$mid'"; 
$dbcon->_query($sqlstr);
$CompList =  $dbcon->_fetch_array();
/* 만약 기업회원과 일반회원과의 가격 차등일 경우 BuyPrice --> ByuPrice1 */
$sqlstr = "select sum(BuyGoodsQty) as tqty, sum(BuyGoodsQty*BuyPrice) as tmount from wizBuyersMore where BuyerID = '$mid'";
$dbcon->_query($sqlstr);
$MoreList = $dbcon->_fetch_array();
?>
          <tr bgcolor="#FFFFFF"> 
            <td align="center">&nbsp;<B><FONT COLOR='BROWN'> 
              <?=$CompList[CompName]?>
              </FONT></B><br />
              &nbsp;<FONT COLOR=GREEN>( 
              <?=$Mlist[Name];?>
              : 
              <?=$Mlist[Tel1];?>
              )</FONT></td>
            <td align="center"><?=number_format($MoreList[tqty])?> 종</td>
            <td align="center"> 
              <?=number_format($MoreList[tmount])?>
              EA</td>
            <td><?=$Mlist[Address1]?>&nbsp;<?=$Mlist[Address2]?></td>
          </tr>
        
      </table>
      <br />
      <table cellspacing=1 bordercolordark=white bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 width="760" class="s1">
        <tr bgcolor="E0E4E8"> 
          <td width="46" height="27">&nbsp;</td>
          <td height="27" align="center">주문번호 / 주문상품</td>
          <td width="103" align="center">구매금액</td>
          <td width="77" align="center"> 결제방식</td>
          <td width="109" align="center"> 주문일시</td>
        </tr>
        <tr bgcolor="#FFFFFF"> 
          <td height=1 colspan=5 align="middle"></td>
        </tr>
        <?
$listNo = "15";
$PageNo = "20";

if (!$sort) {$sort = "UID";}
$WHEREIS = "WHERE Co_Memberid='$mid' and OrderStatus = 50";

$sqlstr = "SELECT count(*) FROM wizBuyers $WHEREIS";
$TOTAL = $dbcon->get_one($sqlstr);

if(empty($cp) || $cp <= 0) $cp = 1;
$START_NO = ($cp - 1) * $listNo;
$BOARD_NO=$TOTAL-($listNo*($cp-1));

$LIST_QUERY = "SELECT * FROM wizBuyers $WHEREIS ORDER BY $sort DESC limit $START_NO, $listNo";
$TABLE_DATA = $dbcon->_query($LIST_QUERY);
$TOTAL_QUERY = $dbcon->_query( "SELECT SUM(TotalAmount) FROM wizBuyers $WHEREIS");
$TOTAL_SMONEY = $dbcon->_fetch_array($TOTAL_QUERY);
$TOTAL_SMONEY = $TOTAL_SMONEY[0];
$i = 0;
while( $LLIST = $dbcon->_fetch_array( $TABLE_DATA ) ) :
		
	$UID = $LLIST[UID];
	$Sender_Name = $LLIST[Sender_Name];
	$Sender_Email = $LLIST[Sender_Email];
	$Sender_Tel = $LLIST[Sender_Tel];
	$Sender_Pcs = $LLIST[Sender_Pcs];
	$Re_Name = $LLIST[Re_Name];
	$Re_Tel = $LLIST[Re_Tel];
	$Zip = $LLIST[Zip];
	$Address = split(" ", $LLIST[Address]);
	$Re_Date = $LLIST[Re_Date];
	$Message = nl2br(stripslashes($LLIST[Message]));
	$How_Buy = $LLIST[How_Buy];
	$How_Bank = split("\|", $LLIST[How_Bank]);
	$Point_Money = $LLIST[Point_Money];
	$Ziro_Money = $LLIST[Ziro_Money];
	$Card_Money = $LLIST[Card_Money];
	$TotalAmount = $LLIST[TotalAmount];
	$Co_Uid = $LLIST[CODE_VALUE];
	$OrderStatus = $LLIST[OrderStatus];
	$Co_Memberid = $LLIST[Co_Memberid];
	$Cart_Info = $LLIST[Co_Name];
	$Buy_Date = $LLIST[Buy_Date];
	$SUB_SMONEY = $SUB_SMONEY + $TotalAmount;
	$NO = $DATA_NUM - $i - (($p-1)*$RECNUM);
	$i++;
	//------------------------------------------[결제방식]
	if ($How_Buy == 'card') {$How_Buyed = "신용카드";}
	else if ($How_Buy == 'point') {$How_Buyed = "포인트";}
	else if ($How_Buy == 'all') {$How_Buyed = "다중결제";}
	else {$How_Buyed = "온라인";}
	//--------------------------------------------------

if($LLIST[OrderStatus]==10) $DeveryStatus = "<font color='blue'>주문접수됨</font>";
else if($LLIST[OrderStatus]==20) $DeveryStatus = "<font color='green'>입금기다림</font>";
else if($LLIST[OrderStatus]==30) $DeveryStatus = "<font color='orange'>입금확인됨</font>";
else if($LLIST[OrderStatus]==40) $DeveryStatus = "<font color='brown'>배송준비중</font>";
else if($LLIST[OrderStatus]==50) $DeveryStatus = "<font color='red'>배송완료됨</font>";
?>
        <tr bgcolor="#FFFFFF"> 
          <td width="46" height="27" align="center" bgcolor="#FFFFFF"><font color="#144179"> 
            <?=$BOARD_NO;?>
            </font></td>
          <td height="27" bgcolor="#FFFFFF"><strong> </strong> 
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="s1">
              <tr> 
                <td width="100" valign="top"><strong> 
                  <?=$Co_Uid?>
                  </strong></td>
                <td><table width="100%" border="0" cellspacing="0" cellpadding="0" class="s1">
<?
$sqlstr = "select BuyGoodsCode, BuyGoodsQty, BuyPrice from wizBuyersMore where BuyCode = '$Co_Uid'";
$dbcon->_query($sqlstr);
while($more = $dbcon->_fetch_array()):
$goodsname=$dbcon->get_one("select Name from wizMall where UID = $more[BuyGoodsCode]");
?>
                    <tr> 					
                      <td width="33%"><?=$goodsname?></td>
                      <td width="35%"><?=$more[BuyGoodsQty];?></td>
                      <td width="30%">
                        <?=number_format($more[BuyPrice]);?>
                        원</td>
                      <td width="2%">&nbsp;</td>
                    </tr>
<?
endwhile;
?>
                  </table></td>
              </tr>
            </table>
            <strong> </strong></td>
          <td width="103" align="center"> 
            <?=number_format($TotalAmount)?>
            원</td>
          <td width="77" align="center"> 
            <?=$How_Buyed?>
          </td>
          <td width="109" align="center"> 
            <?=date("Y.m.d",$LLIST[Buy_Date])?>
          </td>
        </tr>
<?
$BOARD_NO--;
endwhile;
?>
        <tr align="center" bgcolor="#FFFFFF"> 
          <td height="27" colspan="5">현재페이지 합계금액 : <strong><font color="E37509"> 
            <?=number_format($SUB_SMONEY)?>
            원</font></strong>| 총 주문금액 : <strong><font color="703EAE"> 
            <?=number_format($TOTAL_SMONEY);?>
            원 </font></strong></td>
        </tr>
        <tr align="center" bgcolor="#FFFFFF"> 
          <td height="27" colspan="5"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&mid=$mid";
$page_arg2 = array("listno"=>$listNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
          </td>
        </tr>
      </table>    </td>
              </tr>
            </table>