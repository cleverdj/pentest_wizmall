<?php
/*
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com

*/

include ("../lib/class.cart.php");
$cart = new cart;
$cart->get_object($dbcon,$common);
$CART_CODE = $_COOKIE["CART_CODE"];
?>
<SCRIPT LANGUAGE=javascript>
<!-- 
function Order(){

	var f = document.Jumun;
	
}
//-->
</script>
<SCRIPT LANGUAGE=javascript>
<!-- 
function cmp(){
        var f = document.forms.mall_list;
        var i = 0;
        var chked = 0;
        for(i = 0; i < f.length; i++ ) {
                if(f[i].type == 'checkbox') {
                        if(f[i].checked) {
                                chked++;
                        }
                }
        }
        if( chked < 1 ) {
                alert('삭제하고자 하는 상품에 체크해주시기 바랍니다.');
                return false;
        }
        if (confirm('\n\n삭제하는 제품은 DB에서 삭제되어 복구가 불가능합니다.\n\n정말로 삭제하시겠습니까?\n\n')) return true;
        return false;
}
//-->
</SCRIPT>
<SCRIPT LANGUAGE=javascript>
<!-- 

function commaSplit(srcNumber) { 
var txtNumber = '' + srcNumber; 

var rxSplit = new RegExp('([0-9])([0-9][0-9][0-9][,.])'); 
var arrNumber = txtNumber.split('.'); 
arrNumber[0] += '.'; 
do { 
arrNumber[0] = arrNumber[0].replace(rxSplit, '$1,$2'); 
} while (rxSplit.test(arrNumber[0])); 
if (arrNumber.length > 1) { 
return arrNumber.join(''); 
} 
else { 
return arrNumber[0].split('.')[0]; 
	  } 
} 

function filterNum(str) { 
re = /^\$|,/g; 
return str.replace(re, ""); 
} 

function product_select(num,money,product){
	var arrNumber = product.value.split('|');
	if (product.value) {
	num.value = 1;
	}
	else {
	num.value = 0;
	}

	money.value = commaSplit(num.value * arrNumber[0]);
	total = document.Jumun.TOTAL_MONEY;
	var f = document.forms.Jumun;
	var i = 0;
	var t_total = '';
	for(i = 0; i < f.length; i++ ) {
		if(f[i].type == 'text' && f[i].name != 'TOTAL_MONEY') {
			if(filterNum(f[i].value) > 1000) {
				if (t_total > 0) {

					t_total = parseInt(t_total);
				}
				t_total = t_total + parseInt(filterNum(f[i].value));
			}
		}
	}
	if (t_total) {
	total.value = commaSplit(t_total);
	}
	else {
	total.value = 0;
	}
	return;
}

function overclick(){
  	alert("\n\n정확한 계산을 위해 직접 입력은 허용되지 않습니다.\n\n");
}

function really(){
if (confirm('\n\n정말로 장바구니를 모두 비우시겠습니까?\n\n')) return true;
return false;
}

function really(tm){
	if (tm.value < 1) {
		alert('선택된 제품이 없습니다.');
		return false;
	}
	if (confirm('\n\n온라인 견적을 이용해 주셔서 감사합니다.   \n\n고객님께서 선택하신 내용이 정확합니까?  \n\n')) return true;
	return false;
}
function view_page(product){
    //var product;
	if (product) {
	var go_url = "wizmart.php?query=view&no="+ product;
	window.open(go_url, 'estim_view','width=650,height=600,statusbar=no,scrollbars=yes,toolbar=no');
	}
	else {
	alert('\n\n제품을 선택해야 상세설명페이지를 보실 수 있습니다.\n\n');
	}
	return;
}

function is_number(){
         if ((event.keyCode<48)||(event.keyCode>57)){
                  alert("\n\n수량은 숫자만 입력하셔야 합니다.\n\n");
                  event.returnValue=false;
         }
}

function CheckForm(){
var f=document.Jumun;
	if(f.no.value == ''){
	alert ('상품명을 선택해 주세요');
	f.no.focus();
	return false;
	}else if(f.Price.value == '' || f.Price.value == 0){
	alert ('금액이 없어면 장바구니에 담기지 않습니다.');
	return false;
	}else{
	f.query.value = 'save';
	f.submit();	
	}
}


function NumberChk(f){     // 주민번호 valid check , 자동 다음 폼 이동
   num = f.value;
   numFlag = Number(num);
   if(!numFlag){
         alert('숫자를 넣어주세요');
         f.focus();
         return false;
   }
}

function AutoCal(f){
NumberChk(f);
var frm = document.Jumun;
frm.P_MONEY.value = frm.Price.value * frm.BUYNUM.value;
}

function showinputtable(){
	ordermeminfo1.style.display = 'block';
	ordermeminfo2.style.display = 'block';
	ordermeminfo3.style.display = 'block';
	ordermeminfo4.style.display = 'block';
}


//-->
</SCRIPT>


<SCRIPT LANGUAGE=javascript>
<!--
function num_cal(v, flag){
	var num = parseInt(v.value);
	if(flag == "plus"){
		v.value = num + 1;
	}else if(flag == "minus"){
		if(num > 1){
			v.value = num - 1;
		}
	}
	return;
}

function deleachItem(uid){
	location.href = "./order/order5_query.php?query=delete&cuid="+uid
}

function modQty(uid, v){
	location.href = "./order/order5_query.php?query=update_qty&cuid="+uid+"&BUYNUM="+v.value
}
//-->
</SCRIPT>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>주문서 입력</legend>
						<div id="notice">[note]</div>
						<div id="comment">오프라인의 고객 주문을 관리자 모드의 매출 통계와 연동시키고 싶을 경우 이곳에서 주문서를 수동으로 입력해 
                  주셔야 합니다.<br />
                  입력이 완료되후 고객이 장바구니를 이용해 주문한 것과 동일한 방법으로 주문처리를 해 주시면 됩니다.<br />
                  (예, 주문배송관리 -&gt; 주문확인 선택, 주문배송관리 -&gt; 주문배송완료선택)</div>
						</fieldset>
						<p></p>	
      <table class="table_main">
        <TR ALIGN=CENTER BGCOLOR=#FFFFFF HEIGHT=25>
          <TD><iframe frameborder="O" height="25" scrolling="no" name="testframe"  src="./order/order5_2.php"  width="100%"> </iframe></TD>
        </TR>
      </TABLE>
      <br />
      <!-- B2B start -->
      <table class="table_main">
        <tr bgcolor='E0E4E8' height=23 align=CENTER>
          <td width="203">주문상품</td>
          <td width="95" bgcolor="E0E4E8">가격</td>
          <td width="171">수량</td>
          <td width="101">소계</td>
          <td width="81">수정</td>
          <td width="83">삭제</td>
        </tr>
<FORM name='cart_list_form'ACTION='./order/order5_query.php'>   
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type="hidden" name="theme" value="<?=$theme?>">     
<?        
$cartstr = "select sum(c.qty) from wizMall m left join wizCart c on m.UID = c.pid where c.oid = '".$CART_CODE."'";
$TotalUnit = $dbcon->get_one($cartstr);;//총구매수량

$cartstr = "select m.Category, m.UID, m.None, m.Picture, m.Name, 
			c.uid as cuid, c.qty, c.price, c.tprice, c.point, c.optionflag
			from wizMall m 
			left join wizCart c on m.UID = c.pid 
			where c.oid = '".$CART_CODE."' 
			order by c.uid asc";
//echo "cartstr = $cartstr <br />";
$dbcon->_query($cartstr);
$i=0;
$TOTAL_MONEY = 0;
while($cartlist = $dbcon->_fetch_array()):	

    	$Picture	= split("\|", $cartlist[Picture]);
		$UID		= $cartlist["UID"];
		$Category	= $cartlist["Category"];
		$None		= $cartlist["None"];
		$Name		= $cartlist["Name"];
		$cuid		= $cartlist["cuid"];
		$qty		= $cartlist["qty"];
		$price		= $cartlist["price"];
		$tprice		= $cartlist["tprice"];
		$point		= $cartlist["point"];
		$optionflag	= $cartlist["optionflag"];
		$TOTAL_MONEY += $tprice;
		$TOTAL_PRODUCT_MONEY += $tprice;
		
		
	//추가 - 제품이 구매된 모든 카테고리를 하나로 만든다. 캬테고리별 가격을 위해
	//2. 카테고리를 하나로 만든다.
	if(chop($TOTAL_CAT))$TOTAL_CAT .= "|"."$Category";
	else $TOTAL_CAT = $Category;	
?>

          <tr align=CENTER bgcolor="#FFFFFF">
            <td height="65" align=LEFT><TABLE WIDTH=100%  style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                <TR>
                  <TD WIDTH=50><A HREF="<?=$mall->pdviewlink($UID,$Category,$None)?>"><IMG SRC='../config/uploadfolder/productimg/<?=substr($Category, -3)?>/<?=$Picture[0]?>' WIDTH='50' HEIGHT='50' BORDER=0></A></TD>
                  <TD><A HREF="<?=$mall->pdviewlink($UID,$Category,$None)?>"><FONT COLOR=BLUE><U>
                    <?=$Name?>
                    </U></FONT></A>
                    <?
echo $cart->optoStr($optionflag);
?>                  </TD>
                </TR>
              </TABLE></td>
            <td><input type=TEXT size=4 name='Price' maxlength=5 value='<?=number_format($price)?>' readonly>
              원</td>
            <td><table cellpadding=0 cellspacing=0 border=0 class="s1">
                <tr>
                  <td rowspan=2><INPUT TYPE=TEXT SIZE=4 NAME='BUYNUM_<?=$i?>' MAXLENGTH=5 VALUE='<?=$qty?>' onkeypress="onlyNumber()">
                  </td>
                  <td><A href="javascript:num_cal(document.cart_list_form.BUYNUM_<?=$i?>, 'plus')"><img src='img/num_plus.gif' width="15" height="13" border=0></a></td>
                  <td rowspan=2>&nbsp;&nbsp;EA</td>
                </tr>
                <tr>
                  <td><A href="javascript:num_cal(document.cart_list_form.BUYNUM_<?=$i?>, 'minus')"><img src='img/num_minus.gif' width="15" height="12" border=0></a></td>
                </tr>
              </table></td>
            <td><FONT COLOR='#E37509'><B>
              <?=number_format($tprice);?>
              </B></FONT><font color='#CE6500'><b> 원</b></font></td>
            <td><a href="javascript:modQty(<? echo $cuid;?>, document.cart_list_form.BUYNUM_<?=$i?>)"><img src='img/cart_modify.gif' width="19" height="17" border="0"></a>            </td>
            <td><A HREF='javascript:deleachItem(<? echo $cuid;?>)'><img src='img/cart_delete.gif' width="19" height="17" border=0></a></td>
 <?
$i++;
endwhile;
?> </FORM>
      </table>
      <table class="table_main">
        <tr>
          <!--<td height="25" align="right" bgcolor="#FFFFFF">&nbsp;주문자아이디
             <!-- <input name="order_id" type="text" onClick="window.open('./order/order5_1.php','UserSearchWindow','width=354,height=350')" value="<?=$order_id?>" readonly>
              <input type="button" name="Button" value="아이디 찾기" onClick="window.open('./order/order5_1.php','UserSearchWindow','width=354,height=350')" style="cursor:pointer">
            </td>-->
          <td align="right" bgcolor="#FFFFFF"><input type="button" name="Button2" value="주문자입력" onClick="javascript:showinputtable();" style="cursor:pointer"></td>
        </tr>
      </table>

      <?
/*
	$sqlstr = "SELECT m.mname, i.* FROM wizMembers m 
	left join wizMembers_ind i on m.mid = i.id 
	WHERE mid='".$cfg["member"]["mid"]."'";
	$dbcon->_query($sqlstr);
	$olist = $dbcon->_fetch_array();
	
	
	$STel1 = split("\-",$olist[tel1]); 
	$STel2 = split("\-",$olist[tel2]);
	$Inputer = $olist[mname];
	$SName = $olist[mname];
	$SEmail = $olist[email];
	$SZip = split("\-",$olist[zip1]);
	$SAddress1 = $olist[address1];
	$SAddress2 = $olist[address2];
*/
?>
      <script language=javascript>
<!--
function CheckField(){
	var f=document.Jumun;
}

function OpenZipcode(flag){
	if(flag == "1"){//보내는분 주소찾기
		var zip1 = "SZip1";
		var zip2 = "SZip2";
		var firstaddress = "SAddress1";
		var secondaddress = "SAddress2";
	}else{//받는분 주소찾기
		var zip1 = "RZip1";
		var zip2 = "RZip2";
		var firstaddress = "RAddress1";
		var secondaddress = "RAddress2";	
	}
	window.open("../util/zipcode/zipcode.php?form=Jumun&zip1="+zip1+"&zip2="+zip2+"&firstaddress="+firstaddress+"&secondaddress="+secondaddress,"ZipWin","width=490,height=250,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no");	
}


function copyvalue(v){
	var f = document.Jumun;
	//alert(v.vlaue);
	if(f.copybtn[0].checked == true){
		f.RName.value = f.SName.value;
		f.RTel1_1.value = f.STel1_1.value;
		f.RTel1_2.value = f.STel1_2.value;
		f.RTel1_3.value = f.STel1_3.value;
		f.RTel2_1.value = f.STel2_1.value;
		f.RTel2_2.value = f.STel2_2.value;
		f.RTel2_3.value = f.STel2_3.value;
		f.RZip1.value = f.SZip1.value;
		f.RZip2.value = f.SZip2.value;
		f.RAddress1.value = f.SAddress1.value;
		f.RAddress2.value = f.SAddress2.value;	

		return;
	}else{
		f.RName.value = "";
		f.RTel1_1.value = "";
		f.RTel1_2.value = "";
		f.RTel1_3.value = "";
		f.RTel2_1.value = "";
		f.RTel2_2.value = "";
		f.RTel2_3.value = "";
		f.RZip1.value = "";
		f.RZip2.value = "";
		f.RAddress1.value = "";
		f.RAddress2.value = "";			
		return;
	}
}
//-->
</script>
      <FORM NAME="Jumun"  METHOD="POST" action="./order/order5_query.php" onsubmit="return Order();">
        <input type="hidden" name="menushow" value="<?=$menushow?>">
        <input type=hidden name="theme" value='<?=$theme?>'>
        <input type=hidden name="query" value='order' />
        <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd border=1 class="s1" id="ordermeminfo1" style="display:none">
         
          <tr>
            <td width="147" height="20" align="center" bgcolor="F2F2F2" class="black">아이디</td>
            <td width="480" bgcolor="#FFFFFF" style="padding:5"><input name="order_id" type="text" onClick="window.open('./order/order5_1.php','UserSearchWindow','width=354,height=350')" value="<?=$order_id?>" readonly>
              <input type="button" name="Button" value="아이디 찾기" onClick="window.open('./order/order5_1.php','UserSearchWindow','width=354,height=350')" style="cursor:pointer">
            (현재 회원이면 입력)            </td>
          </tr>         
          <tr>
            <td width="147" height="20" align="center" bgcolor="F2F2F2" class="black">이름</td>
            <td width="480" bgcolor="#FFFFFF" style="padding:5"><input name="SName" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="SName" value="<?=$SName?>">            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">주소</td>
            <td bgcolor="#FFFFFF" style="padding:5"><table width="450" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td height="20"><input name="SZip1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="SZip1" value="<?=$SZip[0]?>" size="3">
                    -
                    <input name="SZip2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="SZip2" value="<?=$SZip[1]?>" size="3">
                   <input type="button" name="button" id="button" value="주소찾기" onClick="javascript: OpenZipcode('1')"
style='CURSOR: pointer'></td>
                </tr>
                <tr>
                  <td height="20"><input name="SAddress1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="SAddress1" value="<?=$SAddress1?>" size="60">                  </td>
                </tr>
                <tr>
                  <td height="20"><input name="SAddress2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" value="<?=$SAddress2?>" size="60">                  </td>
                </tr>
              </table></td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">유선전화</td>
            <td bgcolor="#FFFFFF" style="padding:5"><input name="STel1_1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel1_1" value="<?=$STel1[0];?>" size="5">
              -
              <input name="STel1_2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel1_2" value="<?=$STel1[1];?>" size="10">
              -
              <input name="STel1_3" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel1_3" value="<?=$STel1[2];?>" size="10">            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">휴대전화</td>
            <td bgcolor="#FFFFFF" style="padding:5"><input name="STel2_1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel2_1" value="<?=$STel2[0];?>" size="5">
              -
              <input name="STel2_2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel2_2" value="<?=$STel2[1];?>" size="10">
              -
              <input name="STel2_3" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="STel2_3" value="<?=$STel2[2];?>" size="10">            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">E-mail</td>
            <td bgcolor="#FFFFFF" style="padding:5"><input name="SEmail" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="SEmail" value="<?=$SEmail?>" size="60">            </td>
          </tr>
        </table>
        <TABLE width="760" border="0" cellpadding="0" cellSpacing=0 id="ordermeminfo2" style="display:none">
          <tr>
            <td width="348" align="right">배송지 정보가 주문자 정보와 동일 합니까?
              <input type="radio" name="copybtn" value="1" onClick="javascript:copyvalue(this)"; style="cursor:pointer">
              예
              <input type="radio" name="copybtn" value="0" onClick="javascript:copyvalue(this)"; style="cursor:pointer">
              아니오</td>
          </tr>
        </table>
        <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd border=1 class="s1" id="ordermeminfo3" style="display:none">
          <tr>
            <td width="147" height="20" align="center" bgcolor="F2F2F2" class="black">이름</td>
            <td width="480" bgcolor="#FFFFFF" style="padding:5"><input name="RName" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RName" value="<?=$RName;?>">
            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">주소</td>
            <td bgcolor="#FFFFFF" style="padding:5"><table width="450" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td height="20"><input name="RZip1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RZip1" value="<?=$RZip[0]?>" size="3">
                    -
                    <input name="RZip2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RZip2" value="<?=$RZip[1]?>" size="3">
                     <input type="button" name="button" id="button" value="주소찾기" onClick="javascript: OpenZipcode('21')"
style='CURSOR: pointer'></td>
                </tr>
                <tr>
                  <td height="20"><input name="RAddress1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RAddress1" value="<?=$RAddress1?>" size="60">
                  </td>
                </tr>
                <tr>
                  <td height="20"><input name="RAddress2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RAddress2" value="<?=$RAddress2?>" size="60">
                  </td>
                </tr>
              </table></td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">유선전화</td>
            <td bgcolor="#FFFFFF" style="padding:5"><input name="RTel1_1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel1_1" value="<?=$RTel1[0];?>" size="5">
              -
              <input name="RTel1_2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel1_2" value="<?=$RTel1[1];?>" size="10">
              -
              <input name="RTel1_3" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel1_3" value="<?=$RTel1[2];?>" size="10">
            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">휴대전화</td>
            <td bgcolor="#FFFFFF" style="padding:5"><input name="RTel2_1" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel2_1" value="<?=$RTel2[0];?>" size="5">
              -
              <input name="RTel2_2" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel2_2" value="<?=$RTel2[1];?>" size="10">
              -
              <input name="RTel2_3" type="text" style="font: 9pt 굴림; border:1 solid #cccccc" id="RTel2_3" value="<?=$RTel2[2];?>" size="10">
            </td>
          </tr>
          <tr>
            <td height="20" align="center" bgcolor="F2F2F2" class="black">배송메세지</td>
            <td bgcolor="#FFFFFF" style="padding:5"><table width="480" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td><textarea name="Message" cols="50" id="Message" style="font: 9pt 굴림; border:1 solid #cccccc"><?=$Message?>
                </textarea>
                  </td>
                </tr>
                <tr>
                  <td>배송메세지란에는 배송시 참고할 사항이 있으면 적어주십시오.</td>
                </tr>
              </table></td>
          </tr>
        </table><TABLE width="760" border="0" cellpadding="0" cellSpacing=0 id="ordermeminfo4" style="display:none">
          <tr>
            <td width="348" align="right"><input type="submit" name="Button2" value="상품주문"></td>
          </tr>
        </table>
      </FORM></td>
  </tr>
</table>
