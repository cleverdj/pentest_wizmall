<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

if($d_mode == "d_delete"){
	foreach($multi as $key=>$value){
		//echo $key;
		$sqlstr = "delete from wizBillcheck where uid = '$key'";
		$dbcon->_query($sqlstr);	
	}
}
?>
<script language="javascript">
<!--
	function openorderwindow(uid){	
		wizwindow('./order/order1_1.php?uid='+uid, 'cartform','width=620,height=700,statusbar=no,scrollbars=yes,toolbar=no')
	}
	
	function openmemwindow(id){	
		wizwindow('./member/member1_1.php?id='+id, 'regisform','width=650,height=600,statusbar=no,scrollbars=yes,toolbar=no')
	}
	
	function showBillcheck(uid){
		wizwindow('./order/order6_1.php?uid='+uid, 'billform','width=650,height=200,statusbar=no,scrollbars=yes,toolbar=no')
	}
	
	function checkForm(f){
		var i = 0;
		var chked = 0;
		for(i = 0; i < f.length; i++ ) {
			if(f[i].type == 'checkbox') {
				if(f[i].checked) {
					chked++;
				}
			}
		}
		if( chked < 1 ) {
			alert('삭제하고자 하는 상품에 체크해주시기 바랍니다.');
			return false;
		}
		if (confirm('\n\n삭제하는 제품은 DB에서 삭제되어 복구가 불가능합니다.\n\n정말로 삭제하시겠습니까?\n\n')) return true;
		return false;
	}	
//-->
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>세금계산서/현금영수증 발행</legend>
						<div id="notice">[note]</div>
						<div id="comment">아래는 현금영수증 혹은 세금계산서 발행요청/결과 리스트 입니다</div>
						</fieldset>
						<p></p>	
      <TABLE cellSpacing=0 borderColorDark=white width="760" bgColor=#c0c0c0 borderColorLight=#dddddd 
border=0 class="s1">
        <form action='<?=$PHP_SELF?>' method=post>
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type=HIDDEN  name=theme value='<?=$theme?>' >
          <TR>
            <TD width="100" height="24" bgColor=#ffffff><select name="stitle">
                <option value="" selected>검색영역</option>
                <option value="">----------</option>
                <option value='b.oid'<? if($stitle=='b.oid'){ ECHO" SELECTED";}?>>주문번호</option>
                <option value='b.cname'<? if($stitle=='b.cname'){ ECHO" SELECTED";}?>>신청자명</option>
              </select>
            </TD>
            <TD bgColor=#ffffff width="80"><input size=10 name="skey" value='<?=$skey?>'></TD>
            <TD bgColor=#ffffff width="270"><input type="image" src="img/se.gif" width="66" height="20">
              <input name="image" type="image" src="img/list.gif" width="66" height="20" onClick="location.replace('<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=order1')"></TD>
            <TD bgColor=#ffffff width="134">&nbsp;</TD>
            <TD bgColor=#ffffff width="166">&nbsp;</TD>
          </TR>
        </form>
        </TBODY>
        
      </TABLE>
      <br />
      <?
/* 페이징과 관련된 수식 구하기 */
$ListNo = "15";
$PageNo = "20";
if(empty($cp) || $cp <= 0) $cp = 1;
$START_NO = ($cp - 1) * $ListNo;
$whereis = " WHERE 1";
if ($stitle && $skey) {$whereis .= " and $stitle LIKE '%$skey%'";}

if($orderby_select == "") $orderby_select = "b.uid"; 
switch($orderby_select){
	case "b.uid":
		$orderby = "ORDER BY $orderby_select DESC";
	break;
	default:
		$orderby = "ORDER BY $orderby_select DESC";
	break;
}


$sqlstr = "SELECT count(1) FROM wizBillcheck b $whereis";
$TOTAL = $dbcon->get_one($sqlstr);

$LIST_QUERY = "SELECT b.*, bu.uid as buuid, bu.AmountOline, bu.PayMethod, bu.OrderStatus  FROM wizBillcheck b
				left join wizBuyers bu on b.oid = bu.OrderID 
 $whereis $orderby LIMIT $START_NO,$ListNo";
$TABLE_DATA = $dbcon->_query($LIST_QUERY);

$TOTAL_QUERY = $dbcon->_query( "SELECT SUM(TotalAmount) FROM wizBuyers WHERE  OrderStatus < 50 ");
$TOTAL_SMONEY = $dbcon->_fetch_array($TOTAL_QUERY);
$TOTAL_SMONEY = $TOTAL_SMONEY[0];

$NO = $TOTAL-($ListNo*($cp-1));
?>
      <table width="760" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td align="right">&nbsp;</td>
        </tr>
      </table>
      <table class="table_main">
        <tr align=center bgcolor=#B9C2CC>
          <td bgcolor="E0E4E8">&nbsp; </td>
          <td bgcolor="#B9C2CC">주문번호</td>
          <td bgcolor="E0E4E8">발행금액</td>
          <td bgcolor="#B9C2CC">결제방법</td>
          <td bgcolor="E0E4E8">주문상태</td>
          <td bgcolor="#B9C2CC">신청자명<br />
            /회사명</td>
          <td bgcolor="E0E4E8">발행방식</td>
          <td bgcolor="#B9C2CC">발행상태</td>
          <td bgcolor="E0E4E8">요청일시</td>
          <td bgcolor="#B9C2CC">&nbsp;</td>
        </tr>
        <?
$cnt=0;		
while( $list = $dbcon->_fetch_array( $TABLE_DATA ) ) :
		$uid			= $list["uid"];
		$oid			= $list["oid"]; 
		$buuid			= $list["buuid"];
		$AmountOline	= $list["AmountOline"];
		$cname			= $list["cname"];
		$mid			= $list["mid"];
		$ptype			= $list["ptype"];
		switch($ptype){
			case "1":$ptypestr="세금계산서";break;
			case "2":$ptypestr="현금영수증";break;
		}
		$presult			= $list["presult"];
		switch($presult){
			case "1":$presultstr="신청";break;
			case "2":$presultstr="완료";break;
			case "3":$presultstr="취소";break;
		}
		$rdate			= $list["rdate"];
		$PayMethod 		= $list["PayMethod"];
		$PayWay = trim($PayMethod)?$PaySortArr[$PayMethod]:"온라인";
		$OrderStatus	= $list["OrderStatus"];
		
		//상품정보가져오기
		
?>
        <FORM ACTION='<?=$PHP_SELF?>' NAME='receiptList' onsubmit='return checkForm(this)'>
          <INPUT TYPE=HIDDEN NAME="menushow" VALUE='<?=$menushow?>'>
          <INPUT TYPE=HIDDEN NAME=theme VALUE='<?=$theme?>'>
          <INPUT TYPE=HIDDEN NAME=cp VALUE='<?=$cp?>'>
          <INPUT TYPE=HIDDEN NAME="d_mode" VALUE='d_delete'>
          <tr bgcolor=white height=25>
            <td width=30 align="center" bgcolor=#f3f3f3><input type=checkbox VALUE="<?=$uid?>" name="multi[<?=$uid?>]"></td>
            <td align="center" bgcolor="white"><a href="javascript:openorderwindow(<?=$buuid?>)">
              <?=$oid?>
              </a></td>
            <td align="center"><?=number_format($AmountOline);?></td>
            <td align="center"><?=$PayWay?></td>
            <td align="center"><?=$DeliveryStatusArr[$OrderStatus];?></td>
            <td align="center"><A HREF="javascript:openmemwindow('<?=$mid?>')">
              <?=$cname?>
              </a> </td>
            <td align="center"><?=$ptypestr?>            </td>
            <td align="center">&nbsp;
              <?=$presultstr?></td>
            <td align="center"><?=date("Y.m.d", $rdate)?></td>
            <td align="center"><input type="button" name="button" id="button" value="보기" style="cursor:pointer" onclick="showBillcheck('<?=$uid?>');">            </td>
          </tr>
          <?
$NO--; 
$cnt++;
endwhile;
?>
<?
if(!$cnt){
?>
          <tr bgcolor=white height=25>
            <td height="40" colspan="10" align="center" bgcolor=#f3f3f3>요청된 정보가 없습니다.</td>
          </tr>
<?
}
?>
          <tr bgcolor=white height=25>
            <td colspan="10" bgcolor=#FFFFFF><input type="submit" name="button2" id="button2" value="삭제" />            </td>
          </tr>
        </form>
      </table>
      <br />
      <b> </b>
      <table width="760" border="0" cellspacing="0" cellpadding="0" class="s1">
        <tr>
          <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&keyword=".urlencode($keyword)."&SELECT_SORT=$SELECT_SORT&SYear=$SYear&SMonth=$SMonth&SDay=$SDay&FYear=$FYear&FMonth=$FMonth&FDay=$FDay&DataEnable=$DataEnable";
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
//$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?></td>
        </tr>
      </table></td>
  </tr>
</table>
