<?
/*
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***

*/
include "./member/common.php";

if($grade == "5") $title = "기업회원정보";
else if($grade == "10") $title = "일반회원정보";
else if($grantsta == "00") $title = "탈퇴회원정보";
else $title = "전체회원정보";
/* 회원 삭제 하기 끝 */
$whereis = " WHERE 1";
if($grade) $whereis .= " and m.mgrade = '$grade'";
if($grantsta == "00") $whereis .= " and m.mgrantsta = '$grantsta'";

if ($stitle && $keyword) {
                $whereis .= " and $stitle LIKE '%$keyword%'";
}

if (!$sel_orderby) {$orderby = "m.uid@desc";}
else $orderby = $sel_orderby;


if ($DataEnable) {
	$FromDate = mktime(0,0,0,"$SMonth","$SDay","$SYear");
	$ToDate =  mktime(0,0,0,"$FMonth","$FDay","$FYear");
	$whereis .= " AND m.mregdate  >= '$FromDate' AND m.mregdate <= '$ToDate'";
}



$TOTAL_STR = "SELECT count(m.uid) FROM wizMembers m left join wizMembers_ind i on m.mid = i.id";
$REALTOTAL = $dbcon->get_one($TOTAL_STR);

$sqlstr = "SELECT count(m.uid) FROM wizMembers m left join wizMembers_ind i on m.mid = i.id $whereis";
$TOTAL = $dbcon->get_one($sqlstr);
//--페이지 나타내기--
//--페이지링크를 작성하기--

?>
<script language=JavaScript>
<!--
function really(){
	var f = document.forms.memberlist;
	var i = 0;
	var chked = 0;
	for(i = 0; i < f.length; i++ ) {
			if(f[i].type == 'checkbox') {
					if(f[i].checked) {
							chked++;
					}
			}
	}
	if( chked < 1 ) {
			alert('삭제하고자 하는 회원을 체크해주세요.');
			return false;
	}
	if (confirm('\n정말로 삭제하시겠습니까? 삭제는 복구가 불가능합니다.   \n')) return true;
	return false;
}

function changegrant(sta, id){
	var str = "";
	if(sta == "03"){//승인상태
		str = "보류상태로 변경하시겠습니까?";
	}else if(sta == "00"){//탈퇴상태
		str = "보류상태로 변경하시겠습니까?";
	}else{//보류상태 : 04
		str = "승인상태로 변경하시겠습니까?";
	}
	if(confirm(str)){
		location.href = "<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>&grade=<?=$grade?>&grantsta="+sta+"&action=update&id="+id+"&cp=<?=$cp?>";
	}else{
		return false;
	}
}	

function submitListcnt(v){
	var f = document.searchForm;
	f.ListNo.value = v.value;
	f.submit();
}

function gotoHistory(id){
	var url = "./member/front_member.php?query=order&mid="+id;
	wizwindow(url,'buyhistory','width=670,height=700,statusbar=no,scrollbars=yes,toolbar=no');
}
//-->	
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend><?=$title?></legend>
						<div id="notice">[note]</div>
						<div id="comment"><?=$title?>
                  리스트 입니다.</div>
						</fieldset>
						<p></p>	
      <table width="760" border="0" cellspacing="0" cellpadding="0">
        <form name="ListnoForm" action="<?=$PHP_SELF?>">
          <tr>
            <td>총회원수 :
              <?=number_format($REALTOTAL)?>
              /  검색된 회원수:
              <?=number_format($TOTAL)?></td>
            <td width="100" align="right"><select name="ListNo" onChange="submitListcnt(this)">
                <option>리스트갯수</option>
                <option value="15">15</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </td>
            <td width="100"><input type="button" name="button" id="button" value="엑셀출력" style="cursor:pointer" onClick="location.href='./member/member1_exel.php?DownForExel=yes&grade=<?=$grade;?>&grantsta=<?=$grantsta;?>&ListNo=<?=$ListNo?>&PageNo=<?=$PageNo?>&cp=<?=$cp?>'"; /></td>
          </tr>
        </form>
      </table>
<table class="table_main">
              <FORM action='<?=$PHP_SELF?>' NAME='memberlist'>
                <input type=hidden name=theme value='<?=$theme?>'>
                <input type='hidden' name='menushow' value='<?=$menushow?>'>
                <input type='hidden' name='grade' value='<?=$grade?>'>
                <input type='hidden' name='grantsta' value='<?=$grantsta?>'>
                <input type=hidden name=action value='delete'>
                <input type=hidden name=cp value='<?=$cp?>'>
                <input type=hidden name=stitle value='<?=$stitle?>'>
                <input type=hidden name=keyword value='<?=$keyword?>'>
                <input type=hidden name=sel_orderby value='<?=$sel_orderby?>'>
                <input type=hidden name=add value='<?=$add?>'>
                <input type=hidden name=gender value='<?=$gender?>'>
                <input type=hidden name=Dsort value='<?=$Dsort?>'>
                <input type=hidden name=SYear value='<?=$SYear?>'>
                <input type=hidden name=SMonth value='<?=$SMonth?>'>
                <input type=hidden name=SDay value='<?=$SDay?>'>
                <tr align=center bgcolor="E0E4E8">
                  <td>번호</td>
                  <td bgcolor=#B9C2CC>회원이름<br />
                    (성별, 나이)</td>
                  <td>아이디</td>
                  <td bgcolor=#B9C2CC>지역</td>
                  <td>등급</td>
                  <td bgcolor=#B9C2CC>포인트</td>
                  <td>구매내역</td>
                  <td>가입일</td>
                  <td bgcolor=#B9C2CC>로긴수</td>
                  <td>승인</td>
                  <td bgcolor=#B9C2CC><div align="center"><font color=#cccccc>
                      <input type="image" src="img/whe.gif" width="75" height="20">
                      </font></div></td>
                </tr>
                <?
$NO = $TOTAL-($ListNo*($cp-1));
$qry = $dbcon->get_select('m.mid, m.mgrantsta, m.mname, i.gender, m.mloginnum, m.mregdate, m.mexp, m.mgrade, i.gender, i.address1','wizMembers m left join wizMembers_ind i on m.mid  =  i.id',$whereis, $orderby, $START_NO, $ListNo);	
$cnt=0;
while( $list = $dbcon->_fetch_array($qry)) :
        $area = split(" ", trim($list[address1]));
		if(substr($list[jumin2],0,1) == 1 || substr($list[jumin2],0,1) == 2) $BirthCentury = 1900; else $BirthCentury = 2000;
		$age = date("Y") - (substr($list[jumin1],0,2) + $BirthCentury);
		if(!$list[gender]){
		//echo "genderno = $genderno <br />";
			$genderno = substr($list[jumin2],0,1);
			if($genderno == 1 || $genderno == 3) $list[gender] = "남";
			else if($genderno == 2 || $genderno == 4) $list[gender] = "여";
		}	
		$mgrade = $list["mgrade"];
		$mgradestr = $gradetostr_info[$mgrade]?$gradetostr_info[$mgrade]:$mgrade;
?>
                <tr align=center bgcolor="#FFFFFF">
                  <td><A HREF="javascript:memberSearch('<?=$list[mid]?>')"><img src="./img/icon_message.gif" width="17" height="16" border="0" /></a>
                    <?=$NO?>
                    </td>
                  <td><A HREF="javascript:getuserInfo('<?=$list[mid]?>');"><font color = 'black'>
                    <?=$list[mname]?>
                    <? if($list[gender] || $list[jumin2]) echo "<br />(".$list[gender];
			  if($list[jumin2]) echo ",".$age;
			  if($list[gender] || $list[jumin2]) echo ")"; 
			  ?>
                    </font></a></td>
                  <td><A HREF="javascript:getuserInfo('<?=$list[mid]?>');"><font color = 'black'>
                    <?=$list[mid]?>
                    </font></a></td>
                  <td>&nbsp;
                    <?=$area[0]?>
                    </td>
                  <td>&nbsp;<A HREF="javascript:getuserInfo('<?=$list[mid]?>');">
                    <?=$mgradestr?>
                    </a></td>
                  <td>&nbsp;<A HREF="javascript:getuserInfo('<?=$list[mid]?>');"><FONT COLOR=ORANGE>
                    <?=number_format($list["mpoint"])?>
                    </FONT></A></td>
                  <td><a href="javascript:gotoHistory('<?=$list["mid"]?>')">[보기]</a></td>
                  <td>&nbsp;
                    <?=date("Y.m.d", $list[mregdate])?>
                    </td>
                  <td>
                    <?=number_format($list[mloginnum])?>
                    </td>
                  <td><A HREF="javascript:changegrant('<?=$list["mgrantsta"]?>', '<?=$list["mid"]?>');">
                    <?		

if ( $list["mgrantsta"] == "03" ){#승인 상태일 경우
	echo "<IMG SRC='./img/icon_accept.gif' BORDER='0' alt='승인상태'>";
}else if ( $list["mgrantsta"] == "00" ) {# 탈퇴회원일경우
	echo "<IMG SRC='./img/icon_out.gif' BORDER='0' alt='탈퇴상태'>";
}else{// 미승인 상태일 경우
	echo "<IMG SRC='./img/icon_refuse.gif' BORDER='0' alt='보류상태'>";
}		
?>
                    </a></td>
                  <td><INPUT TYPE=CHECKBOX NAME='DeleteMember[<?=$list["uid"]?>]' VALUE='<?=$list[uid]?>'>
                  </td>
                </tr>
                <?
$NO--; 
$cnt++;
endwhile;
?>
              </form>
              <?
		if(!$cnt){
		?>
              <tr align=center bgcolor="#FFFFFF">
                <td height="50" colspan="11">등록된 <?=$title?>가 없습니다.</td>
              </tr>
              <?
		}
		?>
      </table>   
            <table class="table_main">
                    <FORM ACTION='<?=$PHP_SELF?>' method=post name="searchForm">
                      <input type='hidden' name='menushow' value='<?=$menushow?>'>
                      <INPUT TYPE=HIDDEN NAME="theme" VALUE='<?=$theme?>'>
                      <INPUT TYPE=HIDDEN NAME="grade" VALUE='<?=$grade?>'>
                      <INPUT TYPE=HIDDEN NAME="grantsta" VALUE='<?=$grantsta?>'>
                      <INPUT TYPE=HIDDEN NAME="ListNo" VALUE='<?=$ListNo?>'>
                      <tr>
                        <td colspan="4"><div align="left">
                            <?
							//echo "adfasdf";
if ($SMonth&&$SDay&&$SYear) $tdate = mktime(0,0,0,$SMonth,$SDay, $SYear);
else $tdate = $WizApplicationStartDate;
$common->startyear = date("Y", $WizApplicationStartDate);
$common->getSelectDate($tdate);
?>
                            &nbsp;
                            <select name='SYear' size='1'>
                              <?=$common->rtn_year ?>
                            </select>
                            <select name='SMonth' size='1'>
                              <?=$common->rtn_month ?>
                            </select>
                            <select name='SDay' size='1'>
                              <?=$common->rtn_day ?>
                            </select>
                            ~
                            <?
if ($FYear&&$FMonth&&$FDay) $tdate = mktime(0,0,0,$FMonth,$FDay, $FYear);
else $tdate = time();
$common->getSelectDate($tdate);

?>
                            <select name='FYear' size='1'>
                              <?=$common->rtn_year ?>
                            </select>
                            <select name='FMonth' size='1'>
                              <?=$common->rtn_month ?>
                            </select>
                            <select name='FDay' size='1'>
                              <?=$common->rtn_day ?>
                            </select>
                            <input type="checkbox" name="DataEnable" value="1"<? if($DataEnable) echo " checked";?>>
                            Enable   &nbsp;&nbsp;&nbsp;
                            <?=$admin->sel_mem_stitle($stitle)?>
                            <input name="keyword" value="<?=$keyword?>" size=10 />
                            <input type="image" src="img/se.gif" width="66" height="20" />
                          </div></td>
                      </tr>
                      <tr>
                        <td width="20%">&nbsp;
                          <?=$admin->sel_mem_order($sel_orderby)?></td>
                        <td width="15%">&nbsp;</td>
                        <td width="15%">&nbsp;</td>
                        <td width="50%">&nbsp;</td>
                      </tr>
                    </form>
      </table>   
            <br />
      <table cellspacing=0 cellpadding=0 width="760" 
border=0 class="s1">
        <tr>
          <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&grade=$grade&grantsta=$grantsta&ListNo=$ListNo&stitle=$stitle&keyword=".urlencode($keyword)."&sel_orderby=$sel_orderby&SYear=$SYear&SMonth=$SMonth&SDay=$SDay&FYear=$FYear&FMonth=$FMonth&FDay=$FDay&DataEnable=$DataEnable";
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
          </td>
        </tr>
      </table>
      <br />
      <b></b> </td>
  </tr>
</table>
