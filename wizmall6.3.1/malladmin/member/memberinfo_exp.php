<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/
include "../common/header_pop.php";
include "../../config/common_array.php";

if ($query == 'insert'){
	$common->point_fnc($id, $point, 41, $content);
	$common->js_location($PHP_SELF."?id=".$id);
}else if ($query == 'delete'){
	$common->mode = "delete";
	$common->point_fnc($id, $point, 41);
	$common->js_location("$PHP_SELF?id=$id&cp=$cp");
}
?>
<HTML>
<HEAD>
<title>마일리지 정보</title>
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
<style type='text/css'>
<!--
body {
	font-family: '굴림';
	font-size: 9pt;
	color:black;
	text-decoration: none;
}
A:link {
	text-decoration:none;
}
A:visited {
	text-decoration:none;
}
A:active {
	text-decoration:none;
}
A:hover {
	text-decoration:none;
}
tr, td {
	font-family: '굴림';
	font-size: 9pt;
	color:black;
	text-decoration: none;
}
//
-->
</style>
<link rel="stylesheet" href="../common/admin.css" type="text/css">
</head>
<BODY bgcolor=white topmargin=0 leftmargin=10 marginwidth=0 marginheight=0>
<script>
function frm_val(f){
	if(f.content.value==''){
		alert('내용이 입력되지 않았습니다.');
		f.content.focus();
		return false;
	}
	var Digit = '1234567890'
	if(f.point.value==''){
		alert('지급 금액을 입력하세요');
		return false;
	}
	else{
		var len =f.point.value.length;
		var ret;
		ret =false;
		for(var i=0;i<len;i++){
			var ch = f.point.value.substring(i,i+1);
			for (var k=0;k<=Digit.length;k++){
				if(Digit.substring(k,k+1) == ch)
				{
					ret = true;
					break;
				}
			}
			if (!ret){
			//alert('숫자만 입력가능합니다.');
			//f.point.focus();
			//return false;
			}
			ret = false;
		}
	}
}

function really(){
	if (confirm('정말로 삭제하시겠습니까?')) return true;
	return false;
}

function really() {
        if (confirm('\n\n삭제된 데이터는 복구가 불가능합니다.  \n\n정말로 삭제하시겠습니까?  \n\n')) return true;
        return false;
}
</script>
<br />
<br />
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><table cellpadding=0 cellspacing=0 border=0 width=100%>
        <tr>
          <td align=left valign=top width=10></td>
          <td align=left valign=top><b>
            <?=$QryPoint[Name];?>
            회원님의 적립금현황</b></td>
        </tr>
      </table>
      <hr width='100%' color="gray">
      <form action='<?=$PHP_SELF?>' method=post name=form1 onsubmit='return frm_val(this)'>
        <input type=hidden name=id value='<?=$id?>'>
        <input type=hidden name=query value='insert'>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td align=left><b>내용 :</b>
              <input type=text name=content size=60 maxlength=60>
              <br />
              <b>금액 :</b>
              <input type='text' name='point'  size=12  maxlength=10>
              <input type='submit' value='확 인'>
              (-포인트일경우 -2000원과 같이 입력해주세요) </td>
          </tr>
        </table>
        <p>
        <TABLE width="100%" border=0 cellpadding="0" cellSpacing=0 bgColor=#c0c0c0 class="s1">
          <tr align="center" bgcolor="#B9C2CC">
            <td width="52" height="28"><font color="#FFFFFF"><b>번호</b></font></td>
            <td width="439"><font color="#FFFFFF"><b>적립내역</b></font></td>
            <td width="189"><font color="#FFFFFF"><b>가감 적립금 </b></font></td>
            <td width="86"><font color="#FFFFFF"><b>날짜</b></font></td>
            <td width="86"><font color="#FFFFFF"><b>삭제</b></font></td>
          </tr>
          <tr>
            <td height="1" colspan="5" bgcolor="#dddddd"></td>
          </tr>
          <?
/* 페이징과 관련된 수식 구하기 */
$whereis = "WHERE id = '$id'";
$sqlstr = "SELECT * FROM wizPoint $whereis";
$orderby = "order by wdate DESC ";
$dbcon->_query($sqlstr);
$TOTAL = $dbcon->_num_rows();

$pointstr = "select sum(point) from wizPoint $whereis";
$totalpoint = $dbcon->get_one($pointstr);

$ListNo = "15";
$PageNo = "20";

if(empty($cp) || $cp <= 0) $cp = 1;

$START_NO = ($cp - 1) * $ListNo;
$BOARD_NO=$TOTAL-($ListNo*($cp-1));

$SUB_SMONEY = 0;
$cnt=0;
$dbcon->get_select('*','wizPoint',$whereis, $orderby, $START_NO, $ListNo);	
while( $list = $dbcon->_fetch_array( ) ) :
$ptype = $list["ptype"];
?>
          <tr bgcolor="#FFFFFF">
            <td height="26" align="center">
                <?=$BOARD_NO?>                </td>
            <td>
<?
echo $pointinfo[$ptype];
if($list["contents"]) echo "(".$list["contents"].")";
?></td>
            <td>
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                  <tr>
                    <td><font color=BROWN>&nbsp; </font><font color=RED><b>
                      <?=number_format(str_replace("-","",$list["point"]))?>
                      </b></font><font color=BROWN>&nbsp; </font></td>
                    <td><?
if (eregi("-", $list["point"])) {
ECHO "<OPTION style='color:red;'>감산(-)<OPTION>";
$how = 1;
$ORDER_MSG = "<FONT COLOR=ORANGE>(거래취소)</FONT>";
}
else {
$how = 2;
ECHO "<OPTION style='color:blue;'>가산(+)<OPTION>";
$ORDER_MSG = "(거래완료)";
}
?>                    </td>
                  </tr>
                </table>              </td>
            <td align="center">
                <?=date("Y/m/d", $list["wdate"])?></td>
            <td align="center"><A HREF='<?=$PHP_SELF?>?query=delete&id=<?=$id?>&point=<?=$list["point"]?>&uid=<?=$list["uid"]?>&cp=<?=$cp?>' onclick='return really();'>[삭제]</A></td>
          </tr>
          <tr>
            <td height="1" colspan="5" bgcolor="#dddddd"></td>
          </tr>
          <?
$SUB_SMONEY += $list[point];
$BOARD_NO--;
$cnt++;
endwhile;
//echo "totalpoint = $totalpoint <br />";
?>
<?
if(!$cnt){
?>
          <tr bgcolor="#FFFFFF">
            <td height="26" colspan="5" align="center">등록된 포인트가 없습니다.<A HREF='<?=$PHP_SELF?>?query=delete&id=<?=$id?>&point=<?=$list["point"]?>&uid=<?=$list["uid"]?>&cp=<?=$cp?>' onclick='return really();'></A></td>
          </tr>
          <tr>
            <td height="1" colspan="5" bgcolor="#dddddd"></td>
          </tr>
<?
}
?>
        </table>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td height="30" align="right"><B>현재페이지 포인트 : <FONT COLOR=BLUE><?ECHO number_format($SUB_SMONEY);?></FONT> 포인트 | 총 확보포인트 : <FONT COLOR=RED><?ECHO number_format($totalpoint);?></FONT> 포인트</B></td>
          </tr>
          <tr>
            <td height="34" align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?id=$id";
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
//$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
            </td>
          </tr>
        </table>
      </FORM></td>
  </tr>
</table>
</body>
</html>
