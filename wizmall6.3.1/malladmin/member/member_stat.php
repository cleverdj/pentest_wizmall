<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

if($mgrade == "") $mgrade = 10;

$selectYear		= $selectYear ? $selectYear:date("Y");
$selectMonth	= $selectMonth ? $selectMonth:date("m");
$selectDay		= $selectDay ? $selectDay:date("d");
$unixtime		= mktime(0,0,0,$selectMonth,$selectDay,$selectYear);
$thisyear		= date("Y",$unixtime) ;
$thismonth		= date("m",$unixtime);
$thisday		= date("d",$unixtime);


#step 1 : 전체 데이터
$sqlstr = "SELECT COUNT(*) FROM ".$WIZTABLE["MEMBER"];
$totalmember = $dbcon->get_one($sqlstr);

//$sqlstr = "SELECT COUNT(*) as totalstudent FROM ".$WIZTABLE["MEMBER"]." WHERE mgrade = 9";
//$totalstudent = $dbcon->get_one($sqlstr);

//$sqlstr = "SELECT COUNT(*) as totalparent FROM ".$WIZTABLE["MEMBER"]." WHERE mgrade = 7";
//$totalparent = $dbcon->get_one($sqlstr);

#step 2 : 검색 

if(!$year) $year	= date('Y');
if(!$month) $month	= date('m');
if(!$day) $day		= date('d');
if(!$mode) $mode	= "month";
?>
<script language="JavaScript">
<!--
function ModeChange(mode)
{
	document.logform.mode.value=mode;
	document.logform.submit();
}
//-->
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><fieldset class="desc">
						<legend>회원가입통계</legend>
						<div id="notice">[note]</div>
						<div id="comment">회원가입통계입니다.</div>
						</fieldset>
						<p></p>
      <table class="table_main">
        <TR>
          <TD bgcolor="#FFFFFF">총 가입자수 :
            <?=(int)$totalmember?></TD>
        </TR>
        <TR>
          <TD bgcolor="E0E4E8"><form name='logform' action='<?=$PHP_SELF?>' method='get'>
              <input type=hidden name='mode' value='<?=$mode;?>'>
              <input type=hidden name='menushow' value='<?=$menushow;?>'>
              <input type=hidden name='theme' value='<?=$theme;?>'>
              <tr bgcolor='#F2F2F2' height=40>
                  <td nowrap bgcolor="#FFFFFF">&nbsp;
                    <select name="mgrade">
                      <?
foreach($AdminGradeArr as $key=>$value){
	$selected = $mgrade == $key ? "selected":"";
	echo "<option value='$key' $selected>$value</option>\n";
}
?>
                    </select>
                    <select name="selectYear">
                      <?
for($i=2006; $i<=$thisyear; $i++){
		$selected = $i == $selectYear ? "selected":"";
		echo "<option value='$i' $selected>$i</option>\n";
}
?>
                    </select>
                    <select name="selectMonth">
                      <?
for($i=1; $i<=12; $i++){
		$selected = $i == $selectMonth ? "selected":"";
		echo "<option value='".sprintf("%02d", $i)."' $selected>".sprintf("%02d", $i)."</option>\n";
}
?>
                    </select>
                    <select name="selectDay">
                      <?
for($i=1; $i<=31; $i++){
		$selected = $i == $selectDay ? "selected":"";
		echo "<option value='".sprintf("%02d", $i)."' $selected>".sprintf("%02d", $i)."</option>\n";
}
?>
                    </select>
                    <!-- ~ <select name="selectYear1">
<?
for($i=2006; $i<=$thisyear; $i++){
		$selected = $i == $selectYear1 ? "selected":"";
		echo "<option value='$i' $selected>$i</option>\n";
}
?>
	    </select>
	  <select name="selectMonth1">
<?
for($i=1; $i<=12; $i++){
		$selected = $i == $selectMonth1 ? "selected":"";
		echo "<option value='".sprintf("%02d", $i)."' $selected>".sprintf("%02d", $i)."</option>\n";
}
?>
	    </select>	
	  <select name="selectDay1">
<?
for($i=1; $i<=31; $i++){
		$selected = $i == $selectDay1 ? "selected":"";
		echo "<option value='".sprintf("%02d", $i)."' $selected>".sprintf("%02d", $i)."</option>\n";
}
?>
	    </select>	-->
                    <input type="submit" name="Submit" value="확인">
                    <input name="button" type=button style='width:40;<?if($mode=="month") echo "background:#0B9BFF;color:#FFFFFF;'";?>' onClick="ModeChange('month')" value='월별'>
                    <input type=button value='일별' style='width:40;<?if($mode=="day") echo "background:#0B9BFF;color:#FFFFFF;'";?>' onClick="ModeChange('day')">
                    <input type=button value='시간' style='width:40;<?if($mode=="hour") echo "background:#0B9BFF;color:#FFFFFF;'";?>' onClick="ModeChange('hour')">
                    <input type=button value='요일' style='width:40;<?if($mode=="weekday") echo "background:#0B9BFF;color:#FFFFFF;'";?>' onClick="ModeChange('weekday')">
                  </td>
                </tr>
            </form>
        <tr>
          <td bgcolor='#FFFFFF'><!----------->
            <table width=100% cellspacing=0 cellpadding=0>
              <tr>
                <td bgcolor=white><table width=100% bgcolor='dfdfdf' style='color:gray;' class="s1">
                    <tr>
                      <td><img src='./member/images/blank.gif' width=90 height=1></td>
                      <td width=10%>0%</td>
                      <td width=10%>10%</td>
                      <td width=10%>20%</td>
                      <td width=10%>30%</td>
                      <td width=10%>40%</td>
                      <td width=10%>50%</td>
                      <td width=10%>60%</td>
                      <td width=10%>70%</td>
                      <td width=10%>80%</td>
                      <td width=10%>90%</td>
                      <td align=right>100%</td>
                      <td><img src='./member/images/blank.gif' width=175 height=1></td>
                    </tr>
                  </table>
                  <table width=100% cellspacing=0 cellpadding=0 background='./module/WebLog/image/log_bg.gif'>
                    <tr>
                      <td><!--------------------------------------------------------------------------------------------- 월별 --->
                        <table width=100% cellspacing=0 cellpadding=0 class="s1">
                          <?

$total_count=0;
switch ($mode)
{
	case "month" :
		$end = 12;
		$ment = '월';
		for($i=0; $i<=$end; $i++){
			$startdate = mktime(0,0,0,$i,1, $thisyear);
			$enddate = mktime(0,0,-1,$i+1,1, $thisyear);
			$sqlstr = "SELECT count(*) FROM ".$WIZTABLE["MEMBER"]."  WHERE mgrade='$mgrade' and mregdate between $startdate and $enddate";
			$regcnt[$i] = $dbcon->get_one($sqlstr);
			$total_count += $regcnt[$i];
		}
		break;
	case "day" : 
		$end = 31;
		$ment = "일";
		for($i=0; $i<=$end; $i++){
			$startdate = mktime(0,0,0,$thismonth,$i, $thisyear);
			$enddate = mktime(0,0,-1,$thismonth,$i+1, $thisyear);
			$sqlstr = "SELECT count(*) FROM ".$WIZTABLE["MEMBER"]."  WHERE mgrade='$mgrade' and mregdate between $startdate and $enddate";
			$regcnt[$i] = $dbcon->get_one($sqlstr);
			$total_count += $regcnt[$i];
		}
		break;
	case "hour" : 
		$end = 23;
		$ment = "시";
		for($i=0; $i<=$end; $i++){
			$startdate = mktime($i,0,0,$thismonth,$thisday, $thisyear);
			$enddate = mktime($i+1,0,-1,$thismonth,$thisday, $thisyear);
			$sqlstr = "SELECT count(*) FROM ".$WIZTABLE["MEMBER"]." WHERE mgrade='$mgrade' and mregdate between $startdate and $enddate";
			$regcnt[$i] = $dbcon->get_one($sqlstr);
			$total_count += $regcnt[$i];
		}
		break;
	case "weekday" : 
		$end = 7;
		$ment = "시";
		$w = date(w, mktime(0,0,0,$thismonth, $thisday, $thisyear));
		$thisday = $thisday-$w;
		for($i=0; $i<=$end; $i++){
			$startdate = mktime(0,0,0,$thismonth,$thisday+$i, $thisyear);
			$enddate = mktime(0,0,-1,$thismonth,$thisday+$i+1, $thisyear);
			$sqlstr = "SELECT count(*) FROM ".$WIZTABLE["MEMBER"]." WHERE mgrade='$mgrade' and mregdate between $startdate and $enddate";
			$regcnt[$i] = $dbcon->get_one($sqlstr);
			$total_count += $regcnt[$i];
		}
		break;
}

function t_week($cnt)
{
	global $mode;
	global $ment;
	if($mode != "weekday") return $cnt.$ment;

	switch($cnt)
	{
		case 1: return "일";
		case 2: return "월";
		case 3: return "화";
		case 4: return "수";
		case 5: return "목";
		case 6: return "금";
		case 7: return "토";
	}
}

if(!$total_count) $total_count = 1;
for($i=1; $i <= $end ; $i++){
	$per = round(100*$regcnt[$i]/$total_count);
	$re_per = 65*$per/10;
	?>
                          <tr height=20>
                            <td bgcolor=efefef><img src='./member/images/blank.gif' width=5 height=1></td>
                            <td bgcolor=efefef><img src='./member/images/blank.gif' width=95 height=1><br />
                              <a onClick="MonthChange('01')"><font class='Blink'>
                              <?=t_week($i)?>
                              </font></a></td>
                            <td width=90%><img src='./member/images/grp1.gif' height='10' width='<?=$re_per?>'>
                              <?=(int)$regcnt[$i]?>
                              &nbsp;&nbsp; (
                              <?=$per?>
                              %) </td>
                          </tr>
                          <?}?>
                        </table></td>
                    </tr>
                  </table>
                  <!------------->
                </TD>
              </TR>
              <!----->
            </TABLE></td>
        </tr>
      </table>
      <br />
      <br /></td>
  </tr>
</table>
