<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 

Copyright shop-wiz.com
*** Updating List ***
*/
include "../common/header_pop.php";
include "../../config/common_array.php";

include "../../lib/class.member.php";
$member = new member();
$member->get_object($dbcon, $common);

if (!strcmp($query,"update")) :
/* 회원기본정보 변경 시작 */
$birthdate = $birthy."/".$birthm."/".$birthd;
$zip1 = $zip1_1."-".$zip1_2;
$Zip2 = $zip2_1."-".$zip2_2;
$sqlstr = "UPDATE wizMembers SET 
mid = '$id'";
if($ini_pwd == "1") $sqlstr .= ",mpasswd = '".$common->mksqlpwd($passwd)."'";
$sqlstr .= ",mname = '$name'
,mgrade = '$mgrade'
,mailreceive = '$mailreceive'
WHERE mid='".$oldid."'
";	
$dbcon->_query($sqlstr);

/* 회원기본정보 변경 끝 */

/* 회원 기타 정보 변경 시작 */
$sqlstr = "UPDATE wizMembers_ind SET 
id = '$id'
,nickname = '$nickname'
,pwdhint = '$pwdhint'
,pwdanswer = '$pwdanswer'
,gender = '$gender'";

if($ini_jumin == "1") $sqlstr .= ",jumin1 = '".$common->mksqlpwd($jumin1, "memjumin")."',jumin2 = '".$common->mksqlpwd($jumin2, "memjumin")."'";

$sqlstr .= ",birthdate = '$birthdate'
,birthtype = '$birthtype'
,marrdate = '$marrdate'
,marrstatus = '$marrstatus'
,email = '$email'
,mailreceive = '$mailreceive'
,job = '$job'
,scholarship = '$scholarship'
,company = '$company'
,companynum = '$companynum'
,tel1 = '$tel1'
,tel2 = '$tel2'
,tel3 = '$tel3'
,fax = '$fax'
,zip1 = '$zip1'
,address1 = '$address1'
,address2 = '$address2'
,zip2 = '$zip2'
,address3 = '$address3'
,address4 = '$address4'
,url = '$url'
,recid = '$recid'
WHERE id='".$oldid."'
";	
$dbcon->_query($sqlstr);

/* 회원 기타 정보 변경 끝 */
ECHO "<script language=javascript>
window.alert('\\n\\n $name 님의 회원가입 정보가 변경되었습니다.\\n\\n');
location.replace('$PHP_SELF?id=$oldid');
</script>";
exit;
endif;

/* wizMembers 에서 정보 가져 옮 */
$sqlstr = "select m.*, i.* from wizMembers m 
left join wizMembers_ind i on m.mid=i.id
where m.mid = '$id'";
$sqlqry = $dbcon->_query($sqlstr);
$list = $dbcon->_fetch_array();
$tel1 = split("\-",$list[tel1]);
$tel2 = split("\-",$list[tel2]);
$tel3 = split("\-",$list[tel3]);
$fax = split("\-",$list[fax]);
$zip1 = split("\-",$list[zip1]);
$Zip2 = split("\-",$list[Zip2]);
$birthdate = split("\/",$list[birthdate]);
if(!$list[gender]){
//echo "genderno = $genderno <br />";
	$genderno = substr($list[jumin2],0,1);
	if($genderno == 1 || $genderno == 3) $list[gender] = "남";
	else if($genderno == 2 || $genderno == 4) $list[gender] = "여";
}
if(!$birthdate[0]){
//echo "genderno = $genderno <br />";
	if(substr($list[jumin2],0,1) == 1 || substr($list[jumin2],0,1) == 2) $BirthCentury = 19; else $BirthCentury = 20;
	$birthdate[0] = $BirthCentury.substr($list[jumin1],0,2);
	$birthdate[1] = substr($list[jumin1],2,2);
	$birthdate[2] = substr($list[jumin1],4,2);
}

?>
<html>
<head>
<title>회원정보수정</title>
<link rel="stylesheet" href="../../css/admin.css" type="text/css">
<script language="javascript" src="../../js/wizmall.js"></script>
<script language="javascript" src="../../js/jquery-1.3.2.js"></script>
<script language="javascript" src="../../js/admin.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=<?=$cfg["common"]["lan"]?>">
<script language="javascript" type="text/javascript">
<!--
	function insertpoint(type){
	//id, point, 41, $content
		var userid = '<?=$list[mid]?>';
		if(type == "exp"){
			var point = document.getElementById("exp_value").value;
			var content = document.getElementById("exp_cont").value;
		}else if(type == "point"){
			var point = document.getElementById("point_value").value;
			var content = document.getElementById("point_cont").value;			
		}
		
		$.post("../../lib/ajax.admin.php", {smode:"in_point",userid:userid,point:point,content:content,type:type}, function (data){
			//alert(data);
			var result=data.split("|");
			//echo $type."|".$point;
			if(result[0] == "exp"){
				document.getElementById("exp_str").innerHTML = SetComma1(parseInt(RemoveComma(document.getElementById("exp_str").innerHTML)) + parseInt(result[1]));
			}else if(result[0] == "point"){
				document.getElementById("point_str").innerHTML = SetComma1(parseInt(RemoveComma(document.getElementById("point_str").innerHTML)) + parseInt(result[1]));
			}
		});
	}
//-->
</script>
</head>
<body>
<div align="center">
  <FORM ACTION='<?=$PHP_SELF;?>' method=post>
    <input type=hidden name="query" value="update">
    <input type=hidden name='oldid' value='<?=$list[mid]?>'>
    <table class="table_pop600">
      <tr bgcolor="#B9C2CC">
        <td COLSPAN=4>&nbsp; <B><FONT COLOR="#FFFFFF">회원가입 
          상세정보입니다.</FONT></B></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 아이디</td>
        <td bgcolor="#FFFFFF" colspan="3"><input name="id" type="text"  id="id" value="<?=$list[mid]?>" size="15" readonly></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 패스워드</td>
        <td colspan="3" bgcolor="#FFFFFF"><INPUT name="passwd" type="text" id="passwd" VALUE="<?=$list[mpasswd]?>" size="15">
          <input name="ini_pwd" type="checkbox" id="ini_pwd" value="1">
          패스워드 초기화</td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 이 름</td>
        <td bgcolor="#FFFFFF"><INPUT name="name" type="text" id="name" VALUE="<?=$list[mname]?>" size="15"></td>
        <td bgcolor="#e0e4e8">* 메일수신여부</td>
        <td bgcolor="#FFFFFF"><INPUT type="radio" name="mailreceive" value="1"<? if($list[mailreceive]=="1"){ECHO" checked";}?>>
받음
          <INPUT type="radio" name="mailreceive" value="0"<? if($list[mailreceive]=="0"){ECHO" checked";}?>>
받지않음           </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 주민등록번호</td>
        <td bgcolor="#FFFFFF" colspan="3"><input name="jumin1" id="jumin1" value="<?=$list[jumin1]?>" size="7" maxlength="7">
          -
          <INPUT maxLength="7" name="jumin2" size="7" VALUE="<?=$list[jumin2]?>"><input name="ini_jumin" type="checkbox" id="ini_jumin" value="1">
          주빈번호 초기화</td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 생년월일</td>
        <td bgcolor="#FFFFFF"><INPUT type="text" name="birthy" size="4" maxlength="4" VALUE="<?=$birthdate[0]?>">
          년
          <INPUT type="text" name="birthm" size="2" maxlength="2" VALUE="<?=$birthdate[1]?>">
          월
          <INPUT type="text" name="birthd" size="2" maxlength="2" VALUE="<?=$birthdate[2]?>">
          일
          <SELECT NAME="birthtype" size="1">
            <OPTION VALUE="0"<? if($list["birthtype"]=='0'){ECHO" selected";}?>>양력</OPTION>
            <OPTION VALUE="1"<? if($list["birthtype"]=='1'){ECHO" selected";}?>>음력</OPTION>
          </SELECT>        </td>
        <td bgcolor="#e0e4e8">* 성별구분</td>
        <td bgcolor="#FFFFFF"><INPUT TYPE=RADIO NAME='gender' VALUE='1'<?if($list[gender]=='1'){ECHO"checked";}?>>
          남자
          <INPUT TYPE=RADIO NAME='gender' VALUE='2'<?if($list[gender]=='2'){ECHO"checked";}?>>
          여자 </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* E-mail</td>
        <td bgcolor="#FFFFFF" colspan="3"><input name="email" type="text" id="email" value='<?=$list[email]?>' size="45">
          <a href="mailto:<?=$list[Email]?>">메일보내기</a> </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">&nbsp; 
          홈페이지</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT NAME="url" type="text" size="45" VALUE='<?=$list[url]?>'></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 자택 전화번호</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT NAME="tel1" type="text" size="15" VALUE='<?=$list[tel1]?>'>
          &quot;-&quot;포함 입력 </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8" >&nbsp; 핸드폰</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT NAME="tel2" type="text" size="15" VALUE='<?=$list[tel2]?>'>
          &quot;-&quot;포함 입력 </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 자택 
          우편번호</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT maxLength="3" name="zip1_1" size="7" VALUE='<?=$zip1[0]?>'>
          <INPUT maxLength="3" name="zip1_2" size="7" VALUE='<?=$zip1[1]?>'>        </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 동(면)이상주소</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT NAME="address1" type="text" id="address1" VALUE='<?=$list[address1]?>' size="45"></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 나머지 
          주소</td>
        <td bgcolor="#FFFFFF" colspan="3"><INPUT NAME="address2" type="text" id="address2" VALUE='<?=$list[address2]?>' size="20"></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">&nbsp;(직장)학교명</td>
        <td colspan="3" bgcolor="#FFFFFF"><INPUT type="text" name="company" size="20" value="<?=$list[company]?>">        </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">사업자등록(허가)번호</td>
        <td colspan="3" bgcolor="#FFFFFF"><INPUT name="companynum" type="text" id="companynum" value="<?=$list[companynum]?>" size="20">        </td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">* 회원등급</td>
        <td bgcolor="#FFFFFF"><SELECT NAME='mgrade'>
            <?
foreach($gradetostr_info as $key=>$value){ 
	$selected = $key == $list["mgrade"] ? "selected":"";
	ECHO "<OPTION VALUE='$key' $selected>".$value."</OPTION>";
}
?>
          </SELECT></td>
        <td bgcolor="#e0e4e8">회원레벨</td>
        <td bgcolor="#FFFFFF"><?=$member->getLevel($list["mexp"])?></td>
      </tr>
      <tr>
        <td bgcolor="#e0e4e8">로그인</td>
        <td bgcolor="#FFFFFF" colspan="3"><?=$list[mloginnum];?>
          회 </td>
      </tr>
      <tr>
        <td colspan="2" bgcolor="#FFFFFF"><table width="100%">
            <tr>
              <td bgcolor="#e0e4e8"><span class="style1">경험치</span></td>
              <td><a href="javascript:getpointInfo('<?=$id?>', 1)"><span id="exp_str"><?=number_format($list["mexp"])?></span></a></td>
            </tr>
            <tr>
              <td bgcolor="#e0e4e8"><span class="style1">사유</span></td>
              <td><input type="text" name="exp_cont" id="exp_cont"></td>
            </tr>
            <tr>
              <td bgcolor="#e0e4e8"><span class="style1">경험치추가</span></td>
              <td><input name="exp_value" type="text" id="exp_value" size="5">
              <input type="button" name="button" id="button" value="확인" onClick="insertpoint('exp')"></td>
            </tr>
          </table></td>
        <td colspan="2" bgcolor="#FFFFFF"><table width="100%">
          <tr>
            <td bgcolor="#e0e4e8">머니</td>
            <td><a href="javascript:getpointInfo('<?=$id?>', 1)">
              <span id="point_str"><?=number_format($list[mpoint])?></span>
POINT</a></td>
          </tr>
          <tr>
            <td bgcolor="#e0e4e8">사유</td>
            <td><input type="text" name="point_cont" id="point_cont"></td>
          </tr>
          <tr>
            <td bgcolor="#e0e4e8">머니추가 </td>
            <td><input name="point_value" type="text" id="point_value" size="5">
              <input type="button" name="button" id="button" value="확인" onClick="insertpoint('point')"></td>
          </tr>
        </table></td>
      </tr>
    </table>
    <br />
   <div><input type="image" src="../img/su.gif" width="53" height="20" border="0" >
          &nbsp; <img src="../img/order_icon3.gif" width="66" height="20" border="0" onClick="window.print()" style="cursor:pointer"> &nbsp; <img src="../img/order_icon4.gif" width="66" height="20" border="0"  onclick='javascript:top.close();' style="cursor:pointer"> </div>
  </FORM>
</div>
</body>
</html>
