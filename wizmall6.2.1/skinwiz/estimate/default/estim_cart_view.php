<?
/* 
제작자 : 폰돌
*** Updating List ***
*/
?>
<!-- cart view start -->
<!-- 장바구니 보기 -->

<SCRIPT LANGUAGE=javascript>
function num_plus(num){
        gnum = parseInt(num.BUYNUM.value);
        num.BUYNUM.value = gnum + 1;
        return;
}
function num_minus(num){

        gnum = parseInt(num.BUYNUM.value);
        if( gnum > 1 ){
                num.BUYNUM.value = gnum - 1;
        }
        return;
}
function really(){
if (confirm('\n\n정말로 장바구니를 모두 비우시겠습니까?\n\n')) return true;
return false;
}
function is_number(){
         if ((event.keyCode<48)||(event.keyCode>57)){
                  alert("\n\n수량은 숫자만 입력하셔야 합니다.\n\n");
                  event.returnValue=false;
         }
}
</SCRIPT>
<table width="97%" border="0" cellspacing="0" cellpadding="0">
                                <tr> 
                                  
    <td height="15" bgcolor="#FFFFFF" valign="top"> 
      <table width='100%' cellspacing=2 cellpadding=0 border=0>
        <tr bgcolor='#399F92' height=23 align=CENTER> 
          <td>주문상품</td>
          <td>가격</td>
          <td>수량</td>
          <td>소계</td>
          <td>수정</td>
          <td>삭제</td>
        </tr>
<?
//$C_dat=물품아이디|구매수량|옵션|색상
$filepath = "./config/wizmember_tmp/mall_buyers/$_COOKIE[CART_CODE_ESTIM].php"
if (file_exists($filepath)) {
        $Cart_Data = file($filepath);
        for($i = 0; $i < sizeof($Cart_Data) && chop($Cart_Data[$i]); $i++) {
        $C_dat = split("\|", chop($Cart_Data[$i]));
        $VIEW_QUERY = "SELECT * FROM wizMall WHERE UID='$C_dat[0]'";
        $LIST = $dbcon->_fetch_array($dbcon->_query($VIEW_QUERY));
    	$Picture = split("\|", $LIST[Picture]);
		$VIEW_LINK = "'./wizmart.php?query=view&code=$LIST[Category]&no=$LIST[UID]'";
		if (!strcmp($LIST[None],"checked")) {
		$VIEW_LINK = "'#' onclick=\"javascript:alert('제품이 품절되었습니다. 관리자에게 문의하세요.')\"";
		}
        $SUM_MONEY = number_format($LIST[Price] * $C_dat[1]);
if(!$C_dat[2]){            //옵션이 없으면
        $TOTAL_MONEY = $TOTAL_MONEY+($LIST[Price] * $C_dat[1]);
        }
		
//추가 - 제품이 구매된 모든 카테고리를 하나로 만든다. 캬테고리별 가격을 위해
//2. 카테고리를 하나로 만든다.
if(chop($TOTAL_CAT))$TOTAL_CAT .= "|"."$LIST[Category]";
else $TOTAL_CAT = $LIST[Category];		
?>
        <form name='view_form<?ECHO$i;?>'action='./wizcalcu.php'>
          <tr align=CENTER bgcolor="#F3F2EE"> 
            <td height="65" align=LEFT> 
              <TABLE WIDTH=100%>
                <INPUT TYPE=HIDDEN NAME='query' VALUE='modify'>
                <INPUT TYPE=HIDDEN NAME='value' VALUE='<?ECHO"$LIST[UID]-$C_dat[2]-$C_dat[3]";?>'>
                <TR> 
                  <TD WIDTH=50><A HREF='./wizmart.php?code=<?=$LIST[Category]?>&query=view&no=<?=$LIST[UID]?>'><IMG SRC='./wizstock/<?=$Picture[0]?>' WIDTH='50' HEIGHT='50' BORDER=0></A></TD>
                  <TD><A HREF='./wizmart.php?code=<?=$LIST[Category]?>&query=view&no=<?=$LIST[UID]?>'><FONT COLOR=BLUE><U> 
                    <?=$LIST[Name]?>
                    </U></FONT></A><BR> 
                    <?
                if         ($C_dat[2]) {       //옵션이 있어면
                        if (eregi("=", $C_dat[2])) {  // 옵션에 따른 가격이 있으면
                                $SIZE_OPTION_SPL = split("=", $C_dat[2]);
                                ECHO "<FONT COLOR=#CE6500>$SIZE_OPTION_SPL[0] ".number_format($SIZE_OPTION_SPL[1]*$C_dat[1])." 추가</FONT> ";
                                $CHECK1 = chop($SIZE_OPTION_SPL[1]);
                                $SUM_MONEY = number_format((chop($SIZE_OPTION_SPL[1])+$LIST[Price])*$C_dat[1]);
                                $TOTAL_MONEY = $TOTAL_MONEY + (chop($SIZE_OPTION_SPL[1])+$LIST[Price])*$C_dat[1];
                        }

                        else {  // 옵션에 따른 가격이 없으면
                        $TOTAL_MONEY = $TOTAL_MONEY+$LIST[Price]*$C_dat[1];
                        ECHO "<FONT COLOR=#CE6500>${C_dat[2]}</FONT> ";
                        }
                }
                if         ($C_dat[3]) {
                        ECHO " <FONT COLOR=#CE6500>$C_dat[3] </FONT>";
                }
?>
                  </TD>
                </TR>
              </TABLE></td>
            <td> 
              <?=number_format($LIST[Price])?>
              원</td>
            <td> 
              <table cellpadding=0 cellspacing=0 border=0>
                <tr> 
                  <td rowspan=2> 
                    <input type=TEXT size=4 name='BUYNUM' maxlength=5 value='<?ECHO"$C_dat[1]";?>' onKeyPress="is_number()">
                  </td>
                  <td><a href='javascript:num_plus(document.view_form<?ECHO$i;?>);'><img src='./skinwiz/estimate/<?=$EstimSkin?>/images/num_plus.gif' border=0></a></td>
                  <td rowspan=2>&nbsp;&nbsp;EA</td>
                </tr>
                <tr> 
                  <td><a href='javascript:num_minus(document.view_form<?ECHO$i;?>);'><img src='./skinwiz/estimate/<?=$EstimSkin?>/images/num_minus.gif' border=0></a></td>
                </tr>
              </table>
            </td>
            <td><font color='#CE6500'><b> </b></font><FONT COLOR='#E37509'><B><?ECHO"$SUM_MONEY";?></B></FONT><font color='#CE6500'><b> 
              원</b></font></td>
            <td> 
              <input type=IMAGE src='./skinwiz/estimate/<?=$EstimSkin?>/images/cart_modify.gif' name="IMAGE">
            </td>
            <td><a href='./wizcalcu.php?query=delete&value=<?ECHO"$C_dat[0]-$C_dat[2]-$C_dat[3]";?>'><img src='./skinwiz/estimate/<?=$EstimSkin?>/images/cart_delete.gif' border=0></a></td>
          </tr>
          <tr> 
            <td colspan=6 background='./mall_skin/login/<?ECHO"$LOGIN_SKIN";?>/image/cart_line.gif' height=1> 
            </td>
          </tr>
        </form>
        <?
        }   // for
}       // if
?>
      </table>
    
<?
if ($TOTAL_MONEY) { // 장바구니가 담겼으면

$TOTAL_MONEY_TMP=$TOTAL_MONEY;

//<!--- [ 출력메시지를 표시합니다. ] ------------------------------------------------------------------------------------>//
if($TOTAL_MONEY < $cfg["pay"]["TACKBAE_CUTLINE"])

$MESSAGE_TACKBAE = "<TABLE WIDTH='95%' CELLSPACING=0 CELLPADDING=0 BORDER=0><TR><TD WIDTH=50></TD><TD><FONT COLOR='#CE6500'>주문총액이 ".number_format($cfg["pay"]["TACKBAE_CUTLINE"])."원 이하일 경우에는 ".number_format($cfg["pay"]["TACKBAE_MONEY"])."원의 
배송비가 합산되어집니다.</FONT></TD></TR> </TABLE>";

$MESSAGE_RATE1 = "<TABLE WIDTH='95%' CELLSPACING=0 CELLPADDING=0 BORDER=0> <TR><TD WIDTH=50></TD><TD><FONT COLOR='#CE6500'>현금결재(무통장입금)가  아닐경우 ".number_format($TOTAL_MONEY_TMP)."원의".$cfg["pay"]["CARDCHECK_RATE_VALUE1"]."%가 
상품가격에 포함됩니다. </FONT></TD></TR> </TABLE>";

$MESSAGE_VALUE1 = "<TABLE WIDTH='95%' CELLSPACING=0 CELLPADDING=0 BORDER=0> <TR><TD WIDTH=50></TD><TD><FONT COLOR='#CE6500'>현금결재(무통장입금)가 아닐경우 ".number_format($cfg["pay"]["CARDCHECK_RATE_VALUE2"])."원의 금액이 상품가격에 포함됩니다. </FONT></TD></TR> </TABLE>";


//<!--- [ 합산을 계산합니다 ] ------------------------------------------------------------------------------------>//


if($TOTAL_MONEY >= $cfg["pay"]["TACKBAE_CUTLINE"]) $cfg["pay"]["TACKBAE_MONEY"] = 0;

if($TOTAL_MONEY < $cfg["pay"]["TACKBAE_CUTLINE"]){
$TOTAL_MONEY = $TOTAL_MONEY + $cfg["pay"]["TACKBAE_MONEY"];
ECHO $MESSAGE_TACKBAE;
}

if(!strcmp($cfg["pay"]["CARDCHECK_ENABLE"],"NOTSAME") && !strcmp($cfg["pay"]["CARDCHECK_RATE"],"CARDCHECK_PER") ){
$TOTAL_MONEY_TMP=$TOTAL_MONEY_TMP*(1 +  $cfg["pay"]["CARDCHECK_RATE_VALUE1"]/100) + $cfg["pay"]["TACKBAE_MONEY"];
ECHO $MESSAGE_RATE1;
       if(!(strcmp($query,"step3") && strcmp($query,"step4")) && strcmp($check,"online")){
		   $TOTAL_MONEY = $TOTAL_MONEY_TMP;
	   }
}

if(!strcmp($cfg["pay"]["CARDCHECK_ENABLE"],"NOTSAME") && !strcmp($cfg["pay"]["CARDCHECK_RATE"],"CARDCHECK_VALUE") ){
$TOTAL_MONEY_TMP=$TOTAL_MONEY_TMP + $cfg["pay"]["CARDCHECK_RATE_VALUE2"] + $cfg["pay"]["TACKBAE_MONEY"];
ECHO $MESSAGE_VALUE1;
       if(!(strcmp($query,"step3") && strcmp($query,"step4")) && strcmp($check,"online")){
		   $TOTAL_MONEY = $TOTAL_MONEY_TMP;
	   }

}

?>


      <TABLE WIDTH='100%' CELLSPACING=2 CELLPADDING=0 BORDER=0>
        <TR> <TD BACKGROUND='./mall_skin/login/<?ECHO"$LOGIN_SKIN";?>/image/cart_line.gif' HEIGHT=1> 
</TD></TR> <TR> 
    <TD HEIGHT=25 ALIGN=CENTER BGCOLOR=#A9D5CF> 견적상품 가격합계 : <B> 
      <?ECHO number_format($TOTAL_MONEY);?>
      원</B> </TD>
  </TR> <TR> <TD BACKGROUND='./mall_skin/login/<?ECHO"$LOGIN_SKIN";?>/image/cart_line.gif' HEIGHT=1> 
</TD></TR> </TABLE>

<?
} else { // 견적서가 비었으면
?>

      <TABLE WIDTH='100%' CELLSPACING=2 CELLPADDING=0 BORDER=0>
        <TR> 
    <TD HEIGHT=25 ALIGN=CENTER BGCOLOR=#A9D5CF><B>현재 견적서 물품 리스트 내용이 없습니다.</B> 
    </TD>
  </TR> </TABLE><?
}
?></td>
                                </tr>
                                <tr> 
                                  <td height="35" class="title"><img src="../images/blank.gif" width="5" height="15"> 
                                    <table width="100%" border="0" cellspacing="1" cellpadding="0">
                                      <tr> 
                                        
          <td width="50%" align="right"><a href="./wizcalcu.php?query=trash"><img src="./skinwiz/estimate/<?=$EstimSkin?>/images/bu_g_re.gif" width="94" height="30" border="0"></a></td>
                                        <td width="50%"><a href='./wizcalcu.php?query=estim_view'><img src="./skinwiz/estimate/<?=$EstimSkin?>/images/bu_g_acc.gif" width="94" height="30" border="0"></a></td>
                                      </tr>
                                    </table></td>
                                </tr>
                                <tr> 
                                  <td>&nbsp;</td>
                                </tr>
                              </table>