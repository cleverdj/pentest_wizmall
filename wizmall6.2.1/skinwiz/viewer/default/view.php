<?
/* 
제작자 : 폰돌
URL : http://www.shop-wiz.com
Email : master@shop-wiz.com
*** Updating List ***
*/

$view = $mall->getview($no);
?>

<script language="JavaScript">
<!--
function num_plus(num){
	gnum = parseInt(num.BUYNUM.value);
	num.BUYNUM.value = gnum + 1;
	return;
}
function num_minus(num){
	gnum = parseInt(num.BUYNUM.value);
if( gnum > 1 ){
	num.BUYNUM.value = gnum - 1;
	}	
	return;
}

function wishreally(){
if (confirm('\n\n정말로 본 제품을 위시리스트에 담으시겠습니까?\n\n')) return true;
return false;
}


function baropay(){
	var f=document.view_form;

	if(autoCheckForm(f)){
		f.sub_query.value = "baro";
		f.submit();
	}
}

function checkForm(f){
	if(autoCheckForm(f)) return true;
	else return false;
}

function checkthis(v){

	var i,currEl,splitvalue,commanewprice;
	var f = eval("document."+v.form.name);
	var currPrice = parseInt(f.GoodsPrice.value);
	var newprice = 0;
	
	
    for(i = 0; i < f.elements.length; i++){ 
		currEl = f.elements[i]; 
		if (currEl.getAttribute("oflag") != null) { 
			if(currEl.value){
				if(currEl.oflag == "1"){//가격추가
					splitvalue = currEl.value.split('|');
					newprice += parseInt(splitvalue[1]);
				}else if(currEl.oflag == "1"){//상품가격변경
					currPrice = parseInt(splitvalue[1]);
				}
			}
		}
	}
	
	newprice = currPrice + newprice; 
	commanewprice = SetComma1(newprice);	
	if (document.layers) { 
		document.layers.item_price.document.write(commanewprice); 
		document.layers.item_price.document.close(); 
	}else if (document.all) item_price.innerHTML = commanewprice;	
}


function getBigPicture(no){
	wizwindow('./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/picview.php?no='+no, 'BICIMAGEWINDOW','width=750,height=592,statusbar=no,scrollbars=no,toolbar=no,resizable=no')
}
//-->
</script>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td height="40" valign="top"><table width="100%" height="18" border="0" cellpadding="0" cellspacing="0" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
        <tr bgcolor="#F6F6F6">
          <td width="15" height="22">&nbsp;</td>
          <td width="18" height="22" valign="middle"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/sn_arrow.gif" width="13" height="13"></td>
          <td height="22">Home
            <?=$navy_path?>
          </td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td align="center"><table width="98%" border="0" cellspacing="0" cellpadding="0">
        <FORM NAME='view_form' ACTION='./wizbag.php' method="post" onsubmit='return checkForm(this);'>
          <INPUT TYPE=HIDDEN NAME="query" VALUE="cart_save">
          <INPUT TYPE=HIDDEN NAME="no" VALUE="<?=$no?>">
          <INPUT TYPE=HIDDEN NAME="source_id" VALUE="<?=$view["source_id"]?>">
          <INPUT TYPE=HIDDEN NAME="sub_query" VALUE= "">
          <tr>
            <td align="center"><A HREF="javascript:getBigPicture(<?=$view["source_id"]?>)"><img src="<?=$view["imgsrc"]?>" border=0 width="230" /></A></td>
            <td valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                <tr>
                  <td height="25" colspan="3" style="font-family: '굴림', '돋움','Arial';font-size: 14px; color:#333333;line-height:140%"><strong><?=$view[Name]?>
                    <? if($view[Model]) echo "(".$view[Model].")"; ?>
                    </strong>
                    <?=$mall->ShowOptionIcon($cfg["skin"]["ShopIconSkin"], $RegOptionArr, $view[Regoption]);?></td>
                </tr>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td width="90" height="24">&nbsp; <strong>가격</strong></td>
                  <td width="9" height="24">:</td>
                  <td width="226" height="24"><font color="#2266BB"><strong><SPAN id="item_price">
                    <?=number_format($view["Price"])?>
                    </SPAN>원 </strong></font>
                    <input type='hidden' name='GoodsPrice' value='<? echo $view[Price]; ?>'></td>
                </tr>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <?if($view[Price1]):?>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td width="90" height="24">&nbsp; <strong>시중가격</strong></td>
                  <td width="9" height="24">:</td>
                  <td width="226" height="24"><font color="#2266BB"><s>
                    <?=number_format($view[Price1])?>
                    원</s></font></td>
                </tr>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <?endif;?>
                <?if($view[Brand]):?>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td width="90" height="24"><strong> &nbsp; 브랜드</strong></td>
                  <td width="9" height="24">:</td>
                  <td width="226" height="24"><?=$view[Brand]?></td>
                </tr>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <? endif;?>
                <?if($view[Point]):?>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td height="24">&nbsp;<strong> 적립포인트</strong></td>
                  <td height="24">:</td>
                  <td height="24"><?=number_format($view[Point])?></td>
                </tr>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <? endif;?>
                <? //옵션설정값 디스플레이
$substr = "select * from wizMalloptioncfg where opid = '$no' order by oorder asc";
$dbcon->_query($substr);
while($sublist = $dbcon->get_rows()):
	$oname	= $sublist["oname"];
	$oflag	= $sublist["oflag"];
	$ouid = $sublist["uid"];
	
	//옵션값갯수구하기
	$substr1 = "select count(1) from wizMalloption where ouid = '$ouid'";
	$valuecnt = $dbcon->get_one($substr1);
	if($valuecnt > 0 ){
?>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td height="24"><strong> &nbsp;
                    <?=$oname?>
                    </strong></td>
                  <td height="24">:</td>
                  <td height="24"><?
	if($valuecnt == "1"){//옵션등록갯수가 하나이면 일반 텍스트 디스플레이
		echo $oname;
	}else{//실렉트 박스 출력
		//$checkstr = $oflag == "0"?" checkenable msg='".$oname."를 선택해 주세요'":"";
		$checkstr = $oflag == "0"?" checkenable msg='".$oname."를 선택해 주세요'":"";
?>
                    <select name="optionfield[<?=$ouid?>]" class="formline" <?=$checkstr?> oflag="<?=$oflag;?>" onchange="checkthis(this)">
                      <OPTION VALUE=''>
                      <?=$oname?>
                      선택</OPTION>
                      <?
						$substr1 = "select uid, oname, oprice from wizMalloption where ouid = '$ouid' order by uid asc";
						$subqry1 = $dbcon->_query($substr1);
						$subcnt=0;
						while($sublist1 = $dbcon->get_rows()):
							$uid = $sublist1["uid"];
							$oname = $sublist1["oname"];
							$oprice = $sublist1["oprice"];
							if($oprice) $displayoprice = "(".$oprice.")";
							ECHO "<OPTION VALUE='".$uid."|".$oprice."'>".$oname.$displayoprice."</OPTION>\n";
						endwhile;
?>
                    </select>
                    <?
		}//if($valuecnt == "1"){}else{
?>
                  </td>
                </tr>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <? 

	}//if($valuecnt > 0 ){
endwhile;//while($sublist = $dbcon->_fetch_array($subqry)):
?>
                <tr>
                  <td height="1" background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" colspan="3"></td>
                </tr>
                <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                  <td height="24"><strong> &nbsp; 주문수량</strong></td>
                  <td height="24">:</td>
                  <td height="24"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                      <tr>
                        <td width="18"><table cellpadding=0 cellspacing=0 border=0  style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
                            <tr>
                              <td rowspan=2><input type=TEXT size=3 name="BUYNUM" maxlength=5 value="1" onKeyPress="is_number()">
                              </td>
                              <td><a href="javascript:num_plus(document.view_form);"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/num_plus.gif" border=0></a></td>
                              <td rowspan=2>&nbsp;&nbsp;EA</td>
                            </tr>
                            <tr>
                              <td><a href="javascript:num_minus(document.view_form);"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/num_minus.gif" border=0></a></td>
                            </tr>
                          </table></td>
                        <td width="117" align="center" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">&nbsp;</td>
                      </tr>
                    </table></td>
                </tr>
                <tr>
                  <td height="3" colspan="3" bgcolor="#CCCCCC"></td>
                </tr>
              </table></td>
          </tr>
          <tr>
            <td height="40" align="center"><A HREF="javascript:getBigPicture(<?=$view["source_id"]?>)"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/but_zoom.gif" width="83" height="27" border="0"></a></td>
            <td height="40"><table width="318" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td><input type="image" src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/but_jbgn.gif" width="117" height="29"></td>
                  <td><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/but_brgm.gif" width="117" height="29" onclick="baropay();" style="cursor:pointer"></td>
                  <td><a href="<?=$pre_dir?>"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/but_liest.gif" width="70" height="29" border="0"></a></td>
                </tr>
              </table></td>
          </tr>
        </form>
      </table></td>
  </tr>
  <tr>
    <td align="center"><table width="98%" border="0" cellpadding="0" cellspacing="0" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
        <tr bgcolor="#EBEBEB">
          <td height="24">&nbsp; →&nbsp; 상품상세정보</td>
          <td height="24">&nbsp;</td>
        </tr>
        <tr>
          <td height="1"  colspan="2" bgcolor="#cccccc"></td>
        </tr>
        <tr>
          <td height="3" colspan="2" bgcolor="#E8E8E8"></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td align="center"><table width="95%" border="0" cellpadding="0" cellspacing="0">
        <tr align="center" valign="top" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td colspan="2"><br>
            <table width="100%" border="0" cellspacing="0" cellpadding="0" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
              <tr>
                <td valign="top" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%"><font color ="#000000">
                  <?=$view["Description1"]?>
                  </font>
                  <p>&nbsp;</p></td>
              </tr>
            </table>
            <br>
          </td>
        </tr>
        <tr>
          <td background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" height="1" colspan="2"></td>
        </tr>
      </table></td>
  </tr>
  <? if($view[Description3]) :?>
  <tr>
    <td align="center"><table width="98%" border="0" cellpadding="0" cellspacing="0">
        <tr bgcolor="#EBEBEB" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td height="24">&nbsp; →&nbsp; 배송관련정보</td>
          <td height="24">&nbsp;</td>
        </tr>
        <tr>
          <td height="1"  colspan="2" bgcolor="#cccccc"></td>
        </tr>
        <tr>
          <td height="3" colspan="2" bgcolor="#E8E8E8"></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td align="center"><table width="95%" border="0" cellpadding="0" cellspacing="0">
        <tr align="center" valign="top" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td colspan="2"><br>
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td valign="top" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%"><font color ="#000000">
                  <?=$view["Description3"]?>
                  </font>
                  <p>&nbsp;</p></td>
              </tr>
            </table>
            <br>
          </td>
        </tr>
        <tr>
          <td background="skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/bg_w.gif" height="1" colspan="2"></td>
        </tr>
      </table></td>
  </tr>
  <?endif;?>
  <? if($cfg["skin"]["GoodsDisplayPid"] == "checked" && $view[PID]) :?>
  <!-- 인기 판매 제품 시작 -->
  <tr>
    <td align="center"><table width="98%" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/shop_text_04.gif" width="129" height="22"></td>
        </tr>
        <tr>
          <td bgcolor="#C4C4C4" height="1"></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td></td>
  </tr>
  <tr>
    <td align="center"><table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr align="center">
          <?
$cnt=0;
$SimilarPdArr = split("\|",$view[SimilarPd]);
//echo $view[SimilarPd];
while(list($key, $value) = each($SimilarPdArr)):
	if(trim($value)):
	
		$substr="SELECT m1.UID, m1.PID, m1.Category, m1.Picture, m1.None, m1.Regoption, m1.Model, m1.Name, m1.Price, m1.Price1,
		m2.Category as pcategory 
		FROM wizMall m1
		left join wizMall m2
		on m1.PID = m2.UID
		WHERE m1.UID = '$value'";
			
		$subqry=$dbcon->_query($substr);
		$sublist=$dbcon->_fetch_array($subqry);
		$Picture = split("\|", $sublist[Picture]);
		$UID		= $sublist["UID"];
		$PID		= $sublist["PID"];
		$Category	= $sublist["Category"];
		$None		= $sublist["None"];
		$Regoption	= $sublist["Regoption"];
		$Model		= $sublist["Model"];
		$Name		= $sublist["Name"];
		$Price		= $sublist["Price"];
		$Price		= $sublist["Price	"];
	
		$img_folder = substr($Category, -3);
		$img_path = "./config/uploadfolder/productimg/$img_folder/".$Picture[0];
		$View_Pic_Size = $common->TrimImageSize($img_path, 110);
		//if ($cnt <> 0) echo " <td width='1' bgcolor='#E6E6E6'></td>";
?>
          <td height="190"><table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width="80" align="center"><table border="0" cellpadding="0" cellspacing="0">
                    <tr>
                      <td width="80" align="center"><table width="120" height="120" border="1" cellpadding="0" cellspacing="0" style="border-collapse:collapse;" bordercolor="#bababa">
                          <tr>
                            <td align="center" bgcolor="#FFFFFF"><A HREF="<?=$mall->pdviewlink($UID,$Category,$None)?>"><img src="<?=$img_path?>" border="0" <?=$View_Pic_Size?>></A></td>
                          </tr>
                        </table></td>
                    </tr>
                    <tr>
                      <td align="center" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%"><?=$sublist[Name]?>
                        <br>
                        <?=$sublist[Model]?>
                        <br>
                        <font color="#006699"><strong>
                        <?=number_format($sublist[Price])?>
                        원</strong></font></td>
                    </tr>
                  </table></td>
              </tr>
            </table></td>
          <?
		$cnt++;
		if(!($cnt%4)) echo "</tr><tr align='center'>";
	endif;//if(trim($value)):
endwhile;

$tmpcnt = $cnt%4;
if($tmpcnt){
	for($i=$tmpcnt; $i<4; $i++){
		echo "<td width='190' valign='top'></td>";
	}
}
?>
        </tr>
      </table></td>
  </tr>
  <!-- 인기 판매 제품 끝 -->
  <? endif;?>
  <? if($cfg["skin"]["GoodsDisplayEstim"] == "checked"):?>
  <!-- 상품 평가 시작 -->
  <tr>
    <td align="center"><br>
      <table width="98%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td width="468"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/title_view.gif" width="424" height="28"></td>
          <td width="92" align="right"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/but_ww2.gif" width="69" height="19" border="0" onClick="wizwindow('./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/estimatepopup.php?query=<?=$query?>&code=<?=$code?>&no=<?=$no?>&GID=<?=$view["source_id"]?>','','width=554,height=450')" style="cursor:pointer"></td>
        </tr>
        <tr>
          <td height="1"  colspan="2" bgcolor="#cccccc"></td>
        </tr>
        <tr>
          <td height="3" colspan="2" bgcolor="#E8E8E8"></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td align="center"><br>
      <script language="JavaScript">
<!--
function check_reple_Form(){
	var f=document.estimat;
	if(f.Name.value == ''){
		alert('성함을 입력해주세요');
		f.Name.focus();
		return false;
	} else if(f.Contents.value == ''){
		alert('상품사용후기를 입력해주세요');
		f.Contents.focus();
		return false;
	}
}

function reple_delete(uid){
var f=document.estimat;
	f.repleqry.value = "insert";
	f.mode.value = "";
	f.repleuid.value = uid;
	f.submit();

}
//-->
</script>
      <form name="estimat" action="<?=$PHP_SELF?>" onsubmit='return check_reple_Form();'>
        <input type="hidden" name="query" value="<?=$query?>">
        <input type="hidden" name="code" value="<?=$code?>">
        <input type="hidden" name="no" value="<?=$view["source_id"]?>">
        <input type="hidden" name="repleqry" value="insert">
        <input type="hidden" name="Name" value="<?=$cfg["member"]["mname"]?>">
        <input type="hidden" name="repleuid" value="">
        <!--<? if($cfg["member"]):?>
                                <input name="image2" type="image" src="img/main/btn_sub.gif" width="51" height="21"> 
                                <? else: ?>
                                <a href="javascript:window.alert('로그인후 사용가능합니다.')"><img src="img/main/btn_sub.gif" width="51" height="21" border="0"></a> 
                                <? endif;?>-->
      </form>
      <?
    
$sqlstr = "select * from wizEvalu where GID = '".$view["source_id"]."' ORDER BY Wdate desc";
$dbcon->_query($sqlstr);
while($list = $dbcon->_fetch_array()):
$list[Contents] = nl2br($list[Contents]);
$list[Contents] = stripslashes($list[Contents]);
$list[Subject] = stripslashes($list[Subject]);
?>
      <table width="100%" height="80" border="0" cellpadding="0" cellspacing="0" style="border-collapse:collapse;" bordercolor="#bababa">
        <tr style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td width="150">글쓴이</td>
          <td width="150"><?=$list[Name]?>
            <? if($cfg["member"] == $list[ID]):?>
            &nbsp;&nbsp;&nbsp;<a href="javascript:reple_delete('<?=$list[UID]?>');" >x</a>
            <?endif;?></td>
          <td width="150">고객선호도 </td>
          <td width="150"><img src="./skinwiz/viewer/<?=$cfg["skin"]["ViewerSkin"]?>/images/star<?=$list[Grade]?>.gif" width="88" height="15"></td>
        </tr>
        <tr bgcolor="#E6E6E6" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td colspan="4"><?=$list[Subject]?></td>
        </tr>
        <tr valign="top" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">
          <td colspan="4" bgcolor="#FFFFFF" style="word-break:break-all;"><?=$list[Contents]?>
          </td>
        </tr>
      </table>
      <?
endwhile;
?>
      <br>
      <table width="98%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td width="28" style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%"><font color="#006699">≡</font> </td>
          <td style="font-family: '굴림', '돋움','Arial';font-size: 12px; color:#666666;line-height:140%">상품평은 개인의 체험을 바탕으로 한 주관적인 의견으로 사실과 다르거나,보는 사람에 따라 
            차이가 있을 수 있습니다.</td>
        </tr>
      </table></td>
  </tr>
  <!-- 상품 평가 끝 -->
  <?endif;?>
</table>
