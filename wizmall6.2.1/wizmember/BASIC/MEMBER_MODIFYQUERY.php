<?
/* 
제작자 : 폰돌
URL : http://www.shop-wiz.com
Email : master@shop-wiz.com
*** Updating List ***
*/
$pub_path = "../../";
include $pub_path."lib/cfg.common.php";
include ($pub_path."config/db_info.php");
include $pub_path."/lib/cfg.core.php";

include "../../lib/class.database.php";
$dbcon		= new database($cfg["sql"]);

include $pub_path."lib/class.common.php";
$common = new common();
$common->pub_path = $pub_path;
$cfg["member"] = $common->getLogininfo();//로그인 정보를 가져옮
$mid = $cfg["member"]["mid"];
$mname = $cfg["member"]["mname"];

if($smode == "chpwd"){//비밀번호만변경
	$sqlstr = "select count(*) from wizMembers WHERE mpasswd='$ppasswd' AND mid = '".$mid."'";
	$result = $dbcon->get_one($sqlstr);
	if(!$result){
		$common->js_alert("패스워드가 일치하지 않습니다.");
	}else{
		$sqlstr = "UPDATE wizMembers SET 
		mpasswd = '$passwd'
		WHERE mid='".$mid."'
		";	
		$dbcon->_query($sqlstr);
		$str = "\\n\\n".$mname."님의 비밀번호가 변경되었습니다.\\n\\n";
		$goto = $pub_path."wizmember.php?query=chpass";
		$common->js_alert($str, $goto);
	}
}else{
	$sqlstr = "select count(*) from wizMembers WHERE mpasswd='$ppasswd' AND mid = '".$mid."'";
	$dbcon->get_one($sqlstr);
	if(!$result){
		$common->js_alert("패스워드가 일치하지 않습니다.");
	}

	if(!$tel1) $tel1=$tel1_1."-".$tel1_2."-".$tel1_3;
	if(!$tel2) $tel2=$tel2_1."-".$tel2_2."-".$tel2_3;
	if(!$tel3) $tel3=$tel3_1."-".$tel3_2."-".$tel3_3;
	if(!$fax) $fax=$fax1."-".$fax2."-".$fax3;
	$zip1 = ${zip1_1}."-".${zip1_2};
	$zip2 = ${zip2_1}."-".${zip2_2};
	if(!$gender&&$jumin2) $gender = getGender($jumin2);
	if(!$companynum) $companynum = $companynum1."-".$companynum2."-".$companynum3;
	if(!$email) $email = $email_1."@".$email_2;
	$birthdate = $birthyy."/".$birthmm."/".$birthdd;
	$marrdate = $marryy."/".$marrmm."/".$marrdd;
	$passwd = trim($passwd) ? trim($passwd):$ppasswd;



	$sqlstr = "UPDATE wizMembers SET 
	mpasswd = '$passwd',
	mname = '$name',
	mailreceive = '$mailreceive'
	WHERE mid='".$mid."'
	";	
	$dbcon->_query($sqlstr);


	$sqlstr = "UPDATE wizMembers_ind SET 
	nickname = '$nickname',
	pwdhint = '$pwdhint',
	pwdanswer = '$pwdanswer',
	gender = '$gender',
	jumin1 = '$jumin1',
	jumin2 = '$jumin2',
	birthdate = '$birthdate',
	birthtype = '$birthtype',
	marrdate = '$marrdate',
	marrstatus = '$marrstatus',
	email = '$email',
	mailreceive = '$mailreceive',
	job = '$job',
	scholarship = '$scholarship',
	company = '$company',
	companynum = '$companynum',
	telflag = '$telflag',
	tel1 = '$tel1',
	tel2 = '$tel2',
	tel3 = '$tel3',
	fax = '$fax',
	addressflag = '$addressflag',
	zip1 = '$zip1',
	address1 = '$address1',
	address2 = '$address2',
	zip2 = '$zip2',
	address3 = '$address3',
	address4 = '$address4',
	url = '$url'
	WHERE id='".$mid."'
	";	
	$dbcon->_query($sqlstr);
	$str = "\\n\\n".$name."님의 회원가입 정보가 변경되었습니다.\\n\\n";
	$goto = $pub_path."wizmember.php?query=info";
	$common->js_alert($str, $goto);
}
?>