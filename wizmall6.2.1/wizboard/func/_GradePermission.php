<?
/* 
제작자 : 폰돌
스킨 : wizboard list skin 
URL : http://www.shop-wiz.com
Email : master@shop-wiz.com
*** Updating List ***
*/
?>
<?
function getNickName ($MemberGrade){
$fp = "./config/GradeNickName.php";
	if(file_exists($fp)){ //
		$fileArr = file($fp);
		$j = $MemberGrade - 1;
		$Member_txt = trim($fileArr[$j]);
	}else $Member_txt = $MemberGrade;
	return $Member_txt;
}

function MemberGradeBoundary($MemberGradeBoundary, $MemberGrade, $COOKIE_GRADE){
	global $Member_txt;
	switch($MemberGradeBoundary){
		case("over"):
			if($MemberGrade < $COOKIE_GRADE && $MemberGrade ){
				$Member_txt = getNickName($MemberGrade)." 등급 이상 회원";
				return true;
			}
		break;
		case("less"):
			if($MemberGrade > $COOKIE_GRADE && $MemberGrade ){
				$Member_txt = getNickName($MemberGrade)." 등급 이하 회원";
				return true;
			}
		break;
		case("only"):
			if($MemberGrade != $COOKIE_GRADE && $MemberGrade ){
				$Member_txt = getNickName($MemberGrade)." 등급 회원";
				return true;
			}
		break;
	}
}

function MemberGenderBoundary($allowedgender){
	$sqlstr = "select gender from wizMembers_ind where id = '".$_COOKIE["MEMBER_ID"]."'";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	$mygender = $list["gender"];
	$gendertxt = $allowedgender==2?"여성":"남성";
	if($mygender <> $allowedgender){
		echo "<script>window.alert('$gendertxt 전용입니다'); history.go(-1);</script>"; 
		return false;
	}else return true;
}


function Confirm($str, $BID, $GID, $cancelgo=0, $hiddenvalue1=null, $hiddenvalue2=null, $hiddenvalue3=null){
	//$str = addslashes($str);
	if($cancelgo == 0){
		$prev_go = "history.go(-1)";
	}else{
		$prev_go = "location.replace('wizboard.php?BID=$BID&GID=$GID&category=$hiddenvalue1')";
	}
	echo "<script>
	con = confirm(\"$str\")
	if (con==true) location.href ='wizmember.php?query=login&file=wizboard&goto=$BID&goto1=$GID&hiddenvalue1=$hiddenvalue1&hiddenvalue2=$hiddenvalue2&hiddenvalue3=$hiddenvalue3';
	else $prev_go ;
	</script> "; 
	exit;
}

if($MemberGrade == "") $MemberGrade = 0;

switch($mode){
	case "list":
		if(!strcmp($ListForMember, "checked") && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(!$_COOKIE["MEMBER_ID"]){
				$str = "이곳은 회원전용 게시판입니다. \\n\\n 로그인 하시겠습니까?";
				Confirm($str, $BID, $GID, $cancelgo=1, $category, $mode, $hiddenvalue3);
			}else if(MemberGradeBoundary($ListMemberGradeBoundary, $ListMemberGrade, $_COOKIE[MEMBER_GRADE])){
				 echo "<script>window.alert('$Member_txt 전용입니다 \\n\\n 관리자에게 문의 하세요'); history.go(-1);</script>"; 
				 exit;
			}
		}
		if($ListMemberGenderBoundary && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(MemberGenderBoundary($ListMemberGenderBoundary) == false){
				exit;
			}
		}
	break;
	case "view":
		if(!strcmp($ReadForMember, "checked") && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(!$_COOKIE["MEMBER_ID"]){
				$str = "이곳은 회원전용 게시판입니다. \\n\\n 로그인 하시겠습니까?";
				Confirm($str, $BID, $GID, $cancelgo=1, $category, $mode, $UID);
			}else if(MemberGradeBoundary($ReadMemberGradeBoundary, $ReadMemberGrade, $_COOKIE[MEMBER_GRADE])){
				echo "<script>window.alert('$Member_txt 전용입니다 \\n\\n 관리자에게 문의 하세요'); history.go(-1);</script>"; 
				exit;
			}
		}
		if($ReadMemberGenderBoundary && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(MemberGenderBoundary($ReadMemberGenderBoundary) == false){
				exit;
			}
		}			 
	break;
	case "write":
		if(!strcmp($WriteForMember, "checked") && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(!$_COOKIE["MEMBER_ID"]){
				$str = "이곳은 회원전용 게시판입니다. \\n\\n 로그인 하시겠습니까?";
				Confirm($str, $BID, $GID, $cancelgo=1, $category, $mode, $UID);
			}
			if(MemberGradeBoundary($WriteMemberGradeBoundary, $WriteMemberGrade, $_COOKIE[MEMBER_GRADE])){
				echo "<script>window.alert('$Member_txt 전용입니다 \\n\\n 관리자에게 문의 하세요'); history.go(-1);</script>"; 
				exit;
			}
		}
		if($WriteMemberGenderBoundary && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
			if(MemberGenderBoundary($WriteMemberGenderBoundary) == false){
				exit;
			}
		}

/* Admin Writing Only Page 일경우 아래를 실행한다. */
		if(!strcmp($AdminOnly,"yes") && !$_COOKIE["BOARD_PASS"] && !$_COOKIE["ROOT_PASS"]):
			if($GID) $CookieName=${GID}."_".${BID}."_MEMBER_PASS";
			else $CookieName="${BID}_MEMBER_PASS";
			if ( !$_COOKIE[$CookieName] ){ 
				LocationReplace("./wizboard.php?mode=login&BID=$BID&GID=$GID&category=$category&nmode=$mode&adminmode=$adminmode&UID=$UID&cp=$cp");
			}
		endif;
	break;
	default:

	break;
}

/* 아래 부분은 다운로드 페이지에서 처리

if(!strcmp($DownForMember, "checked") && !$_COOKIE[MEMBER_GRADE] && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
echo "<script>
con = confirm(\"자료를 다운 받으시려면 로그인 하셔야 합니다.\\n\\n 로그인 하시겠습니까?\")
if (con==true) location.href ='../wizmember.php?query=login&file=wizboard&goto=$BID&goto1=$GID&hiddenvalue1=$category&hiddenvalue2=view&hiddenvalue3=$UID';
else location.replace('../wizboard.php?BID=$BID&GID=$GID&category=$category');
</script> "; 
exit;
}
	 
if(!strcmp($DownForMember, "checked") && MemberGradeBoundary($DownMemberGradeBoundary, $DownMemberGrade, $_COOKIE[MEMBER_GRADE]) && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
echo "<script>window.alert('${Member_txt}이 다운 가능합니다. \\n\\n 관리자에게 문의 하세요'); history.go(-1);</script>"; 
exit;
}
  */
if($SecretBoard == 1 && !$_COOKIE[BOARD_PASS] && !$_COOKIE[ROOT_PASS]){
	$CookieName="${BID}_MEMBER_PASS";
	if ( !$_COOKIE[$CookieName] ){ 
	echo "<script> if(confirm('이곳은 비밀게시판입니다. \\n 보드관리자로 로그인하시겠습니까?')){
	location.href='./wizboard.php?mode=login&BID=$BID&goto1=$GID&nmode=$mode&UID=$UID&cp=$cp';
	}else{
	history.go(-1);
	}
	</script>"; 
	exit;
	}
}
?>