<?
/*--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      Shop-Wiz PHP General Function
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  function name                                                                           | description                                                                         | use process
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  CheckField($field)                                    |  공백검사
  WindowAlert($str, $action, $gotourl)                  |  경고창
  CheckInt($field)                                      |  정수검사 return true or false
  file_uploade($file_field_name)						|  파일업로딩
  unique_code($tablename, $fieldname1, $fieldvalue1, $fieldname2, $fidelvalue2)
  is_login
  auto_link($text)
  ArraytoSelect($ArrayName, $correspondvalue,$flag)										| Array를 가져와서 select 로 변경하는 함수 defalult flag=1
  TableList                                                 | DB의 테이블들을 보여주는 함수
  function strCutting( $LONG_STR, $CUTTING_LEN, $ABBREVIATE)
  function OptionValueFnc($Option1, $AddPriceOption) | 장바구니용 
  function ShowIcon($ShopSkin, $RegOptionArr, $Option3) | 신규/추천.. 등 아이콘 디스플레이
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

// Blank check
function CheckField($field) {
	if(!ereg("([^[:space:]]+)",$field) || !$field) return true;
}

// Error Message print
function WindowAlert($str, $action, $gotourl=null){ //action : 1 : history.go(-1) 
	if($action){
		switch($action){
			case ("1") :
				echo "<script>window.alert('$str');history.go(-1);</script>";
				exit;
			break;
			case ("10") :
				echo "<script>window.alert('$str');location.href='$gotourl';</script>";
				exit;
			break;
			default:
				echo "<script>window.alert('$str');history.go(-1);</script>";
				exit;			
			break;
		
		}	
	}

}


function LocationHref($url){ //action : 1 : history.go(-1) 
		echo "<script>location.href='$url';</script>";
		exit;
}


// numbercheck
function CheckInt($field) {
	if(ereg("[^[:digit:]]",$field)) return true;
}

function file_uploade($file_field_name){
global $file_name, $file_type, $file_error, $file_size, $file_tmp_name;
	$file_name=$_FILES[$file_field_name]['name'];
	$file_type=$_FILES[$file_field_name]['type'];
	$file_error=$_FILES[$file_field_name]['error'];
	$file_size=$_FILES[$file_field_name]['size'];
	$file_tmp_name=$_FILES[$file_field_name]['tmp_name'];
}


function uploadfile($mode="insert", $file_field_name, $upload_path="", $return1, $return2="", $oldfilename1="", $oldfilename2="", $prohibitextension="", $option1="", $option2=""){
#$option1 : 파일내임 치환 옵션, $option2: 현재파일 삭제옵션 $oldfilename1 : 저장된 파일명, $oldfilename2 : 실제 파일명
	global $$return1, $$return2, $file_name, $file_tmp_name;
	

	if($mode == "insert"){
		file_uploade($file_field_name);//register global on에서 작동되게 설계
		while(is_array($file_name) && list($att_key, $att_value) = each($file_name)):
		$MicroTsmp = split(" ",microtime());
		$newFileName = str_replace(".", "", $MicroTsmp[0]);
			if($file_tmp_name[$att_key]!="none" && $file_tmp_name[$att_key]){
				$extention = strrchr($file_name[$att_key], ".");
				if(ereg($extention, $prohibitextension)) {
					echo "<script>window.alert('시스템에 손상을 주는 파일이 첨부되었습니다.');history.go(-1);</script>";
					return false;
					exit;
				}
				$$return2 .=$file_name[$att_key]."|"; /* 원래 파일명만 넣어둠*/
				if($option1) $file_name[$att_key]=time()."".$extention;
				if (file_exists($upload_path."/".$file_name[$att_key]) && !$UpLoadingOverWriteEnable) {
					if(!$option1){
						$file_name[$att_key] = date("is")."_$file_name[$att_key]";
					}else{
						$file_name[$att_key] = $newFileName."_$file_name[$att_key]";
					}
				}    
				if(!move_uploaded_file($file_tmp_name[$att_key], $upload_path."/".$file_name[$att_key])) {
					echo "<script>window.alert('파일 업로딩에 실패하였습니다.\\n에러:\\ntmp_file = ".$file_tmp_name[$att_key]."\\nuploadpath=".$upload_path."/".$file_name[$att_key]."');history.go(-1);</script>";
					return false;
					exit;
				}
			}
			$$return1 .=$file_name[$att_key]."|";
		endwhile;//while(list($att_key, $att_value) = each($file_name)):
	}else if($mode == "update"){//if($mode == "insert"){
	//echo "oldfilename1 = $oldfilename1 <br>";
	//echo "mode = $mode <br>";
	//exit;
		file_uploade($file_field_name);
		$oldfile1 = split("\|", $oldfilename1);
		$oldfile2 = split("\|", $oldfilename2);
		while(is_array($file_name) && list($att_key, $att_value) = each($file_name)):
			$MicroTsmp = split(" ",microtime());
			$newFileName = str_replace(".", "", $MicroTsmp[0]);
			if($file_tmp_name[$att_key]!="none" && $file_tmp_name[$att_key]){
				$extention = strrchr($file_name[$att_key], ".");
					if(ereg($extention, $prohibitextension)) {
						echo "<script>window.alert('시스템에 손상을 주는 파일이 첨부되었습니다.');history.go(-1);</script>";
						return false;
						exit;
					}	
				$Tmp1[$att_key]=$file_name[$att_key];	
				if($oldfile1[$att_key]) unlink($upload_path."/".$oldfile1[$att_key]);
				if($option1) $file_name[$att_key]=time()."".$extention;
				if (file_exists($upload_path."/".$file_name[$att_key]) && !$UpLoadingOverWriteEnable) {
					if(!$option1){
						$file_name[$att_key] = date("is")."_$file_name[$att_key]";
					}else{
						$file_name[$att_key] = $newFileName."_$file_name[$att_key]";
					}
				}    
				if(!move_uploaded_file($file_tmp_name[$att_key], $upload_path."/".$file_name[$att_key])) {
					echo "<script>window.alert('파일 업로딩에 실패하였습니다.\\n에러:\\ntmp_file = ".$file_tmp_name[$att_key]."\\nuploadpath=".$upload_path."/".$file_name[$att_key]."');history.go(-1);</script>>";
					return false;
					exit;
				}
				$Tmp[$att_key]=$file_name[$att_key];
			}else if($option2[$att_key] && $oldfile1[$att_key]){ //파일 삭제 옵션이 책크 되어 있으면
				unlink($upload_path."/".$oldfile1[$att_key]);
			}else {
				$Tmp[$att_key]=$oldfile1[$att_key];
				$Tmp1[$att_key]=$oldfile2[$att_key];
			}
			
			$$return1 .= $Tmp[$att_key]."|";
			$$return2 .= $Tmp1[$att_key]."|";
		endwhile;
	}//}else if($mode == "update"){//if($mode == "insert"){
}

function unique_code($tablename, $fieldname1, $fieldvalue1, $fieldname2, $fidelvalue2){
	$where = "where $fieldname1 = '$fieldvalue1'";
	if($fieldname2) $where .= " and $fieldname2 = '$fieldvalue2'";
	$sqlstr = "select count(*) from $tablename $where";
	$sqlqry = mysql_query($sqlstr);
	$count = @mysql_result($sqlqry, 0, 0);
	return $count;
}

function selectdatefnc($returnyear, $returnmonth, $returnday, $startyear, $endyear,$regdate){
    $ThisYear = date("Y");
    $ThisMonth = date("m");
    $ThisDay = date("d");

    if(!$regdate){
    $regyear = $ThisYear;
    $regmonth = $ThisMonth;
    $regday = $ThisDay;
    }else{
    $regyear = date("Y", $regdate);
    $regmonth = date("m", $regdate);
    $regday = date("d", $regdate);
    }
    //echo "regyear = $regyear <br>";

/* display select box for year */
    echo "<select name='$returnyear'>\n";
        for($i=$startyear; $i <= $endyear; $i++){
            if($regyear == $i) $selected = 'selected';
            else unset($selected);
            echo "<option value='$i' $selected>$i</option>\n";
        }
    echo "</select>년\n";

/* display select box for month */
    echo "<select name='$returnmonth'>\n";
    for($i=01; $i < 13; $i++){
    $k = substr('0'.$i, -2);
    if($regmonth == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>월\n";

/* display select box for day */
    echo "<select name='$returnday'>\n";
    for($i=01; $i < 32; $i++){
    $k = substr('0'.$i, -2);
    if($regday == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>일\n";
}


function selecttimefnc($returhour, $returnminute, $returnsecond,$regdate){

    $ThisHour = date("H");
    $ThisMinute = date("i");
    $ThisSecond = date("s");
    if(!$regdate){
    $reghour = $ThisHour;
    $regminute = $ThisMinute;
    $regsecond = $ThisSecond;
    }else{
    $reghour = date("H", $regdate);
    $regminute = date("i", $regdate);
    $regsecond = date("s", $regdate);
    }

/* display select box for year */
    echo "<select name='$returhour'>\n";
    for($i=00; $i < 24; $i++){
    $k = substr('0'.$i, -2);
    if($reghour == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>시\n";

/* display select box for month */
    echo "<select name='$returnminute'>\n";
    for($i=00; $i < 60; $i++){
    $k = substr('0'.$i, -2);
    if($regminute == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>분\n";

/* display select box for day */
    echo "<select name='$returnsecond'>\n";
    for($i=00; $i < 60; $i++){
    $k = substr('0'.$i, -2);
    if($regsecond == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>초\n";
}

function selecttimefnc1($returhour, $returnminute, $returnsecond,$regdate){

    $ThisHour = date("H");
    $ThisMinute = date("i");
    $ThisSecond = date("s");
    if(!$regdate){
    $reghour = $ThisHour;
    $regminute = $ThisMinute;
    $regsecond = $ThisSecond;
    }else{
    $reghour = date("H", $regdate);
    $regminute = date("i", $regdate);
    $regsecond = date("s", $regdate);
    }

/* display select box for year */
    echo "<select name='$returhour'>\n";
	echo "<option value='' selected>선택</option>\n";
    for($i=00; $i < 24; $i++){
    $k = substr('0'.$i, -2);
    if($reghour == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>시\n";

/* display select box for month */
    echo "<select name='$returnminute'>\n";
	echo "<option value='' selected>선택</option>\n";
    for($i=00; $i < 60; $i++){
    $k = substr('0'.$i, -2);
    if($regminute == $k) $selected = 'selected';
    else unset($selected);
     echo "<option value='$k' $selected>$k</option>\n";
    }
    echo "</select>분\n";
}


function is_login($goto=null, $path="."){
	global $_COOKIE;
	if($_COOKIE["MEMBER_ID"] && is_file("$path/wizmember_tmp/login_user/$_COOKIE[MEMBER_ID]")){
		return true;
	}else{
		switch($goto){
			case "-1":
				echo "<script>alert('로그인후 사용가능합니다.');history.go(-1);</script>";
				exit;
			break;		
			default:
				return false;
			break;
		}		
	}
}

function UserInfo($path){
	global $_COOKIE;
	global $UserInfo;
	if(!$path) $path = ".";
	$filearr = file("$path/wizmember_tmp/login_user/$_COOKIE[MEMBER_ID].cgi");
	$UserInfo = split("\|", $filearr[0]);
//"$CurrentID|$CurrentNAME|$Log_Time|$CurrentEMAIL|$CurrentURL|$CurrentPoint|");
}

//function auto_link($text) 
//{

#******* www
//$text = eregi_replace("([^/])www([0-9a-zA-Z./@~?&=_]+)","\\1http://www\\2", $text);
#******* http 
//$text = eregi_replace("http://([0-9a-zA-Z./@~?&=_]+)", "<a href=\"http://\\1\" target='_blank'>http://\\1</a>", $text);
#******* ftp
//$text = eregi_replace("ftp://([0-9a-zA-Z./@~?&=_]+)", "<a href=\"ftp://\\1\" target='_blank'>ftp://\\1</a>", $text);
#******* email
//$text = eregi_replace("([_0-9a-zA-Z-]+(\.[_0-9a-zA-Z-]+)*)@([0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)", "<a href=\"mailto:\\1@\\3\">\\1@\\3</a>", $text);
//return $text; 
/*
// URL 치환
$homepage_pattern = "/([^\"\=\>])(mms|http|HTTP|ftp|FTP|telnet|TELNET)\:\/\/(.[^ \n\<\"]+)/";
$text = preg_replace($homepage_pattern,"\\1<a href='\\2://\\3' target='_blank'>\\2://\\3</a>", " ".$text);

// 메일 치환
$email_pattern = "/([ \n]+)([a-z0-9\_\-\.]+)@([a-z0-9\_\-\.]+)/";
$text = preg_replace($email_pattern,"\\1<a href=mailto:\\2@\\3>\\2@\\3</a>", " ".$text);

return $text;
*/
//} 

function is_permited($permkind, $permno){ //$permkinde : listaccessperm, viewaccessperm, writeaccessperm
   // echo "permkind =$permkind , permno = $permno <br>";
	$status = "";
    $permissionArr = split("\|", $_SESSION[adminPerm]);
    while(list($key, $value) = each($permissionArr)):
        if($value == $permno) $status = "on";
    endwhile;
    if(!$_SESSION[ROOT_ID] && !$status){
    echo "<script>
    window.alert('접근이 금지된 페이지 입니다.');
   history.go(-1);
   </script>";
    exit;
    }
}

function auto_link($str)
{
$str=eregi_replace("[-_a-z0-9]+(\.[-_a-z0-9]+)*@[-a-z0-9]+(\.[-a-z0-9]+)+", "<a href='mailto:\\0' target=_blank>\\0</a>",$str);
$str=eregi_replace ("(http|mms|ftp|telnet)://[-a-z0-9]+(\.[-a-z0-9]+)*(/[^\\\*\"\<\>\| &]+(\.[^\\\*\"\<\>\| &]+)?)*/?", "<a href='\\0' target=_blank>\\0</a>",$str);
//$str=eregi_replace ("(http|mms|ftp|telnet)://[-a-z0-9]+(\.[-a-z0-9]+)*(/([^ >]+)*)*/?", "<a href='\\0' target=_blank>\\0</a>",$str);
return $str;
}

function auto_link1($text) 
{

#******* www
$text = eregi_replace("([^/])www([0-9a-zA-Z./@~?&=_]+)","\\1http://www\\2", $text);
#******* http 
$text = eregi_replace("http://([0-9a-zA-Z./@~?&=_]+)", "<a href=\"http://\\1\" target='_blank'>http://\\1</a>", $text);
#******* ftp
$text = eregi_replace("ftp://([0-9a-zA-Z./@~?&=_]+)", "<a href=\"ftp://\\1\" target='_blank'>ftp://\\1</a>", $text);
#******* email
$text = eregi_replace("([_0-9a-zA-Z-]+(\.[_0-9a-zA-Z-]+)*)@([0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)", "<a href=\"mailto:\\1@\\3\">\\1@\\3</a>", $text);
return $text; 
/*
// URL 치환
$homepage_pattern = "/([^\"\=\>])(mms|http|HTTP|ftp|FTP|telnet|TELNET)\:\/\/(.[^ \n\<\"]+)/";
$text = preg_replace($homepage_pattern,"\\1<a href='\\2://\\3' target='_blank'>\\2://\\3</a>", " ".$text);

// 메일 치환
$email_pattern = "/([ \n]+)([a-z0-9\_\-\.]+)@([a-z0-9\_\-\.]+)/";
$text = preg_replace($email_pattern,"\\1<a href=mailto:\\2@\\3>\\2@\\3</a>", " ".$text);

return $text;
*/
}

function ArraytoSelect($ArrayName, $correspondvalue,$flag){
	reset($ArrayName);
	while(list($key, $value) = each($ArrayName)):
		switch($flag){
			case(1):
				if($correspondvalue == $key) $selected = "selected";
				else unset($selected);
				echo "<OPTION VALUE='".$key."' ".$selected.">".$value."</OPTION>\n";
			break;
			case(2):
				if($correspondvalue == $value) $selected = "selected";
				else unset($selected);
				echo "<OPTION VALUE='".$value."' ".$selected.">".$value."</OPTION>\n";
			break;
			case(3):
				if($correspondvalue == $key) $selected = "selected";
				else unset($selected);
				echo "<OPTION VALUE='".$key."' ".$selected.">".$key."</OPTION>\n";
			break;
			default:
				if($correspondvalue == $key) $selected = "selected";
				else unset($selected);
				echo "<OPTION VALUE='".$key."' ".$selected.">".$value."</OPTION>\n";
			break;
		}
	endwhile;
}

function TableList($board_table,$board_ban){
global $MYSQL_DB;
$result = @mysql_list_tables ("$MYSQL_DB");
//$result = @mysql_list_tables ("shopwizdb");
$i=0;
$j=0;

if($board_ban)
{
$board_ban=explode(",",trim($board_ban));
}



while ($i < @mysql_num_rows ($result)) {
$tb_names[$i] = @mysql_tablename ($result, $i);

if($board_ban)
{
unset($is_not_board);
	for($x=0;$x<sizeof($board_ban);$x++)
	{
		if(eregi("$board_ban[$x]",$tb_names[$i]))
		{
		$is_not_board=1;
		}
	}
}

if(eregi("$board_table",$tb_names[$i]) && !$is_not_board)
{
$tb_names[$i] = str_replace( "$board_table", "",$tb_names[$i] ); 
$tables[$j] = $tb_names[$i];
$j++;
}
$i++;
}
return $tables;
}

function strCutting( $LONG_STR, $CUTTING_LEN, $ABBREVIATE)
{
    $LONG_STR  = trim( $LONG_STR ); 
    for( $i=0 ; $i < $CUTTING_LEN ; $i++ ){ 
        if( ord( $LONG_STR[$i] ) >= 128 )
        {
            $KOR++;
        } 
        else
        {
            $ENG++;
        } 
    } 
    if( strlen( $LONG_STR ) > $CUTTING_LEN ){ 
        if( $KOR % 2 == 1 )
        { 
            $CUTTING_LEN = $CUTTING_LEN - 1; 
        } 
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "${SHORT_STR}${ABBREVIATE}"; 
    }
    else {
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "$SHORT_STR"; 
    }
}


function STR_CUTTING( $LONG_STR , $CUTTING_LEN )
{
    $LONG_STR  = trim( $LONG_STR ); 
    for( $i=0 ; $i < $CUTTING_LEN ; $i++ ){ 
        if( ord( $LONG_STR[$i] ) >= 128 )
        {
            $KOR++;
        } 
        else
        {
            $ENG++;
        } 
    } 
    if( strlen( $LONG_STR ) > $CUTTING_LEN ){ 
        if( $KOR % 2 == 1 )
        { 
            $CUTTING_LEN = $CUTTING_LEN - 1; 
        } 
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "$SHORT_STR..."; 
    }
    else {
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "$SHORT_STR"; 
    }
}

function STR_CUTTING1( $LONG_STR , $CUTTING_LEN )
{
    $LONG_STR  = trim( $LONG_STR ); 
    for( $i=0 ; $i < $CUTTING_LEN ; $i++ ){ 
        if( ord( $LONG_STR[$i] ) >= 128 )
        {
            $KOR++;
        } 
        else
        {
            $ENG++;
        } 
    } 
    if( strlen( $LONG_STR ) > $CUTTING_LEN ){ 
        if( $KOR % 2 == 1 )
        { 
            $CUTTING_LEN = $CUTTING_LEN - 1; 
        } 
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "$SHORT_STR"; 
    }
    else {
        $SHORT_STR = substr( $LONG_STR , 0 , $CUTTING_LEN ); 
        return "$SHORT_STR"; 
    }
}

function OptionValueFnc($Option1, $AddPriceOption){
	if($Option1 && eregi("=", $Option1)){//옵션1이 있고 가격이 별도 이면 가격별도 or 가격추가를 이곳에서 정한다.
		if($AddPriceOption == 2){ # 1: 가격추가 2: 가격별도
			$splitArr = split("=", $Option1);
			$splitArr[1] = ereg_replace(",", "", $splitArr[1]);
			if(intval($splitArr[1])) $GoodsPrice = $splitArr[1];
			
			$OptionValue[0] = $GoodsPrice;
			$OptionValue[1] = $splitArr[0];
			return $OptionValue;
		}
	}
}

function koreaWeek($no){
	switch ($no) {
		case ("0"):
			$week = "<font color='red'>일</font>";
			return $week;
		break;
		case ("1"):
			$week = "월";
			return $week;
		break;
		case ("2"):
			$week = "화";
			return $week;
		break;
		case ("3"):
			$week = "수";
			return $week;
		break;
		case ("4"):
			$week = "목";
			return $week;
		break;
		case ("5"):
			$week = "금";
			return $week;
		break;
		case ("6"):
			$week = "<font color='blue'>토</font>";
			return $week;
		break;													
	}
}

function ShowOptionIcon($ShopIconSkin, $RegOptionArr, $Option3){
	$ShowOptionIcon = "";
	$RegOptionRevArr = array_flip($RegOptionArr);
	
	$noimg = 0;
	$tmpkey = $RegOptionRevArr["미노출"];//옵션아이콘 미 노출
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $noimg = 1;
	
	$tmpkey = $RegOptionRevArr["추천상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1' && $noimg == 0) $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_recom.gif'>";
	
	$tmpkey = $RegOptionRevArr["신규상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_new.gif'>";
	
	$tmpkey = $RegOptionRevArr["인기상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_hot.gif'>";
	
	
	$tmpkey = $RegOptionRevArr["히트상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_hit.gif'>";
	
	$tmpkey = $RegOptionRevArr["베스트상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_recom.gif'>";
	
	$tmpkey = $RegOptionRevArr["스페셜상품"];
	$pos = $tmpkey*2;
	if(!is_null($tmpkey) && substr($Option3,$pos,1)== '1') $ShowOptionIcon .=" <img src='./skinwiz/common_icon/$ShopIconSkin/icon_best.gif'>";
	
	Return $ShowOptionIcon;	
}

function showFolderList($targetdir, $SelectName){
	$open_dir = opendir($targetdir);
	while($opendir = readdir($open_dir)) {
		if(($opendir != ".") && ($opendir != "..") && is_dir("$targetdir/$opendir")) {
			$selected = strcmp($SelectName,"$opendir")?"":"selected";
			echo "<option value=\"$opendir\" $selected>$opendir 스킨</option>\n";
		}
	}
	closedir($open_dir);
}

function showFileList($targetdir, $SelectName){
	$open_file = opendir($targetdir);
	$i=0;
	while($opendir = readdir($open_file)) {
		if(($opendir != ".") && ($opendir != "..") && is_file("$targetdir/$opendir")) {
			$fileArr[$i] = $opendir;
			$i++;
		}
	}
	closedir($open_file);
	
	asort ($fileArr);
	reset ($fileArr);
	while (list ($key, $val) = each ($fileArr)) {
		$selected = strcmp($SelectName,$val)?"":"selected";
		echo "<option value=\"$val\" $selected>$val </option>\n";
	}
}

function TrimImageSize($filepath, $size){
	if (is_file("$filepath")){
    $Pic_size = GetImageSize("$filepath");

	if($Pic_size[0] > $size ) $Pic_size[0] = $size;
	if($Pic_size[1] > $size ) $Pic_size[1] = $size;
	if($Pic_size[0] < $Pic_size[1]) $View_Pic_Size = "height=\"$Pic_size[1]\"";
	else $View_Pic_Size = "width=\"$Pic_size[0]\"";
	return $View_Pic_Size;

	}	
}


function getNavy($code){
	global $navy_path, $navy_title;
	$tmpcode = intval($code);
	if($tmpcode){
		$Sqlstr = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no='0000".substr($code, -2)."'";
		//echo $Sqlstr;
		$Sqlquery = mysql_query($Sqlstr);
		$big_name = mysql_result($Sqlquery, 0, 1);
		$FrontAhref = $code >= 100? "<a href='wizmart.php?code=0000".substr($code, -2)."'>":"";
		$BackAhref = $code >= 100? "</a>":"";
		
		$navy_path = " &gt; ".$FrontAhref.$big_name.$BackAhref;
		$navy_title = $big_name;
	}
	if($tmpcode >= 100){
		$Sqlstr = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no='00".substr($code, -4)."'";
		$Sqlquery = mysql_query($Sqlstr);
		$mid_name = mysql_result($Sqlquery, 0, 1);
		$FrontAhref = $code >= 10000 ? "<a href='wizmart.php?code=00".substr($code, -4)."'>":"";
		$BackAhref = $code >= 10000? "</a>":"";		
		$navy_path .= " &gt; ".$FrontAhref.$mid_name.$BackAhref;
		$navy_title = $mid_name;
	}
	if($tmpcode >= 10000){
		$Sqlstr = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no='$code'";
		$Sqlquery = mysql_query($Sqlstr);
		$small_name = mysql_result($Sqlquery, 0, 1);
		$navy_path .= " &gt; ".$small_name;
		$navy_title = $small_name;
	}	

}


/* 그달의 몇번째 주인지 구하는 함수 */
function weekOfMonth($timestamp, $year, $month, $day){
	if ($month == 0 || $year == 0 || $day == 0){
		if ($timestamp == 0) return 0;  // error
		else list($month, $year) = explode(',', date('m,Y', $timestamp));
	}else if ($month == 0 || $year == 0 || $day == 0){
		return 0;  // error
	}else{
		$timestamp = mktime(0, 0, 0, $month, $day, $year);
	}
	
	return date('W', $timestamp) - date('W', mktime(0, 0, 0, $month, 1, $year)) + 1;
}

function ViewMultiContents($attached,$bid,$gid,$width=null, $height=null){
	$UpdirPath = $gid."/".$bid;
	$attachedFile=split("\|",$attached);
#"gif","GIF","jpg","JPG","jpeg","JPEG","png","PNG"
	$viewExtention = ".jpg.jpeg.gif.bmp.png";
	$cnt=0;
	for($i=0; $i<count($attachedFile); $i++){
		$filepath = "./config/wizboard/table/$UpdirPath/updir/$attachedFile[$i]";
		$View_Pic_Size = TrimImageSize($filepath,$width);
		$extention = strtolower(strrchr($attachedFile[$i], "."));
		//echo "extention = $extention <br>";
		switch($extention){
			case ".jpg":
			case ".jpeg":
			case ".gif":
			case ".bmp":
			case ".png":
				$viewAttachedImg[$cnt] = "<img src='./config/wizboard/table/$UpdirPath/updir/$attachedFile[$i]' $View_Pic_Size> ";
				$cnt++;	
			break;
			case ".swf":
				$viewAttachedImg[$cnt] = "<embed src='./config/wizboard/table/$UpdirPath/updir/$attachedFile[$i]' > ";
				$cnt++;	
			break;
			case ".wav":
			case ".mp3":
				$viewAttachedImg[$cnt] = "<bgsound src='./config/wizboard/table/$UpdirPath/updir/$attachedFile[$i]'> ";
				$cnt++;	
			break;	
			case ".asf":
			case ".asx":
			case ".avi":
			case ".wmv":
			case ".wma":
				$viewAttachedImg[$cnt] = "<OBJECT ID='MPlay2' CLASSID='CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6' standby='Loading Windows Media Player components...' width='320' height='304'>
					<PARAM NAME='URL' VALUE='./config/wizboard/table/$UpdirPath/updir/$attachedFile[$i]'>
					<PARAM NAME='AutoStart' VALUE='True'>
					<PARAM NAME='UIMode' VALUE='full'>
					</OBJECT>";
				$cnt++;	
			break;						
		
		}

		
		
	}
	return $viewAttachedImg;
}

##보드관련 아이콘 함수
function showBoardIcon($flag=null, $flag1=null){
#flag : list, write, ....
#flag : null or 1 단순모드
	global $BID, $GID, $UID, $ICON_SKIN_TYPE, $category, $cp,$SEARCHTITLE,$searchkeyword,$adminmode,$optionmode,$NEXT_BOARD,$PRE_BOARD;
	
	switch($flag){
		case "list":
			if($flag1 == 1){
				$icon = "<img alt=\"목록\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/list_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&adminmode=$adminmode&optionmode=$optionmode&category=$category')\" style=\"cursor:hand\" onFocus=\"this.blur()\">";
			}else{
				$icon = "<img alt=\"목록\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/list_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&adminmode=$adminmode&optionmode=$optionmode&category=$category&cp=$cp&SEARCHTITLE=$SEARCHTITLE&searchkeyword=$searchkeyword')\" style=\"cursor:hand\" onFocus=\"this.blur()\">";
			}
			
		break;
		case "write":
			$icon = "<img alt=\"쓰기\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/write_btn.gif\" border=\"0\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&mode=write&adminmode=$adminmode&optionmode=$optionmode&category=$category')\" style=\"cursor:hand\" onFocus=\"this.blur()\">";
		break;	
		case "modify":
			$icon = "<img alt=\"수정\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/modify_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&category=$category&mode=modify&adminmode=$adminmode&optionmode=$optionmode&UID=$UID&cp=$cp')\" style=\"cursor:hand\" onFocus=\"this.blur()\"> ";
		break;	
		case "save":
			$icon = "<img src=\"./wizboard/icon/$ICON_SKIN_TYPE/save_btn.gif\" onClick=\"javascript:WRITE_FUNC()\" style=\"cursor:hand\" onFocus=\"this.blur()\">";
		break;
		case "reply":
			$icon = "<img alt=\"답변\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/reply_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&category=$category&mode=reply&adminmode=$adminmode&optionmode=$optionmode&UID=$UID&cp=$cp');\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;								
		case "cancel":
			$icon = "<img src=\"./wizboard/icon/$ICON_SKIN_TYPE/cancel_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&adminmode=$adminmode&optionmode=$optionmode&query=list&category=$category&cp=$cp')\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "delete":
			$icon = "<img alt=\"삭제\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/del_btn.gif\" onClick=\"javascript:DELETE_THIS('$UID','$cp','$BID','$GID','$adminmode','$optionmode');\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "new":
			$icon = "<img src='./wizboard/icon/${ICON_SKIN_TYPE}/new_btn.gif' onFocus=\"this.blur()\">";
		break;
		case "next":
			$icon = "<img alt=\"다음\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/next_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&category=$category&mode=view&adminmode=$adminmode&optionmode=$optionmode&UID=$NEXT_BOARD[0]&cp=$cp');\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "none_recomm":
			$icon = "";
		break;
		case "prev":
			$icon = "<img alt=\"이전\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/prev_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&category=$category&mode=view&adminmode=$adminmode&optionmode=$optionmode&UID=$PRE_BOARD[0]&cp=$cp');\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "print":
			$icon = "<img alt=\"프린트\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/print_btn.gif\" onClick=\"javascript:printThis()\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "re":
			$icon = "<img src='./wizboard/icon/${ICON_SKIN_TYPE}/re_btn.gif' align=absmiddle onFocus=\"this.blur()\">";
		break;
		case "recomm":
			$icon = "<img alt=\"추천\" src=\"./wizboard/icon/$ICON_SKIN_TYPE/recomm_btn.gif\" onClick=\"javascript:location.replace('$PHP_SELF?BID=$BID&GID=$GID&UID=$UID&mode=view&adminmode=$adminmode&optionmode=$optionmode&cp=$cp&RECOMMAND=OK');\" style=\"cursor:hand\"; onFocus=\"this.blur()\">";
		break;
		case "scrap":
			$icon = "";
		break;	
		case "search":
			$icon = "";
		break;	
		case "secrete":
			$icon = "";
		break;
		case "attached":
			$icon = "";
		break;
	}

	return $icon;
}


function PointInsert($id, $uid=null, $contents, $point, $flag=1, $mode="insert"){
	$wdate = time();
	if($mode == "delete"){
		$sqlstr = "delete from wizPoint where uid = '$uid'";
		$result = mysql_query($sqlstr);
		
		$sqlstr = "update wizMembers SET mpoint=mpoint - $point where mid = '$id'";
		$result = mysql_query($sqlstr);
	}else{
		$sqlstr = "insert into wizPoint (id, contents, point,flag,wdate) values ('$id','$contents','$point','$flag','$wdate')";
		$result = mysql_query($sqlstr);
		
		if($flag <> "0"){//포인트신청일경우
			$sqlstr = "update wizMembers SET mpoint=mpoint + $point where mid = '$id'";
			$result = mysql_query($sqlstr);
		}
	
	}
}

function koreansearch($key, $fieldname)
{
	switch($key)
	{
		case "ㄱ":
			$str = "and $fieldname RLIKE '^(ㄱ|ㄲ)' OR ($fieldname >= '가' AND $fieldname < '나') "; 
			break;
		case "ㄴ":
			$str = "and $fieldname RLIKE '^ㄴ' OR ($fieldname >= '나' AND $fieldname < '다') "; 
			break;
		case "ㄷ":
			$str = "and $fieldname RLIKE '^(ㄷ|ㄸ)' OR ($fieldname >= '다' AND $fieldname < '라') "; 
			break;
		case "ㄹ":
			$str = "and $fieldname RLIKE '^ㄹ' OR ($fieldname >= '라' AND $fieldname < '마') "; 
			break;
		case "ㅁ":
			$str = "and $fieldname RLIKE '^ㅁ' OR ($fieldname >= '마' AND $fieldname < '바') "; 
			break;
		case "ㅂ":
			$str = "and $fieldname RLIKE '^(ㅂ|ㅃ)' OR ($fieldname >= '바' AND $fieldname < '사') "; 
			break;
		case "ㅅ":
			$str = "and $fieldname RLIKE '^(ㅅ|ㅆ)' OR ($fieldname >= '사' AND $fieldname < '아') "; 
			break;
		case "ㅇ":
			$str = "and $fieldname RLIKE '^ㅇ' OR ($fieldname >= '아' AND $fieldname < '자') "; 
			break;
		case "ㅈ":
			$str = "and $fieldname RLIKE '^(ㅈ|ㅉ)' OR ($fieldname >= '자' AND $fieldname < '차') "; 
			break;
		case "ㅊ":
			$str = "and $fieldname RLIKE '^ㅊ' OR ($fieldname >= '차' AND $fieldname < '카') "; 
			break;
		case "ㅋ":
			$str = "and $fieldname RLIKE '^ㅋ' OR ($fieldname >= '카' AND $fieldname < '타') "; 
			break;
		case "ㅌ":
			$str = "and $fieldname RLIKE '^ㅌ' OR ($fieldname >= '타' AND $fieldname < '파') "; 
			break;
		case "ㅍ":
			$str = "and $fieldname RLIKE '^ㅍ' OR ($fieldname >= '파' AND $fieldname < '하') "; 
			break;
		case "ㅎ":
			$str = "and $fieldname RLIKE '^ㅎ' OR $fieldname >= '하' "; 
			break;
		case "eng":
			$str = "and ($fieldname LIKE 'A%' ";
			for($i=66; $i<=90; $i++)
			{
				$temp = chr($i);
				$str .= "OR $fieldname LIKE '$temp%' "; 
			}
			$str .= ") "; 
			break;
	}

	return $str;
} 

function getSelected($array, $selectvalue, $flag=1){
//flag : 1(key, value), 2(value, value), 3(key, key);
	foreach($array as $key=>$value){
		switch($flag){
			case "2":
				$key = $value;
			break;
			case "3":
				$value = $key;
			break;			
		}
		$selected = $selectvalue==$key?" selected":"";
		echo "<option value='".$key."'".$selected.">".$value."</option>\n";
	
	}

}

function PaySelect($showBox, $EnablePay="", $EnableMoney=0, $TotalMoney=0, $Point=0, $Boxtype=1){
	switch ($showBox){
		case "online":
			echo "<input name='check' type='radio' value='online'><strong>무통장 입금 </strong>\n";
		break;
		case "card":
			if($EnablePay && $EnableMoney <= $TotalMoney){
				echo "<input name='check' type='radio' value='card'><strong>신용카드</strong>\n";
			}else{
				echo "<input name='check' type='radio' value='' onclick=\"javascript:window.alert('신용카드구매는 구매액이 ".number_format($EnableMoney)."원 이상만 가능합니다.'); this.checked = false; document.PaySelectForm.check[0].checked = true; document.PaySelectForm.check[0].focus()\"><strong>신용카드</strong>\n";
			}
		break;
		case "hand":
			if($EnablePay && $EnableMoney <= $TotalMoney){
				echo "<input name='check' type='radio' value='hand'><strong>핸드폰 결제</strong>\n";
			}else{
				echo "<input name='check' type='radio' value='' onclick=\"javascript:window.alert('핸드폰구매는 구매액이 ".number_format($EnableMoney)."원 이상만 가능합니다.'); this.checked = false; document.PaySelectForm.check[0].checked = true; document.PaySelectForm.check[0].focus()\"><strong>핸드폰 결제</strong>\n";
			}
		break;		
		case "autobank":
			echo "<input name='check' type='radio' value='autobank'><strong>계좌이체</strong>\n";
		break;
		case "hand":
			if($EnablePay && $EnableMoney <= $TotalMoney){
				echo "<input name='check' type='radio' value='all'><strong>다중구매</strong>\n";
			}else{
				echo "<input name='check' type='radio' value='' onclick=\"javascript:window.alert('다중구매는 구매액이 ".number_format($EnableMoney)."원 이상만 가능합니다.'); this.checked = false; document.PaySelectForm.check[0].checked = true; document.PaySelectForm.check[0].focus()\"><strong>다중구매</strong>\n";
			}
		break;
	}

}

function getGender($jumin2){
	$gender = substr($jumin2, 0, 1);
	return $gender;
}

function getUserTerm($id, $flag=0){
	$sqlstr = "select mvaliddate from wizMembers where mid = '$id'";
	$sqlqry = mysql_query($sqlstr);
	$list = mysql_fetch_array($sqlqry);
	if($list["mvaliddate"] >= time()) return true;
	else return false;
}

function delLogFile($logdir, $time=7200){
	//echo $logdir;
	$LOG_DIR = opendir($logdir);
	while($LOG_FILE = readdir($LOG_DIR)) {
		if($LOG_FILE !="." && $LOG_FILE !=".."){
			$logpath = $logdir."/".$LOG_FILE;
			if(is_file($logpath) && mktime() - filemtime($logpath) > $time) {
				unlink($logpath);
			}
		} //if($LOG_FILE !="." && $LOG_FILE !="..") 닫음
	}

}

function SaveViewItem($no, $cookie_img, $cookie_cat, $path=NULL){//오늘본 제품을 세션에 담는다.
	$logdir = $path."config/wizmember_tmp/view_product";
	$view_file = $logdir."/".session_id().".php";
	delLogFile($logdir);
	//readdir($logdir);
	if (is_file($view_file)){
		include $view_file;
		$cnt = sizeof($TODAY_PRODUCT[uid]);
		if (in_array ("$no", $TODAY_PRODUCT[uid])) {//값이 존재하면 현재 존재하는 값은 삭제한다.(최근에 본 내역으로 솔팅하기 위해);
			$keyvalue = array_search($no,$TODAY_PRODUCT[uid]);
			if(!is_null($keyvalue)){						
				$TODAY_PRODUCT[uid][$keyvalue] = "";
				$TODAY_PRODUCT[img][$keyvalue] = "";
				$TODAY_PRODUCT["category"][$keyvalue] = "";	
			}
		}
			$TODAY_PRODUCT[uid][] = $no;
			$TODAY_PRODUCT[img][] = $cookie_img;	
			$TODAY_PRODUCT["category"][] = "$cookie_cat";
			reset($TODAY_PRODUCT);
			$view_file_list = "<?\n";
			foreach($TODAY_PRODUCT[uid] as $key => $value){
				if($value){
					$view_file_list .= "\$TODAY_PRODUCT[\"uid\"][$key] = \"$value\";\n";
					$view_file_list .= "\$TODAY_PRODUCT[\"img\"][$key] = \"".$TODAY_PRODUCT[img][$key]."\";\n";
					$view_file_list .= "\$TODAY_PRODUCT[\"category\"][$key] = \"".$TODAY_PRODUCT[category][$key]."\";\n";
				}
			}
			$view_file_list .= "?>";
			$fp = fopen($view_file, "w");
			fwrite($fp, $view_file_list);
			fclose($fp);
	}else{
		$fp = fopen($view_file, "w");
		$view_file_list = "<?
\$TODAY_PRODUCT[\"uid\"][0] = \"$no\";
\$TODAY_PRODUCT[\"img\"][0] = \"$cookie_img\";
\$TODAY_PRODUCT[\"category\"][0] = \"$cookie_cat\";
?>";
		fwrite($fp, $view_file_list);
		fclose($fp);
	}
	
}

function dberror($str){
	die(mysql_error()."<br>".$str);
}

function my_filesize($filepath) {
	// 파일 존재유무 책크
	if(is_file($filepath)){
		// 일반적인 파일 사이즈 단위를 설정한다.
		$kb = 1024;         // Kilobyte
		$mb = 1024 * $kb;   // Megabyte
		$gb = 1024 * $mb;   // Gigabyte
		$tb = 1024 * $gb;   // Terabyte
		// byte단위의 파일을 가져온다.
		$size = filesize("$filepath");
		/* 만약 파일이 kb(키로바이트)보다 적으면 그 값을 그대로 리턴하고 아니면 적당한 파일단위를 붙인다.*/
		if($size < $kb) {
			return $size." B";
		}else if($size < $mb) {
			return round($size/$kb,2)." KB";
		}else if($size < $gb) {
			return round($size/$mb,2)." MB";
		}else if($size < $tb) {
			return round($size/$gb,2)." GB";
		}else {
			return round($size/$tb,2)." TB";
		}
	}   
}
?>