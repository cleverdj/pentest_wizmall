<?
/* 
제작자 : 폰돌
제작자 URL : http://www.shop-wiz.com
제작자 Email : master@shop-wiz.com
Free Distributer 
- http://www.shop-wiz.com
*** Updating List ***
*/

include "../lib/cfg.common.php";

include "../config/db_info.php";
include "../lib/class.database.php";
$dbcon		= new database($cfg["sql"]);

include "../lib/class.common.php";
$common		= new common();
include "../config/common_array.php";


include("./admin_check.php");
?>
<?
if ($query == 'update') {    
	foreach($Newcatname as $key => $value){
		$sqlstr = "update wizTable_Category set catname = '$value' where uid = '$key'";
		$dbcon->_query($sqlstr);	
	}
}else if ($query == 'insert') {
	$sqlstr = "select max(ordernum) maxnum from wizTable_Category where bid='$BID' and gid = '$GID'";
	$maxnum = $dbcon->get_one($sqlstr);
	$maxnum = $maxnum ? $maxnum+1:1;
	
	$sqlstr = "insert into wizTable_Category (bid, gid, ordernum, catname) values ('$BID', '$GID', '$maxnum', '$catname')";
	$dbcon->_query($sqlstr);
}else if ($query == 'delete') {
	$TableName = "wizTable_".$GID."_".$BID;
	//현재 카테고리의 카테고리 번호를 구해서 모두 0으로 치환한다.
	$sqlstr = "select ordernum from wizTable_Category where uid = $uid";
	$ordernum = $dbcon->get_one($sqlstr);
	
	$sqlstr = "update $TableName set BID = '0' where BID = 'ordernum'";
	$dbcon->_query($sqlstr);
	
	$sqlstr = "delete from wizTable_Category where uid = $uid";
	$dbcon->_query($sqlstr);
}else if ($query == 'move') {
	$TableName = "wizTable_".$GID."_".$BID;
	foreach($Newcatname as $key => $value){
		if($value){
			$sqlstr = "update from $TableName set BID = '$value' where BID = '$key'";
			$dbcon->_query($sqlstr);
		}
	}
}else if($query=="OptionPageChange"){
	include ("./configwrite.php");
} 
include "../config/wizboard/table/$GID/$BID/config.php";

include "./admin_pop_top.php";
?>
<table class="table_pop_layout">
  <tr>
    <td><table width="600" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#B9C2CC"><a href="./admin1.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">&nbsp;LayOut</font></a> | <a href="./admin2.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">ListPage</font></a> | <a href="./admin3.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">ViewPage</font></a> | <a href="./admin4.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">WritePage</font></a> | <a href="./admin5.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFF00">Option</font></a> </td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF"><table class="table_pop_main">
        <form action="<?=$PHP_SELF?>" method="POST" name="BasicInfo">
          <input type="hidden" name="query" value="OptionPageChange">
          <input type="hidden" name="BID" value="<?=$BID;?>">
          <input type="hidden" name="GID" value="<?=$GID;?>">
<?  
$nodp = array("ListForMember","ReadForMember","WriteForMember","DownForMember","UpLoadingOverWriteEnable","CategoryEnable","WritingPointEnable");

		  foreach($cfg["wizboard"] as $key=>$value)  
		  if (!in_array($key, $nodp)) 
		  echo "<input type='hidden' name='".$key."' value='".$value."'>\n"; 
		  ?>  
          <tr>
            <td height="30" colspan="4" bgcolor="E0E4E8">회원관련(일부 스킨만 적용가능, 1~10등급가능,
              WizMember와 호환)</td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%">회원전용(읽기)
              <input name="ReadForMember" type="checkbox" id="ReadForMember" value="checked" <?=$cfg["wizboard"]["ReadForMember"]?>></td>
            <td colspan="3" bgcolor="#FFFFFF"><select name="ReadMemberGrade">
                <?
	$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["ReadMemberGrade"]);
?>
              </select>
<?
$selArr1 = array("over"=>"이상","less"=>"이하","only"=>"만");
$common->mkselectmenu("ReadMemberGradeBoundary", $selArr1, $cfg["wizboard"]["ReadMemberGradeBoundary"]);
?> 

<?
$selArr2 = array(""=>"성별선택","1"=>"남성전용","2"=>"여성전용");
$common->mkselectmenu("ReadMemberGenderBoundary", $selArr2, $cfg["wizboard"]["ReadMemberGenderBoundary"]);
?>              

            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%">회원전용(쓰기)
              <input name="WriteForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["WriteForMember"]?>></td>
            <td colspan="3" bgcolor="#FFFFFF"><select name="WriteMemberGrade">
<?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["WriteMemberGrade"]);
?>
              </select> 
            <?
$common->mkselectmenu("WriteMemberGradeBoundary", $selArr1, $cfg["wizboard"]["WriteMemberGradeBoundary"]);
?>
            <?
$common->mkselectmenu("WriteMemberGenderBoundary", $selArr2, $cfg["wizboard"]["WriteMemberGenderBoundary"]);
?></td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%">회원전용(다운)
              <input name="DownForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["DownForMember"]?>>
            </td>
            <td colspan="3" bgcolor="#FFFFFF"><select name="DownMemberGrade">
<?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["DownMemberGrade"]);
?>
              </select>
              <?
$common->mkselectmenu("DownMemberGradeBoundary", $selArr1, $cfg["wizboard"]["DownMemberGradeBoundary"]);
?>
            <?
$common->mkselectmenu("DownMemberGenderBoundary", $selArr2, $cfg["wizboard"]["DownMemberGenderBoundary"]);
?></td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%">회원전용(리스트)
              <input name="ListForMember" type="checkbox" value="checked" <?=$cfg["wizboard"]["ListForMember"]?>></td>
            <td colspan="3" bgcolor="#FFFFFF"><select name="ListMemberGrade">
<?
$common->getSelectfromFielArray($gradetostr_info, $cfg["wizboard"]["ListMemberGrade"]);
?>
              </select>
              <?
$common->mkselectmenu("ListMemberGradeBoundary", $selArr1, $cfg["wizboard"]["ListMemberGradeBoundary"]);
?>
            <?
$common->mkselectmenu("ListMemberGenderBoundary", $selArr2, $cfg["wizboard"]["ListMemberGenderBoundary"]);
?></td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%"> 작성시 포인트연동
              <input name="WritingPointEnable" type="checkbox" id="WritingPointEnable" value="checked" <?=$cfg["wizboard"]["WritingPointEnable"]?>></td>
            <td bgcolor="#FFFFFF" width="25%"><input type="text" name="WritingPoint" size="10" value="<?=$cfg["wizboard"]["WritingPoint"]?>">
              포인트 </td>
            <td width="26%" align="center" bgcolor="E0E4E8">동일파일 덮어씌움
              <input name="UpLoadingOverWriteEnable" type="checkbox" id="UpLoadingOverWriteEnable" value="checked" <?=$cfg["wizboard"]["UpLoadingOverWriteEnable"]?>>
              <a href="#" onClick="window.open('http://shop-wiz.com/wizmanual.php?BID=manual&mode=view&UID=3&cp=1&BOARD_NO=2&SEARCHTITLE=&searchkeyword=&category=1','OnlineManual','width=500, height=400,scrollbars=yes,resizable=yes')";><img src="images/help.gif" width="15" height="9" border="0"></a></td>
            <td bgcolor="#FFFFFF" width="24%">&nbsp;</td>
          </tr>
          <tr>
            <td colspan="4" bgcolor="E0E4E8">파일업로딩 금지 확장자 설정하기(","로 나열)<a href="#" onClick="window.open('http://shop-wiz.com/wizmanual.php?BID=manual&mode=view&UID=1&cp=1&BOARD_NO=1&SEARCHTITLE=&searchkeyword=&category=1','OnlineManual','width=500, height=400,scrollbars=yes,resizable=yes')";><img src="images/help.gif" width="20" height="9" border="0"></a></td>
          </tr>
          <tr align="center">
            <td colspan="4" bgcolor="#FFFFFF"><textarea name="ProhibitExtention" style="width:98%;"><?=$cfg["wizboard"]["ProhibitExtention"]?>
</textarea></td>
          </tr>
          <tr>
            <td colspan="4" bgcolor="E0E4E8">카테고리사용
              <input name="CategoryEnable" type="checkbox" value="checked" <?=$cfg["wizboard"]["CategoryEnable"]?>>
              (동일테이브로 옵션선택 - 링크방법은 wizboard.php?BID=보드아이디&amp;category=카테고리번호)</td>
          </tr>
          <tr>
            <td colspan="4" bgcolor="E0E4E8">표시형식 :
              <input type="radio" name="CategoryType" value="radio" <? if($cfg["wizboard"]["CategoryType"] == "radio") echo "checked";?>>
              라디오버튼
              <input type="radio" name="CategoryType" value="select" <? if($cfg["wizboard"]["CategoryType"] == "select") echo "checked";?>>
              실렉트버튼</td>
          </tr>
          <tr>
            <td colspan="4" bgcolor="#FFFFFF"><?
$catstr = "select ordernum, catname, uid from wizTable_Category where gid = '$GID' and bid = '$BID' order by ordernum asc";
$catqry = $dbcon->_query($catstr);
$TotalCount = $dbcon->_num_rows($catqry);
?>
          <tr>
            <td height="25" colspan="4" bgcolor="#FFFFFF"><table border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td>전체 <font color="#b02832"><? echo number_format($TotalCount);?></font> 개
                    카테고리 </td>
                  <td>&nbsp;</td>
                  <td style="color: #1e87b2">카테고리명 :
                    <input name="catname" type="text" class="input"  size="18"></td>
                  <td>&nbsp;</td>
                  <td><button name="btn" onClick="CategoryManager('insert');" title="등록">등록</button></td>
                </tr>
              </table></td>
          </tr>
          <tr>
            <td colspan="4" bgcolor="#FFFFFF"><table class="table_pop_main">
                <tr align="center" bgcolor="F7F7ED">
                  <td width="50">선택</td>
                  <td width="50">번호</td>
                  <td>카테고리명</td>
                  <td>게시물의 <br>
                    카테고리이동</td>
                  <td width="80">삭제</td>
                </tr>
                <?

$cnt=0;
while($catlist = $dbcon->_fetch_array($catqry)):
?>
                <tr align="center" bgcolor="F7F7F7">
                  <td><input name="MultiSelect[<?=$catlist["uid"]?>]" type="checkbox" value="<?=$catlist["uid"]?>"></td>
                  <td><?=$catlist["ordernum"]?></td>
                  <td><input type="text" name="Newcatname[<?=$catlist["uid"]?>]" size="10" value="<?=$catlist["catname"]?>" style="width:100%"></td>
                  <td><table border="0" cellspacing="0" cellpadding="0">
                      <tr>
                        <td><select name="Movecatname[<?=$catlist["ordernum"]?>]">
                            <option value="0">전체</option>
                            <?	
$subcatstr = "select ordernum, catname, uid from wizTable_Category where gid = '$GID' and bid = '$BID' order by ordernum asc";
$dbcon->_query($subcatstr);
while($subcatlist = $dbcon->get_rows()):
$selected = $subcatlist["ordernum"] == $catlist["ordernum"]?"selected":"";
$selectvalue = $subcatlist["ordernum"] == $catlist["ordernum"]?"":$subcatlist["ordernum"];
echo "<option value='".$selectvalue."' $selected>".$subcatlist["catname"]."</option>\n";
endwhile;
?>
                          </select>
                          로 게시물 </td>
                        <td width="5">&nbsp;</td>
                        <td><button name="btn" onClick="CategoryManager('move','<?=$catlist["uid"]?>');" title="이동">이동</button></td>
                      </tr>
                    </table></td>
                  <td><? if($cnt <> 0):?>
                    <button name="btn" onClick="CategoryManager('delete','<?=$catlist["uid"]?>');" title="삭제">삭제</button>
                    <? endif; ?></td>
                </tr>
                <?
$cnt++;
endwhile;
if(!$cnt){
?>
                <tr align="center" bgcolor="F7F7F7">
                  <td colspan="5">등록된 카테고리가 없습니다. </td>
                </tr>
                <?
}
?>
                <tr align="center" bgcolor="F7F7F7">
                  <td colspan="3"><button name="btn" onClick="CategoryManager('update');" title="카테고리명수정">카테고리명수정</button></td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                </tr>
            </table></td>
          </tr>
          <tr>
            <td height="35" colspan="9" bgcolor="#FFFFFF"></td>
          </tr>
          <tr>
            <td height="38" colspan="9" bgcolor="#FFFFFF"><input type="hidden" name="BID2" value="<?=$BID?>">
              <input type="hidden" name="GID2" value="<?=$GID?>">
              <input type="button" name="Button" value="수정" onClick="javascript:submit()"; style="cursor:pointer;">
              <input type="button" name="Submit" value="닫기" onClick="javascript:window.close()"; style="cursor:pointer;"></td>
          </tr>
        </form>
      </table></td>
  </tr>
</table>
<?
include "./admin_pop_bottom.php";
?>