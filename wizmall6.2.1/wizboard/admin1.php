<?
/* 
제작자 : 폰돌
제작자 URL : http://www.shop-wiz.com
제작자 Email : master@shop-wiz.com
Free Distributer 

*** Updating List ***
*/
include "../lib/cfg.common.php";
include "../config/db_info.php";

include "../lib/class.database.php";
$dbcon		= new database($cfg["sql"]);

include "../lib/class.common.php";
$common = new common();

include("./admin_check.php");
?>
<?
function readdirsort($dirpath, $samevalue){ /* $dirpath에 있는 파일들을 읽어 오는 함수*/
	$open_dir = opendir("./$dirpath");
		$i=0;
		while($opendir = readdir($open_dir)){
		$FileArr[$i] = $opendir;
		$i++;
		}
		asort ($FileArr);
		reset ($FileArr);
		while (list ($key, $val) = each ($FileArr)) {
			if(($val != ".") && ($val != "..")){
				if($samevalue == $val){
				echo "<option value=\"".$val."\" selected>".$val."스킨</option>\n";
				}
				else{
				echo "<option value=\"".$val."\">".$val."스킨</option>\n";
				}			
			}
		}
	closedir($open_dir);
}


/******************** 가져오기 실행 **********************************/
if(!strcmp($mode,"OverWrite") && strcmp($CONFIRM,"OK")){
    ECHO"<script>
    con =  confirm(\"가져오시기를 할경우 현재 테이블의 모든 속성이 변경됩니다. \\n 가져오시겠습니까?\");
        if (con==true){
        location.href='$PHP_SELF?mode=$mode&BID=$BID&GID=$GID&LayOutType=$LayOutType&CONFIRM=OK';
        }else{location.href='$PHP_SELF?BID=$BID&GID=$GID';}
    </script>";
}elseif(!strcmp($mode,"OverWrite") && !strcmp($CONFIRM,"OK")){
	copy("../config/wizboard/table/$GID/$LayOutType/top.php","../config/wizboard/table/$GID/$BID/top.php"); 
	copy("../config/wizboard/table/$GID/$LayOutType/bottom.php","../config/wizboard/table/$GID/$BID/bottom.php"); 
	copy("../config/wizboard/table/$GID/$LayOutType/config.php","../config/wizboard/table/$GID/$BID/config.php"); 
}
  
if(!strcmp($mode, "writeit")):
	include ("./configwrite.php");
	/**** 두번째 ***************/
	//$STRING=addslashes($TableTop);
	$STRING = $TableTop;
	$fp = fopen("../config/wizboard/table/$GID/$BID/top.php", "w"); 
	$STRING=stripslashes($STRING);
	fwrite($fp, "$STRING"); 
	fclose($fp);
	/**** 세번째 ***************/
	//$STRING=addslashes($TableBottom);
	$STRING = $TableBottom;
	$fp = fopen("../config/wizboard/table/$GID/$BID/bottom.php", "w"); 
	$STRING=stripslashes($STRING);
	fwrite($fp, "$STRING"); 
	fclose($fp);
	$common->js_location("$PHP_SELF?BID=$BID&GID=$GID");
endif;

include "../config/wizboard/table/$GID/$BID/config.php";

include "./admin_pop_top.php";
?>
<table class="table_pop_layout">
  <tr>
    <td><table width="600" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#B9C2CC"><a href="./admin1.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFF99">&nbsp;<font color="#FFFF00">LayOut</font></font></a><font color="#FFFF99">&nbsp; </font>| <a href="./admin2.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">ListPage</font></a> | <a href="./admin3.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">ViewPage</font></a> | <a href="./admin4.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">WritePage</font></a> | <a href="./admin5.php?BID=<?=$BID?>&GID=<?=$GID?>"><font color="#FFFFFF">Option</font></a> </td>
          <td bgcolor="#B9C2CC"><a href="#" onClick="window.open('http://shop-wiz.com/wizmanual.php?BID=manual&mode=view&UID=5&cp=1&BOARD_NO=2&SEARCHTITLE=&searchkeyword=&category=1','OnlineManual','width=500, height=400,scrollbars=yes,resizable=yes')";><img src="images/help.gif" width="15" height="9" border="0"></a></td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF"><table class="table_pop_main">
        <form action="<?=$PHP_SELF?>" method="POST">
          <input type="hidden" name="mode" value="OverWrite">
          <input type="hidden" name="BID" value="<?=$BID?>">
          <input type="hidden" name="GID" value="<?=$GID?>">
          <tr>
            <td bgcolor="E0E4E8" width="29%">LayOut 가져오기</td>
            <td bgcolor="#FFFFFF" width="71%"><select name="LayOutType">
                <?
$open_dir = opendir("../config/wizboard/table/$GID");
	$i=0;
	while($opendir = readdir($open_dir)){
	$FileArr[$i] = $opendir;
	$i++;
	}
	asort ($FileArr);
	reset ($FileArr);
	while (list ($key, $val) = each ($FileArr)) {
		if(($val != ".") && ($val != "..")){
		echo "<option value=\"".$val."\">".$val." 레이아웃</option>\n";
		
		}
	}
closedir($open_dir);
?>
              </select>
              <input type="submit" name="Submit3" value="가져오기">
            </td>
          </tr>
        </form>
        <tr bgcolor="#FFFFFF">
          <td colspan="2">&nbsp;</td>
        </tr>
      </table></td>
  </tr>
  <form action="<?=$PHP_SELF?>" method="POST" name="BasicInfo">
    <input type="hidden" name="mode" value="writeit">
    <input type="hidden" name="BID" value="<?=$BID?>">
    <input type="hidden" name="GID" value="<?=$GID?>">
<?  foreach($cfg["wizboard"] as $key=>$value)  echo "<input type='hidden' name='".$key."' value='".$value."'>\n"; ?>      
    <tr>
      <td bgcolor="#FFFFFF"><table class="table_pop_main">
          <tr>
            <td bgcolor="E0E4E8" width="29%">동일 DB사용하기</td>
            <td bgcolor="#FFFFFF" width="71%">
              <select name="SameDB">
                <option value="">선택하기</option>
                <?
$sqlstr = "select BID from wizTable_Main where BID is not null and BID <> '' order by BID asc";	
$dbcon->_query($sqlstr);			
while($slist = $dbcon->get_rows()):
	$selected = $cfg["wizboard"]["SameDB"] == $slist["BID"] ? "selected":"";
	echo "<option value='".$slist[BID]."' $selected>".$slist["BID"]." 보드</option>\n";
endwhile;	
?>
              </select>
              동일한 DB에서 데이타를 가져온다.</td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%">확장 DB사용하기
              <input type="checkbox" name="ExtendDBUse" value="checked" <?=$cfg["wizboard"]["ExtendDBUse"]?>></td>
            <td bgcolor="#FFFFFF" width="71%"><input name="ExtendDB" type="text" size="20" value="<?=$cfg["wizboard"]["ExtendDB"]?>">
              <br>
              확장 DB(현재 wizboard외의 DB를 wizBoard DB처럼 사용코져 할때).</td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%"><font color="#FF0000">아이콘 스킨타입</font></td>
            <td bgcolor="#FFFFFF" width="71%"><select name="ICON_SKIN_TYPE">
                <?
readdirsort("./icon",$cfg["wizboard"]["ICON_SKIN_TYPE"]);
?>
              </select>
            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%"><font color="#FF0000">보드 스킨타입</font></td>
            <td bgcolor="#FFFFFF" width="71%"><select name="BOARD_SKIN_TYPE">
                <?
readdirsort("./skin",$cfg["wizboard"]["BOARD_SKIN_TYPE"]);
?>
              </select>
            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%"><font color="#FF0000">페이지표시 스킨타입</font></td>
            <td bgcolor="#FFFFFF" width="71%"><select name="BOTTOM_SKIN_TYPE">
                <?
readdirsort("./skin_btnm",$cfg["wizboard"]["BOTTOM_SKIN_TYPE"]);
?>
              </select>
            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%">코멘트 스킨타입</td>
            <td bgcolor="#FFFFFF" width="71%"><select name="REPLE_SKIN_TYPE">
                <? readdirsort("./skin_reple",$cfg["wizboard"]["REPLE_SKIN_TYPE"]); ?>
              </select>
            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%"><font color="#FF0000">테이블폭(WIDTH)</font></td>
            <td bgcolor="#FFFFFF" width="71%"><input type="text" name="TABLE_WIDTH_NO" value="<?=ereg_replace("%","",$cfg["wizboard"]["TABLE_WIDTH"])?>" size="5" maxlength="5">
              <select name="TABLE_WIDTH_UNIT">
                <option value="%" <? if(ereg("%",$cfg["wizboard"]["TABLE_WIDTH"])) ECHO"selected";?>>%</option>
                <option value="" <? if(!ereg("%",$cfg["wizboard"]["TABLE_WIDTH"])) ECHO"selected";?>>pixels</option>
              </select>
              (테이블 폭은 px로 잡아 주는 것이  좋습니다.)           </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%"><font color="#FF0000">테이블 정렬(ALIGN)</font></td>
            <td bgcolor="#FFFFFF" width="71%"><select name="TABLE_ALIGN">
                <option value="default" <? if(!strcmp($cfg["wizboard"]["TABLE_ALIGN"],"default")) ECHO"selected";?>>Default</option>
                <option value="left" <? if(!strcmp($cfg["wizboard"]["TABLE_ALIGN"],"left")) ECHO"selected";?>>Left</option>
                <option value="right" <? if(!strcmp($cfg["wizboard"]["TABLE_ALIGN"],"right")) ECHO"selected";?>>Right</option>
                <option value="center" <? if(!strcmp($cfg["wizboard"]["TABLE_ALIGN"],"center")) ECHO"selected";?>>Center</option>
              </select>
            </td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%">파일첨부갯수</td>
            <td bgcolor="#FFFFFF" width="71%">
              <select name="ATTACHEDCOUNT">
                <?
for($i=0; $i<=10; $i++){
$selected = $cfg["wizboard"]["ATTACHEDCOUNT"] == $i?"selected":"";
echo "<option value='$i' $selected >{$i}개</option>\n";
}
?>
              </select></td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="25%"><font color="#FF0000">관리자전용</font></td>
            <td bgcolor="#FFFFFF" colspan="3"><input type="radio" name="AdminOnly" value="yes" <? if($cfg["wizboard"]["AdminOnly"]=="yes") ECHO"checked";?>>
              yes
              <input type="radio" name="AdminOnly" value="no" <? if($cfg["wizboard"]["AdminOnly"]=="no") ECHO"checked";?>>
              no (yes선택시 write버튼이 표시되지않음) </td>
          </tr>
          <tr> 
            <td bgcolor="E0E4E8" width="25%"><font color="#FF0000">1:1상담게시판</font></td>
            <td bgcolor="#FFFFFF" colspan="3"> 
              <input type="radio" name="qnaboard" value="1" <? if($cfg["wizboard"]["qnaboard"]=="1") ECHO"checked";?>>
              yes 
              <input type="radio" name="qnaboard" value="0" <? if($cfg["wizboard"]["qnaboard"]=="0") ECHO"checked";?>>
              no(1대1상담용-타인의글은 리스트되지 않음)<br />
              view 메뉴에서 리플라이:no, 코멘트:yes<br />
              option메뉴에서 쓰기:회원전용 으로 각각 설정요망</td>
          </tr>
          <tr>
            <td bgcolor="E0E4E8" width="29%">인클루드 몰 스킨</td>
            <td bgcolor="#FFFFFF" width="71%"><input type="radio" name="INCLUDE_MALL_SKIN" value="yes" <? if(!strcmp($cfg["wizboard"]["INCLUDE_MALL_SKIN"],"yes")) ECHO"checked";?>>
              yes &nbsp;&nbsp;
              <input type="radio" name="INCLUDE_MALL_SKIN" value="no" <? if(!strcmp($cfg["wizboard"]["INCLUDE_MALL_SKIN"],"no")) ECHO"checked";?>>
              no (위즈몰과 연동시 yes를 책크해 주세요)</td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td colspan="2"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td align="center"><input type="submit" name="Button" value="수정" onClick="javascript:submit()"; style="cursor:pointer;">
                    <input type="button" name="Submit" value="닫기" onClick="javascript:window.close()"; style="cursor:pointer;">
                  </td>
                </tr>
              </table></td>
          </tr>
        </table></td>
    </tr>
    <tr>
      <td bgcolor="#FFFFFF">&nbsp;</td>
    </tr>
    <tr>
      <td bgcolor="#FFFFFF"><table class="table_pop_main">
          <tr>
            <td bgcolor="#B9C2CC"><font color="#FFFFFF">테이블상단 </font></td>
          </tr>
          <tr>
            <td align="center"><textarea name="TableTop" style="width:98%;word-break:break-all;" rows="15"><?
$fp = file("../config/wizboard/table/$GID/$BID/top.php");
for($i=0; $i<sizeof($fp); $i++){
$String=stripslashes($fp[$i]);
$String=ereg_replace("&nbsp;","&amp;nbsp;",$String);
echo"$String";
}
?>
</textarea>
            </td>
          </tr>
          <tr>
            <td align="center"><input type="submit" name="Button" value="수정" onClick="javascript:submit()"; style="cursor:pointer;">
              <input type="button" name="Submit2" value="닫기" onClick="javascript:window.close()"; style="cursor:pointer;">
            </td>
          </tr>
        </table></td>
    </tr>
    <tr>
      <td bgcolor="#FFFFFF">&nbsp;</td>
    </tr>
    <tr>
      <td><table class="table_pop_main">
          <tr>
            <td bgcolor="#B9C2CC"><font color="#FFFFFF">테이블하단</font></td>
          </tr>
          <tr>
            <td align="center" bgcolor="#FFFFFF"><textarea name="TableBottom" style="width:98%;word-break:break-all"; rows="15"><?
$fp = file("../config/wizboard/table/$GID/$BID/bottom.php");
for($i=0; $i<sizeof($fp); $i++){
$String=stripslashes($fp[$i]);
$String=ereg_replace("&nbsp;","&amp;nbsp;",$String);
echo"$String";
}
?>
</textarea>
            </td>
          </tr>
          <tr>
            <td align="center" bgcolor="#FFFFFF"><input type="submit" name="Button" value="수정" onClick="javascript:submit()"; style="cursor:pointer;">
              <input type="button" name="Submit22" value="닫기" onClick="javascript:window.close()"; style="cursor:pointer;">
            </td>
          </tr>
        </table></td>
    </tr>
  </form>
</table>
<?
include "./admin_pop_bottom.php";
?>