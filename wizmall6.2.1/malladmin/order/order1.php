<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

switch($OrderStatus){
	case "50":
		$title = "주문완료상품";
	break;
	case "60":
		$title = "반송상품";
	break;
	default:
		$title = "주문 및 배송상품";
	break;
}



$whereis = "where 1";
if(!$OrderStatus) $whereis .= " AND OrderStatus < 50 ";
else $whereis .= " AND OrderStatus = ".$OrderStatus." ";
if ($stitle && $keyword) {$whereis .= " and $stitle LIKE '%$keyword%'";}
if (!$sel_orderby) $sel_orderby = "UID@desc";
if ($orderstatus) $whereis .= " and OrderStatus=$orderstatus";
$orderby = $common->getorderby($sel_orderby);

## 날짜 검색부분 활성화
if ($SMonth&&$SDay&&$SYear)$stdate = mktime(0,0,0,$SMonth,$SDay, $SYear);
else $stdate = $WizApplicationStartDate;

if ($FYear&&$FMonth&&$FDay) $ftdate = mktime(0,0,0,$FMonth,$FDay, $FYear);
else $ftdate = time();

if($DataEnable) $whereis .= " and BuyDate between $stdate AND $ftdate ";

$sqlstr = "SELECT count(*) FROM wizBuyers b ".$whereis;
$TOTAL = $common->gettotal($sqlstr);

$TOTAL_SMONEY = $dbcon->get_one( "SELECT SUM(TotalAmount) FROM wizBuyers b $whereis ");
$NO = $TOTAL-($ListNo*($cp-1));
?>
<script language="javascript">
<!--
	
	function gototermSearch(flag){
		var f = document.SerchForm;
		f.SYear.value	="<?=date("Y")?>";
		f.SMonth.value	="<?=date("m")?>";
		f.SDay.value	="<?=date("d")?>";
		f.FYear.value	="<?=date("Y")?>";
		f.FMonth.value	="<?=date("m")?>";
		f.FDay.value	="<?=date("d")?>";
		switch(flag){
			case "year":
				f.SMonth.value	="01";
				f.SDay.value	="01";
			break;
			case "month":
				f.SDay.value	="01";
			break;
			case "day":
			break;
		}
		f.DataEnable.checked = true;
		f.submit();		
	}
//-->
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><table class="table_title">
        <tr>
          <td bgcolor="#FFFFFF"><b><font color="#FF6600">
            <?=$title?>
            </font></b></td>
        </tr>
        <tr>
          <td bgcolor="#FFFFFF"><table cellspacing=0 cellpadding=0 width="100%" border=0 class="s1">
              <tr>
                <td width="70" align="center" valign="top"><font color=#ff6600>[note]</font></td>
                <td> 주문번호를 클릭시 현재 주문상품 및 배송지에 대한 자세한 내용을 보실 수 있으며 더불어 현재 거래상태를 
                  변경하실 수 있습니다.<br>
                  거래상태를 변경하시면 고객이 주문번호 혹은 로그인만으로도 주문상태를 확인할 수있습니다.<br>
                  주문자를 클릭하시면 주문자의 상세정보를 보실 수 있습니다.<br>
                  * 주의: 카드결제 성공시 거래상태가 "<font color='orange'>입금확인됨</font>" 단계, 
                  실패시는 "<font color='red'>결제실패</font>"로 표시되지만 인터페이스상의 문제로 반드시 
                  카드결제시는 카드사 관리자 모드에서 <font color="#FF0000">반드시 한 번더 확인 바랍니다.</font> </td>
              </tr>
            </table></td>
        </tr>
      </table>
      <br>
     <table class="table_main">
        <form action='<?=$PHP_SELF?>' method=post name="SerchForm">
          <input type="hidden" name="menushow" value='<?=$menushow?>'>
          <input type="hidden"  name="theme" value='<?=$theme?>' >
          <TR>
            <TD width="100" height="24" bgColor=#ffffff><?=$admin->sel_order_stitle($stitle);?>
            </TD>
            <TD bgColor=#ffffff width="80"><input size=10 name=keyword value='<?=$keyword?>' class="dd1"></TD>
            <TD bgColor=#ffffff width="270"><input type="image" src="img/se.gif" width="66" height="20">
              <img src="img/list.gif" width="66" height="20" onClick="location.replace('<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=<?=$theme?>')"></TD>
            <TD bgColor=#ffffff width="134">&nbsp;
              <?=$admin->sel_order_status($DeliveryStatusArr, $orderstatus) ?>
            </TD>
            <TD bgColor=#ffffff width="166"><?=$admin->sel_order_order($sel_orderby);?></TD>
          </TR>
          <tr>
            <td colspan="5" bgcolor="#FFFFFF"><table border="0" class="s1">
                <tr>
                  <td><?
$common->startyear = date("Y", $WizApplicationStartDate);
$common->getSelectDate($stdate);
?>
                    &nbsp;
                    <select name='SYear' size='1'>
                      <?=$common->rtn_year ?>
                    </select>
                    <select name='SMonth' size='1'>
                      <?=$common->rtn_month ?>
                    </select>
                    <select name='SDay' size='1'>
                      <?=$common->rtn_day ?>
                    </select>
                    ~
                    <?
$common->getSelectDate($ftdate);
?>
                    <select name='FYear' size='1'>
                      <?=$common->rtn_year ?>
                    </select>
                    <select name='FMonth' size='1'>
                      <?=$common->rtn_month ?>
                    </select>
                    <select name='FDay' size='1'>
                      <?=$common->rtn_day ?>
                    </select>
                    <input type="checkbox" name="DataEnable" value="1"<? if($DataEnable) echo " checked";?> />
                    Enable </td>
                  <td><a href="javascript:gototermSearch('year')">[<font color='#0000FF'>
                    <?=date("Y")?>
                    년</font>]</a></td>
                  <td><a href="javascript:gototermSearch('month')">[<font color='#0000FF'>
                    <?=date("m")?>
                    월</font>]</a></td>
                  <td><a href="javascript:gototermSearch('day')">[<font color='#0000FF'>
                    <?=date("d")?>
                    일</font>]</a></td>
                </tr>
              </table></td>
          </tr>
        </form>
      </TABLE>
      <br>
      <table cellspacing=0 cellpadding=0 width="760" 
border=0 class="s1">
        <tr>
          <td align=center>&nbsp; <font color=#ff0000>* 주의</font> : 카드결제 성공시 "<font color=orange>입금확인됨</font>" 단계, 실패시는 
            "<font 
                  color=red>결제실패</font>"단계. 카드결제시는 카드사 관리자 모드에서 한 번더 확인 바람</td>
        </tr>
      </table>
      <br>
      <table width="760" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td align="right"><input name="button" type="button" onClick="location.href('./order/order1_4.php?DownForExel=yes&ListNo=<?=$ListNo?>&PageNo=<?=$PageNo?>&cp=<?=$cp?>')" value="엑셀출력"></td>
        </tr>
      </table>
      <table class="table_main">
          <td bgcolor="E0E4E8"><font color="#000000">&nbsp;</font> </td>
          <td>주문번호</td>
          <td bgcolor="E0E4E8"구매금액</td>
          <td>결제방식</td>
          <td bgcolor="E0E4E8">거래상태</td>
          <td>주문자</td>
          <td bgcolor="E0E4E8">전화</td>
          <td>상호</td>
          <td bgcolor="E0E4E8">주문일시</td>
        </tr>
        <?
$dbcon->get_select('*','wizBuyers b',$whereis, $orderby, $START_NO, $ListNo);
while( $list = $dbcon->_fetch_array()) :
        $RAddress1 = split(" ", $list[RAddress1]);
		$BankInfo = split("\|", $list[BankInfo]);
        $SUB_SMONEY = $SUB_SMONEY + $list[TotalAmount];
		$OrderStatus = $list[OrderStatus];
		$PayMethod = $list[PayMethod];
		$PayWay = trim($PayMethod)?$PaySortArr[$PayMethod]:"온라인";
        //--------------------------------------------------
        if (!$list[MemberID]) {$list[MemberID] = "비회원";}

$tmp_color = array("A"=>"blue","B"=>"green","C"=>"orange","D"=>"brown","E"=>"red"); 
$DeveryStatus = "<font color='".$tmp_color[$OrderStatus]."'>".$DeliveryStatusArr[$OrderStatus]."</font>";
if(($PayWay == "신용카드" || $PayWay == "핸드폰" || $PayWay == "자동이체") && $OrderStatus == 10) $DeveryStatus = "<font color='red'>결제실패</font>";
?>
        <tr align=center bgcolor=white height=25>
          <td width=30 align="center" bgcolor=#f3f3f3><?=$NO?></td>
          <td align="center" bgcolor="white"><font color="black"><a href="javascript:openorderwindow(<?=$list[UID]?>)">
            <?=$list[OrderID]?>
            </a></font></td>
          <td align="center"><font color=red><b>
            <?=number_format($list[TotalAmount]);?>
            </b>원</font></td>
          <td align="center"><font color=green>
            <? 
if(!strcmp($list[PayMethod],"card") || !strcmp($list[PayMethod],"all")) echo "<a href='".$PgCorpArr[$cfg["pay"]["CARD_PACK"]]."' target='_blank'><font color='GREEN'>$PayWay</font></a>";
else echo "$PayWay";
?>
            </font></a> </td>
          <td align="center"><font color=red>
            <?=$DeveryStatus?>
            </font> </td>
          <td align="center"><A HREF="javascript:getuserInfo('<?=$list[MemberID]?>')"><font 
                        color=black>
            <?=$list[SName]?>
            (
            <?=$list[MemberID]?>
            )</font></a> </td>
          <td align="center">&nbsp;
            <?=$list[STel1]?></td>
          <td align="center"><font color=green>
            <?=$list[RCompany]?>
            </font></td>
          <td align="center"><font color=brown><? echo date("Y.m.d H:i",$list[BuyDate]);?></font></td>
        </tr>
        <?
$NO--; 
endwhile;
?>
        <tr align=center bgcolor=white height=40>
          <td colspan=9><b>현재페이지 합계금액 : <font color=blue>
            <?=number_format($SUB_SMONEY);?>
            원</font> | 
            주문대기 총금액 : <font color=red>
            <?=number_format($TOTAL_SMONEY);?>
            원</font></b></td>
        </tr>
      </table>
      <br>
      <b> </b>
      <table width="760" border="0" cellspacing="0" cellpadding="0" class="s1">
        <tr>
          <td align="center"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&keyword=".urlencode($keyword)."&stitle=$stitle&sel_orderby=$sel_orderby&orderstatus=$orderstatus&SYear=$SYear&SMonth=$SMonth&SDay=$SDay&FYear=$FYearFMonth=$FMonthFDay=$FDay&DataEnable=$DataEnable";
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
//$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?></td>
        </tr>
      </table></td>
  </tr>
</table>
