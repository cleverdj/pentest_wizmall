<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 

Copyright shop-wiz.com
*** Updating List ***
*/
include "../common/header_pop.php";

include ("../../config/common_array.php");

include ("../../lib/class.wizmall.php");
$mall = new mall;
$mall->db_connect($dbcon);

include ("../../lib/class.cart.php");
$cart = new cart();
$cart->get_object($dbcon);


###################################################
##################### 배송상태 변경 시작 ##########
###################################################

if ($mode == 'chg_deliveryStatus') { // 배송상태 변경
// config/common_array.php 에서 설정 $DeliveryStatusArr = array("10"=>"주문접수", "20"=>"입금대기", "30"=>"입금확인", "40"=>"배송준비", "50"=>"배송완료", "60"=>"물품반송", "70"=>"주문삭제");
	$c_orderstatus	= intval($c_orderstatus);
	$OrderStatus	= intval($OrderStatus);
	
	if (!$OrderStatus || !$c_orderstatus || !$uid) $common->js_alert("잘못된 경로 접근(변수누락)","$PHP_SELF?uid=$uid");
	
	if ($OrderStatus == $c_orderstatus) $common->js_alert("잘못된 경로 접근(배송상태변경없음)","$PHP_SELF?uid=$uid");
	
	
	if($c_orderstatus){//무통장입금일경우 입금확인일 입력
		if(($c_orderstatus <= 20) && ($OrderStatus >= 30 || $OrderStatus <= 50)){
			$PayDate=time();
			$sqlstr = "update wizBuyers SET PayDate = '$PayDate' WHERE UID='$uid'";
			$dbcon->_query($sqlstr);				
		}		
	}
	## 현재의 OrderID 를 구한다.
	$oid	= $cart->get_order_id($uid);
	$cart->ch_buyer_sta($uid, $OrderStatus);## wizBuyers table 상태값 변경
	$cart->ch_cart_sta($oid, $OrderStatus);## wizCart table 에서의 개개항목에 대한 상태값 변경
		
	if ($OrderStatus == 50) {   // 배송완료이면 재고 및 기타 부분 수정
		$sqlstr = "select MemberID, AmountPoint from wizBuyers where OrderID = '$OrderID'";
		$dbcon->_query($sqlstr);
		$MemberID		= $list["MemberID"]; 
		$AmountPoint	= $list["AmountPoint"];
		 
		## 재고갯수 차감
		$sqlstr = "select uid, pid, qty, point from wizCart where oid = '$oid'";
		$qry = $dbcon->_query($sqlstr);

		while($list =$dbcon->_fetch_array($qry)):
			$cuid = $list["uid"];
			$pid = $list["pid"];
			$qty = $list["qty"];
			$point = $list["point"];
			
			## 재고 갯수 변경
			$cart->stock("cuid",$cuid,50,40);
			
			##주문완료에 따른 포인트 입력(포인트 결제일경우 포인트를 생성하지 않음)
			if($MemberID && !$AmountPoint){
				$point = $point * $qty;
				$common->point_fnc($MemberID, $point, 21, $cuid);
			}
		
		endwhile;
		
		## 포인트 결제시 포인트 차감(
		if ($MemberID && $AmountPoint) {
			$point = -$AmountPoint;
			$common->point_fnc($MemberID, $point, 23, $OrderID);
		}

	}//if ($OrderStatus == 50 ) { 

	if ($c_orderstatus == 50) {  //배송완료에서 기타 단계로 이동시
	
		$sqlstr = "select MemberID, AmountPoint from wizBuyers where OrderID = '$OrderID'";
		$dbcon->_query($sqlstr);
		$MemberID		= $list["MemberID"]; 
		$AmountPoint	= $list["AmountPoint"];
		 
		$sqlstr = "select uid, pid, qty, point from wizCart where oid = '$oid'";
		$qry = $dbcon->_query($sqlstr);

		while($list =$dbcon->_fetch_array($qry)):
			$cuid = $list["uid"];
			$pid = $list["pid"];
			$qty = $list["qty"];
			$point = $list["point"];
			
			## 재고 갯수 변경
			$cart->stock("cuid",$cuid,10,50);
			
			//주문완료에서 일반변경에 따른 포인트 제거
			if($MemberID && !$AmountPoint){
				$point = $point * $qty;
				$common->point_fnc($MemberID, $point, 22, $oid);
			}
		endwhile;
		
		// 포인트 결제시 포인트 복귀
		if ($MemberID && $AmountPoint) {
			$content = "주문번호:$member_code";
			$point = +$AmountPoint;
			$common->point_fnc($MemberID, $point, 24, $OrderID);
		}
		
	}//if ($c_orderstatus == 50) {  
	$common->js_location("$PHP_SELF?uid=$uid");
}
###################################################
##################### 배송상태 변경 끝 ############
###################################################



if ($mode == 'delete') {  ##################### 주문데이터삭제 ##########
	$sqlstr = "select OrderID from wizBuyers where UID=$uid";
	$oid= $dbcon->get_one($sqlstr);
		
	$sqlstr = "select uid, pid, qty, point from wizCart where oid = '$oid'";
	$qry = $dbcon->_query($sqlstr);

	while($list =$dbcon->_fetch_array($qry)):
		$cuid = $list["uid"];
		$pid = $list["pid"];
		$qty = $list["qty"];
		$point = $list["point"];
		## 재고 갯수 변경
		$cart->stock("cuid",$cuid,0,10);
	endwhile;
		
	$dbcon->_query("DELETE FROM wizBuyers WHERE UID=$uid");
	$dbcon->_query("DELETE FROM wizCart WHERE oid='$oid'");
	echo "<script>window.alert('\\n\\n주문데이터가 삭제되었습니다.\\n\\n');window.opener.location.reload();self.close();</script>";
	exit;
}

##################### 택배사 및 택배번호 입력  ##########
if(!strcmp($mode, "delever_update")){ /* 택배사 및 택배번호 입력 */
	$sqlstr = "update wizBuyers SET Deliverer = '$Deliverer', InvoiceNo = '$InvoiceNo' WHERE UID='$uid'";
	$dbcon->_query($sqlstr);
	//추후 다중배송을 위해 (개별일경우 별도의 값을 전송, 현재는 이렇게 처리
	$sqlstr = "update wizCart SET deliverer = '$Deliverer', invoiceno = '$InvoiceNo' WHERE oid='$oid'";
	$dbcon->_query($sqlstr);
		
}else if(!strcmp($mode, "chg_address")){ /* 택배사 및 택배번호 입력 */
	$RZip = $RZip1."-".$RZip2;
	$sqlstr = "update wizBuyers set RZip='$RZip', RAddress1='$RAddress1', RAddress2='$RAddress2' WHERE UID='$uid'";
	$result = $dbcon->_query($sqlstr);
}




##################### 문자 전송 시작 ##########
if ($sms_send == 'Y' && $sms_tel && $sms_message) { /////////////////////////////// SMS 전송
// 사용되는 변수
// $sms_tel : 수신자 번호
//$sms_message =  : 발신내용
// $sms_sender_tel : 발신자 번호
// $sms_sender_name : 발신자명
// $sms_sender_id : 발신자 아이디
//$sms_sender_pwd : 발신자 패스워드	
//include "./skin_sms/ANYSMS/smsindex.php"; //이곳에 수정된 모듈이 들어간다.
include "./skin_sms/ICODE/smsindex.php"; //이곳에 수정된 모듈이 들어간다.
}

##################### 이메일 전송 시작 ##########

$msglist = $admin->getmessage_cont($OrderStatus, "mail");
if($msglist["enable"]){
	## 주문자 이메일 가져오기
	$substr = "select SEmail from wizBuyers where UID = '$uid'";
	$subqry = $dbcon->_query($substr);
	$sublist = $dbcon->_fetch_array($subqry);
	$sender_email = $sublist["SEmail"];
	$skinfile = file_get_contents("./mailskin/".$msglist[skin]."/mailform.php");
	//echo "skinfile = $skinfile <br>";
	$msglist[message] = str_replace("{주문번호}", $OrderID, $msglist[message]);
	$msglist[message] = str_replace("{송장번호}", $InvoiceNo, $msglist[message]);
	$skinfile = str_replace("{CONTENTS}", $msglist[message], $skinfile);
	$skinfile = str_replace("{MART_BASEDIR}", $cfg["admin"]["MART_BASEDIR"], $skinfile);
	
	//echo "skinfile = $skinfile <br>";
	$subject = $msglist[subject];
	$contents = $skinfile;
	
	$tomail = $sender_email;
	$from = $cfg["admin"]["ADMIN_EMAIL"];
	$from = "From:$from\nContent-Type:text/html";
	mail ($tomail, $subject, $contents, $from);
}

# 이메일 및 sms 문자 메시지 전송 끝 ##########



$LIST_QUERY = "select * FROM wizBuyers WHERE UID='$uid'";//주문자 정보가져오기
//echo "\$LIST_QUERY = $LIST_QUERY <br>";
$List = $dbcon->_fetch_array($dbcon->_query($LIST_QUERY));
$List[Message] = nl2br(stripslashes($List[Message]));
$OrderID = $List["OrderID"];
$RZip = split("\-", $List["RZip"]);
if (!$List[MemberID]) {$List[MemberID] = "비회원";}

?>
<html>
<head>
<title>위즈몰 관리자 모드 - [배송상세정보]</title>
<meta http-equiv="Content-Type" content="text/html; charset==<?=$cfg["common"]["lan"]?>">
<link rel="stylesheet" href="../common/admin.css" type="text/css">
<script language="JavaScript" src="../../js/button.js"></script>
<script language="JavaScript" src="../../js/wizmall.js"></script>
<script language="JavaScript">
<!--
function down_excel(id){
location.href = './order1_3.php?DownForExel=yes&uid='+id;
}

function really() {
		if (confirm('\n\n이미 거래가 완료된 상태입니다.  \n\n거래가 완료된 상태에서 변경할 경우 \n\n회원에게 부여되었던 포인트 및 \n\n제품판매 정보가 거래완료이전 상태로 되돌려 집니다.\n\n정말로 변경하시겠습니까?  \n\n')) return true;
		return false;
}

function change_flag(flag){
	if(flag == "reorder"){ //재주문처리
	}else if(flag == "2"){
	}else if(flag == "reset"){ //초기상태로 변경
	}

}

function openwindow(uid){
	window.open('./order1_1_1.php?uid='+uid,'AddressChangeForm','width=600, height=200');
}

function changeDeliveryInfo(flag){
	var f = document.OrderinfoForm;
	if(flag == "chg_deliveryStatus"){//거래상태변경
		if(f.c_orderstatus.value != f.OrderStatus.value){
			f.mode.value = flag;
			f.submit();
		}
	}else if(flag == "delete"){//주문삭제
		if (!confirm('\n\n삭제된 주문데이터는 복구가 불가능합니다.  \n\n정말로 삭제하시겠습니까?  \n\n'))return false;
		else {
			f.mode.value = flag;
			f.submit();
		}
	}else if(flag == "delever_update"){//송장번호 입력
		f.mode.value = flag;
		f.submit();
	}else if(flag == "chg_address"){//송장번호 입력
		f.mode.value = flag;
		f.submit();
	}
}

function OpenZipcode(){
wizwindow("../../util/zipcode/zipcode.php?form=OrderinfoForm&zip1=RZip1&zip2=RZip2&firstaddress=RAddress1&secondaddress=RAddress2","ZipWin","width=490,height=250,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no");
}

//-->
</script>
</head>
<body bgcolor="#FFFFFF" text="#000000" leftmargin="0" topmargin="00" marginwidth="0" marginheight="0">
        <FORM ACTION='<?=$PHP_SELF?>' name="OrderinfoForm" method=post>
          <INPUT TYPE=HIDDEN NAME="uid" VALUE='<?=$uid?>'>
          <INPUT TYPE=HIDDEN NAME="mode" VALUE=''>
          <INPUT TYPE=HIDDEN NAME="c_orderstatus" VALUE='<?=$List["OrderStatus"]?>'>
          <INPUT TYPE=HIDDEN NAME="oid" VALUE='<?=$List["OrderID"]?>'>
          <!--<INPUT TYPE=HIDDEN NAME=member_id VALUE='<?=$List[MemberID]?>'>
          <INPUT TYPE=HIDDEN NAME=member_point VALUE='<?=$TOTAL_POINT?>'>
          <INPUT TYPE=HIDDEN NAME=member_code VALUE='<?=$List[OrderID]?>'>
          <INPUT TYPE=HIDDEN NAME=query VALUE='send_modify'>
          <INPUT TYPE=HIDDEN NAME=howbuy VALUE='<?=$List[PayMethod]?>'>
          <INPUT TYPE=HIDDEN NAME=pointmoney VALUE='<?=$List[AmountPoint]?>'>
          <INPUT TYPE=HIDDEN NAME=ziromoney VALUE='<?=$List[AmountOline]?>'>
          <INPUT TYPE=HIDDEN NAME=cardmoney VALUE='<?=$List[AmountPg]?>'>
          <INPUT TYPE=HIDDEN NAME=totalmoney VALUE='<?=$List[TotalAmount]?>'>
		  <INPUT TYPE=HIDDEN NAME=delivery_flag VALUE=''>-->
<table width="600" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr> 
    <td><span class="s1">배송상세정보 </span> </td>
  </tr>
  <tr> 
    <td>
    
<?
$CART_CODE = $OrderID;
$carttype = "orderinfo";
include "../../skinwiz/cart/".$cfg["skin"]["CartSkin"]."/CART_VIEW.php";
?>
      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1" cellpadding="1">
        <tr> 
          <td bgcolor="E0E4E8" colspan="4">[ 주문자 정보 ]</td>
        </tr>
        <tr height=25> 
          <td width=90 bgcolor=#f3f3f3>주문자</td>
          <td width="200" bgcolor="white"><A HREF='mailto:$List[SEmail]'> 
            <?=$List[SName]?>
            </A> ( 
            <?=$List[MemberID]?>
            )</td>
          <td width="90" bgcolor="#f3f3f3">상호명</td>
          <td bgcolor="white"> 
            <?=$List[RCompany]?>          </td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>E-mail</td>
          <td bgcolor="white"><a href='mailto:<?=$List[SEmail]?>'> 
            <?=$List[SEmail]?>
            </a> </td>
          <td bgcolor="#f3f3f3">전화번호</td>
          <td bgcolor="white"> 
            <?=$List[STel1]?>          </td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>휴대폰</td>
          <td bgcolor="white"><A HREF='mailto:<?=$List[SEmail]?>'> </A> 
            <?=$List[STel2]?>          </td>
          <td bgcolor="#f3f3f3">수령인</td>
          <td bgcolor="white"> 
            <?=$List[RName]?>          </td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>우편번호</td>
          <td colspan="3" bgcolor="white"><table border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td><input name="RZip1" type="text"  value="<?=$RZip[0]?>" size="3" class="dd1">
                -<input name="RZip2" type="text"  value="<?=$RZip[1]?>" size="3" class="dd1"></td>
                <td>&nbsp;</td><td><img src="../img/util_icon8.gif" width="86" height="20" onClick='OpenZipcode()' style="cursor:pointer"></td><td>&nbsp;</td><td><button name="주소변경" onClick="changeDeliveryInfo('chg_address');" title="주소변경">주소변경</button></td>
              </tr>
            </table></td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>배송지주소</td>
          <td colspan="3" bgcolor="white"> <input name="RAddress1" type="text" id="RAddress1" value="<?=$List[RAddress1]?>" style="width:99%"  class="dd1"></td>
        </tr>  
        <tr height=25> 
          <td bgcolor=#f3f3f3>배송지주소</td>
          <td colspan="3" bgcolor="white">  <input name="RAddress2" type="text" id="RAddress2" value="<?=$List[RAddress2]?>" style="width:99%"  class="dd1"></td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>배송지전화 </td>
          <td bgcolor="white"> 
            <?=$List[RTel1]?>          </td>
          <td bgcolor="#f3f3f3">희망배송일</td>
          <td bgcolor="white"> 
            <?=$List[ExpectDate]?>          </td>
        </tr>
        <tr height=25> 
          <td bgcolor=#f3f3f3>배송안내글</td>
          <td colspan="3" bgcolor="white"> 
            <?=$List[Message]?>          </td>
        </tr>
      </table>        
      

          
      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 class="s1" cellpadding="1">

          
          <tr  bgcolor=#B9C2CC> 
            <td bgcolor="E0E4E8" colspan="4">[ 주문상태 ]</td>
          </tr>
          <tr height=25> 
            <td width=90 height="19" bgcolor=#f3f3f3>메일내용변경</td>
            <td colspan="3" bgcolor="white"><script>nhnButton('메일내용변경','black9','javascript:window.open("./order1_2_mail.php","","width=450, height=600, scrollbars=1");',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script> </td>
          </tr>		  
          <tr  bgcolor=white height=25> 
            <td width=90 height="19" bgcolor=#f3f3f3>주문번호 </td>
            <td width="200"> 
              <?=$List[OrderID]?>
            </td>
            <td width="90" bgcolor="#f3f3f3">주문일자</td>
            <td> 
              <?=date("Y.m.d", $List[BuyDate])?>
            </td>
          </tr>
          <tr  bgcolor=white height=25> 
            <td bgcolor=#f3f3f3>거래상태</td>
            <td colspan="3"> 
<?            
//$DeliveryStatusArr = array("10"=>"주문접수", "20"=>"입금대기", "30"=>"입금확인", "40"=>"배송준비", "50"=>"배송완료", "60"=>"물품반송", "70"=>"주문삭제");

// case 1. 물품반송->재주문처리
// case 2. 일반
//case 3. 배송완료->초기상태
//case 배송완료상태에서는 주문삭제 불가 
?>            

              <table border="0">
                <tr> 
                  <td> <select name='OrderStatus'>
<?
reset($DeliveryStatusArr);
while(list($key, $value) = each($DeliveryStatusArr)):
 				if($List["OrderStatus"] == $key) $selected = "selected";
				else unset($selected);
				echo "<OPTION VALUE='".$key."' ".$selected.">".$value."</OPTION>\n";

endwhile;
?>			
<?
//ArraytoSelect($DeliveryStatusArr,$List[OrderStatus],$flag=1)
?>
                    </select> </td>
                  <td><img src="../img/order_icon5.gif" width="66" height="20" style="cursor:pointer" onClick="changeDeliveryInfo('chg_deliveryStatus')"></td>
                </tr>
              </table></td>
          </tr>

      </table>
      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1" cellpadding="1">

          <tr  bgcolor=#B9C2CC> 
            <td bgcolor="E0E4E8" colspan="4">[ 택배사 및 송장번호]</td>
          </tr>
          <tr  bgcolor=white height=25> 
            <td width=90 bgcolor=#f3f3f3>택배사</td>
            <td width="200" bgcolor="white"><select name="Deliverer" id="Deliverer">
                <option value="">선택</option>
<?
$substr = "select uid, d_name from wizdeliver";
$subqry = $dbcon->_query($substr);
while($sublist = $dbcon->_fetch_array()):
	$selected = $List[Deliverer] == $sublist["uid"] ? "selected":"";
	echo "<option value='".$sublist["uid"]."' $selected>".$sublist["d_name"]."</option>\n";
endwhile;
?>                
                
              </select>
              </td>
            <td width="90" bgcolor="#f3f3f3">송장번호</td>
            <td><font color="#000000"> 
              <input name="InvoiceNo" class="dd1" value="<?=$List[InvoiceNo]?>" size=13>
              <img src="../img/3.gif" align="middle" width="75" height="20" style="cursor:pointer" onClick="changeDeliveryInfo('delever_update')">
              </font></td>
          </tr>
      </table>

      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 class="s1" cellpadding="1">
        <tr  bgcolor=#B9C2CC> 
          <td bgcolor="E0E4E8" colspan="2">[ SMS 발송 및 관리]</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td width=90 bgcolor=#f3f3f3>SMS발송</td>
          <td> <table width="400" border="0" class="s1">
              <?
$MobilNoSplit = split("\-",$List[STel2]);
for($i=0; $i < sizeof($MobilNoSplit); $i++){
$MobilNo .= $MobilNoSplit[$i];
}
                if($List[OrderStatus]==20 && file_exists("../config/MSG1_sms.cgi")){
                        $sms_msgdata = file("../config/MSG1_sms.cgi");
                        for($x=0;$x<sizeof($sms_msgdata[$x]);$x++){
                                $sms_msg .= $sms_msgdata[$x];
                        }
                }
                if($List[OrderStatus]==30 && file_exists("../config/MSG2_sms.cgi")){
                        $sms_msgdata = file("../config/MSG2_sms.cgi");
                        for($x=0;$x<sizeof($sms_msgdata[$x]);$x++){
                                $sms_msg .= $sms_msgdata[$x];
                        }
                }
                if($List[OrderStatus]==40 && file_exists("../config/MSG3_sms.cgi")){
                        $sms_msgdata = file("../config/MSG3_sms.cgi");
                        for($x=0;$x<sizeof($sms_msgdata[$x]);$x++){
                                $sms_msg .= $sms_msgdata[$x];
                        }
                }
                if($List[OrderStatus]==50 && file_exists("../config/MSG4_sms.cgi")){
                        $sms_msgdata = file("../config/MSG4_sms.cgi");
                        for($x=0;$x<sizeof($sms_msgdata[$x]);$x++){
                                $sms_msg .= $sms_msgdata[$x];
                        }
                }
?>

                <tr> 
                  <td width="54"><font color="#000000"><a href='#' onClick="javascript:window.open('./order1_2.php?what=sms', 'SMSMessageManagerWindow','width=470,height=407,statusbar=no,scrollbars=yes,toolbar=no')">전화번호 
                    </a></font></td>
                  <td width="185"><font color="#000000"> 
                    <input size=13 name="sms_tel" class="dd1" value="<?=$MobilNo?>">
                    </font></td>
                  <td width="147">&nbsp;</td>
                </tr>
                <tr> 
                  <td width="54"><font color="#000000"><a href='#' onClick="javascript:window.open('./order1_2.php?what=sms', 'SMSMessageManagerWindow','width=470,height=407,statusbar=no,scrollbars=yes,toolbar=no')">메세지</a></font></td>
                  <td width="185"> <textarea name="sms_message"><?=$sms_msg?></textarea></td>
                  <td width="147"><table border="0" cellpadding="0" cellspacing="0">
                      <tr>
                        <td><input type="image" src="../img/3.gif" width="75" height="20"></td>
                        <td>&nbsp;</td>
                        <td><script>nhnButton('메세지관리','black9','javascript:window.open("./order1_2.php?what=sms", "SMSMessageManagerWindow","width=470,height=500,statusbar=no,scrollbars=yes,toolbar=no")',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
                      </tr>
                    </table></td>
                </tr>
                <tr>
                  <td colspan="3">sms업체선택은 기본환경&gt;기본환경설정에서 선택해 주세요</td>
                </tr>
              
            </table></td>
        </tr>
      </table>
      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 class="s1" cellpadding="1">
        <tr  bgcolor=#B9C2CC> 
          <td bgcolor="E0E4E8" colspan="2">[ 결제방식 선택 ]</td>
        </tr>
        <?
//------------------------------------------[결제방식]
if ($List[PayMethod] == 'card') {
?>
        <tr  bgcolor=white height=25> 
          <td width=90 bgcolor=#f3f3f3>결제방식</td>
          <td>신용카드 결제</td>
        </tr>
        <?
}
else if ($List[PayMethod] == 'point') {
?>
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3>결제방식</td>
          <td>포인트 결제</td>
        </tr>
        <?
}
else if ($List[PayMethod] == 'hand') {
?>
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3>결제방식</td>
          <td>핸드폰 결제</td>
        </tr>
<?
}
else if ($List[PayMethod] == 'all') {
?>
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3>결제방식</td>
          <td>다중결제(온라인+신용카드+포인트)</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>온라인입금</td>
          <td> 
            <?=number_format($List[AmountOline]);?>
            원</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>입금계좌</td>
          <td> 
            <?=$List[BankInfo]?>
            &nbsp;</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>입금예정일</td>
          <td><? echo date("Y 년 m 월 d 일 H 시","$List[PayDate]"); ?>&nbsp;</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>신용카드</td>
          <td> 
            <?=number_format($List[AmountPg]);?>
            원</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>포인트</td>
          <td> 
            <?=number_format($List[AmountPoint]);?>
            포인트</td>
        </tr>
        <?
}
else {  //온라인 입금일 경우
?>
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3>결제방식</td>
          <td>온라인입금</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td bgcolor=#f3f3f3>입금계좌</td>
          <td> 
            <?=$List[BankInfo]?>
            &nbsp;</td>
        </tr>
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3> 입금인 </td>
          <td> 
            <? echo $List[Inputer]; ?>
            &nbsp;</td>
        </tr>				
        <tr  bgcolor=white height=25> 
          <td width="90" bgcolor=#f3f3f3>입금예정일</td>
          <td> 
            <? if($List[PayDate] >= mktime(0,0,0,0,0,2000)) echo date("Y 년 m 월 d 일 H 시","$List[PayDate]"); ?>
            &nbsp;</td>
        </tr>
        <?
}
//--------------------------------------------------
?>
      </table>
      <? if($cfg["pay"]["CARD_PACK"] == "KICC" && ($List[PayMethod] == 'all' || $List[PayMethod] == 'card')):?>
      <table cellspacing=1 bordercolordark=white width="600" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1" cellpadding="1">
        <tr  bgcolor=#B9C2CC> 
          <td bgcolor="E0E4E8" colspan="2">[ KICC ADMIN MODE ]</td>
        </tr>
        <? 
if($List[CardStatus] == "0000"){
	if($List[Reserved2] == "S1") $CardStatus = "신용결제매입 상태"; 
	else if($List[Reserved2] == "D2") $CardStatus = "신용결제승인취소 상태"; 
	else if($List[Reserved2] == "S2") $CardStatus = "신용결제매입취소 상태";
	else if($List[Reserved2] == "DD") $CardStatus = "신용결제즉시취소 상태";
	else $CardStatus = "승인 상태";
}
?>
        <tr  bgcolor=white height=25> 
          <td width=90 height="47" bgcolor=#f3f3f3> 거래상태</td>
          <td><a href="javascript:void(window.open('../skinwiz/cardmodule/KICC/mainAdmin.php?OrderID=<?=$List[OrderID]?>','KICCADMINWINDOW','width=600, height=250'));"> 
            <?=$CardStatus?>
            </a></td>
        </tr>
      </table>
      <? endif;?>
      <table cellspacing=0  width="600" border=0 class="s1" cellpadding="0">
        <tr> 
          <td colspan="2" align="center"><table border="0" cellspacing="0" cellpadding="0">
              <tr height=30> <!-- "\n\n거래가 완료된 상태에서 삭제가 불가능합니다. \n\n거래상태를 주문접수됨으로 변경후  \n\n삭제 처리하십시오.\n\n" -->
			  <!-- "\n\n거래가 완료된 상태에서 반품처리할 경우 \n\n거래상태를 주문접수됨으로 변경후  \n\n처리하십시오.\n\n" -->
                <?if($List[OrderStatus] <> 10) :?>
                <td> <script>nhnButton('주문삭제','black9','javascript:alert("재고통계 및 포인트 적용을 위해\n거래상태를 주문접수됨으로 변경후  \n삭제 처리하십시오.")',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
                <?else:?>
                <td><script>nhnButton('주문삭제','black9','javascript:changeDeliveryInfo("delete");',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
                <?endif;?>
                <td>&nbsp;</td>
                <td><script>nhnButton('프린트','black9','javascript:self.print();',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
                <td>&nbsp;</td>
                <td><script>nhnButton('창닫기','black9','javascript:self.close();',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
                <td>&nbsp;</td>
                <td><script>nhnButton('엑셀출력','black9','javascript:down_excel("<?=$uid?>");',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script></td>
              </tr>
            </table></td>
        </tr>
      </table></td>
  </tr>
</table></form>
</body>
</html>