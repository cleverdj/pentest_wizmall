<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 

Copyright shop-wiz.com
*** Updating List ***
*/

if (!$sorting) {$sorting = "Output";}
if ($sort) {
if(strlen($sort)==6) $cat_query = substr($sort,4);
		else $cat_query=$sort;
        if ($sort1) {$cat_query = substr($sort,2);}
        if ($sort2) {$cat_query = $sort2;}
        $WHERE = "WHERE Category LIKE '%$cat_query' AND HIT > 0";} else {$WHERE = "WHERE HIT > 0";
}
?>
<?  /* 페이징과 관련된 수식 구하기 */
$listNo = "15";
$PageNo = "20";
if(empty($cp) || $cp <= 0) $cp = 1;
$START_NO = ($cp - 1) * $listNo;
$TOTAL_STR = "SELECT count(*) FROM wizMall $WHERE";
$TOTAL = $dbcon->get_one($TOTAL_STR);


/* 현재 등록된 제품에 대한 총 판매액을 표시한다.*/
$LIST_QUERY = "SELECT * FROM wizMall $WHERE ORDER BY $sorting DESC LIMIT $START_NO,$listNo";
$TABLE_DATA = $dbcon->_query($LIST_QUERY);
$TOTAL_DATA = $dbcon->_fetch_array($dbcon->_query("SELECT sum(Input),sum(Output),sum(Output)*Price,count(*) FROM wizMall", $DB_CONNECT));

/* 판매된 제품을 기준으로 하여 판매량과 금액등을 가져온다. */
$sqlstr = "select sum(TotalAmount) from wizBuyers WHERE OrderStatus = 50";
$OutPutTotalPrice = $dbcon->get_one($sqlstr);

$sqlstr = "select Co_Name from wizBuyers WHERE OrderStatus = 50";
$dbcon->_query($sqlstr);
 while($Product = $dbcon->_fetch_array()):
  $OutPutProductSpec = split("\|",$Product[Co_Name]);
  //echo "\$OutPutProductSpec[1] = $OutPutProductSpec[1] <br>";
  $OutPutProductCount += $OutPutProductSpec[1];
 endwhile;

if ($TOTAL_DATA[0] && $TOTAL_DATA[1]) {
$TOTAL_WIDTH = intval(($TOTAL_DATA[1]/$TOTAL_DATA[0])*100);
}
else {
$TOTAL_WIDTH = 0;
$TOTAL_DATA[0] = 0;
}
?>
<table width="750" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td>&nbsp;</td>
  </tr>
  <tr> 
    <td><table width=100% cellspacing=0 border=1 bgcolor=C0C0C0 align="CENTER" bordercolordark="white" bordercolorlight="#DDDDDD">
        <tr> 
          <td bgcolor="#FFFFFF"><strong><font color="#3366CC">제품 판매 통계</font></strong></td>
        </tr>
        <tr> 
          <td bgcolor="#FFFFFF"> <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <td width="70" align="center" valign="top"><strong><font color="#FF6600">[note]</font></strong> 
                </td>
                <td>&nbsp;</td>
              </tr>
            </table></td>
        </tr>
      </table>
      &nbsp;</td>
  </tr>
  <tr> 
    <td><TABLE WIDTH='98%' CELLSPACING=0 CELLPADDING=0 BORDER=0 ALIGN="CENTER">
        <FORM ACTION='<? echo $PHP_SELF ; ?>' METHOD=POST>
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <INPUT TYPE=HIDDEN NAME=theme VALUE='statistic3'>
          <INPUT TYPE=HIDDEN NAME=cp VALUE='<?ECHO"$cp";?>'>
          <TR> 
            <TD>&nbsp; </TD>
            <TD ALIGN=RIGHT> 
              <!------------------------------------------------------------------------->
              <select name=sort style='width:100' onChange='this.form.submit()'>
                <option value=''>대분류</option>
                <option value=''>-----------</option>
                <?
$SQL_STR = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no < 100 ORDER BY cat_no ASC";
$SQL_QRY = $dbcon->_query($SQL_STR);
while($LIST=@$dbcon->_fetch_array($SQL_QRY)):
	if($sort == $LIST[cat_no]) ECHO "<OPTION VALUE='$LIST[cat_no]' selected>$LIST[cat_name]</OPTION>\n";
	else ECHO "<OPTION VALUE='$LIST[cat_no]'>$LIST[cat_name]</OPTION>\n";
endwhile;	
?>
              </select> 
              <!------------------------------------------------------------------------->
              <select name=sort1 style='width:100' onChange='this.form.submit()'>
                <option value=''>중분류</option>
                <option value=''>-----------</option>
                <?
if($sort){
	$cat_no_new = substr($sort,4);
	$SQL_STR1 = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no < 10000 AND cat_no >= 100 AND cat_no LIKE '%$cat_no_new' ORDER BY cat_no ASC";
	$SQL_QRY1 = $dbcon->_query($SQL_STR1);
		while($LIST1=@$dbcon->_fetch_array($SQL_QRY1)): 
			if($sort1 == $LIST1[cat_no]) ECHO "<OPTION VALUE='$LIST1[cat_no]' selected>$LIST1[cat_name]</OPTION>\n";
			else ECHO "<OPTION VALUE='$LIST1[cat_no]'>$LIST1[cat_name]</OPTION>\n";
		endwhile;
}
?>
              </select> 
              <!------------------------------------------------------------------------->
              <select name=sort2 style='width:100' onChange='this.form.submit()'>
                <option value=''>소분류</option>
                <option value=''>-----------</option>
                <?
$cat_no_new1 = substr($sort1,2);
$SQL_STR1 = "SELECT cat_no, cat_name FROM wizCategory WHERE cat_no >= 10000 AND cat_no LIKE '%$cat_no_new1' ORDER BY cat_no ASC";
$SQL_QRY2 = $dbcon->_query($SQL_STR2);
while($LIST2=@$dbcon->_fetch_array($SQL_QRY2)):
if($sort2 == $LIST2[cat_no]) ECHO "<OPTION VALUE='$LIST2[cat_no]' selected>$LIST2[cat_name]</OPTION>\n";
else ECHO "<OPTION VALUE='$LIST2[cat_no]'>$LIST2[cat_name]</OPTION>\n";
endwhile;
?>
              </select> <SELECT NAME='sorting' onchange='this.form.submit()' style='width:100;'>
                <OPTION VALUE='UID'>상품 정렬</OPTION>
                <OPTION VALUE='UID'>-------------------</OPTION>
                <OPTION VALUE='DATE'<?if($sorting=='DATE'){ECHO" SELECTED";}?>>등록날짜순</OPTION>
                <OPTION VALUE='Price'<?if($sorting=='Price'){ECHO" SELECTED";}?>>상품가격순</OPTION>
                <OPTION VALUE='HIT'<?if($sorting=='HIT'){ECHO" SELECTED";}?>>상품조회순</OPTION>
                <OPTION VALUE='Output'<?if($sorting=='Output'){ECHO" SELECTED";}?>>상품판매순</OPTION>
                <OPTION VALUE='Input'<?if($sorting=='Input'){ECHO" SELECTED";}?>>상품입고순</OPTION>
                <OPTION VALUE='POINT'<?if($sorting=='POINT'){ECHO" SELECTED";}?>>포인트순</OPTION>
              </SELECT> </TD>
          </TR>
          <TR> 
            <TD HEIGHT=10 COLSPAN=2> </TD>
          </TR>
        </FORM>
      </TABLE></td>
  </tr>
  <tr> 
    <td><table width=100% cellspacing=0 border=1 bgcolor=C0C0C0 align="CENTER" bordercolordark="white" bordercolorlight="#DDDDDD">
        <tr bgcolor="#206FBD" align="center"> 
          <TD WIDTH=70><FONT COLOR="#CCCCCC">총등록수</FONT></TD>
          <TD WIDTH=100><FONT COLOR="#CCCCCC">총조회량</FONT></TD>
          <TD WIDTH=100 bgcolor="#206FBD"><FONT COLOR="#CCCCCC">총판매량</FONT></TD>
          <TD><FONT COLOR="#CCCCCC">총판매액</FONT></TD>
        </TR>
        <TR> 
          <TD COLSPAN=5 BGCOLOR=C0C0C0 WIDTH=100% HEIGHT=1> </TD>
        </TR>
        <TR ALIGN=CENTER HEIGHT=22 BGCOLOR=#FFFFFF> 
          <TD><FONT COLOR=BROWN><B><?ECHO number_format($TOTAL_DATA[3]);?> EA</B></FONT></TD>
          <TD WIDTH=100><FONT COLOR=BROWN><B><?ECHO number_format($TOTAL_DATA[0]);?> 
            회</B></FONT></TD>
          <TD WIDTH=100><FONT COLOR=BROWN><B><?=number_format($OutPutProductCount);?> 
            EA</B></FONT></TD>
          <TD ALIGN=center><font color="BROWN"> <strong> 
            <?=number_format($OutPutTotalPrice);?>
            원</strong></font> </TD>
        </TR>
      </TABLE></td>
  </tr>
  <tr> 
    <td>&nbsp;</td>
  </tr>
  <tr> 
    <td><table width=100% cellspacing=0 border=1 bgcolor=C0C0C0 align="CENTER" bordercolordark="white" bordercolorlight="#DDDDDD">
        <TR BGCOLOR='#206FBD' ALIGN=CENTER HEIGHT=22> 
          <TD WIDTH=150><FONT COLOR="#CCCCCC">매장 카테고리</FONT></TD>
          <TD WIDTH=100><FONT COLOR="#CCCCCC">조회수</FONT></TD>
          <TD WIDTH=100><FONT COLOR="#CCCCCC">판매수</FONT></TD>
          <TD WIDTH=270><FONT COLOR="#CCCCCC">판매량그래프(오차범위:1%이내)</FONT></TD>
        </TR>
        <TR> 
          <TD COLSPAN=5 BGCOLOR=C0C0C0 WIDTH=100% HEIGHT=1> </TD>
        </TR>
        <?
$SqlStr="SELECT * FROM wizCategory WHERE cat_no < 100 ORDER BY cat_no ASC"; 
$SqlQry = $dbcon->_query($SqlStr);
while($list=$dbcon->_fetch_array($SqlQry)):
$list[cat_no]=substr($list[cat_no],4);
        $CAT_DATA = $dbcon->_fetch_array($dbcon->_query("SELECT sum(Hit), sum(Output), sum(Output*Price), count(*) FROM wizMall WHERE Category LIKE '%$list[cat_no]'", $DB_CONNECT));
		if ($TOTAL_DATA[1] && $CAT_DATA[1]) {$CAT_WIDTH = intval(($CAT_DATA[1] / $TOTAL_DATA[1])*100);}
        else {$CAT_WIDTH =0;}
        if ($CAT_DATA[0] && $CAT_DATA[1]) {
        $CAT_WIDTH1 = intval(($CAT_DATA[1] / $CAT_DATA[0])*100);}
        else {$CAT_WIDTH1 =0 ;}
?>
        <TR BGCOLOR=WHITE ALIGN=CENTER HEIGHT=22> 
          <TD BGCOLOR=FFFFF1 ALIGN=LEFT><B>&nbsp; 
            <?=$list[cat_name]?>
            </B> <A HREF='<?=$PHP_SELF?>?menushow=<?=$menushow?>&theme=statistic2&sort=<?=$list[cat_no]?>&sorting=<?ECHO$sorting;?>&cp=<?=$cp;?>'><IMG SRC='./img_statistic/more.gif' BORDER=0></A></TD>
          <TD><FONT COLOR=BLUE><?ECHO number_format($CAT_DATA[0]);?>회</FONT></TD>
          <TD><FONT COLOR=BLUE><?ECHO number_format($CAT_DATA[1]);?>EA</FONT></TD>
          <TD ALIGN=LEFT BGCOLOR=EFEFEF><IMG SRC='./img_statistic/grp3.gif' WIDTH='<?ECHO $CAT_WIDTH*2;?>' HEIGHT=10> 
            <?ECHO $CAT_WIDTH;?>%</TD>
        </TR>
        <?
endwhile;
?>
      </TABLE></td>
  </tr>
  <tr> 
    <td>&nbsp;</td>
  </tr>
  <tr> 
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td><B>현재 카테고리</B> : <A HREF='<? echo $PHP_SELF ; ?>?menushow=<?=$menushow?>&theme=statistic2'><font color = 'gray'><font color="#006633">총 
            매장</font></font></a><font color = 'gray'><font color="#006633"></font> 
            <?
if($sort){
$sqlcatstr = "select cat_name from wizCategory where cat_no LIKE '%$sort' and cat_no < 100"; 
$cat_name = $dbcon->get_one($sqlcatstr);
echo " > <A HREF='$PHP_SELF?menushow=$menushow&theme=statistic2&sort=$sort&sort1=$sort1&sort2=$sort2&sorting=$sorting&cp=$cp'><font color='#006633'>$cat_name</font></A>";
}
if($sort1){
$sqlcatstr = "select cat_name from wizCategory where cat_no LIKE '%$sort1' and cat_no < 10000"; 
$cat_name = $dbcon->get_one($sqlcatstr);
echo " > <A HREF='$PHP_SELF?menushow=$menushow&theme=statistic2&sort=$sort&sort1=$sort1&sort2=$sort2&sorting=$sorting&cp=$cp'><font color='#006633'>$cat_name</font></A>";
}
if($sort2){
$sqlcatstr = "select cat_name from wizCategory where cat_no LIKE '%$sort2'"; 
$cat_name = $dbcon->get_one($sqlcatstr);
echo " > <A HREF='$PHP_SELFmenushow=$menushow&theme=statistic2&sort=$sort&sort1=$sort1&sort2=$sort2&sorting=$sorting&cp=$cp'><font color='#006633'>$cat_name</font></A>";
}
?>
            </font></td>
        </tr>
      </table></td>
  </tr>
  <tr> 
    <td><table width=100% cellspacing=0 border=1 bgcolor=C0C0C0 align="CENTER" bordercolordark="white" bordercolorlight="#DDDDDD">
        <tr bgcolor="#206FBD" align="center"> 
          <TD><FONT COLOR="#FFFFFF">제품명/제조사</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">가격/포인트</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">품절</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">입고량</FONT></TD>
		  <TD><FONT COLOR="#FFFFFF">조회량</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">판매량</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">판매액</FONT></TD>
          <TD><FONT COLOR="#FFFFFF">입고량에따른 판매율</FONT></TD>
        </TR>
        <?
$NO = $TOTAL-($listNo*($cp-1));
while( $list = $dbcon->_fetch_array( $TABLE_DATA ) ) :
        $list[Name] = stripslashes($list[Name]);
        $list[CompName] = stripslashes($list[CompName]);
        $list[Description1] = stripslashes($list[Description1]);
        $list[Description2] = stripslashes($list[Description2]);
        $list[Model] = stripslashes($list[Model]);
		$Picture = split("\|",$list[Picture]); 
if ($list[Input]) {
$BUY_WIDTH = intval(($lsit[Output] / $list[Input])*100);
}
else {
$BUY_WIDTH = 0;
}
?>
        <TR bgcolor="#FFFFFF"> 
          <TD> <TABLE WIDTH=100%>
              <TR> 
                <TD WIDTH=50><A HREF='../wizmart.php?code=<?=$list[Category]?>&query=view&no=<?=$list[UID]?>' TARGET=_blank><IMG SRC='../wizstock/<?=$Picture[0]?>' WIDTH='50' HEIGHT='50' BORDER=0></A></TD>
                <TD><?ECHO"$NAME<BR><FONT COLOR=GRAY>$COMPNAME</FONT>";?></TD>
              </TR>
            </TABLE></TD>
          <TD ALIGN=CENTER> <FONT COLOR='#EF7518'><B> 
            <?=$list[Price]?>
            원</B></FONT><BR> 
            <?=$list[Point]?>
            포인트 </TD>
          <TD ALIGN=CENTER> <INPUT TYPE=CHECKBOX NAME='NONE<?=$list[UID]?>' VALUE=checked<?=$None?>></TD>
          <TD ALIGN=CENTER><FONT COLOR=BLUE> 
            <?=$list[Input]?>
            </FONT></TD>
          <TD ALIGN=CENTER><FONT COLOR=BLUE> 
            <?=$list[Hit]?>
            </FONT></TD>
          <TD ALIGN=CENTER><FONT COLOR=BROWN><B> 
            <?=$list[Output]?>
            </B></FONT></TD>
          <TD ALIGN=CENTER><FONT COLOR=RED><B> <?ECHO number_format($list[Output]*$list[Price]);?> 
            원</B></FONT></TD>
          <TD> <IMG SRC='./img_statistic/grp1.gif' HEIGHT=10 WIDTH='100'> 입고(100%)<BR> 
            <IMG SRC='./img_statistic/grp2.gif' HEIGHT=10 WIDTH='<?ECHO"$BUY_WIDTH";?>'> 
            판매(<?ECHO"$BUY_WIDTH";?>%) </TD>
        </TR>
        <?endwhile;?>
      </TABLE></td>
  </tr>
  <tr> 
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td align="center"> 
     <?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?WHERE=$WHERE&menushow=$menushow&theme=statistic2&keyword=".urlencode($keyword)."&sort=$sort&sort1=$sort1&sort2=$sort2&sorting=$sorting";
$page_arg2 = array("listno"=>$listNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?> 
    </td>
  </tr>
</table>