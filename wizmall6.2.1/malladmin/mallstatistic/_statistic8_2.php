<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***
*/

if ($sort) {
        $cat_query = $sort;
        if ($sort1) {$cat_query = $cat_query.">".$sort1;}
        if ($sort2) {$cat_query = $cat_query.">".$sort2;}
        $WHERE = "WHERE Category LIKE '$cat_query%'"; $WHERE1 = "AND Category LIKE '$cat_query%'";
}


$listNo = "15";
$PageNo = "20";
$sqlstr = "SELECT count(*) FROM wizCom where (CompSort = '01' or CompSort = '02' or CompSort = '03')";
$TOTAL = $dbcon->get_one($sqlstr);

if(empty($cp) || $cp <= 0) $cp = 1;
$START_NO = ($cp - 1) * $listNo;

//--페이지 나타내기--
$TP = ceil($TOTAL / $listNo) ; /* 페이지 하단의 총 페이지수 */
$CB = ceil($cp / $PageNo);
$SP = ($CB - 1) * $PageNo + 1;
$EP = ($CB * $PageNo);
$TB = ceil($TP / $PageNo);
?>
<table  border="0" cellpadding="0" cellspacing="0"> <tr> 
    <td height="8"></td>
    <td height="8"></td>
  </tr>
  <tr> 
    <td> </td>
    <td valign="top"><table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd border=1 class="s1" >
        <tr> 
          <td bgcolor="#FFFFFF"><b><font color="#FF6600">거래처(기업회원) 월별 판매 통계</font></b></td>
        </tr>
        <tr> 
          <td bgcolor="#FFFFFF"><table cellspacing=0 cellpadding=0 width="100%" border=0 class="s1">
              <tr> 
                <td width="70" align="center" valign="top"><font color=#ff6600>[note]</font></td>
                <td>기업회원은 통상 Grad 5로 분류 됩니다.</td>
              </tr>
            </table></td>
        </tr>
      </table>
      <br> <table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1">
        
          <tr> 
            <td bgcolor=#ffffff valign="top"> <table cellspacing=0 cellpadding=0 width="100%" 
border=0 class="s1">
                
                  <tr> 
                    <td valign=top align=right height="28">&nbsp; <table width="709" border="0" class="s1">
                        <form action='<?=$PHP_SELF?>' method=POST>
                          <input type=HIDDEN name=cp value='<?=$cp?>'>
                          <input type='hidden' name='menushow' value='<?=$menushow?>'>
                          <input type=HIDDEN name=theme value='<?=$theme?>'>
                          <tr> 
                            <td width="257">&nbsp; </td>
                            <td width="101">&nbsp; </td>
                            <td width="115">&nbsp; </td>
                            <td width="79">&nbsp; </td>
                            <td width="135">&nbsp; </td>
                          </tr>
                        </form>
                      </table></td>
                  </tr>
                
              </table></td>
          </tr>
        
      </table>
      <br> <table width="760" border=0 cellpadding="5" cellspacing=1 bordercolorlight=#dddddd bordercolordark=white bgcolor=#c0c0c0 class="s1">
        
          <tr bgcolor="E0E4E8"> 
            <td align="center"><font color="#000000">거래처명/담당자</font></td>
            <td align="center"><font color="#000000">판매수량</font></td>
            <td align="center"><font color="#000000">총판매금액</font></td>
            <td align="center"><font color="#000000">주 소</font></td>
          </tr>
          <tr bgcolor="#FFFFFF"> 
            <td height=1 colspan=4 align="middle"></td>
          </tr>
          <?
$MSqlstr = "SELECT UID,ID,Grade,Address1,Address2,Tel1,Name FROM wizMembers WHERE ID = '$mid'";
$MSqlqry = $dbcon->_query($MSqlstr);
$Mlist = $dbcon->_fetch_array( $MSqlqry );
$sqlstr = "select CompName, CompChaName, CompChaTel, CompAddress1, CompAddress2 from wizCom where CompID = '$mid'"; 
$dbcon->_query($sqlstr);
$CompList =  $dbcon->_fetch_array();
/* 만약 기업회원과 일반회원과의 가격 차등일 경우 BuyPrice --> ByuPrice1 */
$sqlstr = "select sum(BuyGoodsQty) as tqty, sum(BuyGoodsQty*BuyPrice) as tmount from wizBuyersMore where BuyerID = '$mid'";
$dbcon->_query($sqlstr);
$MoreList = $dbcon->_fetch_array();
?>
          <tr bgcolor="#FFFFFF"> 
            <td align="center"><font color="#000000">&nbsp;<b><font color='BROWN'> 
              <?=$CompList[CompName]?>
              </font></b><br>
              &nbsp;<font color=GREEN>( 
              <?=$Mlist[Name];?>
              : 
              <?=$Mlist[Tel1];?>
              )</font></font></td>
            <td align="center"><font color="#000000">
              <?=number_format($MoreList[tqty])?>
              종</font></td>
            <td align="center"><font color="#000000"> 
              <?=number_format($MoreList[tmount])?>
              EA</font></td>
            <td>
              <?=$Mlist[Address1]?>
              &nbsp;
              <?=$Mlist[Address2]?>
            </td>
          </tr>
        
      </table>
      <br>
      <?
$ThisYear = date("Y");
if(!$SelectedYear) $SelectedYear = $ThisYear;
?>
      <table cellspacing=0 bordercolordark=white width="760" bgcolor=#c0c0c0 bordercolorlight=#dddddd 
border=0 class="s1">
        
          <tr> 
            <td bgcolor=#ffffff valign="top"> <table cellspacing=0 cellpadding=0 width="100%" 
border=0 class="s1">
                
                  <tr> 
                    <td valign=top align=right height="28">&nbsp; <table width="709" border="0" class="s1">
                        <form action="<?=$PHP_SELF?>">
                          <input type='hidden' name='menushow' value='<?=$menushow?>'>
                          <input type="hidden" name="theme" value="<?=$theme?>">
                          <input type="hidden" name="mid" value="<?=$mid?>">
                          <tr> 
                            <td width="257">&nbsp; </td>
                            <td width="101">&nbsp; </td>
                            <td width="115">&nbsp; </td>
                            <td width="79">&nbsp; </td>
                            <td width="135"><select name="SelectedYear" onChange="submit();">
                                <?
for($i = $ThisYear -2; $i <= $ThisYear; $i++){
if($SelectedYear == $i) $selected = "selected";
else unset($selected);
echo "<option value='$i' ${selected}>$i</option>";
}
?>
                              </select>
                              년도 </td>
                          </tr>
                        </form>
                      </table></td>
                  </tr>
                
              </table></td>
          </tr>
        
      </table>
      <table cellspacing=1 bordercolordark=white bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 width="760" class="s1">
        
<?
/*
$MSqlstr = "SELECT UID,ID,Grade,Address1,Address2,Tel1,Name FROM wizMembers WHERE ID = '$mid'";
$MSqlqry = $dbcon->_query($MSqlstr);
$Mlist = $dbcon->_fetch_array( $MSqlqry );
$sqlstr = "select CompName, CompChaName, CompChaTel, CompAddress1, CompAddress2 from wizCom where CompID = '$mid'"; 
$dbcon->_query($sqlstr);
$CompList =  $dbcon->_fetch_array();
*
/* 만약 기업회원과 일반회원과의 가격 차등일 경우 BuyPrice --> ByuPrice1 */
/* 선택 년을 구한다. */
$StartYear = mktime(0,0,0,0,0,$SelectedYear);
$EndYear = mktime(0,0,0,0,0,$SelectedYear+1);
$sqlstr = "select sum(BuyGoodsQty) as tqty, sum(BuyGoodsQty*BuyPrice) as tmount from wizBuyersMore where BuyerID = '$mid' and BuyDate < '$EndYear' and BuyDate >= '$StartYear'";
$dbcon->_query($sqlstr);
$MoreList = $dbcon->_fetch_array();
$TotalQtyofTheYear = $MoreList[tqty];
$TotalAmoutofTheYear = $MoreList[tmount];
//echo "\$sqlstr = $sqlstr <br>";
//echo "\$TotalQtyofTheYear =$TotalQtyofTheYear <br>";
//echo "\$TotalAmoutofTheYear =$TotalAmoutofTheYear <br>";
?>
<?
 // 이번달 카운터 (각각)
  for($i=0;$i<12;$i++)
  {
/* 각달의 토탈 구매량과 금액을 구한다. */
$StartMonth = mktime(0,0,0,$i,0,$SelectedYear);
$EndMonth = mktime(0,0,0,$i+1,0,$SelectedYear);
$sqlstr = "select sum(BuyGoodsQty) as tqty, sum(BuyGoodsQty*BuyPrice) as tmount from wizBuyersMore where BuyerID = '$mid' and BuyDate < '$EndMonth' and BuyDate >= '$StartMonth'";
$dbcon->_query($sqlstr);
$MoreList = $dbcon->_fetch_array();
$TotalQtyofTheMonth = $MoreList[tqty];
$TotalAmoutofTheMonth = $MoreList[tmount];
  
if($TotalAmoutofTheMonth && $TotalAmoutofTheYear) $per1=(int)($TotalAmoutofTheMonth/$TotalAmoutofTheYear*100+1);
else unset($per1);
if($TotalQtyofTheMonth && $TotalQtyofTheYear) $per2=(int)($TotalQtyofTheMonth/$TotalQtyofTheYear*100+1);
else unset($per2);
   if($per1>100)$per1=99;
   if($per2>100)$per2=99;
   $j=$i+1;
?>
          <tr bgcolor="#FFFFFF"> 
            <td width="11%" bgcolor="E0E4E8"><font color="#000000">- 
              <?=$j?>
              월 </font></td>
            <td width="66%" align=left> <table width="200" border="0">
                <tr> 
                  <td><img src="img/blue.gif" width="<?=$per1?>" height="5"></td>
                </tr>
              </table></td>
            <td width="23%" bgcolor="#FFFFFF">&nbsp; 구매금액 : <?=number_format($TotalAmoutofTheMonth);?></td>
          </tr>
          <?		 
  } /* for($i=0;$i<12;$i++) */
?>
        
      </table></td>
  </tr>
</table>
