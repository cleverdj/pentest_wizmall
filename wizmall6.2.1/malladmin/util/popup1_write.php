<?
/* 

powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 
Copyright shop-wiz.com
*** Updating List ***

*/
$BOARD_NAME="wizpopup";



if($query == "insert"){

	/* 파일 업로딩 시작 */
	unset($pattached);
	$file_field_name = "file";
	file_uploade($file_field_name);
	for($i=0; $i<sizeof($file); $i++){
	$MicroTsmp = split(" ",microtime());
	$newFileName = str_replace(".", "", $MicroTsmp[0]);
		if($file_name[$i]!="none" && $file_name[$i]){
			$extention = strrchr($file_name[$i], ".");
			$file_name[$i]=time()."".$extention;
			if (file_exists("../config/wizpopup/$file_name[$i]")) {
			$file_name[$i] = $newFileName."_$file_name[$i]";
			}    
			if(!move_uploaded_file($file_tmp_name[$i], "../config/wizpopup/$file_name[$i]")) {
			echo "파일 업로드에 실패 하였습니다.";
			exit;}
		}
		$pattached .=$file_name[$i]."|";	
	}
	/* 파일 업로딩 끝 */
	if(!$phtmlenable) $phtmlenable = 0;
	if(!$pshtmlenable) $pshtmlenable = 0;
	if(!$pbgenable) $pbgenable = 0;
	$options = $phtmlenable."|".$pshtmlenable."|".$pbgenable."|";
	
	$sqlstr = "insert into $BOARD_NAME (pskinname,pwidth,pheight,ptop,pleft,psubject,pcontents,pattached,imgposition,popupenable,options)
	values('$pskinname','$pwidth','$pheight','$ptop','$pleft','$psubject','$pcontents','$pattached','$imgposition','$popupenable','$options')";
	$dbcon->_query($sqlstr) ;
	echo "<script>alert('성공적으로 저장되었습니다.');location.href='$PHP_SELF?menushow=$menushow&theme=util/popup1';</script>";
}else if($query == "update"){

	/* 파일 업로딩 시작 */
	$sqlstr="select pattached from $BOARD_NAME WHERE uid='$uid'";
	$piclistvalue=$dbcon->get_one($sqlstr);
	$piclist = split("\|", $piclistvalue);	
	unset($pattached);
	$file_field_name = "file";
	file_uploade($file_field_name);
	for($i=0; $i<sizeof($file); $i++){
	$MicroTsmp = split(" ",microtime());
	$newFileName = str_replace(".", "", $MicroTsmp[0]);
		if($preserveimg[$i] == "1" && $piclist[$i]){
			unlink("../config/wizpopup/$piclist[$i]");
		}
		if($file_name[$i]!="none" && $file_name[$i]){
			$extention = strrchr($file_name[$i], ".");	
			$file_name[$i] = time()."".$extention;
			if($piclist[$i]) unlink("../config/wizpopup/$piclist[$i]");
			if (file_exists("../config/wizpopup/$file_name[$i]")) {
			$file_name[$i] = $newFileName."_$file_name[$i]";
			}    
			if(!move_uploaded_file($file_tmp_name[$i], "../config/wizpopup/$file_name[$i]")) {
			echo "파일 업로드에 실패 하였습니다.";
			exit;}
		$UPDIR[$i]=$file_name[$i];
		}else{ $UPDIR[$i]=$piclist[$i];
			if($preserveimg[$i] == "1" && $piclist[$i]){
				$UPDIR[$i] = "";
			}
		}
	$pattached .=$UPDIR[$i]."|";
	}
	/* 파일 업로딩 끝 */


	if(!$phtmlenable) $phtmlenable = 0;
	if(!$pshtmlenable) $pshtmlenable = 0;
	if(!$pbgenable) $pbgenable = 0;
	$options = $phtmlenable."|".$pshtmlenable."|".$pbgenable."|";
	$sqlstr = "update $BOARD_NAME set pskinname='$pskinname',pwidth='$pwidth',pheight='$pheight',ptop='$ptop',pleft='$pleft',
	psubject='$psubject',pcontents='$pcontents',pattached='$pattached',imgposition='$imgposition',popupenable='$popupenable',options='$options'
	where uid='$uid'";
	$dbcon->_query($sqlstr);
	echo "<script>alert('성공적으로 수정되었습니다.');location.href='$PHP_SELF?menushow=$menushow&theme=util/popup1';</script>";
}



if($mode == "update"){
	$sqlstr = "select * from $BOARD_NAME where uid = '$uid'";
	$dbcon->_query($sqlstr);
	$list = $dbcon->_fetch_array();
	$options = split("\|", $list[options]);
	$phtmlenable = $options[0];
	$pshtmlenable = $options[1];
	$pbgenable = $options[2];	
}else {
	$mode = "insert";
}
?>
<script language="Javascript1.2" >
<!-- // load htmlarea
_editor_url = "../js/";                     // URL to htmlarea files
var win_ie_ver = parseFloat(navigator.appVersion.split("MSIE")[1]);
if (navigator.userAgent.indexOf('Mac')        >= 0) { win_ie_ver = 0; }
if (navigator.userAgent.indexOf('Windows CE') >= 0) { win_ie_ver = 0; }
if (navigator.userAgent.indexOf('Opera')      >= 0) { win_ie_ver = 0; }
if (win_ie_ver >= 5.5) {
  document.write('<scr' + 'ipt src="' +_editor_url+ 'editor.js"');
  document.write(' language="Javascript1.2"></scr' + 'ipt>');  
} else { document.write('<scr'+'ipt>function editor_generate() { return false; }</scr'+'ipt>'); }
// -->
</script>

<table class="table_outline">
  <tr>
    <td valign="top"><table class="table_title">
        <TR>
          <TD bgColor=#ffffff><b> <font color="#FF6600">팝업창 관리</font></b></TD>
        </TR>
        <TR>
          <TD bgColor=#ffffff><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0 class="s1">
              <TR>
                <TD vAlign=top align=center width=70><font color=#ff6600>[note]</font> </TD>
                <TD><p>만약 index.php에 아래코드가 없을 경우 아래 코드를 넣어 준다.<br>
                    &lt;?<br>
                    include &quot;./util/wizpopup/popinsert.php&quot;;<br>
                    ?&gt; </p></TD>
              </TR>
            </TABLE></TD>
        </TR>
      </TABLE>
      <br>
      <table class="table_main">
        <form action='<?=$PHP_SELF?>' method='post' enctype="multipart/form-data">
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type='hidden' name='theme' value='<?=$theme?>'>
          <input type="hidden" name="query" value="<? echo $mode;?>">
          <input type='hidden' name='uid' value='<?=$uid?>'>
          <input type="hidden" name="phtmlenable" value="1">
          <tr bgcolor="#FFFFFF">
            <td width="150" height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">스킨선택</font></strong></td>
            <td>&nbsp;
              <select style="WIDTH: 160px" name=pskinname class="dd1">
                <?
$vardir = "../util/wizpopup";
$open_dir = opendir($vardir);
while($opendir = readdir($open_dir)) {
	if(($opendir != ".") && ($opendir != "..") && is_dir("$vardir/$opendir")) {
		$selected = $list[pskinname]==$opendir?"selected":""; 
		echo "<option value=\"$opendir\" $selected>$opendir 스킨</option>\n";
	}
}
closedir($open_dir);
?>
              </select>
              &nbsp; </td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td width="150" height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">팝업창 
              크기 </font></strong></td>
            <td>&nbsp;가로
              <input name='pwidth' type='text' value ="<?=$list[pwidth]?>" class='dd1' size="5" >
              pixels X 세로
              <input name='pheight' type='text' value ="<?=$list[pheight]?>" class='dd1' size="5">
              pixels </td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td width="150" height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">팝업창 
              위치</font></strong></td>
            <td>&nbsp;상단
              <input name='ptop' type='text' value ="<?=$list[ptop]?>" class='dd1' size="5" >
              pixels , 좌측
              <input name='pleft' type='text' value ="<?=$list[pleft]?>" class='dd1' size="5">
              pixels (브라우저로부터 디스플레이 위치)</td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td width="150" height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">공지제목<br>
              <input type="checkbox" name="pshtmlenable" value="checkbox" <? echo $pshtmlenable=="1"?"checked":"";?>>
              HTML 사용 </font></strong></td>
            <td>&nbsp;
              <input name="psubject" type="text" value="<?=$list[psubject]?>" size="40" class='dd1'>
              (일부스킨에 따라 적용가능)</td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">공지내내용<br>
              </font></strong></td>
            <?
$pcontents = stripslashes($pcontents);
?>
            <td>&nbsp;
              <textarea name="pcontents" rows="20" style="width:95%"><?=$list[pcontents]?>
</textarea>
              <br>
              <font color="#000000"> &nbsp;&nbsp;줄바꿈 : Shift + Enter &nbsp;&nbsp;&nbsp; 
              문단바꿈 : Enter</B></font>
              <script language='javascript1.2'>
		editor_generate('pcontents');
		</script>
              </font> </td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td height="38" align='right' bgcolor="E0E4E8"><strong><font color="#000000">이미지업로딩<br>
              <!--  <input type="checkbox" name="pbgenable" value="checkbox" <? echo $pbgenable=="1"?"checked":"";?>>
              BG로 띄우기</font>-->
              </strong></td>
            <td>&nbsp;
              <input type="file" name="file[0]" class='dd1'>
              <input name="preserveimg[0]" type="checkbox" value="1">
              이미지삭제</td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td height="38" align='right' bgcolor="E0E4E8"><strong><font color="#000000">이미지위치<br>
              <!--  <input type="checkbox" name="pbgenable" value="checkbox" <? echo $pbgenable=="1"?"checked":"";?>>
              BG로 띄우기</font>-->
              </strong></td>
            <td>&nbsp;
              <select name="imgposition">
                <option value="top" <? echo $list[imgposition]=="top"?"selected":"";?>>상</option>
                <option value="bottom" <? echo $list[imgposition]=="bottom"?"selected":"";?>>하</option>
              </select></td>
          </tr>
          <tr bgcolor="#FFFFFF">
            <td height="25" align='right' bgcolor="E0E4E8"><strong><font color="#000000">PopUp 
              Enable</font></strong></td>
            <td><font color="#000000"> &nbsp;
              <input name="popupenable" type="checkbox" value="1" <? echo $list[popupenable]=="1"?"checked":"";?>>
              (팝업창을 띄우시려면 이곳에 책크가 되어있어야 합니다.)</font></td>
          </tr>
          <tr align="center" bgcolor="#FFFFFF">
            <td colspan="2"><script>nhnButton('<font color=blue>적용</font>','black9','javascript:submit();',4,0,'#565656','#FFFFFF','#C4C4C4','#ffffff','#ffffff','#ffffff')</script>
            </td>
          </tr>
        </form>
      </table></td>
  </tr>
</table>
