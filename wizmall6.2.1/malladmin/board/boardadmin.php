<?
/* 
powered by 폰돌
Reference URL : http://www.shop-wiz.com
Contact Email : master@shop-wiz.com
Free Distributer : 

*** Updating List ***
*/

include "../lib/class.board.php";
$board = new board();
$board->get_object($dbcon, $common);

$GID = "root";
if(!strcmp($create_table,"makeit")){
	/* New Table 생성 */	
	$SetupPath = "../config/wizboard";	
	$SourcePath = "../wizboard";	
	$board->createTable($m_bid, $GID, $TABLE_DES, $AdminName, $Pass, $group, $SetupPath, $SourcePath,$default_option);
}//if(!strcmp($create_table,"makeit"))에 대한 것을 닫음


/* 테이블설명 및 패스워드 변경 */
if(!strcmp($MODE,"ChangeIt")){
	$sqlstr = "UPDATE wizTable_Main SET BoardDes ='$BoardDes', AdminName='$AdminName', Pass='$Pass' WHERE BID ='$BID' and GID='$GID'";
	$dbcon->_query($sqlstr); 
	ECHO"<script>window.alert('성공적으로 변경되었습니다.'); location.replace('${PHP_SELF}?menushow=$menushow&theme=$theme&GID=${GID}&cp=$cp&Grp=$Grp&ListCount=$ListCount&SEARCHTITLE=$SEARCHTITLE&searchkeyword=$searchkeyword');</script>";
	exit;	
}
?>
<script>
<!--
function reSize() {
    try {
        var objBody = auto_iframe.document.body;
        var objFrame = document.all["auto_iframe"];
        ifrmHeight = objBody.scrollHeight + (objBody.offsetHeight - objBody.clientHeight);
        objFrame.style.height = ifrmHeight;
    }
        catch(e) {}
}

function init_iframe() {
    reSize();
    setTimeout('init_iframe()',1)
}

init_iframe();
//-->
</script>
<table class="table_outline">
  <tr>
    <td valign="top"><table class="table_title">
        <tr>
          <td bgcolor=#ffffff><b><font color="#FF6600">게시판관리</font></b></td>
        </tr>
        <tr>
          <td bgcolor=#ffffff><table cellspacing=0 cellpadding=0 width="100%"  border=0 class="s1">
              <tr>
                <td width=57 align=middle valign="top"><font color=#ff6600>[note]</font> </td>
                <td width="697">게시판의 생성및 게시물삭제 비번, 기타 등 게시물에 대한 조치를 취하는 곳입니다.<br>
                  일부 게시판은 관리자에서 제공되는 쓰기/보기폼이 다를 수 있으므로 이 경우는 웹페이지에서 직접 작성해 주시기 
                  바랍니다.<br>
                  보드의 삭제 및 그룹변경은 유의를 하셔야 하며 보드삭제는 <a href="../wizboard/index.php"><font color="#FF0000">이곳</font></a>을 
                  클릭하신 후 진행하시면됩니다.<br>
                  - 게시판상단 공지글을 입력하실 경우는 topnotice 테이블을 생성해 주시기 바랍니다.<br>
                  단, 게시판스킨에 따라 상단 공지글을 적용/비적용될 수 있습니다.</td>
              </tr>
            </table></td>
        </tr>
      </table>
      <br>
      <?
if($AdminBID)
{
 //include ("./boardlist.php");
?>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td><!-- board List start -->
            <iframe src="../wizboard.php?adminmode=true&BID=<?=$AdminBID?>&GID=<? echo $AdminGID; ?>" width="760" height="800" frameborder="0" framespacing="0" name="auto_iframe" id="auto_iframe" scrolling="no"></iframe></td>
        </tr>
      </table>
      <br>
      <?
}else{
?>
      <!-- board List End -->
      <table class="table_main">
        <tr align=middle bgcolor="E0E4E8">
          <td colspan=7 height=10></td>
        </tr>
        <FORM action="<?=$PHP_SELF?>" method="post">
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type=hidden name="theme" value="<?=$theme?>">
          <input type="hidden" name="GID" value="<? echo $GID; ?>">
          <input type="hidden" name="create_table" value="makeit">
          <tr bgcolor=#ffffff>
            <td width=80><font color="#000000">테이블이름</font></td>
            <td width="170"><font color="#000000">
              <input name=m_bid class="dd1">
              </font></td>
            <td width=76><font color="#000000">테이블설명</font></td>
            <td width="171"><font color="#000000">
              <input name="TABLE_DES" class="dd1">
              </font></td>
            <td align=middle width=61><font color="#000000">패스워드</font></td>
            <td width="107" align=middle><font color="#000000">
              <input name=Pass type="password" class="dd1" size=15 maxlength=15>
              </font></td>
            <td align=middle width=65><div align="center"><font color="#000000">
                <input type="image" src="img/sang.gif" width="53" height="20">
                </font></div></td>
          </tr>
        </form>
        <tr align=middle bgcolor="E0E4E8">
          <td colspan=7 
            height=10></td>
        </tr>
      </table>
      <br>
      <table width="760" border="0" cellspacing="0" cellpadding="0" class="s1">
        <form action="<?=$PHP_SELF?>" name="ListCountForm" method="get">
          <input type="hidden" name="Grp" value="<?=$Grp?>">
          <input type="hidden" name="GID" value="<? echo $GID; ?>">
          <input type='hidden' name='menushow' value='<?=$menushow?>'>
          <input type="hidden" name="theme" value="boardadmin">
          <tr>
            <td>리스트수:
              <select name="ListCount" onChange="submit()">
                <option value="10" <? if($ListCount == 10) echo "selected";?>>10</option>
                <option value="15" <? if($ListCount == 15) echo "selected";?>>15</option>
                <option value="20" <? if($ListCount == 20) echo "selected";?>>20</option>
                <option value="30" <? if($ListCount == 30) echo "selected";?>>30</option>
                <option value="50" <? if($ListCount == 50) echo "selected";?>>50</option>
                <option value="100" <? if($ListCount == 100) echo "selected";?>>100</option>
              </select>
              <select name="SEARCHTITLE">
                <option value="BoardDes" <? if($SEARCHTITLE =="BoardDesd") echo "selected";?>>테이블설명</option>
                <option value="BID" <? if($SEARCHTITLE =="BID") echo "selected";?>>테이블명</option>
              </select>
              <input type="text" name="searchkeyword" value="<?=$searchkeyword?>">
              <input type="submit" name="Submit3" value="검색">
              <input type="button" name="Submit4" value="전체" onclick="javascript:location.href=('<?=$PHP_SELF?>?theme=<?=$theme?>&menushow=<?=$menushow?>');"></td>
          </tr>
        </form>
      </table>
      <table cellspacing=1 bordercolordark=white width="760" 
            bgcolor=#c0c0c0 bordercolorlight=#dddddd border=0 class="s1">
        <tr align=middle bgcolor=E0E4E8>
          <td width=0><font color="#000000">테이블명</font></td>
          <td width=0><font color="#000000">테이블설명</font></td>
          <td width=0><font color="#000000">패스워드<br>
            ( 게시판 관리시 사용)</font></td>
          <td width=0><font color="#000000">경로<br>
            (웹루트에서의 경로)</font></td>
          <td width=0><font color="#000000">패스워드<br>
            변경 </font></td>
          <td width=0><font color="#000000">상세옵션<br>
            수정 </font></td>
          <td width=0><font color="#000000">게시물<br>
            관리</font></td>
          <td width=0 align="center"><font color="#000000">보기</font></td>
        </tr>
        <?
if($Grp) $WHERE = "WHERE Grade != 'A' AND Grp='$Grp'";
else $WHERE = "WHERE Grade != 'A' ";
if($SEARCHTITLE && $searchkeyword) $WHERE .= "and $SEARCHTITLE like '%$searchkeyword%'";

$TargetBoard = "wizTable_Main";
/* 총 갯수 구하기 */
$TOTAL_STR = "SELECT count(UID) FROM $TargetBoard $WHERE";
$TOTAL = $dbcon->get_one($TOTAL_STR);

if(!isset($ListCount) || !$ListCount) $ListCount = 10;
$LIST_NO=$ListCount; /* 페이지당 출력 리스트 수 */
$PageNo=10; /* 페이지 밑의 출력 수 */
if(empty($cp) || $cp <= 0) $cp = 1;

$START_NO = ($cp - 1) * $LIST_NO;
$BOARD_NO=$TOTAL-($LIST_NO*($cp-1));
$SELECT_STR="SELECT * FROM $TargetBoard $WHERE ORDER BY BID ASC LIMIT $START_NO, $LIST_NO";
$dbcon->_query($SELECT_STR);
while($BOARD_LIST=$dbcon->_fetch_array()):
?>
        <tr bgcolor=#ffffff>
          <FORM ACTION=<?=$PHP_SELF?>>
            <input type="hidden" name="BID" value="<?=$BOARD_LIST["BID"]?>">
            <input type="hidden" name="GID" value="<?=$GID?>">
            <input type="hidden" name="MODE" value="ChangeIt">
            <input type='hidden' name='menushow' value='<?=$menushow?>'>
            <input type="hidden" name="theme" value="<?=$theme?>">
            <input type="hidden" name="Grp" value="<?=$Grp?>">
            <input type="hidden" name="cp" value="<?=$cp?>">
            <input type="hidden" name="ListCount" value="<?=$ListCount?>">
            <input type="hidden" name="SEARCHTITLE" value="<?=$SEARCHTITLE?>">
            <input type="hidden" name="searchkeyword" value="<?=$searchkeyword?>">
            <td align=middle height=28><font color="#000000">
              <?=$BOARD_LIST[BID]?>
              </font></td>
            <td align=middle height=28><font color="#000000">
              <input 
                  name=BoardDes class="dd1" value="<?=$BOARD_LIST[BoardDes]?>" size=15 maxlength=15>
              </font></td>
            <td align=middle height=28><font color="#000000">
              <input size=15 name=Pass class="dd1" value="<?=$BOARD_LIST[Pass]?>">
              </font></td>
            <td height=28><font color="#000000"><? echo "wizboard.php?BID=".$BOARD_LIST[BID]."&GID=".$BOARD_LIST[GID]; ?> </font></td>
            <td align=center height=28><font color="#000000"> <img src="img/byun.gif" width="55" height="20" onclick="javascript:submit()"; style="cursor:pointer;"></font></td>
            <td align=center height=28><font color="#000000"><img src="img/su.gif" width="53" height="20" border="0" onclick="javascript:window.open('../wizboard/admin1.php?BID=<?=$BOARD_LIST[BID]?>&GID=<? echo $GID; ?>','옵션보기','scrollbars=yes,resizable=yes,width=630,height=500')"; style="cursor:pointer;"> </font></td>
            <td align=center height=28><font color="#000000"><A HREF="<?=${PHP_SELF}?>?AdminBID=<?=$BOARD_LIST[BID]?>&AdminGID=<? echo $GID?>&menushow=<?=$menushow?>&theme=<?=$theme?>&cp=<?=$cp?>&ListCount=<?=$ListCount?>&SEARCHTITLE=<?=$SEARCHTITLE?>&searchkeyword=<?=$searchkeyword?>"><img src="img/board_icon1.gif" width="66" height="20" border="0"></a></font></td>
            <td align=center height=28><font color="#000000"><A HREF="../wizboard.php?BID=<?=$BOARD_LIST[BID]?>&GID=<? echo $GID?>" target="_blank"><img src="img/board_icon2.gif" width="66" height="20" border="0"></a></font></td>
          </form>
        </tr>
        <?
endwhile;
?>
      </table>
      <br>
      <table cellspacing=0 cellpadding=0 width="100%" border=0>
        <tr>
          <td align=center class="s1"><?
/* 페이지 번호 리스트 부분 */
/* PREVIOUS or First 부분 */
$page_arg1 = $PHP_SELF."?menushow=$menushow&theme=$theme&Grp=$Grp&SEARCHTITLE=$SEARCHTITLE&searchkeyword=".urlencode($searchkeyword)."&ListCount=$ListCount";
$page_arg2 = array("listno"=>$ListNo,"pageno"=>$PageNo,"cp"=>$cp,"total"=>$TOTAL); 
//$page_arg3 = array("pre"=>"./img/pre.gif","next"=>"./img/next.gif");
echo $common->paging($page_arg1,$page_arg2,$page_arg3);
?>
          </td>
        </tr>
      </table>
      <br>
      <?
      }
	  ?></td>
  </tr>
</table>
