<?php
/* 
제작자 : 폰돌
제작자 URL : http://www.shop-wiz.com
제작자 Email : master@shop-wiz.com
Free Distributer 

*** Updating List ***
*/
include "./lib/cfg.common.php";

/****************** // 장바구니 비우기(주문완료후 query=order&option=trash 일경우 ***********************/
if (!strcmp($option,"trash")){ 
        if (file_exists("./config/wizmember_tmp/mall_buyers/$_COOKIE[CART_CODE]")){
        unlink("./config/wizmember_tmp/mall_buyers/$_COOKIE[CART_CODE]");
        setcookie("CART_CODE","",0,"/");
        }
}
include("./config/db_info.php");
include "./config/cfg.core.php";
include "./config/common_array.php";

include "./lib/class.database.php";
$dbcon		= new database($cfg["sql"]);

include "./lib/class.common.php";
$common = new common();
$cfg["member"] = $common->getLogininfo();//로그인 정보를 가져옮
$common->db_connect($dbcon);

include ("./lib/class.wizmall.php");
$mall = new mall;
$mall->db_connect($dbcon);

include ("./lib/class.cart.php");
$cart = new cart;
$cart->get_object($dbcon,$common);

if ($query == 'non_member_order') {
	$dbcon->_query("SELECT * FROM wizBuyers WHERE OrderID='$OrderID'");
	$LLIST = $dbcon->_fetch_array();
	if (!$LLIST) {
		ECHO "<script language=javascript>
		window.alert(' 주문번호에 문제가 있습니다. \\n 다시 한 번 확인해주시기 바랍니다.');
		history.go(-1);
		</script>";
		exit;
	}
}

/****************** 본격적으로 본론 진입 ***********************/
$mem_skin_path = "./wizmember/".$cfg["skin"]["MemberSkin"];//

if(!strcmp($cfg["mem"]["INCLUDE_MALL_SKIN"],"yes")):/* WizMember 스킨 인클루드 책크시 */

if(file_exists("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/layout_start.php")) include ("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/layout_start.php");

if(!$TABLE_WIDTH) $TABLE_WIDTH = "100%";
if(!$TABLE_ALIGN) $TABLE_ALIGN = "DEFAULT";
?>
<script language="javascript" src="./js/wizmall.js"></script>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr> 
    <td> 
      <!-- top menu start -->
      <?
if (file_exists("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/menu_top.php")) include ("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/menu_top.php");
?>
      <!-- top menu end -->
    </td>
  </tr>
  <tr> 
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="170" valign="top"> 
            <!-- left menu start -->
            <?
if ($cfg["skin"]["MenuSkin_Inc"] == 'checked') include ("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/menu_left.php");
?>
            <!-- left menu end -->
          </td>
          <td width="10">&nbsp;</td>
          <td valign="top"><table width="2" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td height="1"> </td>
                    </tr>
                  </table>
            <table width="720" border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <td> 
                  <!-- main menu start -->
                  <?
/* wizMember에 스킨 인클루드 책크시 */
endif;
?>
                  <?				  
if(file_exists("./config/MemberSkinTop.php"))include "./config/MemberSkinTop.php";
?>
                  <table width="<?=$TABLE_WIDTH?>" border="0" cellpadding="0" cellspacing="0" align="<?=$TABLE_ALIGN?>">
                    <tr> 
                      <td valign="top"> 
                        <?
/* 로그인 후 움직이는 페이지 */
unset($status); /* 로그인과 이후 혹은 query 값에 대한 다양한 결과가 요구되므로 $status의 상황에 따라 각각 행동 반경을 정한다. */
if ($cfg["member"]) {
	if ($query == 'point') {
		include ($mem_skin_path."/USER_POINT.php");
		$status = $query;
	}
	else if ($query == 'order') {
		include ($mem_skin_path."/USER_ORDER.php");
		$status = $query;
	}
	else if ($query == 'info') {
		include ($mem_skin_path."/USER_INFO.php");
		$status = $query;
	}
	else if ($query == 'logout') {
		include ("./wizmember/LOG_OUT.php");
		$status = $query;
	}
	else if ($query == 'wish') {
		include ("./skinwiz/wizwish/".$cfg["skin"]["WishSkin"]."/USER_WISH.php");
		$status = $query;
	}
	else if ($query == "mypage") { /*MyPage Total list */
		include ($mem_skin_path."/MYPAGE.php");
		$status = $query;
	}
	else if ($query == "logmanage") { /* 일정관리 관련 */
		include ("./util/wizcalendar/DEFAULT_MALL/index.php");
		$status = $query;
	}
	else if ($query == "logmanage_list") { /* 일정관리 관련 */
		include ("./util/wizcalendar/DEFAULT_MALL/list.php");
		$status = $query;
	}
	else if ($query == "logmanage_write") { /* 일정관리 관련 */
		include ("./util/wizcalendar/DEFAULT_MALL/write.php");
		$status = $query;
	}
	else if ($query == "clickpd") { /* 오늘 본 상품 */
		include ($mem_skin_path."/clickPd.php");
		$status = $query;
	}
	else if ($query == "mycoupon") { /* 쿠폰페이지 */
		include ($mem_skin_path."/mycoupon.php");
		$status = $query;
	}
	else if ($query == 'out') {//회원탈퇴
		include ($mem_skin_path."/USER_OUT.php");
		$status = $query;
	}
	else if ($query == 'regismore') {  //회원가입단계중 추가회원정보입력시 이 옵션 사용(커뮤니티 사이트용)
		include ($mem_skin_path."/USER_REGIS_MORE.php");
		$status = $query;
	}
	else if ($query == 'login' || $query == 'regis_step1' ) {  //회원가입단계중 추가회원정보입력시 이 옵션 사용(커뮤니티 사이트용)
		include ($mem_skin_path."/USER_INFO.php");
		$status = "info";
	}	
	else if ($query == 'chpass') {  //패스워드만 단독 변경
		include ($mem_skin_path."/USER_PASSCHANGE.php");
		$status = "chpass";
	}		
}
/* 로그인 없이 갈 수 있는 페이지 */
	//exit;	
if (!strcmp($query,"passsearch") && !$status) {
	include ($mem_skin_path."/PASS_SEARCH.php");
}
else if (!strcmp($query,"idsearch") && !$status) {
	include ($mem_skin_path."/ID_SEARCH.php");
}
else if (!strcmp($query,"idpasssearch") && !$status) {
	include ($mem_skin_path."/IDPASS_SEARCH.php");
}				
else if (!strcmp($query,"accept") && !$status) { /* 일반회원가입 */
	include ($mem_skin_path."/USER_REGIS_AGGREE.php");
}
else if (!strcmp($query,"select") && !$status) { /* 일반회원가입 */
	include ($mem_skin_path."/USER_REGIS_SELECT.php");
}		
else if (!strcmp($query,"regis_step1") && !$status) { /*  점진적으로 regis를 regis_step1, 2, 3...으로변경*/
	include ($mem_skin_path."/USER_REGIS_STEP1.php");
}		
else if (!strcmp($query,"regis_step2") && !$status) { /*  */
	include ($mem_skin_path."/USER_REGIS_STEP2.php");
}		
else if (!strcmp($query,"regis_step3") && !$status) { /*  */
	include ($mem_skin_path."/USER_REGIS_STEP3.php");
}
else if (!strcmp($query,"regis_done") && !$status) { /*  */
	include ($mem_skin_path."/MEMBER_REGIST_DONE.php");
}
else if (!strcmp($query,"regis_paymember") && !$status) { /*  */
	include ($mem_skin_path."/USER_REGIS_PAY.php");
}			
else if (!strcmp($query,"myblog") && !$status) { /*블로그회원가입 */
	include ($mem_skin_path."/BlogUserLogin.php");
}
else if(!strcmp($query,"non_member_order") && !$status) {
	include ($mem_skin_path."/USER_ORDER_SPEC.php");
}
else if(!strcmp($query,"order_spec") && !$status) {
	include ($mem_skin_path."/USER_ORDER_SPEC.php");
}
else if(!strcmp($query,"login") && !$status) {
	include ($mem_skin_path."/USER_LOGIN.php");
}					
else if(!$status){
	
	$file="wizmember";
	$goto=$query;		
	include ($mem_skin_path."/USER_LOGIN.php");
}

?>
                      </td>
                    </tr>
                  </table>
                  <?
if(file_exists("./config/MemberSkinBottom.php")) include "./config/MemberSkinBottom.php";
?>
                  <?
if(!strcmp($cfg["mem"]["INCLUDE_MALL_SKIN"],"yes")):/* wizMember에 스킨 인클루드 책크시 */				  
?>
                  <!-- main menu end -->
                </td>
              </tr>
            </table> </td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td> 
      <!-- bottom menu start -->
      <?
if (file_exists("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/menu_bottom.php")) include ("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/menu_bottom.php");
?>
      <!-- bottom menu end -->
    </td>
  </tr>
</table>
<?
include ("./skinwiz/layout/".$cfg["skin"]["LayoutSkin"]."/layout_close.php");
/* WizMember 에 스킨 인클루드 책크시 */
endif;
?>