<?php
/**
* 상단 프레임
*
* @filename : main/top.php
* @version  : v 1.0 2003.07.18 18:26:44
* @author   : nsl  <smpoem@magicn.com>
*/

$_SKYDIR_URL = '../';

// 기본 설정 초기화
include_once '../common/skydir_init.php';

// .., . 값을 반영한 절대경로
$cd = realpath($cd);

// 현재 위치를 구한다 맨앞에 / 제거
$curdir = substr($cd, 1, strlen($cd));


// ftp class 초기화
$ftp = new SkyFtp($rcfg->ftpHost, $rcfg->ftpPort, $rcfg->ftpUserID, $rcfg->ftpUserPW);
// ftp 연결
if (!$ftp->ftpLogin()) {

    $ftp->ftpClose();
    $isFtpCon = false;
}
$ftp->ftpClose();

include (HEADER_FILE);
?>
<script language="javascript">
<!--

    //window.onload = initToolBarTop

    function topRefresh() {
       
       <?  
           // 이렇게 구분하지 않으면 자바스크립트 에러남
           // FTP 연결이면
           if ($isFtpCon) {
       ?>
           var cd =  parent.top.right.layerCode.cd.value;
       <?
           } else { 
           // 접속 실패이면 초기 디렉토리
       ?>
           var cd = '<?=$rcfg->initDirRight?>';
       <? } ?>

       parent.dtop.location.href =  '../main/<?=$dcfg->topFile?>' + '?cd=' + cd;
       parent.left_top.location.href =  '../main/left_top.php' + '?cd=' + cd;
       parent.left.location.href =  '../main/<?=$dcfg->leftFile?>' + '?cd=' + cd;
       parent.right.location.href = '../main/<?=$dcfg->rightFile?>?rf=1' + '&cd=' + cd;

       parent.left_bottom.location.reload();
       parent.bottom.location.reload();
    }

	// left 프레임의 스크롤바 위치 top
	function getLeftScrollTop() {

		if (isExplorer) return parent.left.document.body.scrollTop;
		else            return parent.left.window.pageYOffset;
    }

    
    function topClick(cdVal) {

        // 왼쪽 스크롤바 위치
        var leftScrollTop = getLeftScrollTop();

//        window.parent.dtop.location.href   = '<?="$dcfg->topFile?cd="?>' + cdVal;
        window.parent.right.location.href = '<?="$dcfg->rightFile?cd="?>' + cdVal;

        // 왼쪽 프레임도
        window.parent.left.location.href = '<?="$dcfg->leftFile?cd="?>' + cdVal  + '&toppos=' + leftScrollTop;
        return;
    }


    function initToolBarTop() {

        // 폴더 버튼 토글
//	    addToggle(setLeftFrameButton);
//		toggle(setLeftFrameButton, imgLeftFrameButton);
//	    makePressed(setLeftFrameButton);

        // 이미지 버튼 토글
//	    addToggle(setLeftBottomButton);
//		toggle(setLeftBottomButton, imgLeftBottomButton);
//	    makePressed(setLeftBottomButton);

    }

    /**
    * 메세지 원도우를 띄운다
    *
    * @param  string  code : 코드
    * @param  integer winWidth  : 원도우 width
    * @param  integer winHegith : 원도우 height
    */
    function msgWin(code, width, height, isDialog) {

        // 기본 크기 설정
        if (width == -1)  width = 500;
        if (height == -1) height = 450;

        // center 위치 설정
        var left = sky.getCenterPosLeft(width);
        var top  = sky.getCenterPosTop(height);


       // window.showModelessDialog 5.0
       // window.showModalDialog 4.0
       if (window.showModalDialog && isDialog) {

             var option = "dialogHeight: " + height + "px; dialogWidth: " + width + "px;";
                 option += "dialogTop: " + top + "px; dialogLeft: " + left + "px; ";
                 option += "edge: Raised; center: No; help: No; resizable: No; status: No; scroll: no";

            winName = window.showModalDialog('../php/msgwin.php?wmode=dwin&code=' + code, code, option);
        } else if (isDialog) {

            var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top;
            winName = window.open('../php/msgwin.php?wmode=win&code=' + code, code, option);
        } else {

            var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top;
            winName = window.open('../php/msgwin.php?wmode=nwin&code=' + code, code, option);
        }

//        winName.focus();
        return;

    } // msgWin() End


    /**
    * 메세지 원도우를 띄운다 (환경설정)
    *
    * @param  string  code : 코드
    * @param  integer winWidth  : 원도우 width
    * @param  integer winHegith : 원도우 height
    */
    function configWin(code, width, height) {

        // 기본 크기 설정
        if (width == -1)  width = 500;
        if (height == -1) height = 480;

        // center 위치 설정
        var left = sky.getCenterPosLeft(width);
        var top  = sky.getCenterPosTop(height);

        var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top;
        winName = window.open('../php/configwin.php?wmode=nwin&code=' + code, code , option);
        winName.focus();

        return;

    } // configWin() End

    /**
    * 파일찾기 원도우를 띄운다
    *
    */
    function searchWin() {

        // 기본 크기 설정
        var width  = 500;
        var height = 480;

        // center 위치 설정
        var left = sky.getCenterPosLeft(width);
        var top  = sky.getCenterPosTop(height);

        var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top + ',scrollbars=yes, resizable=yes';
        winName = window.open('../php/file_search.php?wmode=nwin', '' , option);
        winName.focus();

        return;

    } // configWin() End
 
    /**
    * 접속하기 원도우를 띄운다
    *
    */
    function connectWin() {

        // 기본 크기 설정
        var width  = 500;
        var height = 420;

        // center 위치 설정
        var left = sky.getCenterPosLeft(width);
        var top  = sky.getCenterPosTop(height);

        var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top + ' ';
        winName = window.open('../php/connect_win.php?install=<?=$_REQUEST['install']?>&wmode=nwin&code=connect_win', '' , option);
        winName.focus();

        return;

    } // connectWin() End
 

    // 인쇄
    function setPrint() {

           top.right.focus(); 
           window.print();
    }

    // 시스템 정보
    function systemInfo() {

        var width  = 350;
        var height = 250;

        var left = sky.getCenterPosLeft(width);
        var top  = sky.getCenterPosTop(height);

        var option = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top;

        window.open('msg/systeminfo.php', '', option);
        return;
    }


    //
    function setImgViewerButton() {

        top.bottom.location.href = '../main/bottom.php?imgmode=reset';
    }


    function goExit() {

        top.close();
    }

<?
// 처음 설치시에 -> 접속정보 창 띄움
if ($_REQUEST['install'] == 'first') {
?>
    connectWin();
<? } ?>
//-->
</script>
<!-- 시계 -->
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" bgcolor="<?=$rcfg->winColor?>" <?=$dcfg->body?>>
<fieldset style="height:100%; width:100%; margin-top: 3; ">

<table border=0 cellpadding=0 cellspacing=0 width=100%>
<tr>
  <td>

  <fieldset style="width:100%; border-top:0; border-left:0; border-right:0;">

  <table border=0 cellpadding=0 cellspacing=0 width=100%>
  <tr>
    <td width=600>

  <table width=600 border=0 cellpadding=0 cellspacing=0 valign=middle style="line-height:105%" class="toolBar2" id="topMenuTable">

  <tr>
    <td width=10></td>
    <td id="topConnectButton" OnClick="connectWin()"  style="word-break:break-all" nowrap valign=middle align=center width=60>
	<img src="../image/top_connect.gif" border="0"><br><?=$lg->topConnect?></td>
    <td width=10></td>
    <td id="topRefreshButton" OnClick="topRefresh()"  style="word-break:break-all" nowrap valign=middle align=center width=60>
	<img src="../image/top_refresh.gif" border="0"><br><?=$lg->topRefresh?></td>

    <td id="setLeftFrameButton" OnClick="parent.left_top.setLeftFrame()"   style="word-break:break-all"  nowrap valign=middle align=center width=50>
	<img src="../image/top_folder.gif" border="0" id="imgLeftFrameButton"><br><?=$lg->topFolder?></td>

    <td id="setLeftBottomButton" OnClick="parent.left_bottom.setLeftBottomFrame()"   style="word-break:break-all"  nowrap align=center valign=middle width=50>
	<img src="../image/top_image.gif" border="0" id="imgLeftBottomButton"><br><?=$lg->topImage?></td>

    <td id="setLeftBottomButton" OnClick="setImgViewerButton()"   style="word-break:break-all"  nowrap valign=middle  align=center width=50>
	<img src="../image/top_image_mode.gif" border="0" id="imgViewerButton"><br><?=$lg->topImageViewer?></td>

    <td id="setPrintButton" OnClick="setPrint()"   style="word-break:break-all"  nowrap valign=middle align=center width=50>
	<img src="../image/top_print.gif" border="0"><br><?=$lg->topPrint?></td>

    <td width=20 align=center><span class="separatorIn30"></span></td>

    <td id="setConfigButton"   style="word-break:break-all"  nowrap valign=middle align=center width=60 OnClick="configWin('config_init', -1, -1, false)">
	<img src="../image/top_config.gif" border="0"><br><?=$lg->topSetting?></td>

    <td id="setSearchButton"   style="word-break:break-all"  nowrap valign=middle align=center width=60 OnClick="searchWin()">
	<img src="../image/top_search.gif" border="0"><br><?=$lg->topSearch?></td>

    <td width=20 align=center><span class="separatorIn30"></span></td>

    <td id="setEmailButton"   style="word-break:break-all"  nowrap valign=middle align=center width=50>
	<a href="mailto:<?=$dcfg->pgEmail?>?subject=[<?=$dcfg->pgName?> <?=$dcfg->pgInfo?>]" title="E-mail"><img src="../image/top_email.gif" border="0"></a><br>
    <a href="mailto:<?=$dcfg->pgEmail?>">E-mail</a></td>

    <td id="aboutButton" OnClick="msgWin('about', 350, 230, true)"   style="word-break:break-all"  nowrap valign=middle align=center width=50>
	<img src="../image/top_nsl.gif" border="0"><br><?=$lg->topAbout?></td>

    <td id="goExitButton" OnClick="goExit()"   style="word-break:break-all"  nowrap valign=middle align=center width=50>
	<img src="../image/top_exit.gif" border="0"><br><?=$lg->topExit?></td>
    <td align=right></td>
  </tr>
  </table>

    </td>
    <td width=* >&nbsp;</td>
    <td width=110 align=center><img src="../image/logo.jpg" width="100" height="45" border="0" align="absmiddle"></td>
    </td>
  </tr>
  </table>

  </fieldset>


  </td>
</tr>
<tr>
  <td>

<script language="javascript" src="<?=$_SKYDIR_URL?>common/js/sky_digital_watch.js"></script>
  	<table border=0 cellpadding=2 cellspacing=0 width=100%>
	<tr>
	  <td width=18><a href="javascript:topClick('')" title="Home"><img src='../image/folder.png' width=16 height=16 align='absmiddle' border='0'></a>&nbsp;</td>
      <td><div id=topDirPos></div></td>
      <td align=right width=200>
      <div id="digitalW"></div></td>
      <td width=10></td>
	</tr>
	</table>

  </td>
</tr>
</table>

</fieldset>

<?
// 다른 프레임에서 참조할 수 있도록 현재 절대경로 위치를 .. ?>
<form name=topurl method=post action=>
<input type=hidden name=cd value='<?=$cd?>'>
</form>
<script language="javascript">
<!--

if (isExplorer)
digitalWatch();
//-->
</script>
</body>
</html>

<script type="text/javascript">
<!--

if (isExplorer) {

var table = document.getElementById("topMenuTable");
for (var i = 0; i < table.rows[0].cells.length; i++) {

	createButton(table.rows[0].cells[i]);
}
table.rows[0].cells[2].setToggle(true);
table.rows[0].cells[3].setToggle(true);
table.rows[0].cells[4].setToggle(true);
}
//-->
</script>

