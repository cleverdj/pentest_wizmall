<?php
/**
* 환경설정 > 배경이미지
*
* @filename : php/config_background.php
* @version  : v 1.0 2003.03.20 17:40
* @author   : nsl <smpoem@magicn.com>
*
* @see
*    - configwin.php
*/

// 배경이미지 리스크
list( , $bgListTemp) =  SkyFile::getCurDirList("../" . $dcfg->bgImageDir);

foreach ($bgListTemp AS $qKey => $qVal) {

    // 이미지 일 경우만
    if ( isViewImg(substr(strrchr($qVal,'.'), 1)) ) {

        $bgList[] = $qVal;
    
       //^^^^^^^^^^^^^^^^^^^^^ 배경이미지 미리 불러오기 부분 ^^^^^^^^^^^^^^^^^^^^

       $fileTemp = '../' . $dcfg->bgImageDir . '/' . $qVal;

       // 이미지 파일의 크기 총합 누적
       $filesizeImgTotal += filesize($fileTemp);

       //    현재파일크기 합 < 이미지 미리불어오기 총 제한 크기
       if ($filesizeImgTotal < $rcfg->imgReloadMaxSizeReal) {

           $fileImageReload[] = $fileTemp;
       }
       //^^^^^^^^^^^^^^^^^^^^^ /배경이미지 미리 불러오기 부분 ^^^^^^^^^^^^^^^^^^^^

    } // if End
} // foreach End

// 반복지정 옵션
$bgRepeatMenu = array('no-repeat'  => $lg->configBackgroundNorepeat,
                      'repeat'     => $lg->configBackgroundHorVer,
                      'repeat-x'   => $lg->configBackgroundHorizontal,
                      'repeat-y'   => $lg->configBackgroundVertical);

// 정렬 옵션
$bgPosMenu = array('center'        => $lg->configBackgroundCenter,
                   'top center'    => $lg->configBackgroundTopCenter,
                   'bottom center' => $lg->configBackgroundBottomCenter,
                   'left center'   => $lg->configBackgroundLeftCetner,
                   'right cetner'  => $lg->configBackgroundRightCenter);

$bgOpacityMenu = SkyHtml::getNumberList(1, 100, 1, '', true);



?>
<table style="border-width:0; border-color:white; border-style:solid;" border="1" width="100%" height="100%" bordercolordark="white" bordercolorlight="#333333" cellpadding=10>
<tr>

<td valign=top>

   <fieldset style="padding:5pt; width=95%" align=center>
    <legend><?=$lg->configBackground?></legend> 


      <script language="javascript">
      <!--

          function inputCheck() {

          }
        //-->
       </script>
      <table border=0 cellpadding=0 cellspacing=0 valign=middle style="line-height:105%; margin-top:5px" width=100%>
      <tr>

      <form name=input method=post action="../php/uconfig_save.php" OnSubmit="return inputCheck()">
      <input type=hidden name=url value="<?=$_SERVER['PHP_SELF']?>">
      <input type=hidden name=wmode value="<?=$wmode?>">
      <input type=hidden name=code value="<?=$code?>">
      <input type=hidden name=fcode value="<?=$fcode?>">
      <input type=hidden name=apply value="">

        <td colspan=2>
        
        <table border=0>
          <tr>
            <td width=40><img src="../image/config_bk.gif"></td>
            <td valign=top><?=$lg->configBackgroundMsg?></td>
          </tr>
        </table>            
          
          </td>
      </tr>     
      <tr>
        <td height=15 colspan=2></td>
      </tr>      
      <tr>
        <td>


      <table border=0 cellpadding=0 cellspacing=0 width=100%>
      <tr>
        <td height=30 width=120><?=$lg->configBackgroundImage?></td>
        <td width=220>

        <table border=0 cellpadding=0 cellspacing=0 width=100%>
        <tr>
          <td>
         <?=SkyHtml::setSelectMenu('bg', $bgList, $bgList, $rcfg->rightBgImage, " OnChange='setApplyBut();imgPreview()'", '', ":: $lg->configBackgroundSelect ::")?>
          </td>
        </table>

        </td>
      </tr>
      <tr>
        <td height=30 width=120><?=$lg->configBackgroundRepeat?></td>
        <td>

        <table border=0 cellpadding=0 cellspacing=0 width=100%>
        <tr>
          <td>
         <?=SkyHtml::setSelectMenuKey('repeat', $bgRepeatMenu, $rcfg->rightBgImageRepeat, ' OnChange=setApplyBut() ', '', ":: $lg->configBackgroundSelect ::")?>
          </td>
        </table>

        </td>
      </tr>
      <tr>
        <td height=30 width=120><?=$lg->configBackgroundPosition?></td>
        <td>

        <table border=0 cellpadding=0 cellspacing=0 width=100%>
        <tr>
          <td>
         <?=SkyHtml::setSelectMenuKey('pos', $bgPosMenu, $rcfg->rightBgImagePos, ' OnChange=setApplyBut() ', '', ":: $lg->configBackgroundSelect ::")?>
          </td>
        </table>

        </td>
      </tr>
      <tr>
        <td height=30 width=120><?=$lg->configBackgroundOpacity?></td>
        <td>

        <table border=0 cellpadding=0 cellspacing=0 width=100%>
        <tr>
          <td>
         <?=SkyHtml::setSelectMenuKey('opacity', $bgOpacityMenu, $rcfg->rightBgImageOpacity, ' OnChange=setApplyBut() ', '', ":: $lg->configBackgroundSelect ::")?>
          </td>
        </table>

        </td>
      </tr>
      </table>

      </td>
      <td width=170>


      <!-- 이미지 미리보기 -->
      <table border=0 cellpadding=0 cellspacing=0 width=98% align=center>
      <tr>
        <td align=center>
        <a href="javascript:imgViewWin()"><img name=preview src="<?=$dcfg->spaceImg?>" align=absmiddle border=0></a></td>
      </tr>
      <tr>
        <td height=5></td>
      </tr>
      <tr>
        <td align=center><div id=previewInfoSize></div></td>
      </tr>
      </table>


       </td>
      <tr>
        <td height=20 colspan=2></td>
      </tr>
      <tr>
        <td height=20 colspan=2>

            <table border=0 style="line-height:110%">
            <tr>
              <td width=20 valign=top><img src="../image/config_help16.gif" align=absmiddle><td>
              <td valign=top>
               <?=$lg->configBackgroundHelp?>
               </td>
            </tr>
            </table>

        </td>
      </tr>
      <tr>
        <td height=15 colspan=2></td>
      </tr>
      </table>

     </fieldset>
</td>
</tr>
</table>
<script language="javascript" src="<?=$_SKYDIR_URL?>common/js/sky_imgsize.js"></script>
<script language="javascript">
<!--

    
     // 배경 이미지 미리보기 부분
     
    imgViewWidth = 150
    imgViewHeight = 150;
    imgViewSrc = '';


    // 왼쪽하단 이미지 미리보기
    function imgPreview() {

       var no =  document.input.bg.selectedIndex - 1;

       if (no >= 0) {

           var imgNameX = myimages[no].src;

           var leftWidth  =  150;
           var leftHeight = 150;

            // width 기준으로만 정렬한다
            widthMax  = leftWidth - 20;
            heightMax = leftHeight - 20;

            tempImg = new Image();
            tempImg.src = imgNameX;

            // 창크기에 맞는 이미지 크기 구함
            getImageSize(tempImg.width,tempImg.height);

            // 실제 크기로 보기를 위한 크기 설정
            imgViewWidth   = tempImg.width;
            imgViewHeight  = tempImg.height;
            imgViewSrc = imgNameX;

    	   if (newImageWidth == 0 || newImageHeight == 0 ){

    	       newImageWidth  = 100;
          	   newImageHeight = 100;
    	    }

            document.preview.src = imgNameX;
            document.preview.width = newImageWidth;
            document.preview.height = newImageHeight;

            // 이미지 정보 전달
            previewInfoSize.innerHTML = "&nbsp;&nbsp; " + imgViewWidth + 'x' + imgViewHeight;
       } else {

            document.preview.src = '<?=$dcfg->spaceImg?>';
            document.preview.width = 1;
            document.preview.height = 1;

            // 이미지 정보 전달
            previewInfoSize.innerHTML = "&nbsp;&nbsp; ";
       }
    }

    // 이미지 실제 크기로 보기    
    function imgViewWin() {

        var width;
        var height;
        var scrollbars = 'no';

        width = imgViewWidth;
        height = imgViewHeight;

        if ( width > (screen.width - 20))  {
            
            width  = screen.width  - 40;
            scrollbars = 'yes';
        }

        if ( height > (screen.height - 20)) { 
            
            height = screen.height - 80;
            scrollbars = 'yes';
        }

        var option = 'left=10, top=10, width=' + width + ', height=' + height + ', scrollbars=' + scrollbars + ', resizable=yes';
    	var url = '../php/imgview.php?file=' + imgViewSrc;

    	window.open( url, '', option );

    }


    var myimages = new Array();
    
    function preloadImages() { 

        for (i=0; i < preloadImages.arguments.length; i++) {  

            myimages[i] = new Image();
            myimages[i].src = preloadImages.arguments[i] 
        } 
    } 
    
<?
    for ($z = 0; $z < count($fileImageReload); $z++) {

        $imgList .= "'" . $fileImageReload[$z] . "', ";

        if ($z > $rcfg->imgReloadMax) break;
    }
        $imgList .= "''";

?>
    preloadImages(<?=$imgList?>);

imgPreview();
//-->
</script>
